(function(t){function e(e){var n=e[0];var r=e[1];var l=e[2];var s,u,m=0,d=[];for(;m<n.length;m++){u=n[m];if(a[u]){d.push(a[u][0])}a[u]=0}for(s in r){if(Object.prototype.hasOwnProperty.call(r,s)){t[s]=r[s]}}if(c)c(e);while(d.length){d.shift()()}o.push.apply(o,l||[]);return i()}function i(){var t;for(var e=0;e<o.length;e++){var i=o[e];var n=true;for(var l=1;l<i.length;l++){var s=i[l];if(a[s]!==0)n=false}if(n){o.splice(e--,1);t=r(r.s=i[0])}}return t}var n={};var a={2:0};var o=[];function r(e){if(n[e]){return n[e].exports}var i=n[e]={i:e,l:false,exports:{}};t[e].call(i.exports,i,i.exports,r);i.l=true;return i.exports}r.m=t;r.c=n;r.d=function(t,e,i){if(!r.o(t,e)){Object.defineProperty(t,e,{configurable:false,enumerable:true,get:i})}};r.r=function(t){Object.defineProperty(t,"__esModule",{value:true})};r.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};r.d(e,"a",e);return e};r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};r.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[];var s=l.push.bind(l);l.push=e;l=l.slice();for(var u=0;u<l.length;u++)e(l[u]);var c=s;o.push([343,0]);return i()})({337:function(t,e,i){"use strict";i.r(e);var n=i(471);var a=i(19);var o=i(26);var r=i(17);var l=i(35);var s=i(2);var u=i(132);var c=i(223);var m={};m.Permalink3dParam={ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"};var d=m;var f=i(261);function h(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var g=function(){t.$inject=["ngeoDebounce","ngeoLocation","ngeoStateManager"];function t(e,i,n){h(this,t);this.manager_;this.ngeoDebounce_=e;this.ngeoLocation_=i;this.ngeoStateManager_=n}t.prototype.initialize=function t(e){var i=this;this.manager_=e;this.manager_.on("load",function(){i.cameraToState_()});if(this.ngeoStateManager_.getInitialBooleanValue("3d_enabled")){this.initialStateToCamera_()}};t.prototype.getManager=function t(){return this.manager_};t.prototype.initialStateToCamera_=function t(){var e=this.ngeoStateManager_;var i=e.getInitialNumberValue(d.Permalink3dParam.LON);var n=e.getInitialNumberValue(d.Permalink3dParam.LAT);var a=e.getInitialNumberValue(d.Permalink3dParam.ELEVATION);var o=e.getInitialNumberValue(d.Permalink3dParam.HEADING)||0;var r=e.getInitialNumberValue(d.Permalink3dParam.PITCH)||0;s["a"].assert(i!==undefined);s["a"].assert(n!==undefined);s["a"].assert(a!==undefined);return this.manager_.set3dWithView(i,n,a,o,r)};t.prototype.cameraToState_=function t(){var e=this;var i=this.manager_;var n=i.getOl3d().getCesiumScene();var a=n.camera;a.moveEnd.addEventListener(this.ngeoDebounce_(function(){var t;var i=a.positionCartographic;e.ngeoStateManager_.updateState((t={},t[d.Permalink3dParam.ENABLED]=true,t[d.Permalink3dParam.LON]=Cesium.Math.toDegrees(i.longitude).toFixed(5),t[d.Permalink3dParam.LAT]=Cesium.Math.toDegrees(i.latitude).toFixed(5),t[d.Permalink3dParam.ELEVATION]=i.height.toFixed(0),t[d.Permalink3dParam.HEADING]=Cesium.Math.toDegrees(a.heading).toFixed(3),t[d.Permalink3dParam.PITCH]=Cesium.Math.toDegrees(a.pitch).toFixed(3),t))},1e3,true));this.manager_.on("toggle",function(t){if(!t.target.is3dEnabled()){e.remove3dState_()}})};t.prototype.remove3dState_=function t(){var e=this;this.ngeoLocation_.getParamKeysWithPrefix(d.Permalink3dParam.PREFIX).forEach(function(t){e.ngeoStateManager_.deleteParam(t)})};return t}();var v="ngeoOlcsService";g.module=angular.module(v,[u["a"].name,c["a"].module.name,f["a"].module.name]).service(v,g);var p=g;var _=p;var b=i(70);var y=i(71);w.$inject=["$attrs","ngeoOlcsControls3dTemplateUrl"];function E(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var P=angular.module("ngeoOlcsControls3d",[]);function C(t,e){return Number.isFinite(e)&&(!Number.isFinite(t)||Math.abs(e-t)>.05)}var T=function(){t.$inject=["$element","ngeoOlcsService"];function t(e,i){E(this,t);this.element_=e;this.ol3dm;this.minTilt;this.maxTilt;this.tiltRightEl_;this.tiltLeftEl_;this.rotation3dEl_;this.angle3dEl_;this.previousRotation_;this.previousViewMatrix_;this.animationFrameRequestId_;this.olcsService_=i}t.prototype.updateWidget_=function t(){var e=this;var i=this.ol3dm.getOl3d().getOlView().getRotation();if(C(this.previousRotation_,i)){this.rotateElement_(this.rotation3dEl_,i);this.previousRotation_=i}var n=this.ol3dm.getCesiumViewMatrix();if(!Cesium.Matrix4.equalsEpsilon(this.previousViewMatrix_,n,1e-5)){var a=this.ol3dm.getTiltOnGlobe();if(Number.isFinite(a||0)){this.rotateElement_(this.angle3dEl_,a);this.previousViewMatrix_=Cesium.Matrix4.clone(n);var o=.01;if(a-this.minTilt<o){this.tiltRightEl_.addClass("ngeo-right-inactive")}else if(this.tiltRightEl_.hasClass("ngeo-right-inactive")){this.tiltRightEl_.removeClass("ngeo-right-inactive")}if(this.maxTilt-a<o){this.tiltLeftEl_.addClass("ngeo-left-inactive")}else if(this.tiltLeftEl_.hasClass("ngeo-left-inactive")){this.tiltLeftEl_.removeClass("ngeo-left-inactive")}}}this.animationFrameRequestId_=requestAnimationFrame(function(){return e.updateWidget_()})};t.prototype.$onDestroy=function t(){if(this.animationFrameRequestId_){cancelAnimationFrame(this.animationFrameRequestId_)}};t.prototype.$onInit=function t(){if(this.minTilt===undefined){this.minTilt=0}if(this.maxTilt===undefined){this.maxTilt=7*Math.PI/16}if(!this.ol3dm){this.ol3dm=s["a"].assert(this.olcsService_.getManager())}this.tiltRightEl_=this.element_.find(".ngeo-tilt-right");this.tiltLeftEl_=this.element_.find(".ngeo-tilt-left");this.rotation3dEl_=this.element_.find(".ngeo-rotation3d");this.angle3dEl_=this.element_.find(".ngeo-angle3d");this.updateWidget_()};t.prototype.rotateElement_=function t(e,i){var n="rotate("+i+"rad)";e.css({"-moz-transform":n,"-webkit-transform":n,"-o-transform":n,"-ms-transform":n,transform:n})};t.prototype.rotate=function t(e){e=Cesium.Math.toRadians(e);this.ol3dm.setHeading(e)};t.prototype.tilt=function t(e){e=Cesium.Math.toRadians(e);var i=this.ol3dm.getTiltOnGlobe();if(i+e<this.minTilt){e=this.minTilt-i}else if(i+e>this.maxTilt){e=this.maxTilt-i}var n=this.ol3dm.getCesiumScene();y["a"].rotateAroundBottomCenter(n,e)};t.prototype.zoom=function t(e){var i=this.ol3dm.getOlView();var n=i.getResolution();var a=i.constrainResolution(n,e);if(i.getAnimating()){i.cancelAnimations()}i.animate({resolution:a,duration:250,easing:b["b"]})};return t}();function w(t,e){if(e){return e}var i=t["ngeoOlcsControls3dTemplateUrl"];return i?i:"ngeo/olsc/controls3d"}P.run(["$templateCache",function(t){t.put("ngeo/olsc/controls3d",i(342))}]);var O={bindings:{minTilt:"<?",maxTilt:"<?",ol3dm:"<?"},controller:T,templateUrl:w};P.component("ngeoOlcsControls3d",O);P.value("ngeoOlcsControls3dTemplateUrl","");var M=P;var S=angular.module("ngeoOlcsModule",[M.name,_.module.name]);var x=S;var I=x;var k=i(23);var L=i(318);var R=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function N(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}function $(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&((typeof e==="undefined"?"undefined":R(e))==="object"||typeof e==="function")?e:t}function A(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof e==="undefined"?"undefined":R(e)))}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e}var F=function(t){A(e,t);function e(i,n,a){N(this,e);var o=$(this,t.call(this,i,a));o.rootScope_=n;return o}e.prototype.toggle3d=function e(){var i=this;var n=t.prototype.toggle3d.call(this);return n.then(function(){i.rootScope_.$apply()})};return e}(L["a"]);var V=F;var j={};j.module=angular.module("app",["gettext",k["a"].name,I.name]);j.MainController=function(t,e){this.map=new a["a"]({layers:[new r["a"]({source:new l["b"]})],view:new o["a"]({center:[0,0],zoom:4})});var i="../node_modules/@camptocamp/cesium/Build/Cesium/Cesium.js";this.ol3dm=new V(i,t,{map:this.map});e.initialize(this.ol3dm)};j.MainController.$inject=["$rootScope","ngeoOlcsService"];j.module.controller("MainController",j.MainController);var D=e["default"]=j},342:function(t,e){t.exports='<div class=ngeo-tools> <div class=ngeo-angle><div class=ngeo-angle3d></div></div> <button class="ngeo-left ngeo-tilt-left" ng-click=$ctrl.tilt(5)></button> <button class="ngeo-right ngeo-tilt-right" ng-click=$ctrl.tilt(-5)></button> </div> <div class=ngeo-zoom> <button class=ol-zoom-in ng-click=$ctrl.zoom(1)></button> <button class=ol-zoom-out ng-click=$ctrl.zoom(-1)></button> </div> <div class=ngeo-tools> <div class=ngeo-rotation><div class=ngeo-rotation3d></div></div> <button class=ngeo-left ng-click=$ctrl.rotate(-15)></button> <button class=ngeo-right ng-click=$ctrl.rotate(15)></button> </div> '},343:function(t,e,i){i(53);i(55);t.exports=i(337)},471:function(t,e){}});
//# sourceMappingURL=simple3d.24e59a.js.map