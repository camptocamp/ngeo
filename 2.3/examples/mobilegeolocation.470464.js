(function(e){function t(t){var a=t[0];var n=t[1];var l=t[2];var s,c,h=0,g=[];for(;h<a.length;h++){c=a[h];if(r[c]){g.push(r[c][0])}r[c]=0}for(s in n){if(Object.prototype.hasOwnProperty.call(n,s)){e[s]=n[s]}}if(u)u(t);while(g.length){g.shift()()}i.push.apply(i,l||[]);return o()}function o(){var e;for(var t=0;t<i.length;t++){var o=i[t];var a=true;for(var l=1;l<o.length;l++){var s=o[l];if(r[s]!==0)a=false}if(a){i.splice(t--,1);e=n(n.s=o[0])}}return e}var a={};var r={17:0};var i=[];function n(t){if(a[t]){return a[t].exports}var o=a[t]={i:t,l:false,exports:{}};e[t].call(o.exports,o,o.exports,n);o.l=true;return o.exports}n.m=e;n.c=a;n.d=function(e,t,o){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:o})}};n.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[];var s=l.push.bind(l);l.push=t;l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;i.push([375,0]);return o()})({331:function(e,t,o){"use strict";o.r(t);var a=o(489);var r=o(19);var i=o(26);var n=o(17);var l=o(35);var s=o(79);var c=o(13);var u=o(41);var h=o(42);var g=o(23);var f=o(2);var v=o(162);var p=o(222);var _=o(70);var d=o(3);var w=o(14);var y=o(250);var m=o(32);var b=angular.module("ngeoMobileGeolocation",[v["a"].module.name,p["a"].module.name]);b.GeolocationEventType={ERROR:"mobile-geolocation-error"};b.directive_=function(){return{restrict:"A",scope:{getMobileMapFn:"&ngeoMobileGeolocationMap",getMobileGeolocationOptionsFn:"&ngeoMobileGeolocationOptions"},controller:"ngeoGeolocationMobileController"}};b.directive("ngeoMobileGeolocation",b.directive_);b.Controller_=function(e,t,o,a,i){var n=this;t.on("click",this.toggleTracking.bind(this));var l=e["getMobileMapFn"]();f["a"].assertInstanceof(l,r["a"]);this.$scope_=e;this.map_=l;var s=e["getMobileGeolocationOptionsFn"]()||{};f["a"].assertObject(s);this.notification_=i;this.featureOverlay_=a.getFeatureOverlay();this.geolocation_=new y["a"]({projection:l.getView().getProjection(),trackingOptions:{enableHighAccuracy:true}});if(s.autorotate){this.autorotateListener()}this.geolocation_.on("error",function(t){n.untrack_();var a=void 0;switch(t.code){case 1:a=o.getString("User denied the request for Geolocation.");break;case 2:a=o.getString("Location information is unavailable.");break;case 3:a=o.getString("The request to get user location timed out.");break;default:a=o.getString("Geolocation: An unknown error occurred.");break}n.notification_.error(a);e.$emit(b.GeolocationEventType.ERROR,t)});this.positionFeature_=new w["a"];if(s.positionFeatureStyle){this.positionFeature_.setStyle(s.positionFeatureStyle)}this.accuracyFeature_=new w["a"];if(s.accuracyFeatureStyle){this.accuracyFeature_.setStyle(s.accuracyFeatureStyle)}this.zoom_=s.zoom;this.follow_=false;this.viewChangedByMe_=false;d["a"](this.geolocation_,"change:accuracyGeometry",function(){n.accuracyFeature_.setGeometry(n.geolocation_.getAccuracyGeometry());n.setPosition_()});d["a"](this.geolocation_,"change:position",function(){n.setPosition_()});var c=l.getView();d["a"](c,"change:center",this.handleViewChange_,this);d["a"](c,"change:resolution",this.handleViewChange_,this)};b.Controller_.$inject=["$scope","$element","gettextCatalog","ngeoFeatureOverlayMgr","ngeoNotification"];b.Controller_.prototype.toggleTracking=function(){if(this.geolocation_.getTracking()){var e=this.geolocation_.getPosition();if(e===undefined){this.untrack_();this.$scope_.$emit(b.GeolocationEventType.ERROR,null);return}f["a"].assert(e!==undefined);var t=this.map_.getView().getCenter();var o=Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1]);if(o<2){this.untrack_()}else{this.untrack_();this.track_()}}else{this.track_()}};b.Controller_.prototype.track_=function(){this.featureOverlay_.addFeature(this.positionFeature_);this.featureOverlay_.addFeature(this.accuracyFeature_);this.follow_=true;this.geolocation_.setTracking(true)};b.Controller_.prototype.untrack_=function(){this.featureOverlay_.clear();this.follow_=false;this.geolocation_.setTracking(false);this.notification_.clear()};b.Controller_.prototype.setPosition_=function(){var e=this.geolocation_.getPosition();var t=new m["a"](e);this.positionFeature_.setGeometry(t);var o=this.accuracyFeature_.getGeometry();if(this.follow_){this.viewChangedByMe_=true;if(this.zoom_!==undefined){this.map_.getView().setCenter(e);this.map_.getView().setZoom(this.zoom_)}else if(o){var a=this.map_.getSize();this.map_.getView().fit(o,a)}this.viewChangedByMe_=false}};b.Controller_.prototype.handleViewChange_=function(e){if(this.follow_&&!this.viewChangedByMe_){this.follow_=false}};b.Controller_.prototype.autorotateListener=function(){var e=this;var t=0;if(window.hasOwnProperty("ondeviceorientationabsolute")){window.addEventListener("deviceorientationabsolute",function(o){t=e.handleRotate_(o.alpha,t)},true)}else if(window.hasOwnProperty("ondeviceorientation")){window.addEventListener("deviceorientation",function(o){if(o.webkitCompassHeading){t=e.handleRotate_(-o.webkitCompassHeading,t)}else{t=e.handleRotate_(o.alpha-270,t)}},true)}else{console.error("Orientation is not supported on this device")}};b.Controller_.prototype.handleRotate_=function(e,t){if(this.geolocation_.getTracking()&&Math.abs(e-t)>.2){t=e;var o=t*Math.PI/180;this.map_.getView().animate({rotation:o,duration:350,easing:_["d"]})}return t};b.controller("ngeoGeolocationMobileController",b.Controller_);var M=b;var C={};var k=angular.module("app",["gettext",M.name,g["a"].name]);C.MainController=function(e,t){var o=new c["c"]({image:new s["a"]({radius:6,fill:new u["a"]({color:"rgba(230, 100, 100, 1)"}),stroke:new h["a"]({color:"rgba(230, 40, 40, 1)",width:2})})});var a=new c["c"]({fill:new u["a"]({color:"rgba(100, 100, 230, 0.3)"}),stroke:new h["a"]({color:"rgba(40, 40, 230, 1)",width:2})});this.mobileGeolocationOptions={positionFeatureStyle:o,accuracyFeatureStyle:a,zoom:17,autorotate:true};this.map=new r["a"]({layers:[new n["a"]({source:new l["b"]})],view:new i["a"]({center:[0,0],zoom:4})});t.init(this.map)};C.MainController.$inject=["$scope","ngeoFeatureOverlayMgr"];k.controller("MainController",C.MainController);var O=t["default"]=C},375:function(e,t,o){o(53);o(55);e.exports=o(331)},489:function(e,t){}});
//# sourceMappingURL=mobilegeolocation.470464.js.map