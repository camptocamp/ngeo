(function(e){function t(t){var a=t[0];var n=t[1];var s=t[2];var l,u,f=0,d=[];for(;f<a.length;f++){u=a[f];if(o[u]){d.push(o[u][0])}o[u]=0}for(l in n){if(Object.prototype.hasOwnProperty.call(n,l)){e[l]=n[l]}}if(h)h(t);while(d.length){d.shift()()}i.push.apply(i,s||[]);return r()}function r(){var e;for(var t=0;t<i.length;t++){var r=i[t];var a=true;for(var s=1;s<r.length;s++){var l=r[s];if(o[l]!==0)a=false}if(a){i.splice(t--,1);e=n(n.s=r[0])}}return e}var a={};var o={11:0};var i=[];function n(t){if(a[t]){return a[t].exports}var r=a[t]={i:t,l:false,exports:{}};e[t].call(r.exports,r,r.exports,n);r.l=true;return r.exports}n.m=e;n.c=a;n.d=function(e,t,r){if(!n.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};n.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=s.push.bind(s);s.push=t;s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var h=l;i.push([421,0]);return r()})({420:function(e,t,r){"use strict";r.r(t);var a=r(548);var o=r.n(a);var i=r(2);var n=r(215);var s=r(179);var l=r(23);var u=r(153);var h=r(175);var f={};f.module=angular.module("gmfapp",["gettext",n["a"].module.name,s["a"].module.name,l["a"].module.name]);f.module.value("gmfTreeUrl","https://geomapfish-demo.camptocamp.com/2.3/wsgi/themes?version=2&background=background");f.module.value("gmfLayersUrl","https://geomapfish-demo.camptocamp.com/2.3/wsgi/layers/");f.module.constant("defaultTheme","Demo");f.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js");f.MainController=function(e,t,r,a,o){var n=this;this.http_=e;this.q_=t;this.gmfThemes_=a;this.gmfXSDAttributes_=o;this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}];this.viewerUrlDev_="../apps/oeview/";this.viewerUrlHosted_="apps/oeview/";this.selectedUrl=this.urls[0];this.gmfServers_;this.gmfServer_;this.gmfLayerNodes=[];this.selectedGmfLayerNode=null;this.featuresCache_={};this.features=null;this.selectedFeature=null;this.geomTypeCache_={};this.selectedGeomType=undefined;r.$watch(function(){return n.selectedGmfLayerNode},function(e,t){n.selectedFeature=null;if(e){n.getFeatures_(e).then(n.handleGetFeatures_.bind(n,e));n.getGeometryType_(e).then(n.handleGetGeometryType_.bind(n,e))}});this.themeName="ObjectEditing";this.gmfThemes_.loadThemes();this.gmfThemes_.getOgcServersObject().then(function(e){n.gmfServers_=e;n.gmfThemes_.getThemesObject().then(function(e){if(!e){return}var t=void 0,r=void 0;var a=void 0;for(t=0,r=e.length;t<r;t++){if(e[t].name===n.themeName){a=e[t];break}}if(!a){return}var o=a.children[0];i["a"].assert(o.ogcServer);var s=n.gmfServers_[o.ogcServer];if(s&&s.wfsSupport===true&&s.urlWfs){n.gmfServer_=s}else{return}var l=[];for(t=0,r=o.children.length;t<r;t++){if(o.children[t].metadata.identifierAttributeField){l.push(o.children[t])}}n.gmfLayerNodes=l;n.selectedGmfLayerNode=n.gmfLayerNodes[1]})})};f.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"];f.MainController.prototype.runEditor=function(){var e=this.selectedGeomType;var t=this.selectedFeature;var r=this.selectedGmfLayerNode.id;var a=this.selectedGmfLayerNode.metadata.identifierAttributeField;i["a"].assert(a!==undefined);var o=t.get(a);var n={};n[s["a"].Param.GEOM_TYPE]=e;n[s["a"].Param.ID]=o;n[s["a"].Param.LAYER]=r;n[s["a"].Param.THEME]=this.themeName;n[s["a"].Param.PROPERTY]=a;var l=f.MainController.appendParams(this.selectedUrl["url"],n);window.open(l)};f.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)};f.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)};f.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode;var r=t.id;var a=t.name;var o=t.metadata.identifierAttributeField;i["a"].assert(o!==undefined);var n=[];var s=this.featuresCache_[r];for(var l=0,u=s.length;l<u;l++){n.push(s[l].get(o))}var h={};h["wfs_layer"]=a;h["wfs_"+o]=n.join(",");var d=f.MainController.appendParams(e,h);window.open(d)};f.MainController.prototype.getFeatures_=function(e){this.getFeaturesDeferred_=this.q_.defer();var t=this.getFeaturesFromCache_(e);if(t){this.getFeaturesDeferred_.resolve()}else{this.issueGetFeatures_(e)}return this.getFeaturesDeferred_.promise};f.MainController.prototype.issueGetFeatures_=function(e){var t=this;var r=e.id;var a=f.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(a).then(function(e){var a=(new u["a"]).readFeatures(e.data);t.featuresCache_[r]=a;t.getFeaturesDeferred_.resolve()})};f.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t;this.selectedFeature=this.features[0]};f.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;var r=this.featuresCache_[t]||null;return r};f.MainController.prototype.getGeometryType_=function(e){this.getGeometryTypeDeferred_=this.q_.defer();var t=this.getGeometryTypeFromCache_(e);if(t){this.getGeometryTypeDeferred_.resolve()}else{this.issueGetAttributesRequest_(e)}return this.getGeometryTypeDeferred_.promise};f.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=h["a"].getGeometryAttribute(t);if(r&&r.geomType){this.geomTypeCache_[e.id]=r.geomType;this.getGeometryTypeDeferred_.resolve()}}.bind(this,e))};f.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t};f.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;var r=this.geomTypeCache_[t];return r};f.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){if(t[e]!==null&&t[e]!==undefined){r.push(e+"="+encodeURIComponent(t[e]))}});var a=r.join("&");e=e.replace(/[?&]$/,"");e=e.indexOf("?")===-1?e+"?":e+"&";return e+a};f.module.controller("MainController",f.MainController);t["default"]=f},421:function(e,t,r){r(74);r(73);e.exports=r(420)},548:function(e,t){}});
//# sourceMappingURL=objecteditinghub.626632.js.map