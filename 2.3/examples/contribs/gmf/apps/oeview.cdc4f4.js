(function(e){function t(t){var a=t[0];var o=t[1];var s=t[2];var l,u,f=0,h=[];for(;f<a.length;f++){u=a[f];if(n[u]){h.push(n[u][0])}n[u]=0}for(l in o){if(Object.prototype.hasOwnProperty.call(o,l)){e[l]=o[l]}}if(c)c(t);while(h.length){h.shift()()}i.push.apply(i,s||[]);return r()}function r(){var e;for(var t=0;t<i.length;t++){var r=i[t];var a=true;for(var s=1;s<r.length;s++){var l=r[s];if(n[l]!==0)a=false}if(a){i.splice(t--,1);e=o(o.s=r[0])}}return e}var a={};var n={1:0};var i=[];function o(t){if(a[t]){return a[t].exports}var r=a[t]={i:t,l:false,exports:{}};e[t].call(r.exports,r,r.exports,o);r.l=true;return r.exports}o.m=e;o.c=a;o.d=function(e,t,r){if(!o.o(e,t)){Object.defineProperty(e,t,{configurable:false,enumerable:true,get:r})}};o.r=function(e){Object.defineProperty(e,"__esModule",{value:true})};o.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};o.d(t,"a",t);return t};o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};o.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=s.push.bind(s);s.push=t;s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;i.push([363,0]);return r()})([,,function(e,t,r){"use strict";var a={};a.assert=function(e,t,r){return e};a.assertNumber=function(e,t,r){return e};a.assertString=function(e,t,r){return e};a.assertFunction=function(e,t,r){return e};a.assertObject=function(e,t,r){return e};a.assertArray=function(e,t,r){return e};a.assertBoolean=function(e,t,r){return e};a.assertElement=function(e,t,r){return e};a.assertInstanceof=function(e,t,r,a){return e};a.assertObjectPrototypeIsIntact=function(){};t["a"]=a},,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a={CIRCLE:"Circle",LINE_STRING:"LineString",MULTI_LINE_STRING:"MultiLineString",MULTI_POINT:"MultiPoint",MULTI_POLYGON:"MultiPolygon",POINT:"Point",POLYGON:"Polygon",RECTANGLE:"Rectangle",TEXT:"Text"};t["a"]=a},,,,,,,function(e,t,r){"use strict";var a={ANGLE:"a",COLOR:"c",IS_CIRCLE:"l",IS_RECTANGLE:"r",IS_TEXT:"t",NAME:"n",SHOW_LABEL:"b",OPACITY:"o",AZIMUT:"z",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"};t["a"]=a},,,,,,,,,,,function(e,t,r){"use strict";var a={BOOLEAN:"boolean",DATE:"date",DATETIME:"datetime",TIME:"time",GEOMETRY:"geometry",NUMBER:"number",SELECT:"select",TEXT:"text"};t["a"]=a},,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(101);var i=r(1);var o=r(7);var s=r(18);var l=r(68);var u=r(93);var c=function e(t,r,a,n,i,o){l["a"].call(this);this.addBlankBackgroundLayer_=true;if(o.addBlankBackgroundLayer!==undefined){this.addBlankBackgroundLayer_=o.addBlankBackgroundLayer}this.$q_=a;this.$http_=t;this.treeUrl_=undefined;if(r.has("gmfTreeUrl")){this.treeUrl_=r.get("gmfTreeUrl")}this.cacheVersion_="0";if(r.has("cacheVersion")){this.cacheVersion_=r.get("cacheVersion")}this.ngeoLocation_=null;if(r.has("ngeoLocation")){this.ngeoLocation_=r.get("ngeoLocation")}this.layerHelper_=n;this.gettextCatalog=i;this.deferred_=a.defer();this.promise_=this.deferred_.promise;this.loaded=false;this.bgLayerPromise_=null};c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"];c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"];i["d"](c,l["a"]);c.findGroupByLayerNodeName=function(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];for(var i=0,o=n.children.length;i<o;i++){var s=n.children[i];var l=[];c.getFlatNodes(s,l);if(c.findObjectByName(l,t)){return s}}}return null};c.findGroupByName=function(e,t){for(var r=0,a=e.length;r<a;r++){var n=e[r];for(var i=0,o=n.children.length;i<o;i++){var s=n.children[i];var l=[];c.getFlatInternalNodes(s,l);if(c.findObjectByName(l,t)){return s}}}return null};c.findObjectByName=function(e,t){return o["d"](e,function(e){return e["name"]===t})};c.findThemeByName=function(e,t){return c.findObjectByName(e,t)};c.getFlatInternalNodes=function(e,t){var r=e.children;if(r!==undefined){t.push(e);for(var a=0;a<r.length;a++){c.getFlatInternalNodes(r[a],t)}}};c.getFlatNodes=function(e,t){var r=void 0;var a=e.children;if(a!==undefined){for(r=0;r<a.length;r++){c.getFlatNodes(a[r],t)}}else{t.push(e)}};c.prototype.getBgLayers=function(){var e=this;var t=this.gettextCatalog;if(this.bgLayerPromise_){return this.bgLayerPromise_}var r=this.$q_;var n=this.layerHelper_;var o=function e(t,r){r.push(i["c"](t));var a=t.children||[];a.forEach(function(t){e(t,r)})};var l=function e(t,r){r.set("label",t.name);r.set("metadata",t.metadata);r.set("dimensions",t.dimensions);var a=[];o(t,a);r.set("querySourceIds",a);return r};var c=function e(t,i){if(i.type==="WMTS"){var o=i;a["a"].assert(o.url,"Layer URL is required");return n.createWMTSLayerFromCapabilitites(o.url,o.layer||"",o.matrixSet,i.dimensions,o.metadata.customOpenLayersOptions).then(l.bind(null,i)).then(null,function(e){var t='Unable to build layer "'+o.layer+'" from WMTSCapabilities: '+o.url+"\n";t+='OpenLayers error is "'+e["message"];console.error(t);return r.resolve(undefined)})}else if(i.type==="WMS"){var s=i;a["a"].assert(s.ogcServer,"An OGC server is required");var u=t[s.ogcServer];a["a"].assert(u,"The OGC server was not found");a["a"].assert(u.url,"The server URL is required");a["a"].assert(u.imageType,"The server image type is required");var c={STYLES:s.styles};if(i.dimensions){for(var f=Object.entries(i.dimensions),h=Array.isArray(f),p=0,f=h?f:f[Symbol.iterator]();;){var d;if(h){if(p>=f.length)break;d=f[p++]}else{p=f.next();if(p.done)break;d=p.value}var g=d;var m=g[0];var v=g[1];c[m]=v}}return l(i,n.createBasicWMSLayer(u.url,s.layers||"",u.imageType,u.type,undefined,c,u.credential?"use-credentials":"anonymous",s.metadata.customOpenLayersOptions))}a["a"].fail("Unsupported type: "+i.type)};var f=function e(t,a){var i=a.children.map(function(e){return e}).reverse();var o=i.map(c.bind(null,t));return r.all(o).then(function(e){var t=void 0;if(e){e=e.filter(function(e){return e});t=new s["b"](e)}var r=n.createBasicGroup(t);l(a,r);return r})};var h=function(e){var t=e.background_layers.map(function(t){var r=t.type;if(r==="WMTS"||r==="WMS"){return c(e.ogcServers,t)}else if(t.children){return f(e.ogcServers,t)}else{return undefined}},this);return r.all(t)}.bind(this);this.bgLayerPromise_=this.promise_.then(h).then(function(r){var a=[];if(e.addBlankBackgroundLayer_){t.getString("blank");a.push(new u["a"]({label:"blank",metadata:{thumbnail:""}}))}r.forEach(function(e){if(e){a.push(e)}});return a});return this.bgLayerPromise_};c.prototype.getThemeObject=function(e){return this.promise_.then(function(t){return c.findThemeByName(t.themes,e)})};c.prototype.getThemesObject=function(){return this.promise_.then(function(e){return e.themes})};c.prototype.getBackgroundLayersObject=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(function(e){return e.background_layers})};c.prototype.getOgcServersObject=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(function(e){return e.ogcServers})};c.prototype.hasEditableLayers=function(){a["a"].assert(this.promise_!==null);return this.promise_.then(this.hasEditableLayers_.bind(this))};c.prototype.hasEditableLayers_=function(e){var t=this;return e.themes.some(function(e){var r=e.children.some(t.hasNodeEditableLayers_.bind(t));return r})};c.prototype.hasNodeEditableLayers_=function(e){if(e.editable){return true}var t=false;var r=e.children;if(r&&r.length){t=r.some(this.hasNodeEditableLayers_.bind(this))}return t};c.getSnappingConfig=function(e){var t=e.metadata&&e.metadata.snappingConfig!==undefined?e.metadata.snappingConfig:null;return t};c.getNodeMaxResolution=function(e){var t=e.metadata;var r=e.maxResolutionHint;if(r===undefined&&t!==undefined){r=t.maxResolution}return r};c.getNodeMinResolution=function(e){var t=e.metadata;var r=e.minResolutionHint;if(r===undefined&&t!==undefined){r=t.minResolution}return r};c.prototype.loadThemes=function(e){var t=this;a["a"].assert(this.treeUrl_,"gmfTreeUrl should be defined.");if(this.loaded){this.deferred_=this.$q_.defer();this.promise_=this.deferred_.promise;this.bgLayerPromise_=null;this.loaded=false}this.$http_.get(this.treeUrl_,{params:e!==undefined?{role:e,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_},cache:false,withCredentials:true}).then(function(e){if(e.data.errors.length!=0){var r="The themes contain some errors:\n"+e.data.errors.join("\n");console.error(r);if(t.ngeoLocation_!==null&&t.ngeoLocation_.hasParam("debug")){window.alert(r)}}t.deferred_.resolve(e.data);t.dispatchEvent("change");t.loaded=true},function(e){t.deferred_.reject(e)})};c.NodeType={MIXED_GROUP:"MixedGroup",NOT_MIXED_GROUP:"NotMixedGroup",WMTS:"WMTS",WMS:"WMS"};c.module=angular.module("gmfThemes",[n["a"].module.name]);c.module.value("gmfThemesOptions",{});c.module.service("gmfThemes",c);t["a"]=c},function(e,t,r){"use strict";var a=r(2);var n=r(3);var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function e(t){o(this,e);this.active_=t.active===true;this.expression=t.expression!==undefined?t.expression:null;this.lowerBoundary_=t.lowerBoundary!==undefined?t.lowerBoundary:null;this.operator_=t.operator||null;this.upperBoundary_=t.upperBoundary!==undefined?t.upperBoundary:null;this.isCustom_=t.isCustom!==false;this.name_=t.name;this.operators_=t.operators||null;this.propertyName_=t.propertyName;this.type_=a["a"].assert(t.type);this.listenerKeys=[]}e.prototype.getExpression=function e(){return this.expression};e.prototype.setExpression=function e(t){this.expression=t};e.prototype.reset=function e(){if(this.getExpression()!==null){this.setExpression(null)}if(this.lowerBoundary!==null){this.lowerBoundary=null}if(this.upperBoundary!==null){this.upperBoundary=null}};e.prototype.destroy=function e(){this.listenerKeys.forEach(n["e"]);this.listenerKeys.length=0};i(e,[{key:"active",get:function e(){return this.active_},set:function e(t){this.active_=t}},{key:"lowerBoundary",get:function e(){return this.lowerBoundary_},set:function e(t){this.lowerBoundary_=t}},{key:"operator",get:function e(){return this.operator_},set:function e(t){this.operator_=t}},{key:"upperBoundary",get:function e(){return this.upperBoundary_},set:function e(t){this.upperBoundary_=t}},{key:"isCustom",get:function e(){return this.isCustom_}},{key:"name",get:function e(){return this.name_}},{key:"operators",get:function e(){return this.operators_}},{key:"propertyName",get:function e(){return this.propertyName_}},{key:"type",get:function e(){return this.type_}},{key:"value",get:function t(){var r=null;var a=this.getExpression();var n=this.lowerBoundary;var i=this.operator;var o=this.propertyName;var s=this.upperBoundary;if(i){if(i===e.OperatorType.BETWEEN||i===e.TemporalOperatorType.DURING){if(n!==null&&s!==null){r={operator:i,lowerBoundary:n,propertyName:o,upperBoundary:s}}}else{if(a!==null){r={expression:a,operator:i,propertyName:o}}}}return r}}]);return e}();s.OperatorType={BETWEEN:"..",EQUAL_TO:"=",GREATER_THAN:">",GREATER_THAN_OR_EQUAL_TO:">=",LESSER_THAN:"<",LESSER_THAN_OR_EQUAL_TO:"<=",LIKE:"~",NOT_EQUAL_TO:"!="};s.SpatialOperatorType={CONTAINS:"contains",INTERSECTS:"intersects",WITHIN:"within"};s.TemporalOperatorType={BEGINS:"time_start",DURING:"time_during",ENDS:"time_end",EQUALS:"time_equal"};t["a"]=s},function(e,t,r){"use strict";var a={};a.DATALAYERGROUP_NAME="data";a.EXTERNALLAYERGROUP_NAME="external";a.COORDINATES_LAYER_NAME="gmfCoordinatesLayerName";a.PermalinkParam={BG_LAYER:"baselayer_ref",BG_LAYER_OPACITY:"baselayer_opacity",EXTERNAL_DATASOURCES_NAMES:"eds_n",EXTERNAL_DATASOURCES_URLS:"eds_u",FEATURES:"rl_features",MAP_CROSSHAIR:"map_crosshair",MAP_TOOLTIP:"map_tooltip",MAP_X:"map_x",MAP_Y:"map_y",MAP_Z:"map_zoom",TREE_GROUPS:"tree_groups",WFS_LAYER:"wfs_layer",WFS_NGROUPS:"wfs_ngroups",WFS_SHOW_FEATURES:"wfs_showFeatures"};t["a"]=a},,function(e,t,r){"use strict";var a=r(2);var n=r(180);var i=r(160);var o=r(38);var s=r(213);var l=r(174);var u=r(155);var c=r(362);var f=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var g=function(e){d(t,e);function t(r){h(this,t);var n=p(this,e.call(this,r));n.dimensionsConfig_=r.dimensionsConfig||null;n.dimensionsFiltersConfig_=r.dimensionsFiltersConfig||null;n.filterCondition_=r.filterCondition||i["a"].AND;n.filterRules_=r.filterRules||null;n.filtrable_=r.filtrable||null;n.copyable_=r.copyable===true;n.dimensions_=r.dimensions||null;n.geometryName_=r.geometryName||t.DEFAULT_GEOMETRY_NAME_;n.ogcImageType_=r.ogcImageType||"image/png";n.ogcLayers_=r.ogcLayers||null;n.ogcServerType_=r.ogcServerType||t.ServerType.MAPSERVER;n.ogcType_=r.ogcType||t.Type.WMS;n.snappable_=r.snappable===true;n.snappingToEdges_=r.snappingToEdges!==false;n.snappingToVertice_=r.snappingToVertice!==false;n.snappingTolerance_=r.snappingTolerance!==undefined?r.snappingTolerance:10;n.timeAttributeName_=r.timeAttributeName;n.timeLowerValue_=r.timeLowerValue;n.timeProperty_=r.timeProperty!==undefined?r.timeProperty:null;n.timeUpperValue_=r.timeUpperValue;n.wfsFeatureNS_=r.wfsFeatureNS||t.WFSFeatureNS[n.ogcServerType_];n.wfsFeaturePrefix_=r.wfsFeaturePrefix||t.WFSFeaturePrefix.FEATURE;n.wfsOutputFormat_=r.wfsOutputFormat||t.WFSOutputFormat.GML3;n.wfsUrl_=r.wfsUrl;n.wmsInfoFormat_=r.wmsInfoFormat||t.WMSInfoFormat.GML;n.wmsIsSingleTile_=r.wmsIsSingleTile===true;n.wmsUrl_=r.wmsUrl;n.wmtsLayer_=r.wmtsLayer;n.wmtsUrl_=r.wmtsUrl;var o=[];if(n.queryable&&n.ogcLayers){for(var f=n.ogcLayers,d=Array.isArray(f),g=0,f=d?f:f[Symbol.iterator]();;){var m;if(d){if(g>=f.length)break;m=f[g++]}else{g=f.next();if(g.done)break;m=g.value}var v=m;if(v.queryable){o.push(v.name)}}}var y=null;if(n.supportsWFS&&o.length){var _=undefined;if(n.wfsOutputFormat_===t.WFSOutputFormat.GML3){_=new l["a"]}else if(n.wfsOutputFormat_===t.WFSOutputFormat.GML2){_=new s["a"]}a["a"].assert(_);y=new u["a"]({featureNS:n.wfsFeatureNS,featureType:o,gmlFormat:_})}n.wfsFormat_=y;var b=null;if(n.supportsWMS&&o.length){if(n.wmsInfoFormat===t.WMSInfoFormat.GML){b=new c["a"]({layers:o})}}n.wmsFormat_=b;return n}t.prototype.getAttributes=function t(){return e.prototype.attributes};t.prototype.setAttributes=function t(r){e.prototype.setAttributes.call(this,r);this.updateGeometryNameFromAttributes_()};t.prototype.combinableWithDataSourceForWFS=function e(t){return this.combinableForWFS&&t.combinableForWFS&&this.supportsWFS&&t.supportsWFS&&this.queryable&&t.queryable&&this.wfsUrl===t.wfsUrl&&this.haveTheSameActiveDimensions(t)};t.prototype.combinableWithDataSourceForWMS=function e(t){return this.combinableForWMS&&t.combinableForWMS&&this.supportsWMS&&t.supportsWMS&&this.queryable&&t.queryable&&this.wmsUrl===t.wmsUrl&&this.haveTheSameActiveDimensions(t)};t.prototype.isAnyOGCLayerInRange=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return!!this.getInRangeOGCLayerNames(t,r).length};t.prototype.getInRangeOGCLayerNames=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var a=[];if(this.ogcLayers){for(var n=this.ogcLayers,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;var u=l.maxResolution;var c=l.minResolution;var f=c===undefined||t>=c;var h=u===undefined||t<=u;var p=f&&h;if(p&&(!r||l.queryable)){a.push(l.name)}}}return a};t.prototype.getOGCLayerNames=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=[];if(this.ogcLayers){for(var a=this.ogcLayers,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(!t||s.queryable){r.push(s.name)}}}return r};t.prototype.getFiltrableOGCLayerName=function e(){a["a"].assert(this.filtrable);var t=this.getOGCLayerNames();a["a"].assert(t.length===1);return t[0]};t.prototype.updateGeometryNameFromAttributes_=function e(){var r=t.DEFAULT_GEOMETRY_NAME_;if(this.attributes){for(var a=this.attributes,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var s;if(n){if(i>=a.length)break;s=a[i++]}else{i=a.next();if(i.done)break;s=i.value}var l=s;if(l.type===o["a"].GEOMETRY){r=l.name;break}}}this.geometryName_=r};t.prototype.haveTheSameActiveDimensions=function e(t){var r=true;var a=this.activeDimensions;var n=t.activeDimensions;for(var i in a){if(a[i]!==n[i]){r=false;break}}if(r){for(var o in n){if(n[o]!==a[o]){r=false;break}}}return r};f(t,[{key:"dimensions",get:function e(){return this.dimensions_}},{key:"dimensionsConfig",get:function e(){return this.dimensionsConfig_},set:function e(t){this.dimensionsConfig_=t}},{key:"dimensionsFiltersConfig",get:function e(){return this.dimensionsFiltersConfig_},set:function e(t){this.dimensionsFiltersConfig_=t}},{key:"filterCondition",get:function e(){return this.filterCondition_},set:function e(t){this.filterCondition_=t}},{key:"filterRules",get:function e(){return this.filterRules_},set:function e(t){this.filterRules_=t}},{key:"timeLowerValue",get:function e(){return this.timeLowerValue_},set:function e(t){this.timeLowerValue_=t}},{key:"timeRangeValue",get:function e(){var t=null;var r=this.timeLowerValue;var a=this.timeUpperValue;if(r!==undefined){t={end:a,start:r}}return t},set:function e(t){if(t){this.timeUpperValue=t.end;this.timeLowerValue=t.start}else{this.timeUpperValue=undefined;this.timeLowerValue=undefined}}},{key:"timeUpperValue",get:function e(){return this.timeUpperValue_},set:function e(t){this.timeUpperValue_=t}},{key:"copyable",get:function e(){return this.copyable_}},{key:"filtrable",get:function e(){return this.filtrable_},set:function e(t){this.filtrable_=t}},{key:"geometryName",get:function e(){return this.geometryName_}},{key:"ogcImageType",get:function e(){return this.ogcImageType_}},{key:"ogcLayers",get:function e(){return this.ogcLayers_}},{key:"ogcServerType",get:function e(){return this.ogcServerType_}},{key:"ogcType",get:function e(){return this.ogcType_}},{key:"snappable",get:function e(){return this.snappable_}},{key:"snappingToEdges",get:function e(){return this.snappingToEdges_}},{key:"snappingToVertice",get:function e(){return this.snappingToVertice_}},{key:"snappingTolerance",get:function e(){return this.snappingTolerance_}},{key:"timeAttributeName",get:function e(){return this.timeAttributeName_}},{key:"timeProperty",get:function e(){return this.timeProperty_}},{key:"wfsFeatureNS",get:function e(){return this.wfsFeatureNS_}},{key:"wfsFeaturePrefix",get:function e(){return this.wfsFeaturePrefix_}},{key:"wfsOutputFormat",get:function e(){return this.wfsOutputFormat_}},{key:"wfsUrl",get:function e(){return this.wfsUrl_}},{key:"wmsInfoFormat",get:function e(){return this.wmsInfoFormat_}},{key:"wmsIsSingleTile",get:function e(){return this.wmsIsSingleTile_}},{key:"wmsUrl",get:function e(){return this.wmsUrl_}},{key:"wmtsLayer",get:function e(){return this.wmtsLayer_}},{key:"wmtsUrl",get:function e(){return this.wmtsUrl_}},{key:"activeDimensions",get:function e(){var t={};var r=this.dimensions_||{};var a=this.dimensionsConfig||{};for(var n in a){if(a[n]===null){if(r[n]!==undefined&&r[n]!==null){t[n]=r[n]}}else{t[n]=a[n]}}return t}},{key:"combinableForWFS",get:function e(){return this.filterRules_===null&&this.timeRangeValue===null}},{key:"combinableForWMS",get:function e(){return this.filterRules_===null&&this.timeRangeValue===null}},{key:"queryable",get:function e(){var t=false;var r=this.supportsWMS||this.supportsWFS;if(r&&this.ogcLayers){for(var a=this.ogcLayers,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.queryable===true){t=true;break}}}return t}},{key:"supportsWFS",get:function e(){return this.wfsUrl!==undefined}},{key:"supportsAttributes",get:function e(){return this.attributes!==null||this.supportsWFS&&this.ogcLayers!==null&&this.ogcLayers.length===1&&this.ogcLayers[0].queryable===true}},{key:"supportsWMS",get:function e(){return this.wmsUrl!==undefined}},{key:"supportsWMTS",get:function e(){return this.wmtsUrl!==undefined}},{key:"wfsFormat",get:function e(){return this.wfsFormat_}},{key:"wmsFormat",get:function e(){return this.wmsFormat_}}]);return t}(n["a"]);g.guessServiceTypeByUrl=function(e){var t=void 0;if(/(wmts)/i.test(e)){t=g.Type.WMTS}else{t=g.Type.WMS}return t};g.DEFAULT_GEOMETRY_NAME_="the_geom";g.ServerType={GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGISSERVER:"qgisserver"};g.Type={WMS:"WMS",WMTS:"WMTS"};g.WFSFeatureNS={geoserver:"http://www.opengis.net/gml/3.2",mapserver:"http://mapserver.gis.umn.edu/mapserver",qgisserver:"http://www.qgis.org/gml"};g.WFSFeaturePrefix={FEATURE:"feature"};g.WFSOutputFormat={GML2:"GML2",GML3:"GML3"};g.WMSInfoFormat={GML:"application/vnd.ogc.gml"};t["a"]=g},,function(e,t,r){"use strict";r.d(t,"a",function(){return p});var a=r(43);var n=r(39);var i=r(92);var o=r(87);var s=r(102);var l=r(30);var u=r(34);var c=r(4);var f={};f.toMulti=function(e){var t=void 0;if(e instanceof l["a"]){t=new i["a"]([]);t.appendPoint(e)}else if(e instanceof n["a"]){t=new o["a"]([]);t.appendLineString(e)}else if(e instanceof u["a"]){t=new s["a"]([]);t.appendPolygon(e)}else{t=e}return t};f.isSafari=function(){return navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1};f.colorZeroPadding=function(e){return e.length==1?"0"+e:e};f.rgbArrayToHex=function(e){var t=e[0];var r=e[1];var a=e[2];if(t!=(t&255)||r!=(r&255)||a!=(a&255)){throw Error('"('+t+","+r+","+a+')" is not a valid RGB color')}var n=f.colorZeroPadding(t.toString(16));var i=f.colorZeroPadding(r.toString(16));var o=f.colorZeroPadding(a.toString(16));return"#"+n+i+o};f.decodeQueryString=function(e){var t={};if(e){var r=e.substring(1).split("&");for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;var l=s.indexOf("=");if(l>=0){var u=s.substring(0,l);var c=s.substring(l+1);t[decodeURIComponent(u)]=decodeURIComponent(c)}else{t[s]=""}}}return t};f.encodeQueryString=function(e){var t=[];for(var r in e){var a=e[r];t.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}return t.join("&")};f.deleteCondition=function(e){return a["g"](e)&&a["l"](e)};function h(e){return[Object(c["C"])(e),Object(c["D"])(e),Object(c["w"])(e),Object(c["v"])(e),Object(c["C"])(e)]}var p={mousedown:false};document.addEventListener("mousedown",function(e){p.mousedown=true});document.addEventListener("mouseup",function(e){p.mousedown=false});t["b"]=f},,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(134);var i=r(234);var o=r(27);var s=r(20);var l=r(116);var u=r(206);var c=r(7);var f=r(72);var h=r(4);var p=r(22);var d=r(39);var g=r(87);var m=r(92);var v=r(30);var y=r(34);var _=r(102);var b=r(299);var S=r(298);var C=r(79);var w=r(45);var T=r(179);var E=r(53);var A=r(13);var L=r(104);var P=function e(t,r){this.$filter_=r;this.decimals_=undefined;if(t.has("ngeoMeasureDecimals")){this.decimals_=t.get("ngeoMeasureDecimals")}this.precision_=undefined;if(t.has("ngeoMeasurePrecision")){this.precision_=t.get("ngeoMeasurePrecision")}this.numberFormat_=r("number");this.unitPrefixFormat_=r("ngeoUnitPrefix");this.ngeoNumberCoordinates_=r("ngeoNumberCoordinates");this.pointFilterFn_=null;this.pointFilterArgs_=[];if(t.has("ngeoPointfilter")){var n=t.get("ngeoPointfilter").split(":");var i=n.shift();var o=this.$filter_(i);a["a"].assertFunction(o);this.pointFilterFn_=o;this.pointFilterArgs_=n}else{this.pointFilterFn_=null}this.projection_;this.download_=t.get("ngeoDownload")};P.$inject=["$injector","$filter"];P.$inject=["$injector","$filter"];P.prototype.setProjection=function(e){this.projection_=e};P.prototype.setStyle=function(e,t){var r=this.getStyle(e);if(t){if(this.supportsVertex_(e)){r.push(this.getVertexStyle())}r.unshift(this.getHaloStyle_(e))}e.setStyle(r)};P.prototype.getStyle=function(e){var t=this.getType(e);var r=void 0;switch(t){case s["a"].LINE_STRING:r=this.getLineStringStyle_(e);break;case s["a"].POINT:r=this.getPointStyle_(e);break;case s["a"].CIRCLE:case s["a"].POLYGON:case s["a"].RECTANGLE:r=this.getPolygonStyle_(e);break;case s["a"].TEXT:r=this.getTextStyle_(e);break;default:break}a["a"].assert(r,"Style should be thruthy");var n=void 0;if(r.constructor===Array){n=r}else{n=[r]}return n};P.prototype.getLineStringStyle_=function(e){var t=this.getStrokeProperty(e);var r=this.getShowLabelProperty(e);var a=this.getShowMeasureProperty(e);var n=this.getRGBAColorProperty(e);var i=[new A["c"]({stroke:new E["a"]({color:n,width:t})})];var o=[];if(a){o.push(this.getMeasure(e))}if(r){o.push(this.getNameProperty(e))}if(r||a){var s=o.join("\n");i.push(new A["c"]({text:this.createTextStyle_({text:s})}))}return i};P.prototype.getPointStyle_=function(e){var t=this.getSizeProperty(e);var r=this.getRGBAColorProperty(e);var a=this.getShowLabelProperty(e);var n=this.getShowMeasureProperty(e);var i=[new A["c"]({image:new C["a"]({radius:t,fill:new w["a"]({color:r})})})];var o=[];if(n){o.push(this.getMeasure(e))}if(a){o.push(this.getNameProperty(e))}if(a||n){var s=o.join("\n");var l=10;var u=1.3;i.push(new A["c"]({text:this.createTextStyle_({text:s,size:l,offsetY:-(t+l/2*o.length*u+4)})}))}return i};P.prototype.optNumber=function(e,t){var r=e.get(t);if(r!==undefined){if(typeof r=="string"){return+r}else{return a["a"].assertNumber(r)}}else{return undefined}};P.prototype.getNumber=function(e,t){var r=e.get(t);if(typeof r=="string"){return+r}else{return a["a"].assertNumber(r)}};P.prototype.getPolygonStyle_=function(e){var t=this.getStrokeProperty(e);var r=this.getOpacityProperty(e);var a=this.getRGBAColorProperty(e);var n=this.getShowLabelProperty(e);var i=this.getShowMeasureProperty(e);var s=a.slice();s[3]=r;var u=this.optNumber(e,o["a"].AZIMUT);var c=[new A["c"]({fill:new w["a"]({color:s}),stroke:new E["a"]({color:a,width:t})})];if(i||n){if(i&&u!==undefined){var f=this.getRadiusLine(e,u);var h=l["a"].getFormattedLength(f,this.projection_,this.precision_,this.unitPrefixFormat_);c.push(new A["c"]({geometry:f,fill:new w["a"]({color:s}),stroke:new E["a"]({color:a,width:t}),text:this.createTextStyle_({text:h,angle:(u%180+180)%180-90})}));c.push(new A["c"]({geometry:new v["a"](f.getLastCoordinate()),text:this.createTextStyle_({text:this.numberFormat_(u,this.decimals_)+"°",size:10,offsetX:Math.cos((u-90)*Math.PI/180)*20,offsetY:Math.sin((u-90)*Math.PI/180)*20})}));if(n){c.push(new A["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),offsetY:-8,exceedLength:true})}))}}else{var p=[];if(i){p.push(this.getMeasure(e))}if(n){p.push(this.getNameProperty(e))}if(n||i){var d=p.join("\n");c.push(new A["c"]({text:this.createTextStyle_({text:d,exceedLength:true})}))}}}return c};P.prototype.getTextStyle_=function(e){return new A["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),color:this.getRGBAColorProperty(e),width:this.getStrokeProperty(e)})})};P.prototype.createEditingStyles=function(e){var t=[255,255,255,1];var r=[0,153,255,1];var a=3;var n=[];var i=e.getGeometry();console.assert(i);var o=i.getType();if(o==="Point"){n.push(new A["c"]({image:new C["a"]({radius:a*2,fill:new w["a"]({color:r}),stroke:new E["a"]({color:t,width:a/2})}),zIndex:Infinity}))}else{if(o==="LineString"){n.push(new A["c"]({stroke:new E["a"]({color:t,width:a+2})}));n.push(new A["c"]({stroke:new E["a"]({color:r,width:a})}))}else{n.push(new A["c"]({stroke:new E["a"]({color:r,width:a/2}),fill:new w["a"]({color:[255,255,255,.5]})}))}n.push(this.getVertexStyle(true))}return n};P.prototype.getVertexStyle=function(e){var t=e!==undefined?e:true;var r={image:new T["a"]({radius:6,points:4,angle:Math.PI/4,fill:new w["a"]({color:[255,255,255,.5]}),stroke:new E["a"]({color:[0,0,0,1]})})};if(t){r.geometry=function(e){var t=e.getGeometry();if(t.getType()=="Point"){return}var r=void 0;var a=[];var n=[];var i=void 0,o=void 0;if(t instanceof d["a"]){n=t.getCoordinates()}else if(t instanceof g["a"]){a=t.getCoordinates()}else if(t instanceof y["a"]){n=t.getCoordinates()[0]}else if(t instanceof _["a"]){r=t.getCoordinates()}if(r){for(i=0,o=r.length;i<o;i++){a=a.concat(r[i])}}for(i=0,o=a.length;i<o;i++){n=n.concat(a[i])}if(n.length){return new m["a"](n)}else{return t}}}return new A["c"](r)};P.prototype.supportsVertex_=function(e){var t=[s["a"].LINE_STRING,s["a"].POLYGON,s["a"].RECTANGLE];var r=this.getType(e);return c["f"](t,r)};P.prototype.getHaloStyle_=function(e){var t=this.getType(e);var r=void 0;var n=3;switch(t){case s["a"].POINT:var i=this.getSizeProperty(e);r=new A["c"]({image:new C["a"]({radius:i+n,fill:new w["a"]({color:[255,255,255,1]})})});break;case s["a"].LINE_STRING:case s["a"].CIRCLE:case s["a"].POLYGON:case s["a"].RECTANGLE:var o=this.getStrokeProperty(e);r=new A["c"]({stroke:new E["a"]({color:[255,255,255,1],width:o+n*2})});break;case s["a"].TEXT:r=new A["c"]({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),width:n*3})});break;default:break}a["a"].assert(r,"Style should be thruthy");return r};P.getFilteredFeatureValues=function(e){var t=e.getProperties();delete t["boundedBy"];delete t[e.getGeometryName()];delete t["ngeo_feature_type_"];return t};P.prototype.getAngleProperty=function(e){var t=+e.get(o["a"].ANGLE);a["a"].assertNumber(t);return t};P.prototype.getColorProperty=function(e){var t=a["a"].assertString(e.get(o["a"].COLOR));a["a"].assertString(t);return t};P.prototype.getRGBAColorProperty=function(e){return f["c"](this.getColorProperty(e))};P.prototype.getNameProperty=function(e){var t=a["a"].assertString(e.get(o["a"].NAME));a["a"].assertString(t);return t};P.prototype.getOpacityProperty=function(e){return this.getNumber(e,o["a"].OPACITY)};P.prototype.getShowMeasureProperty=function(e){var t=e.get(o["a"].SHOW_MEASURE);if(t===undefined){t=false}else if(typeof t==="string"){t=t==="true"?true:false}return a["a"].assertBoolean(t)};P.prototype.getShowLabelProperty=function(e){var t=e.get(o["a"].SHOW_LABEL);if(t===undefined){t=false}else if(typeof t==="string"){t=t==="true"?true:false}return a["a"].assertBoolean(t)};P.prototype.getSizeProperty=function(e){return this.getNumber(e,o["a"].SIZE)};P.prototype.getStrokeProperty=function(e){return this.getNumber(e,o["a"].STROKE)};P.prototype.export=function(e,t){switch(t){case P.FormatType.GPX:this.exportGPX(e);break;case P.FormatType.KML:this.exportKML(e);break;default:break}};P.prototype.exportGPX=function(e){var t=new b["a"];var r="application/gpx+xml";var a="export.gpx";this.export_(e,t,a,r)};P.prototype.exportKML=function(e){var t=new S["a"];var r="application/vnd.google-earth.kml+xml";var a="export.kml";this.export_(e,t,a,r)};P.prototype.export_=function(e,t,r,a){var n=this;var i=a!==undefined?a:"text/plain";var o=[];var s=void 0;e.forEach(function(e){s=new p["a"](e.getProperties());n.setStyle(s,false);o.push(s)});var l=this.projection_?{dataProjection:"EPSG:4326",featureProjection:this.projection_}:{};var u=t.writeFeatures(o,l);this.download_(u,r,i+";charset=utf-8")};P.prototype.createTextStyle_=function(e){if(e.angle){var t=e.angle!==undefined?e.angle:0;var r=t*Math.PI/180;e.rotation=r;delete e.angle}e.font=["normal",(e.size||10)+"pt","Arial"].join(" ");if(e.color){e.fill=new w["a"]({color:e.color||[0,0,0,1]});delete e.color}e.stroke=new E["a"]({color:[255,255,255,1],width:e.width||3});delete e.width;return new L["a"](e)};P.prototype.getMeasure=function(e){var t=e.getGeometry();a["a"].assert(t,"Geometry should be truthy");var r="";if(t instanceof y["a"]){if(this.getType(e)===s["a"].CIRCLE){var n=this.optNumber(e,o["a"].AZIMUT);a["a"].assertNumber(n);var i=this.getRadiusLine(e,n);r=u["a"].getFormattedAzimutRadius(i,this.projection_,this.decimals_,this.precision_,this.unitPrefixFormat_,this.numberFormat_)}else{r=l["a"].getFormattedArea(t,this.projection_,this.precision_,this.unitPrefixFormat_)}}else if(t instanceof d["a"]){r=l["a"].getFormattedLength(t,this.projection_,this.precision_,this.unitPrefixFormat_)}else if(t instanceof v["a"]){if(this.pointFilterFn_===null){r=l["a"].getFormattedPoint(t,this.decimals_,this.ngeoNumberCoordinates_)}else{var c=t.getCoordinates();var f=this.pointFilterArgs_.slice(0);f.unshift(c);r=this.pointFilterFn_.apply(this,f)}}return r};P.prototype.getType=function(e){var t=e.getGeometry();a["a"].assert(t,"Geometry should be thruthy");var r=void 0;if(t instanceof v["a"]){if(e.get(o["a"].IS_TEXT)){r=s["a"].TEXT}else{r=s["a"].POINT}}else if(t instanceof m["a"]){r=s["a"].MULTI_POINT}else if(t instanceof y["a"]){if(e.get(o["a"].IS_CIRCLE)){r=s["a"].CIRCLE}else if(e.get(o["a"].IS_RECTANGLE)){r=s["a"].RECTANGLE}else{r=s["a"].POLYGON}}else if(t instanceof _["a"]){r=s["a"].MULTI_POLYGON}else if(t instanceof d["a"]){r=s["a"].LINE_STRING}else if(t instanceof g["a"]){r=s["a"].MULTI_LINE_STRING}a["a"].assert(r,"Type should be thruthy");return r};P.prototype.panMapToFeature=function(e,t,r){var n=r!==undefined?r:250;var i=t.getSize();a["a"].assertArray(i);var o=t.getView();var s=o.calculateExtent(i);var l=e.getGeometry();if(!l.intersectsExtent(s)){var u=o.getCenter();a["a"].assertArray(u);var c=void 0;if(l instanceof d["a"]){c=l.getCoordinateAt(.5)}else if(l instanceof y["a"]){c=l.getInteriorPoint().getCoordinates()}else if(l instanceof v["a"]){c=l.getCoordinates()}else{c=h["x"](l.getExtent())}o.animate({center:u,duration:n},{center:c,duration:n})}};P.prototype.getRadiusLine=function(e,t){var r=e.getGeometry();var a=r.getExtent();var n=(a[3]-a[1])/2;var i=h["x"](r.getExtent());var o=Math.cos((t-90)*Math.PI/180)*n;var s=-Math.sin((t-90)*Math.PI/180)*n;var l=[o+i[0],s+i[1]];return new d["a"]([i,l])};P.prototype.getNonSpatialProperties=function(e){var t=e.getGeometryName();var r={};var a=e.getProperties();for(var n in a){if(n!==t){r[n]=a[n]}}return r};P.prototype.clearNonSpatialProperties=function(e){var t=e.getGeometryName();var r=e.getProperties();for(var a in r){if(a!==t){e.set(a,undefined)}}};P.FormatType={GPX:"GPX",KML:"KML"};P.module=angular.module("ngeoFeatureHelper",[i["a"].name,n["a"].name]);P.module.service("ngeoFeatureHelper",P);t["a"]=P},,,,function(e,t,r){"use strict";var a=function e(t,r){this.getActive=function(){return t[r]};this.setActive=function(e){t[r]=e}};t["a"]=a},,,,,,function(e,t,r){"use strict";var a=function e(){};a.prototype.showMessage=function(e){};a.prototype.show=function(e){var t=this.getMessageObjects(e);t.forEach(this.showMessage,this)};a.prototype.error=function(e){this.show(this.getMessageObjects(e,a.Type.ERROR))};a.prototype.info=function(e){this.show(this.getMessageObjects(e,a.Type.INFORMATION))};a.prototype.success=function(e){this.show(this.getMessageObjects(e,a.Type.SUCCESS))};a.prototype.warn=function(e){this.show(this.getMessageObjects(e,a.Type.WARNING))};a.prototype.getMessageObjects=function(e,t){var r=[];var n=null;var i=a.Type.INFORMATION;if(typeof e==="string"){r.push({msg:e,type:t!==undefined?t:i})}else if(Array.isArray(e)){e.forEach(function(a){if(typeof e==="string"){n={msg:a,type:t!==undefined?t:i}}else{n=a;if(t!==undefined){n.type=t}}r.push(n)},this)}else{n=e;if(t!==undefined){n.type=t}if(n.type===undefined){n.type=i}r.push(n)}return r};a.Type={ERROR:"error",INFORMATION:"information",SUCCESS:"success",WARNING:"warning"};t["a"]=a},,,,,,,function(e,t,r){"use strict";var a=r(1);var n=r(33);var i=function e(t){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};n["a"].call(this,t);this.detail=r};a["d"](i,n["a"]);t["a"]=i},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(38);var i=r(47);var o=r(3);var s=r(22);var l=r(135);var u=r(70);var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){p(t,e);function t(r){f(this,t);r.type=n["a"].GEOMETRY;var a=h(this,e.call(this,r));var i=r.featureProperties||{};a.feature_=new s["a"](i);a.format_=new l["a"];a.updatingExpression_=false;a.updatingGeometry_=false;a.geometryChangeListenerKey_=null;a.listenerKeys.push(o["a"](a.feature_,"change:"+a.feature.getGeometryName(),a.handleFeatureGeometryChange_,a));a.setGeometryFromExpression_();return a}t.prototype.setExpression=function t(r){this.updatingExpression_=true;e.prototype.setExpression.call(this,r);if(!this.updatingGeometry_){this.setGeometryFromExpression_()}this.registerGeometryChange_();this.updatingExpression_=false};t.prototype.handleFeatureGeometryChange_=function e(){if(this.updatingExpression_){return}this.updatingGeometry_=true;var t=this.feature_.getGeometry();if(t){this.expression=this.format_.writeGeometry(t)}else{this.expression=null}this.registerGeometryChange_();this.updatingGeometry_=false};t.prototype.handleGeometryChange_=function e(t){var r=a["a"].assertInstanceof(t.target,u["a"]);this.updatingGeometry_=true;this.expression=this.format_.writeGeometry(r);this.updatingGeometry_=false};t.prototype.setGeometryFromExpression_=function e(){var t=null;if(this.expression){var r=a["a"].assertString(this.expression);t=this.format_.readGeometry(r)}this.geometry=t};t.prototype.registerGeometryChange_=function e(){if(this.geometryChangeListenerKey_!==null){o["e"](this.geometryChangeListenerKey_);this.geometryChangeListenerKey_=null}var t=this.feature_.getGeometry();if(t){this.geometryChangeListenerKey_=o["a"](t,"change",this.handleGeometryChange_,this)}};c(t,[{key:"feature",get:function e(){return this.feature_}},{key:"geometry",get:function e(){return this.feature_.getGeometry()||null},set:function e(t){this.feature_.setGeometry(t)}}]);return t}(i["a"]);t["a"]=d},,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(208);var i=r(1);var o=r(64);var s=r(9);var l=r(57);var u=r(13);var c=function e(){this.featureUidToGroupIndex_={};this.groups_=[];this.source_=new l["b"]({useSpatialIndex:false});this.layer_=new o["a"]({source:this.source_,style:this.styleFunction_.bind(this),updateWhileAnimating:true,updateWhileInteracting:true})};c.prototype.addFeature=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);var r=i["c"](e).toString();this.featureUidToGroupIndex_[r]=t;this.groups_[t].features[r]=e;this.source_.addFeature(e)};c.prototype.removeFeature=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);var r=i["c"](e).toString();delete this.featureUidToGroupIndex_[r];delete this.groups_[t].features[r];this.source_.removeFeature(e)};c.prototype.clear=function(e){a["a"].assert(e>=0);a["a"].assert(e<this.groups_.length);var t=this.groups_[e];for(var r in t.features){this.removeFeature(t.features[r],e)}a["a"].assert(s["d"](t.features))};c.prototype.getLayer=function(){return this.layer_};c.prototype.getFeatureOverlay=function(){var e=this.groups_.length;this.groups_.push({styleFunction:u["a"],features:{}});return new n["a"](this,e)};c.prototype.init=function(e){this.layer_.setMap(e)};c.prototype.setStyle=function(e,t){a["a"].assert(t>=0);a["a"].assert(t<this.groups_.length);this.groups_[t].styleFunction=e===null?u["c"].defaultFunction:Object(u["d"])(e)};c.prototype.styleFunction_=function(e,t){var r=i["c"](e).toString();a["a"].assert(r in this.featureUidToGroupIndex_);var n=this.featureUidToGroupIndex_[r];var o=this.groups_[n];return o.styleFunction(e,t)};c.module=angular.module("ngeoFeatureOverlayMgr",[n["a"].module.name]);c.module.service("ngeoFeatureOverlayMgr",c);t["a"]=c},function(e,t,r){"use strict";var a=r(2);var n=r(7);var i=r(269);var o=r(78);var s=r(114);var l=r(93);var u=r(9);var c=r(126);var f=r(156);var h=r(149);var p=r(112);var d=function e(t,r,a){this.$q_=t;this.$http_=r;this.tilesPreloadingLimit_=a};d.$inject=["$q","$http","ngeoTilesPreloadingLimit"];d.$inject=["$q","$http","ngeoTilesPreloadingLimit"];d.GROUP_KEY="groupName";d.REFRESH_PARAM="random";d.prototype.createBasicWMSLayer=function(e,t,r,a,n,i,o,l,u){var f={FORMAT:r,LAYERS:t};var h=void 0;if(n){f["TIME"]=n}if(a){f["SERVERTYPE"]=a;h=a.replace("qgisserver","qgis")}var p=Object.assign({},l,{url:e,params:f,serverType:h,crossOrigin:o});var d=new c["a"](p);if(i){d.updateParams(i)}var g=Object.assign({},u,{source:d});return new s["a"](g)};d.prototype.createBasicWMSLayerFromDataSource=function(e,t){var r=e.wmsUrl;a["a"].assert(r);var n=e.getOGCLayerNames().join(",");var i=e.ogcServerType;var o=e.ogcImageType;var s=this.createBasicWMSLayer(r,n,o,i,undefined,undefined,t);s.setVisible(e.visible);s.set("querySourceIds",[e.id]);return s};d.prototype.createWMTSLayerFromCapabilitites=function(e,t,r,a,o){var s=new i["a"];var c=new l["a"]({preload:this.tilesPreloadingLimit_});var f=this.$q_;return this.$http_.get(e,{cache:true}).then(function(i){var l=void 0;if(i.data){l=s.read(i.data)}if(l){var p=Object.assign({},o,Object(h["b"])(l,{matrixSet:r,crossOrigin:"anonymous",layer:t}));var d=new h["a"](p);if(a&&!u["d"](a)){d.updateDimensions(a)}c.setSource(d);var g=l["Contents"]["Layer"];var m=n["d"](g,function(e,r,a){return e["Identifier"]==t});c.set("capabilitiesStyles",m["Style"]);return f.resolve(c)}return f.reject("Failed to get WMTS capabilities from "+e)})};d.prototype.createWMTSLayerFromCapabilititesObj=function(e,t,r){var n=Object(h["b"])(e,{crossOrigin:"anonymous",layer:t["Identifier"]});a["a"].assert(n);var i=new h["a"](n);if(r&&!u["d"](r)){i.updateDimensions(r)}return new l["a"]({capabilitiesStyles:t["Style"],preload:Infinity,source:i})};d.prototype.createBasicGroup=function(e){var t=new o["a"];if(e){t.setLayers(e)}return t};d.prototype.getGroupFromMap=function(e,t){var r=e.getLayerGroup().getLayers();var a=void 0;r.getArray().some(function(e){if(e.get(d.GROUP_KEY)===t){a=e;return true}else{return false}});if(!a){a=this.createBasicGroup();a.set(d.GROUP_KEY,t);e.addLayer(a)}return a};d.prototype.getFlatLayers=function(e){if(e instanceof o["a"]){var t=e.getLayers().getArray();var r=t.some(function(e){return e instanceof o["a"]});if(!r){return t.slice()}}return this.getFlatLayers_(e,[],undefined)};d.prototype.getFlatLayers_=function(e,t,r){var a=this;var n=e.getOpacity();if(r!==undefined){r*=n}else{r=n}if(e instanceof o["a"]){var i=e.getLayers();i.forEach(function(e){a.getFlatLayers_(e,t,r)})}else{if(t.indexOf(e)<0){e.set("inheritedOpacity",r,true);t.push(e)}}return t};d.prototype.getLayerByName=function(e,t){var r=this;var a=null;t.some(function(t){if(t instanceof o["a"]){var n=t.getLayers().getArray();a=r.getLayerByName(e,n)}else if(t.get("layerNodeName")===e){a=t}return!!a});return a};d.prototype.getWMTSLegendURL=function(e){var t=void 0;var r=e.get("capabilitiesStyles");if(r!==undefined){var a=r[0]["legendURL"];if(a!==undefined){t=a[0]["href"]}}return t};d.prototype.getWMSLegendURL=function(e,t,r,a,n,i,o,s,l,u,c){if(!e){return undefined}var f={FORMAT:"image/png",TRANSPARENT:true,SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetLegendGraphic",LAYER:t};if(r!==undefined){f["SCALE"]=r}if(a!==undefined){f["RULE"]=a;if(n!==undefined){f["WIDTH"]=n}if(i!==undefined){f["HEIGHT"]=i}}if(o=="qgis"){if(s!=undefined){f["DPI"]=s}if(l!=undefined&&u!=undefined&&r!=undefined&&s!=undefined&&a==undefined){f["BBOX"]=l.join(",");f["SRS"]=u;f["WIDTH"]=Math.round((l[2]-l[0])/r*39.37*s);f["HEIGHT"]=Math.round((l[3]-l[1])/r*39.37*s)}}if(c){Object.assign(f,c)}return p["a"](e,f)};d.prototype.isLayerVisible=function(e,t){if(!e.getVisible()){return false}var r=t.getView().getResolution();return r>e.getMinResolution()&&r<e.getMaxResolution()};d.prototype.refreshWMSLayer=function(e){var t=e.getSource();a["a"].assert(t instanceof c["a"]||t instanceof f["a"]);var r=t;var n=r.getParams();n[d.REFRESH_PARAM]=Math.random();r.updateParams(n)};d.prototype.setZIndexToFirstLevelChildren=function(e,t){if(!(e instanceof o["a"])){return}var r=e.getLayers();r.forEach(function(e){return e.setZIndex(t)})};d.prototype.updateWMSLayerState=function(e,t,r){if(t.length<=0){e.setVisible(false)}else{e.setVisible(true);var a=e.getSource();if(r){a.updateParams({LAYERS:t,TIME:r})}else{a.updateParams({LAYERS:t})}}};d.prototype.getQuerySourceIds=function(e){return e.get("querySourceIds")};d.module=angular.module("ngeoLayerHelper",[]).service("ngeoLayerHelper",d).value("ngeoTilesPreloadingLimit",Infinity);t["a"]=d},,,,,function(e,t,r){"use strict";var a=r(2);var n=r(140);var i=r(1);var o=r(3);var s=r(78);var l=r(74);var u=function e(t,r,u){var c=this;var f=u["ngeoLayertreeNotroot"]===undefined;this.isRoot=f;var h=u["ngeoLayertree"];this.rootScope_=r;this.properties={};this.state_="off";this.node;if(f){t.$watch(h,function(e,t){c.node=e})}else{this.node=t.$eval(h);a["a"].assert(this.node!==undefined)}var p=u["ngeoLayertreeMap"];var d=t.$eval(p);a["a"].assert(d!==undefined);this.parent=t.$parent["layertreeCtrl"];this.children=[];if(this.parent){this.parent.children.push(this)}t.$on("$destroy",function(){if(c.parent){var e=c.parent.children.indexOf(c);a["a"].assert(e>=0);c.parent.children.splice(e,1)}});this.uid=i["c"](this);this.depth=f?0:this.parent.depth+1;t["uid"]=this.uid;t["depth"]=this.depth;this.map=d;var g=u["ngeoLayertreeNodelayer"];if(g===undefined){var m=u["ngeoLayertreeNodelayerexpr"];var v=t.$eval(m);a["a"].assertString(v);g=v}a["a"].assert(g!==undefined);this.nodelayerExpr=g;this.layer=null;if(!f){var y=t.$eval(g,{treeCtrl:this})||null;if(y){a["a"].assert(y instanceof l["a"]||y instanceof s["a"]);this.layer=y}}this.dataSource_=null;if(this.layer){n["a"].layerLoading(this.layer,t);n["a"].layer(this.layer);o["a"](this.layer,"change:opacity",function(){c.rootScope_.$broadcast("ngeo-layertree-opacity",c)})}var _=u["ngeoLayertreeListeners"];if(_===undefined){var b=u["ngeoLayertreeListenersexpr"];_=t.$eval(b)}if(_!==undefined){a["a"].assertString(_)}this.listenersExpr=_;if(_){t.$eval(_,{treeScope:t,treeCtrl:this})}t["layertreeCtrl"]=this};u.$inject=["$scope","$rootScope","$attrs"];u.$inject=["$scope","$rootScope","$attrs"];u.prototype.getState=function(){return this.state_};u.prototype.setState=function(e,t){var r=this;if(e===this.state_){return}this.setStateInternal_(e);if(this.parent){this.parent.refreshState()}var a=this.isRoot?this.children:[u.getFirstParentTree(this)];if(t===undefined||t){a.forEach(function(e){r.rootScope_.$broadcast("ngeo-layertree-state",r,e)})}};u.prototype.setStateInternal_=function(e){var t=this;this.state_=e==="on"?"on":"off";this.children.forEach(function(e){e.setStateInternal_(t.state_)})};u.prototype.refreshState=function(){var e=this.getCalculateState();if(this.state_===e){return}this.state_=e;if(this.parent){this.parent.refreshState()}};u.prototype.getCalculateState=function(){if(this.node.children===undefined){return this.state_}var e=void 0;var t=void 0;this.children.some(function(r){e=r.getCalculateState();if(t){if(t!==e){return e="indeterminate"}}t=e});return e};u.prototype.getSetActive=function(e){var t=this.layer;var r=this.map;if(!t){return}if(e!==undefined){if(!e){r.removeLayer(t)}else{r.addLayer(t)}}else{return r.getLayers().getArray().indexOf(t)>=0}};u.prototype.getDataSource=function(){return this.dataSource_};u.prototype.setDataSource=function(e){this.dataSource_=e};u.getFirstParentTree=function(e){var t=e;while(!t.parent.isRoot){t=t.parent}return t};u.VisitorDecision={STOP:"STOP",SKIP:"SKIP",DESCEND:"DESCEND"};u.Visitor;u.prototype.traverseDepthFirst=function(e){var t=e(this)||u.VisitorDecision.DESCEND;switch(t){case u.VisitorDecision.STOP:return true;case u.VisitorDecision.SKIP:return false;case u.VisitorDecision.DESCEND:for(var r=0;r<this.children.length;++r){var n=this.children[r];var i=n.traverseDepthFirst(e);if(i){return true}}return false;default:a["a"].fail("Unhandled case")}};u.module=angular.module("ngeoLayertreeController",[]);u.module.controller("ngeoLayertreeController",u);t["a"]=u},,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(82);var i=r(52);var o=r(1);var s=r(40);var l=r(11);var u=r(113);var c=r(200);var f=r(3);var h=r(32);var p=r(64);var d=r(57);var g=r(45);var m=r(53);var v=r(13);var y=function e(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};h["a"].call(this,{handleEvent:e.handleEvent_});this.helpTooltipElement_=null;this.helpTooltipOverlay_=null;this.measureTooltipElement_=null;this.measureTooltipOverlay_=null;this.measureTooltipOverlayCoord_=null;this.sketchFeature=null;this.continueMsg=null;this.decimals=t.decimals;this.precision=t.precision;this.displayHelpTooltip_=t.displayHelpTooltip!==undefined?t.displayHelpTooltip:true;this.startMsg;if(t.startMsg!==undefined){this.startMsg=t.startMsg}else{this.startMsg=document.createElement("span");this.startMsg.textContent="Click to start drawing."}this.changeEventKey_=null;this.postcomposeEventKey_=null;var r=t.style!==undefined?t.style:[new v["c"]({fill:new g["a"]({color:"rgba(255, 255, 255, 0.2)"})}),new v["c"]({stroke:new m["a"]({color:"white",width:5})}),new v["c"]({stroke:new m["a"]({color:"#ffcc33",width:3})})];this.vectorLayer_=new p["a"]({source:new d["b"],style:r});this.drawInteraction_=this.createDrawInteraction(t.sketchStyle,this.vectorLayer_.getSource());this.shouldHandleDrawInteractionActiveChange_=true;f["a"](this.drawInteraction_,"change:active",this.handleDrawInteractionActiveChange_,this);f["a"](this.drawInteraction_,"drawstart",this.onDrawStart_,this);f["a"](this.drawInteraction_,"drawend",this.onDrawEnd_,this);f["a"](this,"change:active",this.updateState_,this)};o["d"](y,h["a"]);y.getFormattedArea=function(e,t,r,a){var n=e.clone().transform(t,"EPSG:4326");var i=Math.abs(c["a"](n,{projection:"EPSG:4326"}));return a(i,"m²","square",r)};y.getFormattedCircleArea=function(e,t,r){var a=Math.PI*Math.pow(e.getRadius(),2);return r(a,"m²","square",t)};y.getFormattedLength=function(e,t,r,a){var n=0;var i=e.getCoordinates();for(var o=0,s=i.length-1;o<s;++o){var u=l["l"](i[o],t,"EPSG:4326");var f=l["l"](i[o+1],t,"EPSG:4326");n+=c["b"](u,f)}return a(n,"m","unit",r)};y.getFormattedPoint=function(e,t,r,a){return r(e.getCoordinates(),t,a)};y.handleEvent_=function(e){if(e.type!="pointermove"||e.dragging){return true}var t=this.sketchFeature===null?this.startMsg:this.continueMsg;if(this.displayHelpTooltip_){s["d"](this.helpTooltipElement_);this.helpTooltipElement_.appendChild(t);this.helpTooltipOverlay_.setPosition(e.coordinate)}return true};y.prototype.getDrawInteraction=function(){return this.drawInteraction_};y.prototype.createDrawInteraction=function(e,t){};y.prototype.setMap=function(e){h["a"].prototype.setMap.call(this,e);this.vectorLayer_.setMap(e);var t=this.drawInteraction_.getMap();if(t!==null){t.removeInteraction(this.drawInteraction_)}if(e!==null){e.addInteraction(this.drawInteraction_)}};y.prototype.onDrawStart_=function(e){var t=this;this.sketchFeature=e.feature||e.detail.feature;this.vectorLayer_.getSource().clear(true);this.createMeasureTooltip_();var r=this.sketchFeature.getGeometry();a["a"].assert(r!==undefined);this.changeEventKey_=f["a"](r,"change",function(){t.handleMeasure(function(e,r){if(r!==null){t.measureTooltipElement_.innerHTML=e;t.measureTooltipOverlayCoord_=r}})});this.cancelEventKey_=f["a"](document.body,"keydown",function(e){t.handleEscapeKeyDown_(e)});this.postcomposeEventKey_=f["a"](this.getMap(),"postcompose",function(){t.measureTooltipOverlay_.setPosition(t.measureTooltipOverlayCoord_)})};y.prototype.onDrawEnd_=function(e){this.measureTooltipElement_.classList.add("ngeo-tooltip-static");this.measureTooltipOverlay_.setOffset([0,-7]);var t=new n["a"]("measureend",{feature:this.sketchFeature});this.dispatchEvent(t);this.sketchFeature=null;this.unlistenerEvent_()};y.prototype.unlistenerEvent_=function(){if(this.changeEventKey_!==null&&this.postcomposeEventKey_!==null){f["e"](this.changeEventKey_);f["e"](this.postcomposeEventKey_);f["e"](this.cancelEventKey_);this.changeEventKey_=null;this.postcomposeEventKey_=null;this.cancelEventKey_=null}};y.prototype.createHelpTooltip_=function(){this.removeHelpTooltip_();if(this.displayHelpTooltip_){this.helpTooltipElement_=document.createElement("div");this.helpTooltipElement_.classList.add("tooltip");this.helpTooltipOverlay_=new u["a"]({element:this.helpTooltipElement_,offset:[15,0],positioning:"center-left"});this.getMap().addOverlay(this.helpTooltipOverlay_)}};y.prototype.removeHelpTooltip_=function(){if(this.displayHelpTooltip_){this.getMap().removeOverlay(this.helpTooltipOverlay_);if(this.helpTooltipElement_!==null){this.helpTooltipElement_.parentNode.removeChild(this.helpTooltipElement_)}this.helpTooltipElement_=null;this.helpTooltipOverlay_=null}};y.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_();this.measureTooltipElement_=document.createElement("div");this.measureTooltipElement_.classList.add("tooltip");this.measureTooltipElement_.classList.add("ngeo-tooltip-measure");this.measureTooltipOverlay_=new u["a"]({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center",stopEvent:false});this.getMap().addOverlay(this.measureTooltipOverlay_)};y.prototype.removeMeasureTooltip_=function(){if(this.measureTooltipElement_!==null){this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_);this.measureTooltipElement_=null;this.measureTooltipOverlay_=null;this.measureTooltipOverlayCoord_=null}};y.prototype.updateState_=function(){var e=this.getActive();this.shouldHandleDrawInteractionActiveChange_=false;this.drawInteraction_.setActive(e);this.shouldHandleDrawInteractionActiveChange_=true;if(!this.getMap()){return}if(e){if(!this.measureTooltipOverlay_){this.createMeasureTooltip_();this.createHelpTooltip_()}}else{this.vectorLayer_.getSource().clear(true);this.getMap().removeOverlay(this.measureTooltipOverlay_);this.removeMeasureTooltip_();this.removeHelpTooltip_();this.unlistenerEvent_()}};y.prototype.handleMeasure=function(e){};y.prototype.getTooltipElement=function(){return this.measureTooltipElement_};y.prototype.handleDrawInteractionActiveChange_=function(){if(this.shouldHandleDrawInteractionActiveChange_){this.setActive(this.drawInteraction_.getActive())}};y.prototype.handleEscapeKeyDown_=function(e){var t=e.keyCode===27;if(!i["a"].mousedown&&this.drawInteraction_.getActive()&&t){this.drawInteraction_.setActive(false);this.drawInteraction_.setActive(true)}};t["a"]=y},,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(225);var i=r(167);var o=r(224);var s=r(9);function l(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var u=function(){e.$inject=["$injector","ngeoDataSources","ngeoDataSourcesHelper","ngeoQuerent","ngeoQueryResult"];function e(t,r,a,n,i){l(this,e);var o=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};this.dataSources_=r.collection;this.ngeoDataSourcesHelper_=a;this.ngeoQuerent_=n;this.result_=i;this.limit_=o.limit!==undefined?o.limit:50;this.queryCountFirst_=o.queryCountFirst!==undefined?o.queryCountFirst:false;this.tolerancePx_=o.tolerance!==undefined?o.tolerance:3;this.bboxAsGETParam_=o.bboxAsGETParam||false;this.dataSourceNames_={}}e.prototype.issue=function e(t){this.clear();var r=void 0;if(t.dataSources===undefined&&t.queryableDataSources===undefined){r=this.ngeoQuerent_.getQueryableDataSources(this.dataSources_.getArray(),t.map)}var a=t.limit!==undefined?t.limit:this.limit_;s["a"](t,{queryableDataSources:r,limit:a,tolerancePx:this.tolerancePx_,wfsCount:this.queryCountFirst_,bboxAsGETParam:this.bboxAsGETParam_});this.result_.pending=true;this.ngeoQuerent_.issue(t).then(this.handleResult_.bind(this))};e.prototype.clear=function e(){this.result_.total=0;for(var t=this.result_.sources,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;i.features.length=0;i.pending=false;i.queried=false;i.tooManyResults=false;i.totalFeatureCount=undefined}this.result_.sources.length=0;this.result_.pending=false};e.prototype.handleResult_=function e(t){var r=this;var n=0;var i=function e(i){var o=Number(i);var s=r.ngeoDataSourcesHelper_.getDataSource(o);var l=s.name;a["a"].assert(s);var u=t[o];var c=u.features;var f=u.limit;var h=u.tooManyFeatures===true;var p=u.totalFeatureCount;var d={};c.forEach(function(e){var t=a["a"].assertString(e.get("ngeo_feature_type_"));if(!d[t]){d[t]=[]}if(s.attributes&&s.attributes.length){var r=e.getProperties();var n={};s.attributes.forEach(function(t){if(t.alias){n[t.alias]=r[t.name];e.unset(t.name,true)}else{n[t.name]=r[t.name]}});e.setProperties(n,true)}d[t].push(e)});for(var g in d){l=g?g:l;var m=d[g];r.result_.sources.push({features:m,id:o,label:l,limit:f,pending:false,queried:true,tooManyResults:h,totalFeatureCount:p});n+=c.length}};for(var o in t){i(o)}this.result_.total=n;this.result_.pending=false};return e}();u.module=angular.module("ngeoMapQuerent",[i["a"].module.name,o["a"].module.name,n["a"].module.name]);u.module.service("ngeoMapQuerent",u);u.module.value("ngeoQueryResult",{sources:[],total:0,pending:false});t["a"]=u},function(e,t,r){"use strict";var a=r(3);var n=function e(){this.listenerKeys_={}};n.prototype.addListenerKey=function(e,t){if(!this.listenerKeys_[e]){this.initListenerKey_(e)}this.listenerKeys_[e].push(t)};n.prototype.clearListenerKey=function(e){this.initListenerKey_(e)};n.prototype.initListenerKey_=function(e){if(!this.listenerKeys_[e]){this.listenerKeys_[e]=[]}else{if(this.listenerKeys_[e].length){this.listenerKeys_[e].forEach(a["e"]);this.listenerKeys_[e].length=0}}};n.module=angular.module("ngeoEventHelper",[]);n.module.service("ngeoEventHelper",n);t["a"]=n},function(e,t,r){"use strict";(function(e){var a=r(48);var n=r(46);var i=r(2);var o=r(106);var s=r(75);var l=r(239);var u=r(190);var c=r(7);var f=r(3);var h=r(9);var p=function e(t,r,a,n,i,o,s){this.$timeout_=t;this.$injector_=r;this.gettextCatalog_=a;this.layerHelper_=n;this.ngeoNotification_=i;this.gmfThemes_=o;this.root={children:[]};this.rootCtrl=null;this.numberOfGroupsToAddInThisDigestLoop=0;this.groupsToAddInThisDigestLoop_=[];this.promiseForGroupsToAddInThisDigestLoop_=null;this.ngeoStateManager_=s;this.ogcServers_=null;f["a"](this.gmfThemes_,"change",this.handleThemesChange_,this)};p.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"];p.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"];p.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t});if(this.rootCtrl&&this.rootCtrl.children){this.gmfThemes_.getThemesObject().then(function(t){e.refreshFirstLevelGroups_(t)})}};p.prototype.setFirstLevelGroups=function(e){this.root.children.length=0;this.ngeoStateManager_.deleteParam(a["a"].PermalinkParam.TREE_GROUPS);return this.addFirstLevelGroups(e)};p.prototype.addFirstLevelGroups=function(e,t,r){var a=this;var n=[];e.slice().reverse().forEach(function(e){if(!a.addFirstLevelGroup_(e)){n.push(e)}});if(n.length>0&&!r){this.notifyCantAddGroups_(n)}return n.length===0};p.prototype.updateTreeGroupsState_=function(e){var t={};t[a["a"].PermalinkParam.TREE_GROUPS]=e.map(function(e){return e.name}).join(",");this.ngeoStateManager_.updateState(t);if(this.$injector_.has("gmfPermalink")){this.$injector_.get("gmfPermalink").cleanParams(e)}};p.prototype.addFirstLevelGroup_=function(e){var t=this;var r=false;var a=e.id;this.root.children.some(function(e){if(a===e.id){return r=true}},this);this.groupsToAddInThisDigestLoop_.some(function(e){if(a===e.id){return r=true}},this);if(r){return false}this.groupsToAddInThisDigestLoop_.push(e);this.numberOfGroupsToAddInThisDigestLoop=0;if(this.promiseForGroupsToAddInThisDigestLoop_!==null){this.$timeout_.cancel(this.promiseForGroupsToAddInThisDigestLoop_)}this.promiseForGroupsToAddInThisDigestLoop_=this.$timeout_(function(){t.numberOfGroupsToAddInThisDigestLoop=t.groupsToAddInThisDigestLoop_.length;t.groupsToAddInThisDigestLoop_.forEach(function(e){t.root.children.unshift(e)});t.updateTreeGroupsState_(t.root.children);t.groupsToAddInThisDigestLoop_.length=0;t.promiseForGroupsToAddInThisDigestLoop_=null});return true};p.prototype.addGroupByName=function(e,t){var r=this;this.gmfThemes_.getThemesObject().then(function(a){var i=n["a"].findGroupByName(a,e);if(i){r.addFirstLevelGroups([i],t,false)}})};p.prototype.addGroupByLayerName=function(e,t,r){var a=this;this.gmfThemes_.getThemesObject().then(function(i){var s=n["a"].findGroupByLayerNodeName(i,e);if(s){var l=a.addFirstLevelGroups([s],t,r);a.$timeout_(function(){var t=a.getTreeCtrlByNodeId(s.id);if(!t){console.warn("Tree controller not found, unable to add the group");return}var r=void 0;t.traverseDepthFirst(function(t){if(t.node.name===e){r=t;return o["a"].VisitorDecision.STOP}});if(l){t.setState("off")}if(r){r.setState("on")}})}})};p.prototype.removeGroup=function(e){var t=this.root.children;var r=0,a=false;t.some(function(t){if(t.name===e.name){return a=true}r++});if(a){t.splice(r,1);this.updateTreeGroupsState_(t)}};p.prototype.removeAll=function(){while(this.root.children.length){this.removeGroup(this.root.children[0])}};p.prototype.cloneGroupNode_=function(e,t){var r=h["a"]({},e);this.toggleNodeCheck_(r,t);return r};p.prototype.toggleNodeCheck_=function(e,t){var r=this;if(!e.children){return}e.children.forEach(function(e){if(e.children){r.toggleNodeCheck_(e,t)}else if(e.metadata){e.metadata.isChecked=c["f"](t,e.name)}})};p.prototype.notifyCantAddGroups_=function(e){var t=[];var r=this.gettextCatalog_;e.forEach(function(e){t.push(r.getString(e.name))});var a=t.length<2?r.getString("group is already loaded."):r.getString("groups are already loaded.");this.ngeoNotification_.notify({msg:t.join(", ")+" "+a,type:s["a"].Type.INFORMATION})};p.prototype.getTreeCtrlByNodeId=function(e){var t=null;if(this.rootCtrl&&this.rootCtrl.traverseDepthFirst){this.rootCtrl.traverseDepthFirst(function(r){if(r.node.id===e){t=r;return o["a"].VisitorDecision.STOP}})}return t};p.prototype.getOgcServer=function(e){if(e.parent.node.mixed){var t=e.node;i["a"].assert(t.ogcServer);return this.ogcServers_[t.ogcServer]}else{var r=e;while(!r.parent.isRoot){r=r.parent}var a=r.node;i["a"].assert(a.ogcServer);return this.ogcServers_[a.ogcServer]}};p.prototype.refreshFirstLevelGroups_=function(e){var t=this;var r={};this.rootCtrl.children.map(function(e){var a=e.node.name;r[a]=t.getFirstLevelGroupFullState_(e)});var a=[];this.root.children.map(function(i){var o=i.name;var s=n["a"].findGroupByName(e,o);if(s){var l=r[o];if(l){t.setNodeMetadataFromFullState_(s,l)}a.push(s)}});this.setFirstLevelGroups(a);this.$timeout_(function(){t.updateTreeGroupsState_(t.root.children)})};p.prototype.getFirstLevelGroupFullState_=function(t){var r=this;var a={};t.children.map(function(e){a[e.node.name]=r.getFirstLevelGroupFullState_(e)});var n=void 0,i=void 0,o=void 0;if(t.children.length>0){var s=e("#gmf-layertree-layer-group-"+t.uid);if(s){i=s.hasClass("in")}}else{n=t.getState();if(n==="on"){n=true}else if(n==="off"){n=false}else{n=undefined}var l=e("#gmf-layertree-node-"+t.uid+"-legend");if(l){o=l.is(":visible")}}return{children:a,isChecked:n,isExpanded:i,isLegendExpanded:o}};p.prototype.setNodeMetadataFromFullState_=function(e,t){var r=this;if(!t){return e}if(e.children){e.children.map(function(e){r.setNodeMetadataFromFullState_(e,t.children[e.name])})}var a=e.metadata;a.isChecked=t.isChecked;a.isExpanded=t.isExpanded;a.isLegendExpanded=t.isLegendExpanded;return e};p.module=angular.module("gmfTreeManager",[n["a"].module.name,o["a"].module.name,l["a"].module.name,u["a"].module.name]);p.module.service("gmfTreeManager",p);t["a"]=p}).call(this,r(36))},function(e,t,r){"use strict";var a=r(2);var n=r(198);var i=r(1);var o=function e(t,r){this.$filter_=t;this.gettextCatalog_=r;n["a"].call(this)};o.$inject=["$filter","gettextCatalog"];o.$inject=["$filter","gettextCatalog"];i["d"](o,n["a"]);o.prototype.formatTimeValue=function(e,t,r,a){var n=new Date(e);var i=a?"UTC":undefined;var o="yyyy";var s="yyyy-MM";var l="yyyy-MM-dd";var u=undefined;if(!r){var c=this.gettextCatalog_;o=c.getString("yyyy");s=c.getString("M/yyyy");l=c.getString("M/d/yyyy");u=c.getString("M/d/yyyy HH:MM:ss")}switch(t){case"year":return this.$filter_("date")(n,o,i);case"month":return this.$filter_("date")(n,s,i);case"day":return this.$filter_("date")(n,l,i);case"second":if(u){return this.$filter_("date")(n,u,i)}else{return n.toISOString().replace(/\.\d{3}/,"")}default:return n.toISOString().replace(/\.\d{3}/,"")}};o.prototype.formatWMSTimeParam=function(e,t,r){a["a"].assert(e.resolution!==undefined);if(e.mode==="range"){a["a"].assert(t.end!==undefined);return this.formatTimeValue(t.start,e.resolution,true,r)+"/"+this.formatTimeValue(t.end,e.resolution,true,r)}else{return this.formatTimeValue(t.start,e.resolution,true,r)}};o.module=angular.module("ngeoWMSTime",[n["a"].module.name]);o.module.service("ngeoWMSTime",o);t["a"]=o},function(e,t,r){"use strict";var a=r(12);var n=r(123);var i=angular.module("ngeoAngularFilters",[]);i.Scalify=function(e){var t=e("number");var r=function e(r){var a=t(r,0);return a?"1 : "+a:""};r["$stateful"]=true;return r};i.Scalify.$inject=["$filter"];i.filter("ngeoScalify",i.Scalify);i.Number=function(e){var t=e.NUMBER_FORMATS;var r=function e(r,a){var n=t.GROUP_SEP;var i=t.DECIMAL_SEP;if(a===undefined){a=3}if(r===Infinity){return"∞"}else if(r===-Infinity){return"-∞"}else if(r===0){return"0"}var o=r<0;r=Math.abs(r);var s=a-Math.floor(Math.log(r)/Math.log(10))-1;var l=Math.pow(10,s);r=Math.round(r*l);var u="";var c=Math.floor(r/l);if(s>0){var f=""+r;while(f.length<s){f="0"+f}u=f.substring(f.length-s);while(u[u.length-1]==="0"){u=u.substring(0,u.length-1)}}var h=[];var p=""+c;while(p.length>3){var d=p.length-3;h.unshift(p.substring(d));p=p.substring(0,d)}h.unshift(p);return(o?"-":"")+h.join(n)+(u.length===0?"":i+u)};return r};i.Number.$inject=["$locale"];i.filter("ngeoNumber",i.Number);i.UnitPrefix=function(e){var t=e("ngeoNumber");var r=["","k","M","G","T","P"];var a=["","Ki","Mi","Gi","Ti","Pi"];var n=function e(n,i,o,s){if(i===undefined){i=""}var l=1e3;var u=r;if(o==="square"){l=1e6}else if(o==="binary"){l=1024;u=a}var c=0;var f=u.length-1;while(n>=l&&c<f){n=n/l;c++}var h=u[c]+i;var p=h.length==0?"":" ";return t(n,s)+p+h};return n};i.UnitPrefix.$inject=["$filter"];i.filter("ngeoUnitPrefix",i.UnitPrefix);i.NumberCoordinates=function(e){var t=function t(r,a,n){var i=n?n:"{x} {y}";var o=r[0];var s=r[1];var l=parseInt(a,10)|0;o=e("number")(o,l);s=e("number")(s,l);return i.replace("{x}",o).replace("{y}",s)};return t};i.NumberCoordinates.$inject=["$filter"];i.filter("ngeoNumberCoordinates",i.NumberCoordinates);i.DMSCoordinates=function(){var e=function e(t,r,i){var o=a["d"](t+180,360)-180;var s=Math.abs(3600*o);var l=Math.floor(s/3600);var u=Math.floor(s/60%60);var c=s%60;return l+"° "+n["b"](u,2)+"′ "+n["b"](c,2,i)+"″ "+r.charAt(o<0?1:0)};var t=function t(r,a,n){var i=parseInt(a,10)|0;var o=n?n:"{x} {y}";var s=e(r[0],"EW",i);var l=e(r[1],"NS",i);return o.replace("{x}",s).replace("{y}",l)};return t};i.filter("ngeoDMSCoordinates",i.DMSCoordinates);i.trustHtmlFilter=function(e){return function(t){if(t!==undefined&&t!==null){return e.trustAsHtml(""+t)}else{return e.trustAsHtml("&nbsp;")}}};i.trustHtmlFilter.$inject=["$sce"];i.filter("ngeoTrustHtml",i.trustHtmlFilter);i.Duration=function(e){var t=Object.freeze({SECONDS:Symbol("seconds"),MINUTES:Symbol("minutes"),HOURS:Symbol("hours"),DAYS:Symbol("days")});var r=function r(a,n){var i="";switch(n){case t.SECONDS:i=e.getPlural(a,"second","seconds");break;case t.MINUTES:i=e.getPlural(a,"minute","minutes");break;case t.HOURS:i=e.getPlural(a,"hour","hours");break;case t.DAYS:i=e.getPlural(a,"day","days");break;default:break}return a+" "+i};var a=function e(a){a=Math.round(a);var n=void 0;if(a<60){return r(a,t.SECONDS)}var i=a%60;a=Math.floor(a/60);if(a<60){n=r(a,t.MINUTES);if(i>0){n+=" "+r(i,t.SECONDS)}return n}i=a%60;a=Math.floor(a/60);if(a<24){n=r(a,t.HOURS);if(i>0){n+=" "+r(i,t.MINUTES)}return n}i=a%24;a=Math.floor(a/24);n=r(a,t.DAYS);if(i>0){n+=" "+r(i,t.HOURS)}return n};return a};i.Duration.$inject=["gettextCatalog"];i.filter("ngeoDuration",i.Duration);var o=function e(){return function(e){if(e){return e.replace(/<!\[CDATA\[(.*)\]\]>/,"$1")}}};i.filter("removeCDATA",o);t["a"]=i},,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(32);var i=r(159);var o=r(78);var s=r(74);var l=r(240);var u=r(247);var c={};c.interaction=function(e){a["a"].assertInstanceof(e,n["a"]);Object.defineProperty(e,"active",{get:function t(){return e.getActive()},set:function t(r){e.setActive(r)}})};c.layer=function(e){a["a"].assertInstanceof(e,i["a"]);Object.defineProperty(e,"visible",{configurable:true,get:function t(){return e.getVisible()},set:function t(r){e.setVisible(r)}});Object.defineProperty(e,"opacity",{configurable:true,get:function t(){return e.getOpacity()},set:function t(r){e.setOpacity(r)}})};c.layerLoading=function(e,t){var r=void 0;var n=null;var i=null;var c=h;var f=p;e.set("load_count",0,true);if(e instanceof o["a"]){e.getLayers().on("add",function(t){var r=t.element;r.set("parent_group",e)})}if(e instanceof s["a"]){r=e.getSource();if(r===null){return}else if(r instanceof u["b"]){n=["tileloadstart"];i=["tileloadend","tileloaderror"]}else if(r instanceof l["a"]){n=["imageloadstart"];i=["imageloadend","imageloaderror"]}else{a["a"].fail("unsupported source type")}r.on(n,function(){c(e);t.$applyAsync()});r.on(i,function(){f(e);t.$applyAsync()})}Object.defineProperty(e,"loading",{configurable:true,get:function t(){return e.get("load_count")>0}});function h(e){var t=e.get("load_count");var r=e.get("parent_group");e.set("load_count",++t,true);if(r){h(r)}}function p(e){var t=e.get("load_count");var r=e.get("parent_group");e.set("load_count",--t,true);if(r){p(r)}}};t["a"]=c},,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a={AND:"&&",NOT:"!",OR:"||"};t["a"]=a},,,,function(e,t,r){"use strict";var a=r(2);var n=r(160);var i=r(38);var o=r(65);var s=r(133);var l=r(47);function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function c(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var h=function(e){f(t,e);function t(r){u(this,t);r.type=r.type||i["a"].DATE;return c(this,e.call(this,r))}return t}(l["a"]);var p=h;var d=r(94);var g=r(185);function m(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function v(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function y(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var _=function(e){y(t,e);function t(r){m(this,t);r.operator=r.operator||l["a"].OperatorType.LIKE;r.type=i["a"].TEXT;return v(this,e.call(this,r))}return t}(l["a"]);var b=_;var S=r(155);var C=r(60);var w=r(7);var T=r(162);function E(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var A=function(){e.$inject=["gettextCatalog","ngeoFeatureHelper","ngeoWMSTime"];function e(t,r,a){E(this,e);this.gettextCatalog_=t;this.ngeoFeatureHelper_=r;this.ngeoWMSTime_=a}e.prototype.createRulesFromAttributes=function e(t,r){var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;a.push(this.createRuleFromAttribute(l,r))}return a};e.prototype.createRuleFromAttribute=function e(t,r){var n=void 0;var o=r===true;var s=this.gettextCatalog_.getString(t.name);switch(t.type){case i["a"].DATE:case i["a"].DATETIME:if(o){n=new p({name:s,operator:l["a"].TemporalOperatorType.EQUALS,operators:[l["a"].TemporalOperatorType.EQUALS,l["a"].TemporalOperatorType.BEGINS,l["a"].TemporalOperatorType.ENDS],propertyName:t.name,type:t.type})}else{n=new p({name:s,operator:l["a"].TemporalOperatorType.DURING,propertyName:t.name,type:t.type})}break;case i["a"].GEOMETRY:n=new d["a"]({name:s,operator:l["a"].SpatialOperatorType.WITHIN,operators:[l["a"].SpatialOperatorType.CONTAINS,l["a"].SpatialOperatorType.INTERSECTS,l["a"].SpatialOperatorType.WITHIN],propertyName:t.name,type:t.type});break;case i["a"].NUMBER:if(o){n=new l["a"]({name:s,operator:l["a"].OperatorType.EQUAL_TO,operators:[l["a"].OperatorType.EQUAL_TO,l["a"].OperatorType.GREATER_THAN,l["a"].OperatorType.GREATER_THAN_OR_EQUAL_TO,l["a"].OperatorType.LESSER_THAN,l["a"].OperatorType.LESSER_THAN_OR_EQUAL_TO,l["a"].OperatorType.NOT_EQUAL_TO],propertyName:t.name,type:i["a"].NUMBER})}else{n=new l["a"]({name:s,operator:l["a"].OperatorType.BETWEEN,propertyName:t.name,type:i["a"].NUMBER})}break;case i["a"].SELECT:n=new g["a"]({choices:a["a"].assert(t.choices),name:s,propertyName:t.name});break;default:if(o){n=new b({name:s,operator:l["a"].OperatorType.LIKE,operators:[l["a"].OperatorType.LIKE,l["a"].OperatorType.EQUAL_TO,l["a"].OperatorType.NOT_EQUAL_TO],propertyName:t.name})}else{n=new b({name:s,operator:l["a"].OperatorType.LIKE,propertyName:t.name})}break}return n};e.prototype.createRules=function e(t){var r=[];for(var a=t,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;r.push(this.createRule(s))}return r};e.prototype.createRule=function e(t){var r=void 0;switch(t.type){case i["a"].DATE:case i["a"].DATETIME:r=new p(t);break;case i["a"].GEOMETRY:r=new d["a"](t);break;case i["a"].SELECT:var n=t;a["a"].assert(n.choices);r=new g["a"](n);break;default:r=new b(t);break}return r};e.prototype.cloneRule=function e(t){var r=void 0;var a=t.getExpression();if(a===null){a=undefined}var n=t.isCustom;var i=t.lowerBoundary!==null?t.lowerBoundary:undefined;var o=t.name;var s=t.operator!==null?t.operator:undefined;var u=t.operators?t.operators.slice(0):undefined;var c=t.propertyName;var f=t.type!==null?t.type:undefined;var h=t.upperBoundary!==null?t.upperBoundary:undefined;var m={expression:a,isCustom:n,lowerBoundary:i,name:o,operator:s,operators:u,propertyName:c,type:f,upperBoundary:h};if(t instanceof p){r=new p(m)}else if(t instanceof d["a"]){r=new d["a"](m);r.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature))}else if(t instanceof g["a"]){m.choices=t.choices.slice(0);r=new g["a"](m)}else if(t instanceof b){r=new b(m)}else{r=new l["a"](m)}return r};e.prototype.extendRule=function e(t,r){if(r.getExpression()!==t.getExpression()){r.setExpression(t.getExpression())}if(r.lowerBoundary!==t.lowerBoundary){r.lowerBoundary=t.lowerBoundary}if(r.operator!==t.operator){r.operator=t.operator}if(r.upperBoundary!==t.upperBoundary){r.upperBoundary=t.upperBoundary}if(t instanceof d["a"]&&r instanceof d["a"]){this.ngeoFeatureHelper_.clearNonSpatialProperties(r.feature);r.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature))}};e.prototype.serializeRules=function e(t){var r=this;return t.map(function(e){var t=r.serializeRule(e);return t})};e.prototype.serializeRule=function e(t){var r={name:t.name,propertyName:t.propertyName,type:t.type};if(t.expression!==null){r.expression=t.expression}if(t.lowerBoundary!==null){r.lowerBoundary=t.lowerBoundary}if(t.operator!==null){r.operator=t.operator}if(t.operators!==null){r.operators=t.operators.slice(0)}if(t.upperBoundary!==null){r.upperBoundary=t.upperBoundary}if(t instanceof d["a"]){r.featureProperties=this.ngeoFeatureHelper_.getNonSpatialProperties(t.feature)}if(t instanceof g["a"]){r.choices=t.choices}return r};e.prototype.createFilter=function e(t){var r=t.dataSource;var a=null;if(t.filter){a=t.filter}else{var i=t.filterRules||r.filterRules;var o=[];if(i&&i.length){for(var s=i,l=Array.isArray(s),u=0,s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{u=s.next();if(u.done)break;c=u.value}var f=c;var h=this.createFilterFromRule_(f,r,t.srsName);if(h){o.push(h)}}}var p=r.filterCondition;if(o.length===1){a=o[0]}else if(o.length>=2){if(p===n["a"].AND){a=C["and"].apply(null,o)}else if(p===n["a"].OR||p===n["a"].NOT){a=C["or"].apply(null,o)}}if(a&&p===n["a"].NOT){a=C["not"](a)}}if(t.incTime){var d=this.createTimeFilterFromDataSource_(r);if(d){if(a){a=C["and"].apply(null,[a,d])}else{a=d}}}if(t.incDimensions){var g=this.createDimensionsFilterFromDataSource_(r);if(g){if(a){a=C["and"].apply(null,[a,g])}else{a=g}}}return a};e.prototype.createFilterString=function e(t){var r=null;var a=this.createFilter(t);if(a){var n=Object(S["b"])(a);var i=new XMLSerializer;r=i.serializeToString(n)}return r};e.prototype.createFilterFromRule_=function e(t,r,n){var i=null;var o=t.value;if(!o){return null}var s=o.expression;var u=o.lowerBoundary;var c=o.operator;var f=o.propertyName;var h=o.upperBoundary;var m=l["a"].OperatorType;var v=l["a"].SpatialOperatorType;var y=l["a"].TemporalOperatorType;var _=[v.CONTAINS,v.INTERSECTS,v.WITHIN];var b=[m.GREATER_THAN,m.GREATER_THAN_OR_EQUAL_TO,m.LESSER_THAN,m.LESSER_THAN_OR_EQUAL_TO];if(t instanceof p){var S=void 0;var E=void 0;if(c===y.DURING){S=Object(T["a"])(u).format("YYYY-MM-DD");E=Object(T["a"])(h).format("YYYY-MM-DD")}else if(c===y.EQUALS){S=Object(T["a"])(s).format("YYYY-MM-DD");E=S}else if(c===y.BEGINS){S=Object(T["a"])(s).format("YYYY-MM-DD");E=Object(T["a"])(s).add(30,"years").format("YYYY-MM-DD")}else if(c===y.ENDS){S="1970-01-01";E=Object(T["a"])(s).format("YYYY-MM-DD")}if(S&&E){i=C["during"](f,S,E)}}else if(t instanceof g["a"]){var A=t.selectedChoices;if(A.length===1){i=C["equalTo"](f,A[0])}else if(A.length>=2){var L=[];for(var P=A,M=Array.isArray(P),x=0,P=M?P:P[Symbol.iterator]();;){var F;if(M){if(x>=P.length)break;F=P[x++]}else{x=P.next();if(x.done)break;F=x.value}var R=F;L.push(C["equalTo"](f,R))}i=C["or"].apply(null,L)}}else if(w["f"](_,c)){var D=r.geometryName;a["a"].assertInstanceof(t,d["a"]);var k=a["a"].assert(t.geometry);if(c===v.CONTAINS){i=C["contains"](D,k,n)}else if(c===v.INTERSECTS){i=C["intersects"](D,k,n)}else if(c===v.WITHIN){i=C["within"](D,k,n)}}else if(w["f"](b,c)){var $=a["a"].assertNumber(s);if(c===m.GREATER_THAN){i=C["greaterThan"](f,$)}else if(c===m.GREATER_THAN_OR_EQUAL_TO){i=C["greaterThanOrEqualTo"](f,$)}else if(c===m.LESSER_THAN){i=C["lessThan"](f,$)}else if(c===m.LESSER_THAN_OR_EQUAL_TO){i=C["lessThanOrEqualTo"](f,$)}}else if(c===m.BETWEEN){i=C["between"](f,u,h)}else if(c===m.EQUAL_TO){i=C["equalTo"](f,s)}else if(c===m.LIKE){var O=String(s).replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*");i=C["like"](f,"*"+O+"*","*",".","!",false)}else if(c===m.NOT_EQUAL_TO){i=C["notEqualTo"](f,s)}return i};e.prototype.createDimensionsFilterFromDataSource_=function e(t){var r=t.dimensionsFiltersConfig;var a=t.dimensions;var n=[];for(var i in r){var o=r[i].value;if(o===null){if(a[i]!==undefined&&a[i]!==null){o=a[i]}}if(o!==null){n.push(C["equalTo"](r[i].field,o,true))}}if(n.length===1){return n[0]}else if(n.length>=2){return C["and"].apply(null,n)}return null};e.prototype.createTimeFilterFromDataSource_=function e(t){var r=null;var a=t.timeRangeValue;var n=t.timeProperty;var i=t.timeAttributeName;if(a&&n&&i){if(a.end!==undefined){var o=this.ngeoWMSTime_.formatWMSTimeParam(n,a).split("/");r=C["during"](i,o[0],o[1])}else{var s=n.resolution||"seconds";var l=this.ngeoWMSTime_.formatWMSTimeParam(n,a);var u=void 0;switch(s){case"year":u=Object(T["a"])(l).add(1,"years").subtract(1,"seconds");break;case"month":u=Object(T["a"])(l).add(1,"months").subtract(1,"seconds");break;case"day":u=Object(T["a"])(l).add(1,"days").subtract(1,"seconds");break;default:}if(u){var c=Object(T["a"])(l).utc().format("YYYY-MM-DD HH:mm:ss");var f=u.utc().format("YYYY-MM-DD HH:mm:ss");r=C["during"](i,c,f)}}}return r};return e}();A.module=angular.module("ngeoRuleHelper",[o["a"].module.name,s["a"].module.name]);A.module.service("ngeoRuleHelper",A);var L=t["a"]=A},function(e,t,r){"use strict";var a=r(48);var n=r(2);var i=r(101);var o=r(304);var s=r(167);var l=r(180);var u=r(18);var c=r(64);var f=r(57);var h=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function p(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function d(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function g(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){g(t,e);function t(r){p(this,t);var a=d(this,e.call(this,r));a.featuresCollection_=r.features||new u["b"];a.source_=new f["b"]({features:a.featuresCollection_,wrapX:false});a.layer_=new c["a"]({source:a.source_});return a}h(t,[{key:"features",get:function e(){return this.featuresCollection_.getArray()}},{key:"featuresCollection",get:function e(){return this.featuresCollection_}},{key:"layer",get:function e(){return this.layer_}},{key:"extent",get:function e(){return this.source_.getExtent()}}]);return t}(l["a"]);var v=m;var y=r(214);function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function b(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function S(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var C=function(e){S(t,e);function t(r){_(this,t);var a=b(this,e.call(this,r));var n=r.injector;a.rootScope_=n.get("$rootScope");a.unregister_={};return a}t.prototype.addDataSource=function t(r){e.prototype.addDataSource.call(this,r);n["a"].assertInstanceof(r,v);this.registerDataSource_(r)};t.prototype.registerDataSource_=function e(t){this.unregister_[t.id]=this.rootScope_.$watch(function(){return t.visible},this.handleDataSourceVisibleChange_.bind(this,t))};t.prototype.handleDataSourceVisibleChange_=function e(t,r,a){if(r!==undefined){t.layer.setVisible(r)}};t.prototype.removeDataSource=function t(r){e.prototype.removeDataSource.call(this,r);n["a"].assertInstanceof(r,v);this.unregisterDataSource_(r)};t.prototype.unregisterDataSource_=function e(t){this.unregister_[t.id]();delete this.unregister_[t.id]};return t}(y["a"]);var w=C;var T=r(50);var E=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function A(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function L(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function P(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var M=function(e){P(t,e);function t(r){A(this,t);var a=L(this,e.call(this,r));a.url_=r.url;return a}E(t,[{key:"url",get:function e(){return this.url_}}]);return t}(y["a"]);var x=M;var F=r(7);var R=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function D(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function k(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function $(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var O=function(e){$(t,e);function t(r,a){D(this,t);var n=k(this,e.call(this,r));var i=r.injector;n.layer_;n.ngeoLayerHelper_=a;n.rootScope_=i.get("$rootScope");n.wmsDataSourceUnregister_={};n.init_();return n}t.prototype.init_=function e(){n["a"].assert(this.dataSources.length,"At least one data source is required.");for(var t=this.dataSources,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var i;if(r){if(a>=t.length)break;i=t[a++]}else{a=t.next();if(a.done)break;i=a.value}var o=i;n["a"].assertInstanceof(o,T["a"]);this.registerDataSource_(o)}};t.prototype.destroy=function t(){for(var r=this.dataSources,a=Array.isArray(r),i=0,r=a?r:r[Symbol.iterator]();;){var o;if(a){if(i>=r.length)break;o=r[i++]}else{i=r.next();if(i.done)break;o=i.value}var s=o;n["a"].assertInstanceof(s,T["a"]);this.unregisterDataSource_(s)}e.prototype.destroy.call(this)};t.prototype.addDataSource=function t(r){e.prototype.addDataSource.call(this,r);n["a"].assertInstanceof(r,T["a"]);this.registerDataSource_(r)};t.prototype.registerDataSource_=function e(t){var r=t.id;this.wmsDataSourceUnregister_[r]=this.rootScope_.$watch(function(){return t.visible},this.handleDataSourceVisibleChange_.bind(this));if(!this.layer_){this.layer_=this.ngeoLayerHelper_.createBasicWMSLayerFromDataSource(t)}else{this.layer_.get("querySourceIds").push(r);this.updateLayer_()}};t.prototype.handleDataSourceVisibleChange_=function e(t,r){if(t!==undefined&&t!==r){this.updateLayer_()}};t.prototype.updateLayer_=function e(){var t=this.layer;var r=[];for(var a=this.dataSources,i=Array.isArray(a),o=0,a=i?a:a[Symbol.iterator]();;){var s;if(i){if(o>=a.length)break;s=a[o++]}else{o=a.next();if(o.done)break;s=o.value}var l=s;n["a"].assertInstanceof(l,T["a"]);if(l.visible){r=r.concat(l.getOGCLayerNames())}}this.ngeoLayerHelper_.updateWMSLayerState(t,r.join(","))};t.prototype.removeDataSource=function t(r){e.prototype.removeDataSource.call(this,r);n["a"].assertInstanceof(r,T["a"]);this.unregisterDataSource_(r)};t.prototype.unregisterDataSource_=function e(t){var r=t.id;var a=this.layer;var n=this.wmsDataSourceUnregister_[r];n();delete this.wmsDataSourceUnregister_[r];F["j"](this.dataSources,t);var i=this.ngeoLayerHelper_.getQuerySourceIds(a);if(i){F["j"](i,r)}if(this.dataSources.length){this.updateLayer_()}};R(t,[{key:"layer",get:function e(){return this.layer_}}]);return t}(x);var I=O;var N=r(1);var G=r(4);var U=r(3);var j=r(299);var V=r(298);var H=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function W(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var B=function(){e.$inject=["gettextCatalog","$injector","$q","$rootScope","ngeoDataSources","ngeoFile","ngeoLayerHelper"];function e(t,r,a,n,i,o,s){W(this,e);this.injector_=r;this.q_=a;this.rootScope_=n;this.dataSources_=i.collection;this.ngeoFile_=o;this.ngeoLayerHelper_=s;this.extDataSources_={};this.files_={};this.map_=null;this.fileGroup_=new w({dataSources:[],injector:this.injector_,title:t.getString("Local files")});this.wmsGroupsCollection_=new u["b"];this.wmtsGroupsCollection_=new u["b"];this.wmtsCache_={};U["a"](this.dataSources_,"remove",this.handleDataSourcesRemove_,this)}e.prototype.addWMSGroup_=function e(t){this.wmsGroupsCollection.push(t)};e.prototype.removeWMSGroup_=function e(t){this.wmsGroupsCollection.remove(t)};e.prototype.getWMSGroup=function e(t){var r=null;for(var a=this.wmsGroups,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.url===t){r=s;break}}return r};e.prototype.addWMTSGroup_=function e(t){this.wmtsGroupsCollection.push(t)};e.prototype.removeWMTSGroup_=function e(t){this.wmtsGroupsCollection.remove(t)};e.prototype.getWMTSGroup=function e(t){var r=null;for(var a=this.wmtsGroups,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.url===t){r=s;break}}return r};e.prototype.isExternalDataSource=function e(t){return!!this.extDataSources_[t.id]};e.prototype.addLayer_=function e(t){this.layerGroup.getLayers().push(t)};e.prototype.removeLayer_=function e(t){this.layerGroup.getLayers().remove(t)};e.prototype.createAndAddDataSourceFromWMSCapability=function t(r,a,n){var i=e.getId(r);var o=a["Service"];n=o["OnlineResource"]||n;var s=void 0;if(this.extDataSources_[i]){s=this.extDataSources_[i]}else{var l=a["Capability"]["Request"];var u=l["GetMap"]["Format"];var c="image/png";var f=u.includes(c)?c:u[0];var h=l["GetFeatureInfo"]["Format"];var p=h.includes(T["a"].WMSInfoFormat.GML)?T["a"].WMSInfoFormat.GML:undefined;var d=r["queryable"]===true&&p!==undefined;s=new T["a"]({id:i,name:r["Title"],ogcImageType:f,ogcLayers:[{name:r["Name"],queryable:d}],ogcType:T["a"].Type.WMS,visible:true,wmsInfoFormat:p,wmsUrl:n});this.extDataSources_[i]=s}var g=this.getWMSGroup(n);if(g){if(!g.dataSources.includes(s)){g.addDataSource(s);this.dataSources_.push(s)}}else{g=new I({dataSources:[s],injector:this.injector_,title:o["Title"],url:n},this.ngeoLayerHelper_);this.addLayer_(g.layer);this.addWMSGroup_(g);this.dataSources_.push(s)}};e.prototype.createAndAddDataSourceFromWMTSCapability=function t(r,a,i){var o=e.getId(r);if(this.wmtsCache_[o]){return}var s=void 0;if(this.extDataSources_[o]){s=this.extDataSources_[o]}else{var l=n["a"].assertString(r["Title"]);var u=n["a"].assertString(r["Identifier"]);s=new T["a"]({id:o,name:l,ogcType:T["a"].Type.WMTS,visible:true,wmtsLayer:u,wmtsUrl:i});this.extDataSources_[o]=s}var c=this.getWMTSGroup(i);if(!c){c=new x({dataSources:[],title:a["ServiceIdentification"]["Title"],url:i});this.addWMTSGroup_(c)}c.addDataSource(s);var f=this.ngeoLayerHelper_.createWMTSLayerFromCapabilititesObj(a,r);this.addLayer_(f);this.dataSources_.push(s);this.wmtsCache_[o]={layerObj:f,unregister:this.rootScope_.$watch(function(){return s.visible},this.handleWMTSDataSourceVisibleChange_.bind(this,f))}};e.prototype.createAndAddDataSourceFromFile=function e(t,r){var a=this;this.getFileDataSource_(t).then(function(e){var t=true;var n=a.fileGroup_;if(Object(G["H"])(e.extent)){t=false}else{if(n.dataSources.includes(e)){return}a.addLayer_(e.layer);n.addDataSource(e);a.map_.getView().fit(e.extent);a.dataSources_.push(e)}if(r){r(t)}},function(e){console.error("Failed to load file: "+t.name);if(r){r(false)}})};e.prototype.getFileDataSource_=function t(r){var a=this;var n=this.q_.defer();if(this.files_[r.name]){n.resolve(this.files_[r.name])}else{var i=this.ngeoFile_;i.read(r).then(function(t){var o=void 0;var s={featureProjection:a.map_.getView().getProjection()};if(i.isKml(t)){o=new V["a"]({extractStyles:false}).readFeatures(t,s)}else if(i.isGpx(t)){o=(new j["a"]).readFeatures(t,s)}if(o){var l=e.getId(r);var c=new v({features:new u["b"](o),id:l,name:r.name,visible:true});a.files_[r.name]=c;a.extDataSources_[l]=c;n.resolve(c)}else{n.reject()}})}return n.promise};e.prototype.handleWMTSDataSourceVisibleChange_=function e(t,r,a){if(r!==undefined&&r!==a){t.setVisible(r)}};e.prototype.handleDataSourcesRemove_=function e(t){var r=t.element;if(this.extDataSources_[r.id]===r){if(r instanceof v){this.removeFileDataSource_(r)}else if(r instanceof T["a"]){this.removeOGCDataSource_(r)}}};e.prototype.removeFileDataSource_=function e(t){this.removeLayer_(t.layer);this.fileGroup_.removeDataSource(t)};e.prototype.removeOGCDataSource_=function e(t){if(t.ogcType===T["a"].Type.WMS){var r=t.wmsUrl;n["a"].assert(r);var a=this.getWMSGroup(r);if(a&&a.dataSources.includes(t)){a.removeDataSource(t);if(!a.dataSources.length){this.removeLayer_(a.layer);a.destroy();this.removeWMSGroup_(a)}}}else if(t.ogcType===T["a"].Type.WMTS){var i=t.wmtsUrl;n["a"].assert(i);var o=this.getWMTSGroup(i);if(o&&o.dataSources.includes(t)){o.removeDataSource(t);var s=t.id;this.removeLayer_(this.wmtsCache_[s].layerObj);this.wmtsCache_[s].unregister();delete this.wmtsCache_[s];if(!o.dataSources.length){o.destroy();this.removeWMTSGroup_(o)}}}};H(e,[{key:"fileGroup",get:function e(){return this.fileGroup_}},{key:"wmsGroups",get:function e(){return this.wmsGroupsCollection_.getArray()}},{key:"wmsGroupsCollection",get:function e(){return this.wmsGroupsCollection_}},{key:"wmtsGroups",get:function e(){return this.wmtsGroupsCollection_.getArray()}},{key:"wmtsGroupsCollection",get:function e(){return this.wmtsGroupsCollection_}},{key:"layerGroup",get:function e(){var t=this.map_;n["a"].assert(t);return this.ngeoLayerHelper_.getGroupFromMap(t,a["a"].EXTERNALLAYERGROUP_NAME)}},{key:"map",set:function e(t){this.map_=t}}]);return e}();B.getId=function(e){return N["c"](e)+1e6};B.module=angular.module("gmfExternalDataSourcesManager",[i["a"].module.name,o["a"].module.name,s["a"].module.name]);B.module.service("gmfExternalDataSourcesManager",B);var q=t["a"]=B},,function(e,t,r){"use strict";var a=r(2);var n=r(180);var i=r(18);var o=r(3);var s=r(226);var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(){u(this,e);this.collection_=new i["b"];this.map_=null;this.listenerKeys_=[];o["a"](this.collection_,"add",this.handleDataSourcesAdd_,this)}e.prototype.bindMap_=function e(t){var r=t.getView();this.listenerKeys_.push(o["a"](r,"change:resolution",this.handleViewResolutionChange_,this));var n=r.getResolution();a["a"].assertNumber(n);this.syncDataSourcesToResolution_(n)};e.prototype.unbindMap_=function e(t){this.listenerKeys_.forEach(o["e"]);this.listenerKeys_=[]};e.prototype.handleViewResolutionChange_=function e(t){var r=t.target;a["a"].assertInstanceof(r,s["a"]);var n=r.getResolution();a["a"].assertNumber(n);this.syncDataSourcesToResolution_(n)};e.prototype.syncDataSourcesToResolution_=function e(t){var r=this;this.collection_.forEach(function(e){r.syncDataSourceToResolution_(e,t)})};e.prototype.syncDataSourceToResolution_=function e(t,r){if(!t.supportsDynamicInRange){return}var a=t.maxResolution;var n=t.minResolution;var i=n===null||n===undefined||r>=n;var o=a===null||a===undefined||r<=a;var s=i&&o;t.inRange=s};e.prototype.handleDataSourcesAdd_=function e(t){var r=a["a"].assertInstanceof(t.element,n["a"]);if(this.map_){var i=this.map_.getView().getResolution();a["a"].assertNumber(i);this.syncDataSourceToResolution_(r,i)}};l(e,[{key:"map",set:function e(t){if(this.map_===t){return}if(this.map_){this.unbindMap_(this.map_)}this.map_=t;if(t){this.bindMap_(t)}}},{key:"collection",get:function e(){return this.collection_}}]);return e}();c.module=angular.module("ngeoDataSources",[]);c.module.service("ngeoDataSources",c);t["a"]=c},function(e,t,r){"use strict";var a=r(46);var n=r(2);var i=r(106);var o=r(133);var s=r(1);var l=r(114);var u=r(93);var c=function e(t,r,a,n){var i=this;this.layerHelper_=r;this.ngeoWMSTime_=a;this.ogcServersObject_;n.getOgcServersObject().then(function(e){i.ogcServersObject_=e});t.$on("ngeo-layertree-state",function(e,t,r){i.sync_(e,r)})};c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"];c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"];c.prototype.createLayer=function(e,t,r,a){var n=null;if(e.node.children!==undefined&&e.node.mixed){n=this.createGroup_(e,t,r,a)}else if(e.node.children===undefined&&e.parent.node.mixed){n=this.createLeafInAMixedGroup_(e,t)}else if(e.node.children===undefined){this.initGmfLayerInANotMixedGroup_(e,t)}else if(e.depth===1&&!e.node.mixed){n=this.createGroup_(e,t,r,a)}if(n&&e.node.metadata.opacity){n.setOpacity(e.node.metadata.opacity)}return n};c.prototype.sync_=function(e,t){var r=this;t.traverseDepthFirst(function(e){if(e.layer&&!e.node.mixed){r.updateLayerState_(e.layer,e)}})};c.prototype.updateLayerState_=function(e,t){var r=t.getState()==="on";if(t.node.type==="WMTS"){e.setVisible(r)}else if(!t.node.mixed&&t.depth===1){n["a"].assertInstanceof(e,l["a"]);var a=[];var i=[];t.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.getState()==="on"){a.push(e.node.layers);var t=e.node.style!==undefined?e.node.style:"";i.push(t)}});if(a.length===0){e.setVisible(false)}e.getSource().updateParams({LAYERS:a.reverse().join(","),STYLES:i.reverse().join(",")});if(a.length!==0){e.setVisible(true)}}else{n["a"].assertInstanceof(e,l["a"]);e.setVisible(r)}};c.prototype.createGroup_=function(e,t,r,a){var n=e.node;var i=null;var o=e.parent.isRoot;var s=true;if(n.metadata.printNativeAngle!==undefined){s=n.metadata.printNativeAngle}if(o){i=this.createLayerFromGroup_(e,!!n.mixed);var l=a|0;r.getLayers().insertAt(l,i)}else{var u=!this.isOneParentNotMixed_(e);if(u){i=this.createLayerFromGroup_(e,true);var f=c.getLayer(e.parent);f.getLayers().insertAt(0,i)}}i.set("printNativeAngle",s);return i};c.prototype.createLayerFromGroup_=function(e,t){var r=this;var a=void 0;var i=e.node;if(t){a=this.layerHelper_.createBasicGroup()}else{var o=this.getTimeParam_(e);var s=this.ogcServersObject_[i.ogcServer||""];n["a"].assert(s);n["a"].assert(s.url);n["a"].assert(s.type);n["a"].assert(s.imageType);a=this.layerHelper_.createBasicWMSLayer(s.url,"",s.imageType,s.type,o,undefined,s.credential?"use-credentials":"anonymous");var l=false;e.traverseDepthFirst(function(e){r.updateLayerReferences_(e.node,a);if(e.node.metadata.isChecked){e.setState("on",false);r.updateLayerState_(a,e);l=true}});a.setVisible(l);a.set("layerNodeName",i.name)}return a};c.prototype.createLeafInAMixedGroup_=function(e,t){var r=e.node;var a=void 0;if(r.type==="WMTS"){a=this.createWMTSLayer_(r)}else{var i=r;var o=this.getTimeParam_(e);var s=this.ogcServersObject_[i.ogcServer];n["a"].assert(s);n["a"].assert(s.url);n["a"].assert(s.type);n["a"].assert(i.layers);n["a"].assert(s.imageType);var l={STYLES:i.style};a=this.layerHelper_.createBasicWMSLayer(s.url,i.layers,s.imageType,s.type,o,l,s.credential?"use-credentials":"anonymous")}a.set("layerNodeName",r.name);this.updateLayerReferences_(r,a);var u=r.metadata.isChecked===true;if(u){e.setState("on",false)}a.setVisible(u);var f=c.getLayer(e.parent);f.getLayers().insertAt(0,a);return a};c.prototype.initGmfLayerInANotMixedGroup_=function(e,t){var r=e.node;var a=this.getFirstLevelGroupCtrl_(e);n["a"].assert(a);var i=a.layer;n["a"].assertInstanceof(i,l["a"]);this.updateLayerReferences_(r,i);if(r.metadata.isChecked){e.setState("on",false);this.updateLayerState_(i,a)}else{e.parent.refreshState()}};c.prototype.createWMTSLayer_=function(e){var t=new u["a"];n["a"].assert(e.url);n["a"].assert(e.layer);this.layerHelper_.createWMTSLayerFromCapabilitites(e.url,e.layer,e.matrixSet,e.dimensions).then(function(e){t.setSource(e.getSource());t.set("capabilitiesStyles",e.get("capabilitiesStyles"))});return t};c.prototype.updateLayerReferences_=function(e,t){var r=s["c"](e);var a=t.get("querySourceIds")||[];a.push(r);t.set("querySourceIds",a);var n=e.metadata.disclaimer;if(n){var i=t.get("disclaimers")||[];i.push(e.metadata.disclaimer);t.set("disclaimers",i)}};c.prototype.getTimeParam_=function(e){var t=void 0;var r=void 0;var a=e.node;if(a.time){t=a.time}else if(a.children){e.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.node.time){t=e.node.time;return i["a"].VisitorDecision.STOP}})}if(t){var n=this.ngeoWMSTime_.getOptions(t)["values"];r=this.ngeoWMSTime_.formatWMSTimeParam(t,{start:n[0]||n,end:n[1]})}return r};c.prototype.isOneParentNotMixed_=function(e){var t=e.parent;var r=false;do{r=t.node.mixed===false;t=t.parent}while(t.parent&&!r);return r};c.prototype.getFirstLevelGroupCtrl_=function(e){var t=e;while(!t.parent.isRoot){t=t.parent}return t};c.getLayer=function(e){var t=e;var r=null;while(!t.isRoot&&r===null){if(t.layer){r=t.layer}t=t.parent}return r};c.module=angular.module("gmfSyncLayertreeMap",[a["a"].module.name,i["a"].module.name,o["a"].module.name]);c.module.service("gmfSyncLayertreeMap",c);t["a"]=c},,,,,function(e,t,r){"use strict";(function(e){var a=r(275);var n=r(228);var i=r(274);var o=r(168);var s=r(2);var l=r(242);var u=r(317);var c=r.n(u);var f=r(455);var h=r.n(f);var p=r(347);var d=r(345);var g=r(52);var m=r(212);var v=r(20);var y=r(230);var _=r(229);var b=r(101);var S=r(232);var C=r(238);var w=r(189);var T=r(140);var E=r(131);var A=r(65);var L=r(69);var P=r(188);var M=r(1);var x=r(7);var F=r(18);var R=r(3);var D=r(4);var k=r(22);var $=r(135);var O=r(223);var I=r(114);var N=r(93);var G=r(45);var U=r(13);var j=r(104);var V=angular.module("GmfEditingFeatureComponent",[a["a"].module.name,n["a"].module.name,i["a"].module.name,p["a"].name,d["a"].name,b["a"].module.name,C["a"].name,w["a"].name,E["a"].module.name,A["a"].module.name,P["a"].module.name]);V.run(["$templateCache",function(e){e.put("gmf/editing/editFeatureComponent",r(377))}]);V.component_=function(){return{controller:"GmfEditfeatureController as efCtrl",scope:{dirty:"=gmfEditfeatureDirty",editableTreeCtrl:"=gmfEditfeatureEditabletreectrl",map:"<gmfEditfeatureMap",state:"=gmfEditfeatureState",tolerance:"<?gmfEditfeatureTolerance",vectorLayer:"<gmfEditfeatureVector",closeAfterSave:"=?gmfEditfeatureCloseaftersave"},bindToController:true,templateUrl:"gmf/editing/editFeatureComponent"}};V.directive("gmfEditfeature",V.component_);V.Controller_=function(e,t,r,a,n,i,o,s,l,u,c,f){var h=this;this.dirty;this.editableTreeCtrl;this.map;this.state;this.tolerance;this.vectorLayer;this.closeAfterSave=false;this.element_=e;this.q_=t;this.scope_=r;this.timeout_=a;this.gettextCatalog_=n;this.gmfEditFeature_=i;this.gmfSnapping_=o;this.gmfXSDAttributes_=s;this.ngeoEventHelper_=l;this.ngeoFeatureHelper_=u;this.ngeoLayerHelper_=c;this.ngeoToolActivateMgr_=f;this.editableNode_;this.editableWMSLayer_;this.confirmDeferred_=null;this.unsavedModificationsModalShown=false;this.pending=false;this.active=true;this.createActive=false;this.createToolActivate=new L["a"](this,"createActive");this.mapSelectActive=true;this.mapSelectToolActivate=new L["a"](this,"mapSelectActive");this.feature=null;this.scope_.$watch(function(){return h.feature},this.handleFeatureChange_.bind(this));this.featureId=undefined;this.features;this.interactions_=new F["b"];this.modify_;this.modifyToolActivate;this.menu_=new S["a"]({actions:[{cls:"fa fa-arrows",label:n.getString("Move"),name:"move"},{cls:"fa fa-rotate-right",label:n.getString("Rotate"),name:"rotate"}]});this.translate_;this.rotate_;this.rotateToolActivate;this.translateToolActivate;this.listenerKeys_=[];this.attributes=null;this.geomType;this.showServerError=false;this.serverErrorMessage=null;this.serverErrorType=null};V.Controller_.$inject=["$element","$q","$scope","$timeout","gettextCatalog","gmfEditFeature","gmfSnapping","gmfXSDAttributes","ngeoEventHelper","ngeoFeatureHelper","ngeoLayerHelper","ngeoToolActivateMgr"];V.Controller_.prototype.$onInit=function(){var t=this;var r=this.gettextCatalog_.getCurrentLanguage();e.datetimepicker.setLocale(r);e.datetimepicker.setDateFormatter(new l["a"]);this.dirty=this.dirty===true;this.editableNode_=this.editableTreeCtrl.node;this.features=this.vectorLayer.getSource().getFeaturesCollection();this.tolerance=this.tolerance!==undefined?this.tolerance:10;var a=o["a"].getLayer(this.editableTreeCtrl);s["a"].assert(a instanceof I["a"]||a instanceof N["a"]);this.editableWMSLayer_=a;this.modify_=new O["a"]({deleteCondition:g["b"].deleteCondition,features:this.features,style:this.ngeoFeatureHelper_.getVertexStyle(false)});this.interactions_.push(this.modify_);this.rotate_=new y["a"]({features:this.features,style:new U["c"]({text:new j["a"]({text:"",font:"normal 18px FontAwesome",fill:new G["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.rotate_);this.translate_=new _["a"]({features:this.features,style:new U["c"]({text:new j["a"]({text:"",font:"normal 18px FontAwesome",fill:new G["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.translate_);this.initializeInteractions_();this.modifyToolActivate=new L["a"](this.modify_,"active");this.rotateToolActivate=new L["a"](this.rotate_,"active");this.translateToolActivate=new L["a"](this.translate_,"active");this.map.addOverlay(this.menu_);this.scope_.$watch(function(){return t.createActive},function(e,r){if(e){t.gmfSnapping_.ensureSnapInteractionsOnTop()}});this.scope_.$on("$destroy",this.handleDestroy_.bind(this));var n=M["c"](this);this.ngeoEventHelper_.addListenerKey(n,R["a"](this.features,"add",this.handleFeatureAdd_,this));this.scope_.$watch(function(){return t.mapSelectActive},this.handleMapSelectActiveChange_.bind(this));this.scope_.$watch(function(){return t.state},function(e,r){var a=V.State;if(e===a.STOP_EDITING_PENDING){t.confirmCancel().then(function(){t.state=a.STOP_EDITING_EXECUTE})}else if(e===a.DEACTIVATE_PENDING){t.confirmCancel().then(function(){t.state=a.DEACTIVATE_EXECUTE})}});this.scope_.$watch(function(){return t.unsavedModificationsModalShown},function(e,r){if(r&&!e){t.state=V.State.IDLE}});this.gmfXSDAttributes_.getAttributes(this.editableNode_.id).then(this.setAttributes_.bind(this));this.toggle_(true)};V.Controller_.prototype.save=function(){var e=this;s["a"].assert(this.attributes);var t=this.feature.clone();t.setId(this.feature.getId());var r=this.featureId;this.pending=true;var a=new l["a"];for(var n=this.attributes,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var u;if(i){if(o>=n.length)break;u=n[o++]}else{o=n.next();if(o.done)break;u=o.value}var c=u;if(c.format){if(this.feature.get(c.name)){var f=this.feature.get(c.name);s["a"].assertString(f);var h=a.parseDate(f,c.format);var p="Y-m-d\\TH:i:s";if(c.type==="date"){p="Y-m-d"}else if(c.type==="time"){p="H:i:s"}else if(c.type==="datetime"){h.setMinutes(h.getMinutes()+h.getTimezoneOffset())}t.set(c.name,a.formatDate(h,p))}else{t.set(c.name,null)}}}var d=r?this.gmfEditFeature_.updateFeature(this.editableNode_.id,t):this.gmfEditFeature_.insertFeatures(this.editableNode_.id,[t]);d.then(function(t){e.dirty=false;e.pending=false;e.handleEditFeature_(t);e.gmfSnapping_.refresh();if(e.closeAfterSave){e.cancel()}},function(t){e.showServerError=true;e.pending=false;e.serverErrorType="error type : "+t.data["error_type"];e.serverErrorMessage="error message : "+t.data["message"]})};V.Controller_.prototype.cancel=function(){this.dirty=false;this.feature=null;this.features.clear();this.menu_.close();this.unsavedModificationsModalShown=false};V.Controller_.prototype.confirmCancel=function(){var e=this;return this.checkForModifications_().then(function(){e.cancel()})};V.Controller_.prototype.checkForModifications_=function(e){this.confirmDeferred_=this.q_.defer();if(this.feature&&this.dirty){this.unsavedModificationsModalShown=true;if(e){this.scope_.$apply()}}else{this.confirmDeferred_.resolve()}return this.confirmDeferred_.promise};V.Controller_.prototype.continueWithoutSaving=function(){this.cancel();this.confirmDeferred_.resolve()};V.Controller_.prototype.delete=function(){var e=this;var t=this.gettextCatalog_.getString("Do you really want to delete the selected feature?");if(confirm(t)){this.pending=true;this.gmfEditFeature_.deleteFeature(this.editableNode_.id,this.feature).then(function(t){e.dirty=false;e.pending=false;e.ngeoLayerHelper_.refreshWMSLayer(e.editableWMSLayer_);e.cancel()},function(t){e.showServerError=true;e.pending=false;e.serverErrorType="error type : "+t.data["error_type"];e.serverErrorMessage="error message : "+t.data["message"]})}};V.Controller_.prototype.submit=function(){var e=this;this.timeout_(function(){e.element_.find('input[type="submit"]').click()},0)};V.Controller_.prototype.handleEditFeature_=function(e){var t=(new $["a"]).readFeatures(e.data);if(t.length){this.feature.setId(t[0].getId());this.ngeoLayerHelper_.refreshWMSLayer(this.editableWMSLayer_)}if(this.confirmDeferred_){this.confirmDeferred_.resolve()}};V.Controller_.prototype.setAttributes_=function(e){this.attributes=e;for(var t=e,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;if(i.type=="date"){i.format="Y-m-d";i.mask="9999-19-39"}else if(i.type=="time"){i.format="H:i";i.mask="29:59"}else if(i.type=="datetime"){i.format="Y-m-d H:i";i.mask="9999-19-39 29:59"}}var o=m["a"].getGeometryAttribute(this.attributes);if(o&&o.geomType){this.geomType=o.geomType}};V.Controller_.prototype.handleFeatureAdd_=function(e){var t=this;this.feature=null;this.timeout_(function(){s["a"].assert(t.attributes);var r=e.element;s["a"].assertInstanceof(r,k["a"]);var a=new l["a"];for(var n=t.attributes,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var u;if(i){if(o>=n.length)break;u=n[o++]}else{o=n.next();if(o.done)break;u=o.value}var c=u;if(c.format){if(r.get(c.name)){var f=void 0;if(c.type==="datetime"){f=new Date(r.get(c.name));f.setMinutes(f.getMinutes()-f.getTimezoneOffset())}else{var h="";if(c.type==="date"){h="Y-m-d"}else if(c.type==="time"){h="H:i:s"}var p=r.get(c.name);s["a"].assertString(p);f=a.parseDate(p,h)}r.set(c.name,a.formatDate(f,c.format))}else{r.set(c.name,null)}}}t.feature=r;t.createActive=false;if(!r.getId()){t.dirty=true}t.scope_.$apply()},0)};V.Controller_.prototype.toggle_=function(e){var t=this.listenerKeys_;var r=["create-",M["c"](this)].join("-");var a=["other-",M["c"](this)].join("-");var n=this.ngeoToolActivateMgr_;if(e){t.push(R["a"](this.menu_,"actionclick",this.handleMenuActionClick_,this));t.push(R["a"](this.translate_,"translateend",this.handleTranslateEnd_,this));t.push(R["a"](this.rotate_,"rotateend",this.handleRotateEnd_,this));n.registerTool(r,this.createToolActivate,false);n.registerTool(r,this.mapSelectToolActivate,true);n.registerTool(a,this.createToolActivate,false);n.registerTool(a,this.modifyToolActivate,true);n.registerTool(a,this.translateToolActivate,false);n.registerTool(a,this.rotateToolActivate,false)}else{t.forEach(R["e"]);t.length=0;n.unregisterTool(r,this.createToolActivate);n.unregisterTool(r,this.mapSelectToolActivate);n.unregisterTool(a,this.createToolActivate);n.unregisterTool(a,this.modifyToolActivate);n.unregisterTool(a,this.translateToolActivate);n.unregisterTool(a,this.rotateToolActivate);this.createActive=false;this.cancel()}this.modify_.setActive(e);this.mapSelectActive=e;this.editableTreeCtrl.properties["editing"]=e};V.Controller_.prototype.handleMapSelectActiveChange_=function(e){var t=this.map.getViewport();s["a"].assertElement(t);if(e){R["a"](this.map,"click",this.handleMapClick_,this);R["a"](t,"contextmenu",this.handleMapContextMenu_,this)}else{R["c"](this.map,"click",this.handleMapClick_,this);R["c"](t,"contextmenu",this.handleMapContextMenu_,this)}};V.Controller_.prototype.handleMapClick_=function(e){var t=this;var r=e.target.getInteractions().getArray();var a=r.find(function(e){return e.getActive()===true});if(this.cancelEventKey_===undefined){this.cancelEventKey_=R["a"](document.body,"keydown",function(e){var r=e.keyCode===27;if(!g["a"].mousedown&&r&&a.getActive()){t.cancel();t.scope_.$apply();R["e"](t.cancelEventKey_);t.cancelEventKey_=undefined}})}var n=e.coordinate;var i=e.pixel;var o=this.map.forEachFeatureAtPixel(i,function(e){var r=false;if(x["f"](t.features.getArray(),e)){r=e}return r},{hitTolerance:5});if(o){return}this.checkForModifications_(true).then(function(){var e=t.map;var r=e.getView();var a=r.getResolution();var i=a*t.tolerance;var o=D["c"]([n[0],n[1],n[0],n[1]],i);t.gmfEditFeature_.getFeaturesInExtent([t.editableNode_.id],o).then(t.handleGetFeatures_.bind(t));t.cancel();t.pending=true})};V.Controller_.prototype.handleMapContextMenu_=function(e){var t=this;var r=this.map.getEventPixel(e);var a=this.map.getCoordinateFromPixel(r);var n=this.map.forEachFeatureAtPixel(r,function(e){var r=false;if(x["f"](t.features.getArray(),e)){r=e}return r},{hitTolerance:7});n=n?n:null;if(n){var i=this.ngeoFeatureHelper_.getType(n);if(i===v["a"].POLYGON||i===v["a"].MULTI_POLYGON||i===v["a"].LINE_STRING||i===v["a"].MULTI_LINE_STRING){this.menu_.open(a)}e.preventDefault();e.stopPropagation()}};V.Controller_.prototype.handleGetFeatures_=function(e){var t=this;this.pending=false;this.timeout_(function(){if(e.length){var r=e[0];t.feature=r;t.features.push(r)}},0)};V.Controller_.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(false);T["a"].interaction(e)})};V.Controller_.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})};V.Controller_.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})};V.Controller_.prototype.handleFeatureChange_=function(e,t){var r=this;var a=void 0;if(t){R["c"](t,"propertychange",this.handleFeaturePropertyChange_,this);a=t.getGeometry();s["a"].assert(a);R["c"](a,"change",this.handleFeatureGeometryChange_,this);this.unregisterInteractions_()}if(e){this.featureId=e.getId();R["a"](e,"propertychange",this.handleFeaturePropertyChange_,this);a=e.getGeometry();s["a"].assert(a);R["a"](a,"change",this.handleFeatureGeometryChange_,this);this.registerInteractions_();this.gmfSnapping_.ensureSnapInteractionsOnTop();if(this.featureId){this.timeout_(function(){r.dirty=false;r.scope_.$apply()},0)}}else{this.featureId=undefined}};V.Controller_.prototype.handleFeaturePropertyChange_=function(){this.dirty=true};V.Controller_.prototype.handleFeatureGeometryChange_=function(){this.dirty=true;this.scope_.$apply()};V.Controller_.prototype.handleMenuActionClick_=function(e){var t=e.detail.action;switch(t){case"move":this.translate_.setActive(true);this.scope_.$apply();break;case"rotate":this.rotate_.setActive(true);this.scope_.$apply();break;default:break}};V.Controller_.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(false);this.scope_.$apply()};V.Controller_.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(false);this.scope_.$apply()};V.Controller_.prototype.handleDestroy_=function(){this.features.clear();this.handleFeatureChange_(null,this.feature);this.feature=null;var e=M["c"](this);this.ngeoEventHelper_.clearListenerKey(e);this.toggle_(false);this.handleMapSelectActiveChange_(false);this.unregisterInteractions_();R["e"](this.cancelEventKey_);this.cancelEventKey_=undefined};V.controller("GmfEditfeatureController",V.Controller_);V.State={IDLE:"idle",DEACTIVATE_EXECUTE:"deactivate_execute",DEACTIVATE_PENDING:"deactivate_pending",STOP_EDITING_EXECUTE:"stop_editing_execute",STOP_EDITING_PENDING:"stop_editing_pending"};t["a"]=V}).call(this,r(36))},,,,function(e,t,r){"use strict";var a=r(132);var n=r(46);var i=r(190);var o=function e(t,r,a,n,i){this.$rootScope_=t;this.gmfThemes_=r;this.modeFlush=a;this.gmfTreeManager_=n;this.ngeoStateManager_=i;this.themeName_=""};o.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"];o.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"];o.prototype.addTheme=function(e,t){if(this.modeFlush){this.ngeoStateManager_.updateState({theme:e.name});this.setThemeName(e.name);this.gmfTreeManager_.setFirstLevelGroups(e.children)}else{this.gmfTreeManager_.addFirstLevelGroups(e.children,false,t)}};o.prototype.getThemeName=function(){return this.themeName_};o.prototype.isLoading=function(){return!this.gmfThemes_.loaded};o.prototype.updateCurrentTheme=function(e,t,r){var a=this;this.gmfThemes_.getThemesObject().then(function(i){if(!e&&a.modeFlush){var o=n["a"].findThemeByName(i,t);if(o){a.gmfTreeManager_.addFirstLevelGroups(o.children,false,r)}}if(e){var s=n["a"].findThemeByName(i,e);if(s){a.addTheme(s,true)}}else{a.setThemeName(t)}})};o.prototype.setThemeName=function(e,t){this.themeName_=e;if(!t){this.$rootScope_.$emit(o.EventType.THEME_NAME_SET,e)}};o.prototype.removeAll=function(){this.gmfTreeManager_.removeAll()};o.EventType={THEME_NAME_SET:"gmf-thememanager-theme_name_set"};o.module=angular.module("gmfThemeManager",[a["a"].module.name,n["a"].module.name,i["a"].module.name]);o.module.value("gmfTreeManagerModeFlush",true);o.module.service("gmfThemeManager",o);t["a"]=o},,,function(e,t,r){"use strict";var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var i=function(){function e(t){n(this,e);this.inRange_=t.inRange!==false;this.visible_=t.visible===true;this.attributes=t.attributes||null;this.id_=t.id;this.identifierAttribute_=t.identifierAttribute;this.maxResolution_=t.maxResolution;this.minResolution_=t.minResolution;this.name_=t.name}e.prototype.getAttributes=function e(){return this.attributes};e.prototype.setAttributes=function e(t){this.attributes=t};a(e,[{key:"inRange",get:function e(){return this.inRange_},set:function e(t){this.inRange_=t}},{key:"visible",get:function e(){return this.visible_},set:function e(t){this.visible_=t}},{key:"id",get:function e(){return this.id_}},{key:"identifierAttribute",get:function e(){return this.identifierAttribute_}},{key:"maxResolution",get:function e(){return this.maxResolution_}},{key:"minResolution",get:function e(){return this.minResolution_}},{key:"name",get:function e(){return this.name_}},{key:"queryable",get:function e(){return false}},{key:"supportsDynamicInRange",get:function e(){return this.maxResolution!==null||this.minResolution!==null}}]);return e}();t["a"]=i},,,,,function(e,t,r){"use strict";var a=r(38);var n=r(47);var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function s(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function l(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=function(e){l(t,e);function t(r){o(this,t);r.operator=n["a"].OperatorType.EQUAL_TO;r.type=a["a"].SELECT;var i=s(this,e.call(this,r));i.choices_=r.choices;return i}i(t,[{key:"choices",get:function e(){return this.choices_}},{key:"selectedChoices",get:function e(){var t=void 0;if(this.expression){var r=String(this.expression);t=r.split(",")}else{t=[]}return t}}]);return t}(n["a"]);t["a"]=u},,function(e,t,r){"use strict";var a=angular.module("ngeoDebounce",[]);a.factory_=function(e){return function(t,r,a){var n=null;return function(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++){o[s]=arguments[s]}var l=this;var u=function e(){n=null;t.apply(l,o)};if(n!==null){e.cancel(n)}n=e(u,r,a)}}};a.factory_.$inject=["$timeout"];a.factory("ngeoDebounce",a.factory_);t["a"]=a},function(e,t,r){"use strict";var a=r(2);var n=function e(t){this.groups_={};this.scope_=t};n.$inject=["$rootScope"];n.$inject=["$rootScope"];n.prototype.registerTool=function(e,t,r){var n=this;var i=this.groups_[e];if(!i){i=this.groups_[e]=[]}var o=this.scope_.$watch(t.getActive,function(r,a){if(r===a){return}if(r){n.deactivateTools_(e,t)}else{n.activateDefault_(e)}});i.push({tool:t,defaultTool:r||false,unlisten:o});if(a["a"].ENABLE_ASSERTS){var s=0;i.forEach(function(e){if(e.defaultTool){s++}});a["a"].assert(s<=1,"more than one default tool in group "+e)}};n.prototype.unregisterTool=function(e,t){var r=this.groups_[e];if(r){for(var a=0;a<r.length;a++){if(r[a].tool==t){r[a].unlisten();r.splice(a,1);break}}}};n.prototype.unregisterGroup=function(e){var t=this.groups_[e];if(t){for(var r=0;r<t.length;r++){t[r].unlisten()}delete this.groups_[e]}};n.prototype.activateTool=function(e){e.setActive(true)};n.prototype.deactivateTool=function(e){e.setActive(false)};n.prototype.deactivateTools_=function(e,t){var r=this.groups_[e];for(var a=0;a<r.length;a++){if(t!=r[a].tool){r[a].tool.setActive(false)}}};n.prototype.activateDefault_=function(e){var t=this.groups_[e];var r=null;var a=false;for(var n=0;n<t.length;n++){a=a||t[n].tool.getActive();if(t[n].defaultTool){r=t[n].tool}}if(!a&&r!==null){r.setActive(true)}};n.module=angular.module("ngeoToolActivateMgr",[]);n.module.service("ngeoToolActivateMgr",n);t["a"]=n},function(e,t,r){"use strict";var a=angular.module("ngeoBtnComponent",[]);a.btnGroupComponent_=function(e){return{restrict:"A",controller:"ngeoBtnGroupController",link:function t(r,a,n,i){var o=e(n["ngeoBtnGroupActive"]).assign;if(o){r.$watch(function(){return i.buttons_.some(function(e){return e(r)===true})},function(e){o(r,e)})}}}};a.btnGroupComponent_.$inject=["$parse"];a.directive("ngeoBtnGroup",a.btnGroupComponent_);a.BtnGroupController=function(e){this.buttons_=[];this.scope_=e};a.BtnGroupController.$inject=["$scope"];a.BtnGroupController.prototype.activate=function(e){var t=this;this.buttons_.forEach(function(r,a){if(a!=e){r.assign(t.scope_,false)}})};a.BtnGroupController.prototype.addButton=function(e){this.buttons_.push(e);return this.buttons_.length-1};a.controller("ngeoBtnGroupController",a.BtnGroupController);a.btnComponent_=function(e){return{require:["?^ngeoBtnGroup","ngModel"],restrict:"A",link:function t(r,a,n,i){var o=i[0];var s=i[1];var l=-1;var u=e(n["ngModel"]);var c=u.assign;if(u(r)===undefined){c(r,false)}if(o!==null){l=o.addButton(u)}a.on("click",function(){r.$apply(function(){s.$setViewValue(!s.$viewValue);s.$render()})});s.$render=function(){if(s.$viewValue&&o!==null){o.activate(l)}a.toggleClass("active",s.$viewValue)}}}};a.btnComponent_.$inject=["$parse"];a.directive("ngeoBtn",a.btnComponent_);t["a"]=a},function(e,t,r){"use strict";var a=r(2);var n=r(233);var i=function e(t,r){var n=this;this.initialState={};this.ngeoLocation=t;this.usedKeyRegexp=r;this.useLocalStorage_;this.setUseLocalStorage(false);var i=t.getParamKeys().filter(function(e){return e!="debug"&&e!="no_redirect"});if(i.length===0){if(this.useLocalStorage_){var o=function e(t){a["a"].assert(t);n.usedKeyRegexp.some(function(e){if(t.match(e)){var r=window.localStorage[t];if(r!==undefined||r!==null){n.initialState[t]=r}else{n.initialState[t]=""}return true}})};for(var s in window.localStorage){o(s)}}}else{i.forEach(function(e){n.usedKeyRegexp.some(function(t){if(e.match(t)){var r=n.ngeoLocation.getParam(e);if(r!==undefined){n.initialState[e]=r;return true}}})})}};i.$inject=["ngeoLocation","ngeoUsedKeyRegexp"];i.$inject=["ngeoLocation","ngeoUsedKeyRegexp"];i.prototype.setUseLocalStorage=function(e){this.useLocalStorage_=e;if(this.useLocalStorage_){try{if("localStorage"in window){window.localStorage["test"]="";delete window.localStorage["test"]}else{this.useLocalStorage_=false}}catch(e){console.error(e);this.useLocalStorage_=false}}return this.useLocalStorage_};i.prototype.getInitialValue=function(e){return this.initialState[e]};i.prototype.getInitialStringValue=function(e){return this.initialState[e]};i.prototype.getInitialNumberValue=function(e){var t=this.initialState[e];if(t===undefined){return undefined}return parseFloat(t)};i.prototype.getInitialBooleanValue=function(e){var t=this.initialState[e];if(t===undefined){return undefined}return t==="true"};i.prototype.updateState=function(e){this.ngeoLocation.updateParams(e);if(this.useLocalStorage_){for(var t in e){a["a"].assert(t);var r=e[t];a["a"].assert(r!==undefined);window.localStorage[t]=r}}};i.prototype.deleteParam=function(e){this.ngeoLocation.deleteParam(e);if(this.useLocalStorage_){delete window.localStorage[e]}};i.module=angular.module("ngeoStateManager",[n["a"].module.name]);i.module.service("ngeoStateManager",i);i.module.value("ngeoUsedKeyRegexp",[new RegExp(".*")]);t["a"]=i},,function(e,t,r){"use strict";var a=r(13);var n={};n.getDefaultDrawStyleFunction=function(){var e=Object(a["b"])();return function(t,r){return e[t.getGeometry().getType()]}};n.getDefaultModifyStyleFunction=function(){var e=Object(a["b"])();return function(t,r){return e["Point"]}};t["a"]=n},,function(e,t,r){"use strict";(function(e){var a=r(82);var n=r(68);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function s(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function(t){r.$inject=["$http","$injector","$rootScope","authenticationBaseUrl","gmfUser"];s(r,t);function r(e,a,n,s,l){i(this,r);var u=o(this,t.call(this));u.$http_=e;u.$rootScope_=n;u.baseUrl_=s.replace(/\/$/,"");u.user_=l;u.noReloadRole_=a.has("gmfAuthenticationNoReloadRole")?a.get("gmfAuthenticationNoReloadRole"):null;u.load_();return u}r.prototype.load_=function e(){var t=this.baseUrl_+"/"+r.RouteSuffix.IS_LOGGED_IN;this.$http_.get(t,{withCredentials:true}).then(this.handleLogin_.bind(this,true))};r.prototype.changePassword=function t(a,n,i){var o=this;var s=this.baseUrl_+"/"+r.RouteSuffix.CHANGE_PASSWORD;return this.$http_.post(s,e.param({oldPassword:a,newPassword:n,confirmNewPassword:i}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:true}).then(function(e){o.user_.is_password_changed=true})};r.prototype.login=function t(a,n){var i=this.baseUrl_+"/"+r.RouteSuffix.LOGIN;return this.$http_.post(i,e.param({login:a,password:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:true}).then(this.handleLogin_.bind(this,false))};r.prototype.logout=function e(){var t=this;var a=this.user_["role_name"]===this.noReloadRole_;var n=this.baseUrl_+"/"+r.RouteSuffix.LOGOUT;return this.$http_.get(n,{withCredentials:true}).then(function(){t.resetUser_(a)})};r.prototype.resetPassword=function t(a){var n=this.baseUrl_+"/"+r.RouteSuffix.RESET_PASSWORD;var i=function(e){var t=e.data;return t}.bind(this);return this.$http_.post(n,e.param({login:a}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(i)};r.prototype.getFunctionalities=function e(){return this.user_.functionalities};r.prototype.getRoleId=function e(){return this.user_.role_id};r.prototype.handleLogin_=function e(t,r){var n=r.data;this.setUser_(n,!t);if(t){var i=new a["a"]("ready",{user:this.user_});this.dispatchEvent(i)}return r};r.prototype.setUser_=function e(t,r){for(var n in t){this.user_[n]=t[n]}if(r&&t.username!==undefined){var i=new a["a"]("login",{user:this.user_});this.dispatchEvent(i)}};r.prototype.resetUser_=function e(t){t=t||false;for(var r in this.user_){this.user_[r]=null}var n=new a["a"]("logout",{user:this.user_});this.dispatchEvent(n);if(!t){this.load_()}};return r}(n["a"]);l.RouteSuffix={CHANGE_PASSWORD:"loginchange",IS_LOGGED_IN:"loginuser",LOGIN:"login",LOGOUT:"logout",RESET_PASSWORD:"loginresetpassword"};l.module=angular.module("gmfAuthenticationService",[]);l.module.service("gmfAuthenticationService",l);l.module.value("gmfUser",{functionalities:null,is_password_changed:null,role_id:null,role_name:null,username:null});t["a"]=l}).call(this,r(36))},,,,function(e,t,r){"use strict";var a=function e(){};a.prototype.createDate=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return e!==null?new Date(e):t};a.prototype.getTime=function(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return e?e.getTime():t};a.prototype.getOptions=function(e){var t=this.createDate(e.minValue);var r=this.createDate(e.maxValue);var a=this.createDate(e.minDefValue,t);var n=this.createDate(e.maxDefValue,r);var i=e.mode==="range"?[this.getTime(a),this.getTime(n)]:this.getTime(a);return{minDate:this.getTime(t),maxDate:this.getTime(r),values:i}};a.prototype.getUTCDate=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())};a.module=angular.module("ngeoTime",[]);a.module.service("ngeoTime",a);t["a"]=a},,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(192);var i=r(82);var o=r(1);var s=r(22);var l=r(3);var u=r(17);var c=r(199);var f=r(157);var h=r(39);var p=r(30);var d=r(24);var g=r(64);var m=r(57);var v=function e(t){d["b"].call(this,{handleDownEvent:e.handleDownEvent_,handleEvent:e.handleEvent_,handleUpEvent:e.handleUpEvent_});this.downPx_=null;this.source_=t.source!==undefined?t.source:null;this.started_=false;this.sketchFeature_=null;this.sketchPoint_=null;this.squaredClickTolerance_=4;this.sketchLayer_=new g["a"]({source:new m["b"]({useSpatialIndex:false,wrapX:false}),style:t.style||n["a"].getDefaultDrawStyleFunction()});l["a"](this,"change:active",this.updateState_,this)};o["d"](v,d["b"]);v.handleDownEvent_=function(e){this.downPx_=e.pixel;return true};v.handleUpEvent_=function(e){var t=this.downPx_;var r=e.pixel;var a=t[0]-r[0];var n=t[1]-r[1];var i=a*a+n*n;var o=true;if(i<=this.squaredClickTolerance_){this.handlePointerMove_(e);if(!this.started_){this.startDrawing_(e)}else{this.finishDrawing_()}o=false}return o};v.handleEvent_=function(e){var t=true;if(e.type==="pointermove"){t=this.handlePointerMove_(e)}else if(e.type==="dblclick"){t=false}return d["c"].call(this,e)&&t};v.prototype.handlePointerMove_=function(e){if(this.started_){this.modifyDrawing_(e)}else{this.createOrUpdateSketchPoint_(e)}return true};v.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();if(this.sketchPoint_===null){this.sketchPoint_=new s["a"](new p["a"](t));this.updateSketchFeatures_()}else{var r=this.sketchPoint_.getGeometry();a["a"].assertInstanceof(r,p["a"]);r.setCoordinates(t)}};v.prototype.updateSketchFeatures_=function(){var e=[];if(this.sketchFeature_!==null){e.push(this.sketchFeature_)}if(this.sketchPoint_!==null){e.push(this.sketchPoint_)}var t=this.sketchLayer_.getSource();t.clear(true);t.addFeatures(e)};v.prototype.startDrawing_=function(e){var t=e.coordinate;this.started_=true;var r=new h["a"]([t.slice(),t.slice()]);var n=new c["a"](t,0);var o=new f["a"]([r,n]);a["a"].assert(o!==undefined);this.sketchFeature_=new s["a"];this.sketchFeature_.setGeometry(o);this.updateSketchFeatures_();var l=new i["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(l)};v.prototype.modifyDrawing_=function(e){var t=e.coordinate;var r=a["a"].assertInstanceof(this.sketchFeature_.getGeometry(),f["a"]);var n=r.getGeometriesArray();var i=n[0];a["a"].assertInstanceof(i,h["a"]);var o=i.getCoordinates();var s=this.sketchPoint_.getGeometry();a["a"].assertInstanceof(s,p["a"]);s.setCoordinates(t);var l=o[o.length-1];l[0]=t[0];l[1]=t[1];a["a"].assertInstanceof(i,h["a"]);i.setCoordinates(o);var u=a["a"].assertInstanceof(n[1],c["a"]);u.setRadius(i.getLength());this.updateSketchFeatures_()};v.prototype.abortDrawing_=function(){this.started_=false;var e=this.sketchFeature_;if(e!==null){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLayer_.getSource().clear(true)}return e};v.prototype.shouldStopEvent=u["a"];v.prototype.updateState_=function(){var e=this.getMap();var t=this.getActive();if(e===null||!t){this.abortDrawing_()}this.sketchLayer_.setMap(t?e:null)};v.prototype.finishDrawing_=function(){var e=this.abortDrawing_();a["a"].assert(e!==null);if(this.source_!==null){this.source_.addFeature(e)}var t=new i["a"]("drawend",{feature:this.sketchFeature_});this.dispatchEvent(t)};v.prototype.setMap=function(e){d["b"].prototype.setMap.call(this,e);this.updateState_()};var y=v;var _=r(116);var b=r(147);var S=function e(t,r){var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_["a"].call(this,n);this.continueMsg;if(n.continueMsg!==undefined){this.continueMsg=n.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent="Click to finish."}this.numberFormat=a["a"].assert(r);this.unitPrefixFormat=a["a"].assert(t)};o["d"](S,_["a"]);S.prototype.createDrawInteraction=function(e,t){return new y({source:t,style:e})};S.prototype.handleMeasure=function(e){var t=a["a"].assertInstanceof(this.sketchFeature.getGeometry(),f["a"]);var r=a["a"].assertInstanceof(t.getGeometries()[0],h["a"]);var n=S.getFormattedAzimutRadius(r,a["a"].assertInstanceof(this.getMap().getView().getProjection(),b["a"]),this.decimals,this.precision,this.unitPrefixFormat,this.numberFormat);e(n,r.getLastCoordinate())};S.getFormattedAzimutRadius=function(e,t,r,a,n,i){var o=S.getFormattedAzimut(e,r,i);o+=", "+_["a"].getFormattedLength(e,t,a,n);return o};S.getFormattedAzimut=function(e,t,r){var a=S.getAzimut(e);return r(a,t)+"°"};S.getAzimut=function(e){var t=e.getCoordinates();var r=t[1][0]-t[0][0];var a=t[1][1]-t[0][1];var n=Math.acos(a/Math.sqrt(r*r+a*a));var i=r>0?1:-1;return i*n*180/Math.PI%360};var C=t["a"]=S},function(e,t,r){"use strict";var a=r(2);var n=r(310);var i=angular.module("ngeoPopup",["ngSanitize"]);i.value("ngeoPopupTemplateUrl",function(e,t){var r=t["ngeoPopupTemplateurl"];return r!==undefined?r:"ngeo/message/popupcomponent"});i.run(["$templateCache",function(e){e.put("ngeo/message/popupcomponent",r(425))}]);i.directive_=function(e){return{restrict:"A",templateUrl:e,link:function e(t,r,a){r.addClass("popover");t.close=function(e){if(e){e.stopPropagation();e.preventDefault()}r.addClass("hidden")};t.$watch("open",function(e,t){r.css("display",e?"block":"none")})}}};i.directive_.$inject=["ngeoPopupTemplateUrl"];i.directive("ngeoPopup",i.directive_);var o=i;var s=function e(t,r,a,n){var i=this;this.scope=r.$new(true);this.scope.$watch(function(){return i.scope["open"]},function(e){if(!e&&i.autoDestroy_){i.timeout_(function(){i.destroy()})}});this.sce_=a;this.timeout_=n;this.element_=angular.element("<div ngeo-popup></div>");this.autoDestroy_=false;t(this.element_)(this.scope);angular.element(document.body).append(this.element_)};s.prototype.getOpen=function(){return this.scope["open"]};s.prototype.setOpen=function(e){this.scope["open"]=e};s.prototype.destroy=function(){this.scope.$destroy();this.element_.remove()};s.prototype.setTitle=function(e){var t=this.sce_.trustAsHtml(e);this.scope["title"]=t};s.prototype.setContent=function(e,t){this.scope["content"]=t?this.sce_.trustAsHtml(e):e};s.prototype.setUrl=function(e){var t=this.sce_.trustAsHtml('<iframe src="'+e+'" width="100%" height="100%"></iframe>');this.setContent(t)};s.prototype.setWidth=function(e){this.element_.width(e)};s.prototype.setHeight=function(e){this.element_.height(e)};s.prototype.setSize=function(e,t){this.setWidth(e);this.setHeight(t)};s.prototype.setAutoDestroy=function(e){this.autoDestroy_=e};s.prototype.addClass=function(e){this.element_.addClass(e)};s.prototype.open=function(e){if(e.url){this.setUrl(e.url)}else if(e.content){this.setContent(e.content)}else{a["a"].fail('ngeo.message.Popup options requirest "url" or "content".')}if(e.autoDestroy!==undefined){this.setAutoDestroy(e.autoDestroy)}if(e.cls!==undefined){this.addClass(e.cls)}if(e.height!==undefined){this.setHeight(e.height)}if(e.title!==undefined){this.setTitle(e.title)}if(e.width!==undefined){this.setWidth(e.width)}this.setOpen(true)};s.Factory=function(e,t,r,a){return function(){return new s(e,t,r,a)}};s.Factory.$inject=["$compile","$rootScope","$sce","$timeout"];s.module=angular.module("ngeoCreatePopup",[o.name]);s.module.factory("ngeoCreatePopup",s.Factory);var l=t["a"]=s},function(e,t,r){"use strict";var a=r(3);var n=function e(t,r){this.manager_=t;this.features_=null;this.index_=r};n.prototype.addFeature=function(e){this.manager_.addFeature(e,this.index_)};n.prototype.removeFeature=function(e){this.manager_.removeFeature(e,this.index_)};n.prototype.clear=function(){this.manager_.clear(this.index_)};n.prototype.setFeatures=function(e){var t=this;if(this.features_!==null){this.features_.clear();a["c"](this.features_,"add",this.handleFeatureAdd_,this);a["c"](this.features_,"remove",this.handleFeatureRemove_,this)}if(e!==null){e.forEach(function(e){t.addFeature(e)});a["a"](e,"add",this.handleFeatureAdd_,this);a["a"](e,"remove",this.handleFeatureRemove_,this)}this.features_=e};n.prototype.setStyle=function(e){this.manager_.setStyle(e,this.index_)};n.prototype.handleFeatureAdd_=function(e){var t=e.element;this.addFeature(t)};n.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature(t)};n.module=angular.module("ngeoFeatureOverlay",[]);t["a"]=n},,,,function(e,t,r){"use strict";var a=r(2);var n=r(295);var i=r(38);var o=r(1);var s=r(124);var l=function e(){s["a"].call(this)};o["d"](l,s["a"]);l.prototype.read=function(e){return s["a"].prototype.read.call(this,e)};l.prototype.readFromDocument=function(e){a["a"].assert(e.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(var t=e.firstChild;t;t=t.nextSibling){if(t.nodeType==Node.ELEMENT_NODE){return this.readFromNode(t)}}return null};l.prototype.readFromNode=function(e){a["a"].assert(e.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");a["a"].assert(e.localName=="schema","localName should be schema");var t=e.getElementsByTagName("element");if(!t.length){t=e.getElementsByTagName("xsd:element")}var r=[];var n=void 0;for(var i=0,o=t.length;i<o;i++){n=this.readFromElementNode_(t[i]);if(n){r.push(n)}}return r};l.prototype.readFromElementNode_=function(e){var t=e.getAttribute("name");a["a"].assertString(t,"name should be defined in element node.");var r=e.getAttribute("alias");var o=e.getAttribute("nillable");var s=!(o===true||o==="true");var l={name:t,alias:r,required:s};var u=e.getAttribute("type");if(u){if(!n["a"].setGeometryType(l,u)){this.setAttributeByXsdType_(l,u)}}else{var c=e.getElementsByTagName("enumeration");if(!c.length){c=e.getElementsByTagName("xsd:enumeration")}if(c.length){l.type=i["a"].SELECT;var f=[];for(var h=0,p=c.length;h<p;h++){f.push(c[h].getAttribute("value"))}l.choices=f}else{var d=e.getElementsByTagName("restriction");if(!d.length){d=e.getElementsByTagName("xsd:restriction")}if(d.length&&d[0]){var g=d[0];this.setAttributeByXsdType_(l,g.getAttribute("base"));var m=e.getElementsByTagName("maxLength");if(!m.length){m=e.getElementsByTagName("xsd:maxLength")}if(m.length&&m[0]){l.maxLength=Number(m[0].getAttribute("value"))}}}}if(!l.type){return null}a["a"].assert(l.type);return l};l.prototype.setAttributeByXsdType_=function(e,t){if(t==="xsd:boolean"){e.type=i["a"].BOOLEAN}else if(t==="xsd:date"){e.type=i["a"].DATE}else if(t==="xsd:dateTime"){e.type=i["a"].DATETIME}else if(t==="xsd:time"){e.type=i["a"].TIME}else if(t==="xsd:decimal"||t==="xsd:double"){e.type=i["a"].NUMBER;e.numType=l.NumberType.FLOAT}else if(t==="xsd:integer"){e.type=i["a"].NUMBER;e.numType=l.NumberType.INTEGER}else if(t==="xsd:string"){e.type=i["a"].TEXT}};l.getGeometryAttribute=function(e){var t=null;for(var r=0,a=e.length;r<a;r++){if(e[r].type===i["a"].GEOMETRY){t=e[r];break}}return t};l.NumberType={FLOAT:"float",INTEGER:"integer"};t["a"]=l},,function(e,t,r){"use strict";var a=r(2);var n=r(18);var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=function(){function e(t){o(this,e);this.dataSourcesCollection_=new n["b"](t.dataSources);this.title_=t.title}e.prototype.destroy=function e(){this.dataSourcesCollection_.clear()};e.prototype.getDataSourceState=function t(r){return r.visible?e.VisibilityState.ON:e.VisibilityState.OFF};e.prototype.addDataSource=function e(t){this.dataSourcesCollection_.push(t)};e.prototype.removeDataSource=function e(t){this.dataSourcesCollection_.remove(t)};e.prototype.toggleVisibilityState=function t(){var r=this.visibilityState!==e.VisibilityState.ON;for(var a=this.dataSources,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.visible!==r){s.visible=r}}};i(e,[{key:"dataSources",get:function e(){return this.dataSourcesCollection_.getArray()}},{key:"dataSourcesCollection",get:function e(){return this.dataSourcesCollection_}},{key:"title",get:function e(){return this.title_}},{key:"visibilityState",get:function t(){var r=void 0;for(var n=this.dataSources,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(r===undefined){r=this.getDataSourceState(l)}else{var u=this.getDataSourceState(l);if(u!==r){r=e.VisibilityState.INDETERMINATE}}if(r===e.VisibilityState.INDETERMINATE){break}}a["a"].assertString(r);return r}}]);return e}();s.VisibilityState={INDETERMINATE:"indeterminate",OFF:"off",ON:"on"};t["a"]=s},,,,,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(180);var i=r(167);var o=r(295);var s=r(38);var l=r(212);function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var c=function(){function e(){u(this,e)}e.prototype.read=function e(t){return t.map(this.readFromComplexTypeElement_)};e.prototype.readFromComplexTypeElement_=function e(t){var r=a["a"].assertString(t["name"]);var n="alias"in t?a["a"].assertString(t["alias"]):null;var i=t["minOccurs"]!="0";var u={name:r,alias:n,required:i};var c=a["a"].assertString(t["type"]);if(!o["a"].setGeometryType(u,c)){if(c==="gml:TimeInstantType"||c==="dateTime"){u.type=s["a"].DATETIME}else if(c==="date"){u.type=s["a"].DATE}else if(c==="time"){u.type=s["a"].TIME}else if(c==="decimal"||c==="double"){u.type=s["a"].NUMBER;u.numType=l["a"].NumberType.FLOAT}else if(c==="integer"||c==="long"){u.type=s["a"].NUMBER;u.numType=l["a"].NumberType.INTEGER}else if(c==="boolean"){u.type=s["a"].BOOLEAN}else{u.type=s["a"].TEXT}}return u};return e}();var f=c;var h=r(225);var p=r(3);var d=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function g(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var m=function(){e.$inject=["$q","ngeoDataSources","ngeoQuerent"];function e(t,r,a){g(this,e);this.q_=t;this.collection_=r.collection;this.ngeoQuerent_=a;this.cache_={};p["a"](this.collection_,"add",this.handleDataSourcesAdd_,this);p["a"](this.collection_,"remove",this.handleDataSourcesRemove_,this)}e.prototype.getDataSource=function e(t){return this.cache_[t]||null};e.prototype.getDataSourceAttributes=function e(t){var r=this.q_.defer();if(t.attributes){r.resolve(t.attributes)}else{this.ngeoQuerent_.wfsDescribeFeatureType(t).then(function(e){var n=t.getOGCLayerNames()[0];a["a"].assertString(n,"The data source should have only one ogcLayer.");for(var i=e.element,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;if(u.name===n){for(var c=e.complexType,h=Array.isArray(c),p=0,c=h?c:c[Symbol.iterator]();;){var d;if(h){if(p>=c.length)break;d=c[p++]}else{p=c.next();if(p.done)break;d=p.value}var g=d;if(g.name==u.type){var m=g.complexContent;var v=(new f).read(m);t.setAttributes(v);r.resolve(v);break}}}}})}return r.promise};e.prototype.handleDataSourcesAdd_=function e(t){var r=a["a"].assertInstanceof(t.element,n["a"]);this.cache_[r.id]=r};e.prototype.handleDataSourcesRemove_=function e(t){var r=a["a"].assertInstanceof(t.element,n["a"]);delete this.cache_[r.id]};d(e,[{key:"collection",get:function e(){return this.collection_}}]);return e}();m.module=angular.module("ngeoDataSourcesHelper",[i["a"].module.name,h["a"].module.name]);m.module.service("ngeoDataSourcesHelper",m);var v=t["a"]=m},function(e,t,r){"use strict";var a=r(2);var n=r(50);var i=r(164);var o=r(133);var s=r(155);var l=r(1);var u=r(124);var c=r(0);var f=function e(){u["a"].call(this)};l["d"](f,u["a"]);f.prototype.read;f.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling){if(t.nodeType==Node.ELEMENT_NODE){return this.readFromNode(t)}}return null};f.prototype.readFromNode=function(e){var t={};t=c["u"](t,f.PARSERS_,e,[]);return t};f.readElement_=function(e,t){var r={};for(var a=0,n=e.attributes.length;a<n;a++){var i=e.attributes.item(a);r[i.name]=i.value}if(t.length===1){r["type"]=r["type"].split(":").pop()}return r};f.readComplexType_=function(e,t){var r=e.getAttribute("name");var a=c["u"]({name:r},f.COMPLEX_TYPE_PARSERS_,e,t);a["complexContent"]=a["complexContent"]["extension"]["sequence"]["element"];return a};f.readComplexContent_=function(e,t){return c["u"]({},f.COMPLEX_CONTENT_PARSERS_,e,t)};f.readExtension_=function(e,t){return c["u"]({},f.EXTENSION_PARSERS_,e,t)};f.readSequence_=function(e,t){return c["u"]({},f.SEQUENCE_PARSERS_,e,t)};f.NAMESPACE_URIS_=[null,"http://www.w3.org/2001/XMLSchema"];f.PARSERS_=a["a"].assert(c["r"](f.NAMESPACE_URIS_,{element:c["m"](f.readElement_),complexType:c["m"](f.readComplexType_)}));f.COMPLEX_TYPE_PARSERS_=a["a"].assert(c["r"](f.NAMESPACE_URIS_,{complexContent:c["n"](f.readComplexContent_)}));f.COMPLEX_CONTENT_PARSERS_=a["a"].assert(c["r"](f.NAMESPACE_URIS_,{extension:c["n"](f.readExtension_)}));f.EXTENSION_PARSERS_=a["a"].assert(c["r"](f.NAMESPACE_URIS_,{sequence:c["n"](f.readSequence_)}));f.SEQUENCE_PARSERS_=a["a"].assert(c["r"](f.NAMESPACE_URIS_,{element:c["m"](f.readElement_)}));var h=f;var p=r(359);var d=r(269);var g=r(9);var m=r(112);var v=r(4);var y=r(126);function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var b=function(){e.$inject=["$http","$q","ngeoRuleHelper","ngeoWMSTime"];function e(t,r,a,n){_(this,e);this.http_=t;this.q_=r;this.ngeoRuleHelper_=a;this.ngeoWMSTime_=n;this.requestCancelers_=[];this.wmsGetCapabilitiesPromises_={};this.wmtsGetCapabilitiesPromises_={}}e.prototype.issue=function e(t){var r=[];var n=t.map;this.cancelStillRunningRequests_();var i=void 0;if(t.queryableDataSources){i=t.queryableDataSources}else{var o=t.dataSources;a["a"].assert(o,"DataSources should be set");i=this.getQueryableDataSources(o,n)}var s=this.getCombinableWFSDataSources_(i.wfs);r.push(this.issueCombinedWFS_(s,t));var l=t.coordinate;if(l){var u=this.getCombinableWMSDataSources_(i.wms);r.push(this.issueCombinedWMS_(u,t))}return this.q_.all(r).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.getQueryableDataSources=function e(t,r){var i={wfs:[],wms:[]};var o=a["a"].assertNumber(r.getView().getResolution());for(var s=t,l=Array.isArray(s),u=0,s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{u=s.next();if(u.done)break;c=u.value}var f=c;if(!this.isDataSourceQueryable_(f,o)){continue}if(f instanceof n["a"]){if(f.supportsWFS){i.wfs.push(f)}else{i.wms.push(f)}}}return i};e.prototype.wfsDescribeFeatureType=function e(t){a["a"].assert(t.supportsAttributes,"The data source must support WFS, have a single OGCLayer that\n      is queryable in order to issue WFS DescribeFeatureType requests");var r=t.getOGCLayerNames();var n=m["a"](a["a"].assertString(t.wfsUrl),{REQUEST:"DescribeFeatureType",SERVICE:"WFS",VERSION:"2.0.0",TYPENAME:r});return this.http_.get(n).then(function(e){var t=new h;return t.read(e.data)})};e.prototype.wmsFindLayerCapability=function e(t,r){var a=null;for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l["Name"]===r){a=l;break}else if(l["Layer"]){a=this.wmsFindLayerCapability(l["Layer"],r);if(a){break}}}return a};e.prototype.wmsGetCapabilities=function e(t,r){var n=r!==false;var i={REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.3.0"};var o=m["a"](t,i);var s=void 0;if(!n||!this.wmsGetCapabilitiesPromises_[t]){s=this.http_.get(o).then(function(e){var t=new p["a"];return t.read(e.data)})}else if(n&&this.wmsGetCapabilitiesPromises_[t]){s=this.wmsGetCapabilitiesPromises_[t]}a["a"].assert(s);if(n&&!this.wmsGetCapabilitiesPromises_[t]){this.wmsGetCapabilitiesPromises_[t]=s}return s};e.prototype.wmtsFindLayerCapability=function e(t,r){var a=null;for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l["Identifier"]===r){a=l;break}}return a};e.prototype.wmtsGetCapabilities=function e(t,r){var n=r!==false;var i=void 0;if(!n||!this.wmtsGetCapabilitiesPromises_[t]){i=this.http_.get(t).then(function(e){var t=new d["a"];return t.read(e.data)})}else if(n&&this.wmtsGetCapabilitiesPromises_[t]){i=this.wmtsGetCapabilitiesPromises_[t]}a["a"].assert(i);if(n&&!this.wmtsGetCapabilitiesPromises_[t]){this.wmtsGetCapabilitiesPromises_[t]=i}return i};e.prototype.handleCombinedQueryResult_=function e(t){var r={};for(var a=t,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;for(var l in s){var u=Number(l);r[u]=s[u]}}return r};e.prototype.handleQueryResult_=function e(t,r,a,i){var o={};for(var s=t,l=Array.isArray(s),u=0,s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{u=s.next();if(u.done)break;c=u.value}var f=c;var h=void 0;var p=void 0;var d=void 0;if(typeof i==="number"){h=[];p=true;d=i}else{if(f instanceof n["a"]){h=this.readAndTypeFeatures_(f,i.data,a)}else{h=[]}}var g=f.id;this.setUniqueIds_(h,f.id);o[g]={features:h,limit:r,tooManyFeatures:p,totalFeatureCount:d}}return o};e.prototype.readAndTypeFeatures_=function e(t,r,a){var n=this;var i=[];var o=void 0;var s=this.getSetOlFormatTypes_(t,a).slice();s.forEach(function(e){n.getSetOlFormatTypes_(t,a,[e]);if(a){o=t.wfsFormat.readFeatures(r)}else{o=t.wmsFormat.readFeatures(r)}if(o.length>0){o.forEach(function(t){t.set("ngeo_feature_type_",e);i.push(t)})}});this.getSetOlFormatTypes_(t,a,s);return i};e.prototype.getSetOlFormatTypes_=function e(t,r,a){var n=void 0;if(r){if(a){t.wfsFormat.setFeatureType(a)}n=t.wfsFormat.getFeatureType()}else{if(a){t.wmsFormat.setLayers(a)}n=t.wmsFormat.getLayers()}if(!n){return[]}return Array.isArray(n)?n:[n]};e.prototype.issueCombinedWFS_=function e(t,r){var n=this;var i=[];var o=a["a"].assertNumber(r.limit);var l=r.map;var u=l.getView();var c=a["a"].assertNumber(u.getResolution());var f=u.getProjection();var h=f.getCode();var p=r.wfsCount===true;var d=void 0;var m=r.coordinate;if(m){var y=r.tolerancePx;a["a"].assert(y);var _=y*c;d=v["c"](v["m"](m),_)}else{d=r.extent}var b=new s["a"];var S=new XMLSerializer;var C=function e(t){var s=void 0;var l=void 0;var u=[];var f=void 0;var m={};if(r.bboxAsGETParam&&d){m["bbox"]=d.join(",")}for(var v=t,y=Array.isArray(v),_=0,v=y?v:v[Symbol.iterator]();;){var C;if(y){if(_>=v.length)break;C=v[_++]}else{_=v.next();if(_.done)break;C=_.value}var w=C;if(!s){l=w.wfsFeatureNS;var T=w.wfsFeaturePrefix;var E=w.geometryName;var A=w.wfsOutputFormat;s={bbox:d,featureNS:l,featurePrefix:T,geometryName:E,outputFormat:A,srsName:h};f=w.wfsUrl;g["a"](m,w.activeDimensions)}u=u.concat(w.getInRangeOGCLayerNames(c,true));var L=void 0;if(r.filter){L=n.ngeoRuleHelper_.createFilter({dataSource:w,filter:r.filter,incDimensions:true,incTime:true})}else if(w.filterRules&&w.filterRules.length||w.timeRangeValue||w.dimensionsFiltersConfig&&Object.keys(w.dimensionsFiltersConfig).length>0){a["a"].assert(t.length===1,"A data source having filterRules or timeRangeValue should issue\n            a single query, alone.");L=n.ngeoRuleHelper_.createFilter({dataSource:w,incDimensions:true,incTime:true,srsName:h})}if(L){s["filter"]=L}}a["a"].assert(s);s.featureTypes=u;a["a"].assert(f);var P=n.q_.defer();i.push(P.promise.then(n.handleQueryResult_.bind(n,t,o,true)));var M=void 0;if(p){var x=g["a"]({resultType:"hits"},s);var F=b.writeGetFeature(x);var R=S.serializeToString(F);var D=n.registerCanceler_();M=n.http_.post(f,R,{params:m,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:D.promise}).then(function(e){var r=t[0].wfsFormat.readFeatureCollectionMetadata(e.data);return r["numberOfFeatures"]}.bind(n))}else{M=n.q_.resolve()}M.then(function(e){if(e===undefined||e<o){var t=g["a"]({maxFeatures:o},s);var r=b.writeGetFeature(t);var i=S.serializeToString(r);a["a"].assertString(f);var l=n.registerCanceler_();n.http_.post(f,i,{params:m,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:l.promise}).then(function(e){P.resolve(e)})}else{P.resolve(e)}})};for(var w=t,T=Array.isArray(w),E=0,w=T?w:w[Symbol.iterator]();;){var A;if(T){if(E>=w.length)break;A=w[E++]}else{E=w.next();if(E.done)break;A=E.value}var L=A;C(L)}return this.q_.all(i).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.issueCombinedWMS_=function e(t,r){var n=[];var i=a["a"].assertNumber(r.limit);var o=r.map;var s=o.getView();var l=a["a"].assertNumber(s.getResolution());var u=s.getProjection();var c=u.getCode();var f=r.coordinate;a["a"].assert(f);for(var h=t,p=Array.isArray(h),d=0,h=p?h:h[Symbol.iterator]();;){var m;if(p){if(d>=h.length)break;m=h[d++]}else{d=h.next();if(d.done)break;m=d.value}var v=m;var _=void 0;var b=[];var S=void 0;var C=false;var w={};var T=null;var E=null;for(var A=v,L=Array.isArray(A),P=0,A=L?A:A[Symbol.iterator]();;){var M;if(L){if(P>=A.length)break;M=A[P++]}else{P=A.next();if(P.done)break;M=P.value}var x=M;if(!S){S=x.wmsInfoFormat;_=x.wmsUrl}b=b.concat(x.getInRangeOGCLayerNames(l,true));if(!C){g["a"](w,x.activeDimensions);C=true}if(x.filterRules&&x.filterRules.length){a["a"].assert(v.length===1);E=x.getFiltrableOGCLayerName();T=this.ngeoRuleHelper_.createFilterString({dataSource:x,srsName:c})}if(x.timeRangeValue!==null&&x.timeProperty){a["a"].assert(v.length===1);w["TIME"]=this.ngeoWMSTime_.formatWMSTimeParam(x.timeProperty,x.timeRangeValue)}}w["LAYERS"]=b;w["QUERY_LAYERS"]=b;if(T&&E){var F=null;if(b.length===1){F=T}else{var R=[];for(var D=0,k=b.length;D<k;D++){if(b[D]===E){R.push("("+T+")")}else{R.push("()")}}F=R.join("")}w["FILTER"]=F}a["a"].assert(_);var $=new y["a"]({params:w,url:_});var O=a["a"].assertString($.getGetFeatureInfoUrl(f,l,c,{FEATURE_COUNT:i,INFO_FORMAT:S}));var I=this.registerCanceler_();n.push(this.http_.get(O,{timeout:I.promise}).then(this.handleQueryResult_.bind(this,v,i,false)))}return this.q_.all(n).then(this.handleCombinedQueryResult_.bind(this))};e.prototype.getCombinableWFSDataSources_=function e(t){var r=[];var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.combinableForWFS){var u=false;for(var c=r,f=Array.isArray(c),h=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(h>=c.length)break;p=c[h++]}else{h=c.next();if(h.done)break;p=h.value}var d=p;if(l.combinableWithDataSourceForWFS(d[0])){d.push(l);u=true}}if(!u){r.push([l])}}else{a.push([l])}}return r.concat(a)};e.prototype.getCombinableWMSDataSources_=function e(t){var r=[];var a=[];for(var n=t,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.combinableForWMS){var u=false;for(var c=r,f=Array.isArray(c),h=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(h>=c.length)break;p=c[h++]}else{h=c.next();if(h.done)break;p=h.value}var d=p;if(l.combinableWithDataSourceForWMS(d[0])){d.push(l);u=true}}if(!u){r.push([l])}}else{a.push([l])}}return r.concat(a)};e.prototype.isDataSourceQueryable_=function e(t,r){var a=t.visible&&t.inRange&&t.queryable;if(a&&t instanceof n["a"]){var i=t;a=i.isAnyOGCLayerInRange(r,true)}return a};e.prototype.setUniqueIds_=function e(t,r){t.forEach(function(e){if(e.getId()!==undefined){var t=r+"_"+e.getId();e.setId(t)}})};e.prototype.registerCanceler_=function e(){var t=this.q_.defer();this.requestCancelers_.push(t);return t};e.prototype.cancelStillRunningRequests_=function e(){for(var t=this.requestCancelers_,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;i.resolve()}this.requestCancelers_.length=0};return e}();b.CombinedDataSources;b.module=angular.module("ngeoQuerent",[i["a"].module.name,o["a"].module.name]);b.module.service("ngeoQuerent",b);var S=t["a"]=b},,,function(e,t,r){"use strict";var a=r(132);var n=r(46);var i=r(2);var o=r(106);var s=r(1);var l=r(3);var u=r(18);var c=r(155);var f=r(268);function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function p(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var g=function e(t,r,a,n,i,o,s){this.http_=t;this.q_=r;this.rootScope_=a;this.timeout_=i;this.injector_=n;this.gmfThemes_=o;this.gmfTreeManager_=s;this.cache_={};this.listenerKeys_=[];this.map_=null;this.mapViewChangePromise_=null;this.ogcServers_=null;this.ngeoSnappingSource_=this.injector_.has("ngeoSnappingSource")?this.injector_.get("ngeoSnappingSource"):undefined};g.$inject=["$http","$q","$rootScope","$injector","$timeout","gmfThemes","gmfTreeManager"];g.$inject=["$http","$q","$rootScope","$injector","$timeout","gmfThemes","gmfTreeManager"];var m=function(e){d(t,e);function t(r){h(this,t);var a=p(this,e.call(this,r));document.body.addEventListener("keydown",function(e){var t=!e.metaKey;var r=e.keyCode!==17;a.setActive(r&&t)});document.body.addEventListener("keyup",function(){a.setActive(true)});return a}return t}(f["a"]);g.prototype.ensureSnapInteractionsOnTop=function(){var e=this.map_;i["a"].assert(e);var t=void 0;for(var r in this.cache_){t=this.cache_[r];if(t.active){i["a"].assert(t.interaction);e.removeInteraction(t.interaction);e.addInteraction(t.interaction)}}};g.prototype.setMap=function(e){var t=this;var r=this.listenerKeys_;if(this.map_){this.treeCtrlsUnregister_();this.unregisterAllTreeCtrl_();r.forEach(l["e"]);r.length=0}this.map_=e;if(e){this.treeCtrlsUnregister_=this.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl){return t.gmfTreeManager_.rootCtrl.children}},function(e){t.timeout_(function(){if(e){t.unregisterAllTreeCtrl_();t.gmfTreeManager_.rootCtrl.traverseDepthFirst(t.registerTreeCtrl_.bind(t))}},0)});r.push(l["a"](this.gmfThemes_,"change",this.handleThemesChange_,this),l["a"](e,"moveend",this.handleMapMoveEnd_,this))}};g.prototype.handleThemesChange_=function(){var e=this;this.ogcServers_=null;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t})};g.prototype.registerTreeCtrl_=function(e){var t=e.node;if(t.children){return}t=e.node;var r=n["a"].getSnappingConfig(t);if(r){var a=this.getWFSConfig_(e);if(a){var i=s["c"](e);var o=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e));this.cache_[i]={active:false,featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",features:new u["b"],geometryName:"geom",interaction:null,maxFeatures:50,requestDeferred:null,snappingConfig:r,treeCtrl:e,wfsConfig:a,stateWatcherUnregister:o};this.handleTreeCtrlStateChange_(e,e.getState())}}};g.prototype.unregisterAllTreeCtrl_=function(){for(var e in this.cache_){var t=this.cache_[e];if(t){t.stateWatcherUnregister();this.deactivateItem_(t);delete this.cache_[e]}}};g.prototype.getWFSConfig_=function(e){if(this.ogcServers_===null){return null}var t=e.node;if(t.type!==n["a"].NodeType.WMS){return null}var r=t;var a=[];for(var s=0,l=r.childLayers.length;s<l;s++){if(r.childLayers[s].queryable){a.push(r.childLayers[s].name)}}if(!a.length){return null}var u=void 0;var c=e.parent.node;if(c.mixed){u=r.ogcServer}else{var f=o["a"].getFirstParentTree(e);var h=f.node;u=h.ogcServer}if(!u){return null}var p=this.ogcServers_[u];if(!p.wfsSupport){return null}var d=p.urlWfs;i["a"].assert(d,"urlWfs should be defined.");return{featureTypes:a.join(","),url:d}};g.prototype.handleTreeCtrlStateChange_=function(e,t){var r=s["c"](e);var a=this.cache_[r];if(t==="on"){this.activateItem_(a)}else{this.deactivateItem_(a)}};g.prototype.activateItem_=function(e){if(e.active){return}var t=this.map_;i["a"].assert(t);var r=new m({edge:e.snappingConfig.edge,features:e.features,pixelTolerance:e.snappingConfig.tolerance,vertex:e.snappingConfig.vertex});t.addInteraction(r);e.interaction=r;e.active=true;this.loadItemFeatures_(e)};g.prototype.deactivateItem_=function(e){if(!e.active){return}var t=this.map_;i["a"].assert(t);var r=e.interaction;t.removeInteraction(r);e.interaction=null;e.features.clear();if(e.requestDeferred){e.requestDeferred.resolve();e.requestDeferred=null}e.active=false;this.refreshSnappingSource_()};g.prototype.loadAllItems_=function(){this.mapViewChangePromise_=null;var e=void 0;for(var t in this.cache_){e=this.cache_[t];if(e.active){this.loadItemFeatures_(e)}}};g.prototype.refresh=function(){this.loadAllItems_()};g.prototype.loadItemFeatures_=function(e){var t=this;if(e.requestDeferred){e.requestDeferred.resolve()}var r=this.map_;i["a"].assert(r);var a=r.getView();var n=r.getSize();i["a"].assert(n);var o=a.calculateExtent(n);var s=a.getProjection().getCode();var l=e.wfsConfig.featureTypes.split(",");var u={srsName:s,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:l,outputFormat:"GML3",bbox:o,geometryName:e.geometryName,maxFeatures:e.maxFeatures};var f=new c["a"];var h=new XMLSerializer;var p=f.writeGetFeature(u);var d=h.serializeToString(p);var g=e.wfsConfig.url;e.requestDeferred=this.q_.defer();this.http_.post(g,d,{timeout:e.requestDeferred.promise}).then(function(r){e.requestDeferred=null;e.features.clear();var a=(new c["a"]).readFeatures(r.data);if(a){e.features.extend(a);t.refreshSnappingSource_()}})};g.prototype.handleMapMoveEnd_=function(){if(this.mapViewChangePromise_){this.timeout_.cancel(this.mapViewChangePromise_)}this.mapViewChangePromise_=this.timeout_(this.loadAllItems_.bind(this),400)};g.prototype.refreshSnappingSource_=function(){this.ngeoSnappingSource_.clear();for(var e in this.cache_){var t=this.cache_[e];if(t.active){this.ngeoSnappingSource_.addFeatures(t.features.getArray())}}};g.Cache;g.CacheItem;g.WFSConfig;g.module=angular.module("gmfSnapping",[a["a"].module.name,n["a"].module.name,o["a"].module.name]);g.module.service("gmfSnapping",g);t["a"]=g},function(e,t,r){"use strict";var a=r(2);var n=r(1);var i=r(4);var o=r(22);var s=r(3);var l=r(70);var u=r(39);var c=r(30);var f=r(34);var h=r(209);var p=r(64);var d=r(57);var g=r(52);var m=function e(t){this.listenerKeys_=[];this.featureListenerKeys_={};this.keyPressListenerKey_=null;this.myFeatures_=t.features!==undefined?t.features:null;this.vectorSource_=new d["b"]({useSpatialIndex:false});this.vectorLayer_=new p["a"]({source:this.vectorSource_,style:t.style,updateWhileAnimating:true,updateWhileInteracting:true});this.centerFeatures_={};h["a"].call(this,t)};n["d"](m,h["a"]);m.prototype.setActive=function(e){if(this.keyPressListenerKey_){s["e"](this.keyPressListenerKey_);this.keyPressListenerKey_=null}h["a"].prototype.setActive.call(this,e);if(e){this.keyPressListenerKey_=s["a"](document,"keyup",this.handleKeyUp_,this)}this.setState_()};m.prototype.setMap=function(e){var t=this.getMap();if(t){this.vectorLayer_.setMap(null)}h["a"].prototype.setMap.call(this,e);if(e){this.vectorLayer_.setMap(e)}this.setState_()};m.prototype.setState_=function(){var e=this;var t=this.getMap();var r=this.getActive();var a=this.myFeatures_;var n=this.listenerKeys_;if(t&&r&&a){a.forEach(function(t){return e.addFeature_(t)});n.push(s["a"](a,"add",this.handleFeaturesAdd_,this),s["a"](a,"remove",this.handleFeaturesRemove_,this))}else{if(t){var i=t.getTargetElement();i.style.cursor="default"}n.forEach(s["e"]);n.length=0;a.forEach(function(t){return e.removeFeature_(t)})}};m.prototype.handleFeaturesAdd_=function(e){var t=e.element;a["a"].assertInstanceof(t,o["a"],"feature should be an ol.Feature");this.addFeature_(t)};m.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)};m.prototype.addFeature_=function(e){var t=n["c"](e);var r=e.getGeometry();a["a"].assertInstanceof(r,l["a"]);this.featureListenerKeys_[t]=s["a"](r,"change",this.handleGeometryChange_.bind(this,e),this);var i=this.getGeometryCenterPoint_(r);var u=new o["a"](i);this.centerFeatures_[t]=u;this.vectorSource_.addFeature(u)};m.prototype.removeFeature_=function(e){var t=n["c"](e);if(this.featureListenerKeys_[t]){s["e"](this.featureListenerKeys_[t]);delete this.featureListenerKeys_[t];this.vectorSource_.removeFeature(this.centerFeatures_[t]);delete this.centerFeatures_[t]}};m.prototype.handleGeometryChange_=function(e,t){var r=t.target;a["a"].assertInstanceof(r,l["a"]);var i=this.getGeometryCenterPoint_(r);var o=n["c"](e);this.centerFeatures_[o].setGeometry(i)};m.prototype.getGeometryCenterPoint_=function(e){var t=void 0;var r=void 0;if(e instanceof f["a"]){r=e.getInteriorPoint()}else if(e instanceof u["a"]){t=e.getCoordinateAt(.5)}else{var n=e.getExtent();t=i["x"](n)}if(!r&&t){r=new c["a"](t)}a["a"].assert(r,"Point should be thruthy");return r};m.prototype.handleKeyUp_=function(e){if(!g["a"].mousedown&&e.keyCode===27){this.setActive(false)}};t["a"]=m},function(e,t,r){"use strict";var a=r(2);var n=r(192);var i=r(82);var o=r(52);var s=r(1);var l=r(4);var u=r(22);var c=r(3);var f=r(24);var h=r(70);var p=r(30);var d=r(39);var g=r(34);var m=r(64);var v=r(57);var y=function e(t){a["a"].assert(t.features);this.listenerKeys_=[];this.modified_=false;this.keyPressListenerKey_=null;this.changingFeature_=false;this.pixelTolerance_=t.pixelTolerance!==undefined?t.pixelTolerance:10;this.features_=t.features;this.feature_=null;this.coordinate_=null;this.centerCoordinate_=null;this.overlay_=new m["a"]({source:new v["b"]({useSpatialIndex:false,wrapX:!!t.wrapX}),style:t.style||n["a"].getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.centerFeatures_={};f["b"].call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_})};s["d"](y,f["b"]);y.prototype.setActive=function(e){var t=this;if(this.keyPressListenerKey_){c["e"](this.keyPressListenerKey_);this.keyPressListenerKey_=null}f["b"].prototype.setActive.call(this,e);if(e){this.keyPressListenerKey_=c["a"](document,"keyup",this.handleKeyUp_,this);this.features_.forEach(function(e){return t.addFeature_(e)});this.listenerKeys_.push(c["a"](this.features_,"add",this.handleFeatureAdd_,this),c["a"](this.features_,"remove",this.handleFeatureRemove_,this))}else{this.listenerKeys_.forEach(c["e"]);this.listenerKeys_.length=0;this.features_.forEach(function(e){return t.removeFeature_(e)})}};y.prototype.addFeature_=function(e){var t=e.getGeometry();a["a"].assertInstanceof(t,h["a"]);e.set("angle",0);var r=s["c"](e);var n=new p["a"](this.getCenterCoordinate_(t));var i=new u["a"](n);this.centerFeatures_[r]=i;this.overlay_.getSource().addFeature(i)};y.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new i["a"]("modifystart",{features:this.features_});this.dispatchEvent(t)}};y.prototype.removeFeature_=function(e){this.feature_=null;if(e){var t=s["c"](e);if(this.centerFeatures_[t]){this.overlay_.getSource().removeFeature(this.centerFeatures_[t]);delete this.centerFeatures_[t]}}};y.prototype.setMap=function(e){this.overlay_.setMap(e);f["b"].prototype.setMap.call(this,e)};y.prototype.handleFeatureAdd_=function(e){var t=e.element;a["a"].assertInstanceof(t,u["a"],"feature should be an ol.Feature");this.addFeature_(t)};y.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};y.prototype.handleDown_=function(e){var t=e.map;var r=t.forEachFeatureAtPixel(e.pixel,function(e,t){return e},undefined);if(r){var a=false;this.features_.forEach(function(e){if(s["c"](e)==s["c"](r)){a=true}});if(!a){r=null}}if(r){this.coordinate_=e.coordinate;this.feature_=r;var n=this.feature_.getGeometry();if(n!==undefined){this.centerCoordinate_=this.getCenterCoordinate_(n)}return true}return false};y.prototype.getCenterCoordinate_=function(e){var t=void 0;if(e instanceof d["a"]){t=e.getFlatMidpoint()}else if(e instanceof g["a"]){t=e.getFlatInteriorPoint()}else{var r=e.getExtent();t=l["x"](r)}return t};y.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_.getGeometry();var r=this.coordinate_[0];var a=this.coordinate_[1];var n=this.centerCoordinate_[0];var i=this.centerCoordinate_[1];var o=r-n;var s=a-i;var l=e.coordinate[0]-n;var u=e.coordinate[1]-i;this.coordinate_[0]=e.coordinate[0];this.coordinate_[1]=e.coordinate[1];var c=Math.atan2(u,l);var f=Math.atan2(s,o);var h=f-c;t.rotate(-h,[n,i])};y.prototype.handleUp_=function(e){if(this.modified_){var t=new i["a"]("rotateend",{feature:this.feature_});this.dispatchEvent(t);this.modified_=false;this.setActive(false)}return false};y.prototype.handleKeyUp_=function(e){if(!o["a"].mousedown&&e.keyCode===27){this.setActive(false)}};t["a"]=y},function(e,t,r){"use strict";var a=r(18);var n=angular.module("ngeoFeatures",[]);n.value("ngeoFeatures",new a["b"]);t["a"]=n},function(e,t,r){"use strict";(function(e){var a=r(2);var n=r(82);var i=r(1);var o=r(3);var s=r(113);var l=r(109);var u=function t(r,a){var n=this;var i=a!==undefined?a:{};i.positioning=l["a"].TOP_LEFT;this.listenerKeys_=[];this.clickOutListenerKey_=null;var o=e("<div/>",{class:"panel panel-default"});this.autoClose_=r.autoClose!==undefined?r.autoClose:true;if(r.title){var u=e("<div>",{class:"panel-heading"}).appendTo(o);e("<span>",{text:r.title}).appendTo(u)}var c=e("<div>",{class:"list-group"}).appendTo(o);this.actions_=[];r.actions.forEach(function(t){n.actions_.push(e("<button>",{class:"list-group-item","data-name":t.name,text:[" ",t.label!==undefined?t.label:t.name].join("")}).appendTo(c).prepend(e("<span>",{class:t.cls!==undefined?t.cls:""})))});i.element=o[0];s["a"].call(this,i)};i["d"](u,s["a"]);u.prototype.setMap=function(e){var t=this;var r=this.getMap();if(r){this.listenerKeys_.forEach(o["e"]);this.listenerKeys_.length=0}s["a"].prototype.setMap.call(this,e);if(e){this.actions_.forEach(function(e){var r=e.data();t.listenerKeys_.push(o["a"](e[0],"click",t.handleActionClick_.bind(t,r.name)))});this.listenerKeys_.push(o["a"](e,"pointermove",this.handleMapPointerMove_,this))}};u.prototype.open=function(e){this.setPosition(e);if(this.autoClose_){this.clickOutListenerKey_=o["a"](document.documentElement,"mousedown",this.handleClickOut_,this)}};u.prototype.close=function(){this.setPosition(undefined);if(this.clickOutListenerKey_!==null){o["e"](this.clickOutListenerKey_)}};u.prototype.handleActionClick_=function(e,t){this.dispatchEvent(new n["a"]("actionclick",{action:e}));if(this.autoClose_){this.close()}t.stopPropagation()};u.prototype.handleClickOut_=function(t){var r=this.getElement();if(r&&e(t.target).closest(r).length===0){this.close()}};u.prototype.handleMapPointerMove_=function(e){var t=e.originalEvent.target;a["a"].assertInstanceof(t,Element);var r=this.getElement();a["a"].assertInstanceof(r,Element);if(r.contains(t)){e.coordinate=[Infinity,Infinity];e.pixel=[Infinity,Infinity]}};t["a"]=u}).call(this,r(36))},function(e,t,r){"use strict";var a=r(2);var n=r(52);var i=function e(t,r){this.history_=r;this.schema_=t.protocol.substring(0,t.protocol.length-1);this.domain_=t.hostname;this.port_=t.port?parseInt(t.port,10):undefined;this.path_=t.pathname;this.queryData_=n["b"].decodeQueryString(t.search);this.fragment_=n["b"].decodeQueryString(t.hash)};i.replaceState=function(e,t){try{e.replaceState(null,"",t)}catch(e){}};i.prototype.getPath=function(){return this.path_};i.prototype.getUriString=function(){var e=[];if(this.schema_){e.push(this.schema_,":")}if(this.domain_||this.schema_==="file"){e.push("//");e.push(this.domain_);if(this.port_!==undefined){e.push(":",String(this.port_))}}if(this.path_){if(this.domain_&&this.path_.charAt(0)!=="/"){e.push("/")}e.push(this.path_)}var t=n["b"].encodeQueryString(this.queryData_);if(t.length>0){e.push("?",t)}var r=n["b"].encodeQueryString(this.fragment_);if(r.length>0){e.push("#",r)}return e.join("")};i.prototype.hasParam=function(e){return e in this.queryData_};i.prototype.hasFragmentParam=function(e){return e in this.fragment_};i.prototype.getParam=function(e){return this.queryData_[e]};i.prototype.getFragmentParam=function(e){return this.fragment_[e]};i.prototype.getParamAsInt=function(e){var t=this.getParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseInt(t,10);return isNaN(r)?undefined:r};i.prototype.getParamAsFloat=function(e){var t=this.getParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseFloat(t);return isNaN(r)?undefined:r};i.prototype.getFragmentParamAsInt=function(e){var t=this.getFragmentParam(e);if(t===undefined){return undefined}a["a"].assertString(t);var r=parseInt(t,10);return isNaN(r)?undefined:r};i.prototype.getParamKeys=function(){var e=[];for(var t in this.queryData_){e.push(t)}return e};i.prototype.getFragmentParamKeys=function(){var e=[];for(var t in this.fragment_){e.push(t)}return e};i.prototype.getParamKeysWithPrefix=function(e){var t=[];for(var r in this.queryData_){if(r.indexOf(e)==0){t.push(r)}}return t};i.prototype.getFragmentParamKeysWithPrefix=function(e){var t=[];for(var r in this.fragment_){if(r.indexOf(e)==0){t.push(r)}}return t};i.prototype.updateParams=function(e){for(var t in e){this.queryData_[t]=e[t]}};i.prototype.updateFragmentParams=function(e){for(var t in e){this.fragment_[t]=e[t]}};i.prototype.deleteParam=function(e){delete this.queryData_[e]};i.prototype.deleteFragmentParam=function(e){delete this.fragment_[e]};i.prototype.refresh=function(){i.replaceState(this.history_,this.getUriString())};i.prototype.setPath=function(e){this.path_=e};i.LocationFactory=function(e,t){var r=t.history;var a=new i(t.location,t.history);var n=a.getUriString();e.$watch(function(){var t=a.getUriString();if(n!==t){e.$evalAsync(function(){n=t;if(r!==undefined&&r.replaceState!==undefined){i.replaceState(r,t)}e.$broadcast("ngeoLocationChange")})}});return a};i.LocationFactory.$inject=["$rootScope","$window"];i.MockProvider=function(e){e["$get"]=function(){var e={absUrl:function e(){return""},hash:function e(t){return t!==undefined?this:""},host:function e(){return""},path:function e(t){return t!==undefined?this:""},port:function e(){return 0},protocol:function e(){return""},replace:function e(){},search:function e(t,r){return t!==undefined?this:{}},url:function e(t){return""}};return e}};i.MockProvider.$inject=["$locationProvider"];i.module=angular.module("ngeoLocation",[]);i.module.factory("ngeoLocation",i.LocationFactory);t["a"]=i},function(e,t,r){"use strict";var a=r(52);var n=r(361);var i=r.n(n);var o=angular.module("ngeoDownload",[]);o.factory_=function(){function e(e,t,r){var i=r!==undefined&&!a["b"].isSafari()?r:"text/plain;charset=utf-8";var o=new Blob([e],{type:i});Object(n["saveAs"])(o,t)}return e};o.factory("ngeoDownload",o.factory_);t["a"]=o},,,function(e,t,r){"use strict";var a={};a.module=angular.module("gmfDataSourceBeingFiltered",[]);a.module.value("gmfDataSourceBeingFiltered",{dataSource:null});t["a"]=a},function(e,t,r){"use strict";var a=r(36);var n=r.n(a);var i=r(220);var o=r.n(i);var s=r(326);var l=r.n(s);var u=r(433);var c=r.n(u);var f=r(2);function h(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var p=angular.module("ngeoModal",[]);p.component_={template:'<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <ng-transclude></ng-transclude>\n      </div>\n    </div>\n  </div>',require:{ngModel:"ngModel"},transclude:true,controller:"ngeoModalController",bindings:{resizable:"<ngeoModalResizable",closable:"<ngeoModalClosable"}};p.component("ngeoModal",p.component_);p.Controller_=function(){e.$inject=["$scope","$element"];function e(t,r){h(this,e);this.$element_=r;this.$scope_=t;this.modal_;this.closable;this.resizable;this.ngModel}e.prototype.$postLink=function e(){var t=this;this.modal_=this.$element_.children();if(!this.closable){this.modal_.attr("data-keyboard",false);this.modal_.attr("data-backdrop","static")}this.resizable=!!this.resizable;var r=this.modal_.find(".modal-dialog");r.draggable({handle:".modal-header"});if(this.resizable){r.resizable()}this.ngModel.$render=function(){t.modal_.modal(t.ngModel.$viewValue?"show":"hide")};this.modal_.on("shown.bs.modal hidden.bs.modal",function(e){var r=e.type;f["a"].assert(r=="shown"||r=="hidden");t.ngModel.$setViewValue(r=="shown")})};e.prototype.$onDestroy=function e(){this.modal_.modal("hide");this.modal_.modal("removeBackdrop");var t=this.modal_.find(".modal-dialog");t.draggable("destroy");if(this.resizable){t.resizable("destroy")}};return e}();p.controller("ngeoModalController",p.Controller_);t["a"]=p},function(e,t,r){"use strict";var a=r(327);var n=r.n(a);var i=r(2);var o=r(75);var s=r(1);var l=function e(t){o["a"].call(this);this.timeout_=t;var r=angular.element('<div class="ngeo-notification"></div>');angular.element(document.body).append(r);this.container_=r;this.cache_={}};l.$inject=["$timeout"];l.$inject=["$timeout"];s["d"](l,o["a"]);l.DEFAULT_DELAY_=7e3;l.prototype.notify=function(e){this.show(e)};l.prototype.clear=function(){for(var e in this.cache_){this.clearMessageByCacheItem_(this.cache_[parseInt(e,10)])}};l.prototype.showMessage=function(e){var t=this;var r=e.type;i["a"].assertString(r,"Type should be set.");var a=["alert","fade"];switch(r){case o["a"].Type.ERROR:a.push("alert-danger");break;case o["a"].Type.INFORMATION:a.push("alert-info");break;case o["a"].Type.SUCCESS:a.push("alert-success");break;case o["a"].Type.WARNING:a.push("alert-warning");break;default:break}var n=angular.element('<div class="'+a.join(" ")+'"></div>');var u=void 0;if(e.target){u=angular.element(e.target)}else{u=this.container_}u.append(n);n.html(e.msg).addClass("in");var c=e.delay!==undefined?e.delay:l.DEFAULT_DELAY_;var f={el:n};var h=s["c"](n);f.promise=this.timeout_(function(){n.alert("close");delete t.cache_[h]},c);this.cache_[h]=f};l.prototype.clearMessageByCacheItem_=function(e){var t=e.el;var r=e.promise;var a=s["c"](t);t.alert("close");this.timeout_.cancel(r);delete this.cache_[a]};l.CacheItem;l.module=angular.module("ngeoNotification",[]);l.module.service("ngeoNotification",l);t["a"]=l},,,function(e,t,r){"use strict";var a=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=1e3*60*60*24;var i=3600;var o=function e(t,r){return typeof t==="string"&&typeof r==="string"&&t.toLowerCase()===r.toLowerCase()};var s=function e(t,r,a){var n=a||"0";var i=t.toString();return i.length<r?e(n+i,r):i};var l=function e(t){var r=void 0,n=void 0;t=t||{};for(r=1;r<arguments.length;r++){n=arguments[r];if(!n){continue}for(var i in n){if(n.hasOwnProperty(i)){if(a(n[i])==="object"){e(t[i],n[i])}else{t[i]=n[i]}}}}return t};var u=function e(t,r){for(var a=0;a<r.length;a++){if(r[a].toLowerCase()===t.toLowerCase()){return a}}return-1};var c={dateSettings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["AM","PM"],ordinal:function e(t){var r=t%10,a={1:"st",2:"nd",3:"rd"};return Math.floor(t%100/10)===1||!a[r]?"th":a[r]}},separators:/[ \-+\/\.T:@]/g,validParts:/[dDjlNSwzWFmMntLoYyaABgGhHisueTIOPZcrU]/g,intParts:/[djwNzmnyYhHgGis]/g,tzParts:/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,tzClip:/[^-+\dA-Z]/g};var f=function e(t){var r=this;var a=l(c,t);r.dateSettings=a.dateSettings;r.separators=a.separators;r.validParts=a.validParts;r.intParts=a.intParts;r.tzParts=a.tzParts;r.tzClip=a.tzClip};f.prototype={constructor:f,getMonth:function e(t){var r=this;var a=void 0;a=u(t,r.dateSettings.monthsShort)+1;if(a===0){a=u(t,r.dateSettings.months)+1}return a},parseDate:function e(t,r){var n=this,i={date:null,year:null,month:null,day:null,hour:0,min:0,sec:0},s=n.dateSettings;var l=void 0,u=false,c=false,f=void 0,h=void 0,p=void 0,d=void 0,g=void 0,m=void 0,v=void 0;if(!t){return null}if(t instanceof Date){return t}if(r==="U"){l=parseInt(t);return l?new Date(l*1e3):t}switch(typeof t==="undefined"?"undefined":a(t)){case"number":return new Date(t);case"string":break;default:return null}var y=r.match(n.validParts);if(!y||y.length===0){throw new Error("Invalid date format definition.")}var _=t.replace(n.separators,"\0").split("\0");for(l=0;l<_.length;l++){f=_[l];h=parseInt(f);switch(y[l]){case"y":case"Y":if(h){m=f.length;i.year=m===2?parseInt((h<70?"20":"19")+f):h}else{return null}u=true;break;case"m":case"n":case"M":case"F":if(isNaN(h)){p=n.getMonth(f);if(p>0){i.month=p}else{return null}}else{if(h>=1&&h<=12){i.month=h}else{return null}}u=true;break;case"d":case"j":if(h>=1&&h<=31){i.day=h}else{return null}u=true;break;case"g":case"h":d=y.indexOf("a")>-1?y.indexOf("a"):y.indexOf("A")>-1?y.indexOf("A"):-1;v=_[d];if(d>-1){g=o(v,s.meridiem[0])?0:o(v,s.meridiem[1])?12:-1;if(h>=1&&h<=12&&g>-1){i.hour=h+g-1}else if(h>=0&&h<=23){i.hour=h}}else{if(h>=0&&h<=23){i.hour=h}else{return null}}c=true;break;case"G":case"H":if(h>=0&&h<=23){i.hour=h}else{return null}c=true;break;case"i":if(h>=0&&h<=59){i.min=h}else{return null}c=true;break;case"s":if(h>=0&&h<=59){i.sec=h}else{return null}c=true;break}}if(u===true&&i.year&&i.month&&i.day){i.date=new Date(i.year,i.month-1,i.day,i.hour,i.min,i.sec,0)}else{if(c!==true){return null}i.date=new Date(0,0,0,i.hour,i.min,i.sec,0)}return i.date},guessDate:function e(t,r){if(typeof t!=="string"){return t}var a=this,n=t.replace(a.separators,"\0").split("\0"),i=/^[djmn]/g,o=r.match(a.validParts),s=new Date,l=0;var u=void 0,c=void 0,f=void 0,h=void 0,p=void 0,d=void 0;if(!i.test(o[0])){return t}for(c=0;c<n.length;c++){var g=2;h=n[c];p=parseInt(h.substr(0,2));if(isNaN(p)){return null}switch(c){case 0:if(o[0]==="m"||o[0]==="n"){s.setMonth(p-1)}else{s.setDate(p)}break;case 1:if(o[0]==="m"||o[0]==="n"){s.setDate(p)}else{s.setMonth(p-1)}break;case 2:d=s.getFullYear();u=h.length;g=u<4?u:4;d=parseInt(u<4?d.toString().substr(0,4-u)+h:h.substr(0,4));if(!d){return null}s.setFullYear(d);break;case 3:s.setHours(p);break;case 4:s.setMinutes(p);break;case 5:s.setSeconds(p);break}f=h.substr(g);if(f.length>0){n.splice(c+1,0,f)}}return s},parseFormat:function e(t,r){var a=void 0;var o=this,l=o.dateSettings,u=/\\?(.?)/gi,c=function e(t,r){return a[t]?a[t]():r};a={d:function e(){return s(a.j(),2)},D:function e(){return l.daysShort[a.w()]},j:function e(){return r.getDate()},l:function e(){return l.days[a.w()]},N:function e(){return a.w()||7},w:function e(){return r.getDay()},z:function e(){var t=new Date(a.Y(),a.n()-1,a.j()),r=new Date(a.Y(),0,1);return Math.round((t-r)/n)},W:function e(){var t=new Date(a.Y(),a.n()-1,a.j()-a.N()+3),r=new Date(t.getFullYear(),0,4);return s(1+Math.round((t-r)/n/7),2)},F:function e(){return l.months[r.getMonth()]},m:function e(){return s(a.n(),2)},M:function e(){return l.monthsShort[r.getMonth()]},n:function e(){return r.getMonth()+1},t:function e(){return new Date(a.Y(),a.n(),0).getDate()},L:function e(){var t=a.Y();return t%4===0&&t%100!==0||t%400===0?1:0},o:function e(){var t=a.n(),r=a.W(),n=a.Y();return n+(t===12&&r<9?1:t===1&&r>9?-1:0)},Y:function e(){return r.getFullYear()},y:function e(){return a.Y().toString().slice(-2)},a:function e(){return a.A().toLowerCase()},A:function e(){var t=a.G()<12?0:1;return l.meridiem[t]},B:function e(){var t=r.getUTCHours()*i,a=r.getUTCMinutes()*60,n=r.getUTCSeconds();return s(Math.floor((t+a+n+i)/86.4)%1e3,3)},g:function e(){return a.G()%12||12},G:function e(){return r.getHours()},h:function e(){return s(a.g(),2)},H:function e(){return s(a.G(),2)},i:function e(){return s(r.getMinutes(),2)},s:function e(){return s(r.getSeconds(),2)},u:function e(){return s(r.getMilliseconds()*1e3,6)},e:function e(){var t=/\((.*)\)/.exec(String(r))[1];return t||"Coordinated Universal Time"},I:function e(){var t=new Date(a.Y(),0),r=Date.UTC(a.Y(),0),n=new Date(a.Y(),6),i=Date.UTC(a.Y(),6);return t-r!==n-i?1:0},O:function e(){var t=r.getTimezoneOffset(),a=Math.abs(t);return(t>0?"-":"+")+s(Math.floor(a/60)*100+a%60,4)},P:function e(){var t=a.O();return t.substr(0,3)+":"+t.substr(3,2)},T:function e(){var t=(String(r).match(o.tzParts)||[""]).pop().replace(o.tzClip,"");return t||"UTC"},Z:function e(){return-r.getTimezoneOffset()*60},c:function e(){return"Y-m-d\\TH:i:sP".replace(u,c)},r:function e(){return"D, d M Y H:i:s O".replace(u,c)},U:function e(){return r.getTime()/1e3||0}};return c(t,t)},formatDate:function e(t,r){var a=this;var n=void 0,i=void 0,o=void 0,s=void 0,l=void 0,u="";var c="\\";if(typeof t==="string"){t=a.parseDate(t,r);if(!t){return null}}if(t instanceof Date){o=r.length;for(n=0;n<o;n++){l=r.charAt(n);if(l==="S"||l===c){continue}if(n>0&&r.charAt(n-1)===c){u+=l;continue}s=a.parseFormat(l,t);if(n!==o-1&&a.intParts.test(l)&&r.charAt(n+1)==="S"){i=parseInt(s)||0;s+=a.dateSettings.ordinal(i)}u+=s}return u}return""}};t["a"]=f},function(e,t,r){"use strict";(function(e){var r=function e(t,r){this.$http_=t;this.gmfShortenerCreateUrl_=r};r.$inject=["$http","gmfShortenerCreateUrl"];r.$inject=["$http","gmfShortenerCreateUrl"];r.prototype.getShortUrl=function(e){var t={url:e};if(!this.gmfShortenerCreateUrl_){return{data:{short_url:e},status:200}}return this.postShortUrl_(t)};r.prototype.sendShortUrl=function(e,t,r){var a={url:e,email:t};if(r){a["message"]=r}return this.postShortUrl_(a)};r.prototype.postShortUrl_=function(t){return this.$http_.post(this.gmfShortenerCreateUrl_,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})};r.URL_MAX_LEN=2083;r.URL_PATH_MAX_LEN=2048;r.module=angular.module("gmfShareService",[]);r.module.service("gmfShareService",r);t["a"]=r}).call(this,r(36))},,,,,function(e,t,r){"use strict";var a=r(58);var n=r(12);var i=function e(){this.extentHalfHorizontalDistance_;this.extentHalfVerticalDistance_};i.INCHES_PER_METER_=39.37;i.DOTS_PER_INCH_=72;i.prototype.createPrintMaskPostcompose=function(e,t,r){var o=this;return function(s){var l=s.context;var u=s.frameState;var c=u.viewState.resolution;var f=u.size[0]*u.pixelRatio;var h=u.size[1]*u.pixelRatio;var p=[f/2,h/2];var d=e();var g=d[1]*a["b"];var m=d[0]*a["b"];var v=t(u);var y=i.DOTS_PER_INCH_;var _=i.INCHES_PER_METER_;var b=m/y/_*v/c/2;o.extentHalfHorizontalDistance_=d[0]/y/_*v/2;var S=g/y/_*v/c/2;o.extentHalfVerticalDistance_=d[1]/y/_*v/2;l.beginPath();l.moveTo(0,0);l.lineTo(f,0);l.lineTo(f,h);l.lineTo(0,h);l.lineTo(0,0);l.closePath();if(!r){o.drawPrintZone_(l,p,b,S)}else{var C=n["i"](r());o.drawPrintZoneWithRotation_(l,p,b,S,C)}l.fillStyle="rgba(0, 5, 25, 0.5)";l.fill()}};i.prototype.drawPrintZone_=function(e,t,r,a){var n=t[0]-r;var i=t[1]-a;var o=t[0]+r;var s=t[1]+a;e.moveTo(n,i);e.lineTo(n,s);e.lineTo(o,s);e.lineTo(o,i);e.lineTo(n,i);e.closePath()};i.prototype.drawPrintZoneWithRotation_=function(e,t,r,a,n){var i=Math.sqrt(Math.pow(r,2)+Math.pow(a,2));var o=Math.atan(a/r)-n;var s=Math.atan(r/a)-n;var l=t[0]-Math.cos(o)*i;var u=t[1]+Math.sin(o)*i;var c=t[0]+Math.sin(s)*i;var f=t[1]+Math.cos(s)*i;var h=t[0]+Math.cos(o)*i;var p=t[1]-Math.sin(o)*i;var d=t[0]-Math.sin(s)*i;var g=t[1]-Math.cos(s)*i;e.moveTo(l,u);e.lineTo(c,f);e.lineTo(h,p);e.lineTo(d,g);e.lineTo(l,u);e.closePath()};i.prototype.getOptimalScale=function(e,t,r,a){var n=e[0]*t;var o=e[1]*t;var s=n*i.INCHES_PER_METER_*i.DOTS_PER_INCH_/r[0];var l=o*i.INCHES_PER_METER_*i.DOTS_PER_INCH_/r[1];var u=Math.min(s,l);var c=-1;for(var f=0,h=a.length;f<h;++f){if(u>a[f]){c=a[f]}}return c};i.prototype.getOptimalResolution=function(e,t,r){var a=i.DOTS_PER_INCH_*i.INCHES_PER_METER_;var n=t[0]*r/(a*e[0]);var o=t[1]*r/(a*e[1]);var s=Math.max(n,o);return s};i.prototype.getBottomLeftCorner=function(e){return[e[0]-this.extentHalfHorizontalDistance_,e[1]-this.extentHalfVerticalDistance_]};i.prototype.getBottomRightCorner=function(e){return[e[0]+this.extentHalfHorizontalDistance_,e[1]-this.extentHalfVerticalDistance_]};i.prototype.getUpLeftCorner=function(e){return[e[0]-this.extentHalfHorizontalDistance_,e[1]+this.extentHalfVerticalDistance_]};i.prototype.getUpRightCorner=function(e){return[e[0]+this.extentHalfHorizontalDistance_,e[1]+this.extentHalfVerticalDistance_]};i.module=angular.module("ngeoPrintUtils",[]);i.module.service("ngeoPrintUtils",i);t["a"]=i},,,function(e,t,r){"use strict";var a=r(11);var n=r(280);var i=r(279);var o=r(196);var s=["+proj="+i["a"],"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=600000","+y_0=200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");var l=[42e4,3e4,9e5,35e4];o["a"].defs("EPSG:21781",s);n["a"](o["a"]);a["g"]("EPSG:21781").setExtent(l);var u="EPSG:21781";t["a"]=u},function(e,t,r){"use strict";var a=r(2);var n=r(116);var i=r(1);var o=r(39);var s=r(110);var l=r(25);var u=r(4);var c=undefined;var f=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};n["a"].call(this,a);if(c===undefined){c=false;document.body.addEventListener("keydown",function(e){var t=!!e.metaKey;var r=e.keyCode===17;c=t||r});document.body.addEventListener("keyup",function(){c=false})}if(a.continueMsg!==undefined){this.continueMsg=a.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent=r.getString("Click to continue drawing the line.");var i=document.createElement("br");i.textContent=r.getString("Double-click or click last point to finish.");this.continueMsg.appendChild(i)}this.format=t;this.tolerance=a.tolerance;this.source=a.source};i["d"](f,n["a"]);f.prototype.createDrawInteraction=function(e,t){return new s["a"]({type:"LineString",geometryFunction:this.linestringGeometryFunction.bind(this),condition:function e(){return true},style:e,source:t})};f.prototype.linestringGeometryFunction=function(e,t){var r=this;if(c){var a=this.getMap().getView().getRotation();var n=Math.PI/4;var i=e[e.length-2];var s=e[e.length-1];var f=i[0]-s[0];var h=i[1]-s[1];var p=Object(l["d"])(i,s);var d=a+Math.round((Math.atan2(h,f)-a)/n)*n;s[0]=i[0]-p*Math.cos(d);s[1]=i[1]-p*Math.sin(d);if(this.tolerance!==undefined&&this.source!==undefined){var g=this.getMap().getView().getResolution()*this.tolerance;var m=[s[0]-g,s[1]-g,s[0]+g,s[1]+g];var v=this.source;var y=v.getFeaturesInExtent(m);y.forEach(function(e){var t=[];var a=[];var n=Infinity;var o=Object(l["d"])(i,s);var c=i[0];var f=i[1];var h=s[0];var p=s[1];var d=[(h-c)/o,(p-f)/o];var v=[c+(o+g)*d[0],f+(o+g)*d[1]];e.getGeometry().forEachSegment(function(e,o){t=r.computeLineSegmentIntersection(i,v,e,o);if(t!==undefined&&Object(u["h"])(m,t[0],t[1])){var c=Object(l["d"])(s,t);if(c<n){n=c;a=t}}});if(a){s[0]=a[0]||s[0];s[1]=a[1]||s[1]}})}}var _=t;if(_){_.setCoordinates(e);return _}return new o["a"](e)};f.prototype.handleMeasure=function(e){var t=a["a"].assertInstanceof(this.sketchFeature.getGeometry(),o["a"]);var r=this.getMap().getView().getProjection();a["a"].assert(r);var i=n["a"].getFormattedLength(t,r,this.precision,this.format);var s=t.getLastCoordinate();e(i,s)};f.prototype.computeLineSegmentIntersection=function(e,t,r,a){var n=(a[0]-r[0])*(e[1]-r[1])-(a[1]-r[1])*(e[0]-r[0]);var i=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]);var o=(a[1]-r[1])*(t[0]-e[0])-(a[0]-r[0])*(t[1]-e[1]);if(o===0){return}var s=n/o;var l=i/o;if(s>=0&&s<=1&&l>=0&&l<=1){var u=[];u[0]=e[0]+s*(t[0]-e[0]);u[1]=e[1]+s*(t[1]-e[1]);return u}};t["a"]=f},function(e,t,r){"use strict";var a=r(2);var n=r(116);var i=r(1);var o=r(34);var s=r(110);var l=function e(t,r){var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};n["a"].call(this,a);this.continueMsg;if(a.continueMsg!==undefined){this.continueMsg=a.continueMsg}else{this.continueMsg=document.createElement("span");this.continueMsg.textContent=r.getString("Click to continue drawing the polygon.");var i=document.createElement("br");i.textContent=r.getString("Double-click or click starting point to finish.");this.continueMsg.appendChild(i)}this.format=t};i["d"](l,n["a"]);l.prototype.createDrawInteraction=function(e,t){return new s["a"]({type:"Polygon",source:t,style:e})};l.prototype.handleMeasure=function(e){var t=a["a"].assertInstanceof(this.sketchFeature.getGeometry(),o["a"]);var r=this.getMap().getView().getProjection();a["a"].assert(r);var i=n["a"].getFormattedArea(t,r,this.precision,this.format);var s=t.getCoordinates()[0].length;var l=null;if(s>3){l=t.getInteriorPoint().getCoordinates()}e(i,l)};t["a"]=l},,,,,,,,,,function(e,t,r){"use strict";var a=r(36);var n=r(328);var i=r(438);var o=r(436);var s=r(194);var l=r(75);var u=r(239);var c=r(238);function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=angular.module("gmfAuthentication",[s["a"].module.name,u["a"].module.name,c["a"].name]);h.gmfAuthenticationTemplateUrl_=function(e,t){var r=t["gmfAuthenticationTemplateurl"];return r!==undefined?r:"gmf/authentication"};h.run(["$templateCache",function(e){e.put("gmf/authentication",r(432))}]);p.$inject=["$element","$attrs","gmfAuthenticationTemplateUrl"];function p(e,t,r){return r(e,t)}h.component_={bindings:{allowPasswordReset:"<?gmfAuthenticationAllowPasswordReset",allowPasswordChange:"<?gmfAuthenticationAllowPasswordChange",passwordValidator:"<?gmfAuthenticationPasswordValidator",forcePasswordChange:"<?gmfAuthenticationForcePasswordChange",infoMessage:"=?gmfAuthenticationInfoMessage"},controller:"GmfAuthenticationController",templateUrl:p};h.value("gmfAuthenticationTemplateUrl",h.gmfAuthenticationTemplateUrl_);h.component("gmfAuthentication",h.component_);h.AuthenticationController_=function(){e.$inject=["$element","gettextCatalog","gmfAuthenticationService","gmfUser","ngeoNotification"];function e(t,r,a,n,i){f(this,e);this.$element_=t;this.gmfUser=n;this.gettextCatalog=r;this.gmfAuthenticationService_=a;this.notification_=i;this.allowPasswordReset;this.allowPasswordChange;this.passwordValidator=null;this.forcePasswordChange;this.infoMessage=null;this.changingPassword=false;this.userMustChangeItsPassword=false;this.resetPasswordModalShown=false;this.error=false;this.loginVal="";this.pwdVal="";this.oldPwdVal="";this.newPwdVal="";this.newPwdConfVal=""}e.prototype.$onInit=function e(){this.allowPasswordReset=this.allowPasswordReset!==false;this.allowPasswordChange=this.allowPasswordChange!==false;this.forcePasswordChange=this.forcePasswordChange===true;if(this.forcePasswordChange){this.changingPassword=true}this.userMustChangeItsPassword=this.gmfUser.is_password_changed===false&&this.forcePasswordChange};e.prototype.changePassword=function e(){var t=this;var r=this.gettextCatalog;var a=this.oldPwdVal;var n=this.newPwdVal;var i=this.newPwdConfVal;var o=[];if(a===""){o.push(r.getString("The old password is required."))}if(n===""){o.push(r.getString("The new password is required."))}if(i===""){o.push(r.getString("The password confirmation is required."))}if(o.length){this.setError_(o)}else{if(a===n){o.push(r.getString("The old and new passwords are the same."))}if(n!==i){o.push(r.getString("The passwords don't match."))}if(this.passwordValidator){if(!this.passwordValidator.isPasswordValid(a)){o.push(r.getString(this.passwordValidator.notValidMessage))}}if(o.length){this.setError_(o)}else{this.gmfAuthenticationService_.changePassword(a,n,i).then(function(){t.changePasswordReset();t.setError_([r.getString("Your password has successfully been changed.")],l["a"].Type.INFORMATION)}).catch(function(e){t.setError_(r.getString("Incorrect old password."))})}}};e.prototype.login=function e(){var t=this.gettextCatalog;var r=[];if(this.loginVal===""){r.push(t.getString("The username is required."))}if(this.pwdVal===""){r.push(t.getString("The password is required."))}if(r.length){this.setError_(r)}else{var a=t.getString("Incorrect credentials or disabled account.");this.gmfAuthenticationService_.login(this.loginVal,this.pwdVal).then(this.resetError_.bind(this),this.setError_.bind(this,a))}};e.prototype.logout=function e(){var t=this.gettextCatalog;var r=t.getString("Could not log out.");this.gmfAuthenticationService_.logout().then(this.resetError_.bind(this),this.setError_.bind(this,r))};e.prototype.resetPassword=function e(){var t=this.gettextCatalog;if(!this.loginVal){this.setError_(t.getString("Please, input a login..."));return}var r=t.getString("An error occurred while resetting the password.");var a=function(e){this.resetPasswordModalShown=true;this.resetError_()}.bind(this);this.gmfAuthenticationService_.resetPassword(this.loginVal).then(a,this.setError_.bind(this,r))};e.prototype.changePasswordReset=function e(){this.resetError_();this.changingPassword=false;this.oldPwdVal="";this.newPwdVal="";this.newPwdConfVal=""};e.prototype.setError_=function e(t,r){if(r==undefined){r=l["a"].Type.ERROR}if(this.error){this.resetError_()}this.error=true;var a=this.$element_.find(".gmf-authentication-error");if(!Array.isArray(t)){t=[t]}t.forEach(function(e){this.notification_.notify({msg:e,target:a,type:r})},this)};e.prototype.resetError_=function e(){this.notification_.clear();this.error=false};return e}();h.controller("GmfAuthenticationController",h.AuthenticationController_);var d=h;var g=angular.module("gmfAuthenticationModule",[d.name,s["a"].module.name]);var m=g;var v=r(46);var y=r(2);var _=r(82);var b=r(1);var S=r(182);var C=r(78);var w=r(74);var T=r(126);var E=r(156);var A=r(149);var L=r(101);var P=function e(t){S["a"].call(this);this.mapUids_={};this.ngeoLayerHelper_=t};P.$inject=["ngeoLayerHelper"];P.$inject=["ngeoLayerHelper"];b["d"](P,S["a"]);P.prototype.get=function(e){var t=b["c"](e).toString();return t in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,P.BACKGROUNDLAYERGROUP_NAME).getLayers().item(0):null};P.prototype.set=function(e,t){var r=-200;var a=b["c"](e).toString();var n=this.get(e);if(t!==null){t.setZIndex(r);this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,r)}var i=this.ngeoLayerHelper_.getGroupFromMap(e,P.BACKGROUNDLAYERGROUP_NAME);if(n!==null){y["a"].assert(a in this.mapUids_);if(t!==null){i.getLayers().setAt(0,t)}else{i.getLayers().removeAt(0);delete this.mapUids_[a]}}else if(t!==null){i.getLayers().insertAt(0,t);this.mapUids_[a]=true}var o=new _["a"]("change",{current:t,previous:n});this.dispatchEvent(o);return n};P.prototype.getOpacityBgLayer=function(e){var t=b["c"](e).toString();return t in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,P.BACKGROUNDLAYERGROUP_NAME).getLayers().item(1):null};P.prototype.setOpacityBgLayer=function(e,t){var r=this.ngeoLayerHelper_.getGroupFromMap(e,P.BACKGROUNDLAYERGROUP_NAME);var a=r.getLayers().remove(this.getOpacityBgLayer(e));var n=-100;t.setOpacity(a?a.getOpacity():0);t.setVisible(a?a.getVisible():true);t.setZIndex(n);this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,n);var i=r.getLayers().getArray().indexOf(t);if(i===-1){r.getLayers().push(t)}};P.prototype.updateDimensions=function(e,t){var r=this.get(e);if(r){var a=[r];if(r instanceof C["a"]){a=r.getLayers().getArray()}a.forEach(function(e){y["a"].assertInstanceof(e,w["a"]);if(e){var r=false;var a={};for(var n in e.get("dimensions")){var i=t[n];if(i!==undefined){a[n]=i;r=true}}if(r){var o=e.getSource();if(o instanceof A["a"]){o.updateDimensions(a);o.refresh()}else if(o instanceof E["a"]||o instanceof T["a"]){o.updateParams(a);o.refresh()}}}})}};P.module=angular.module("ngeoBackgroundLayerMgr",[L["a"].module.name]);P.module.service("ngeoBackgroundLayerMgr",P);P.BACKGROUNDLAYERGROUP_NAME="background";var M=P;var x=r(3);var F=angular.module("gmfBackgroundlayerselector",[v["a"].module.name,M.module.name]);F.value("gmfBackgroundlayerselectorTemplateUrl",function(e,t){var r=t["gmfBackgroundlayerselectorTemplateurl"];return r!==undefined?r:"gmf/backgroundlayerselector"});F.run(["$templateCache",function(e){e.put("gmf/backgroundlayerselector",r(431))}]);R.$inject=["$element","$attrs","gmfBackgroundlayerselectorTemplateUrl"];function R(e,t,r){return r(e,t)}F.component_={controller:"GmfBackgroundlayerselectorController as ctrl",bindings:{map:"=gmfBackgroundlayerselectorMap",opacityOptions:"=gmfBackgroundlayerOpacityOptions",select:"&?gmfBackgroundlayerselectorSelect"},templateUrl:R};F.component("gmfBackgroundlayerselector",F.component_);F.Controller_=function(e,t,r){var a=this;this.map;this.opacityOptions;this.select;this.bgLayer;this.bgLayers;this.opacityLayer;this.gmfThemes_=r;this.listenerKeys_=[];this.listenerKeys_.push(x["a"](r,"change",this.handleThemesChange_,this));this.backgroundLayerMgr_=t;this.listenerKeys_.push(x["a"](this.backgroundLayerMgr_,"change",function(e){a.bgLayer=e.detail.current}));e.$on("$destroy",this.handleDestroy_.bind(this))};F.Controller_.$inject=["$scope","ngeoBackgroundLayerMgr","gmfThemes"];F.Controller_.prototype.$onInit=function(){this.handleThemesChange_()};F.Controller_.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getBgLayers().then(function(t){e.bgLayers=t;if(e.opacityOptions!==undefined){var r=t.find(function(t){return t.get("label")===e.opacityOptions});if(r!==undefined){e.setOpacityBgLayer(r);e.opacityLayer=r;e.bgLayers=e.bgLayers.slice();var a=e.bgLayers.findIndex(function(t){return t===e.opacityLayer});e.bgLayers.splice(a,1);e.bgLayers.push(r)}}})};F.Controller_.prototype.getSetBgLayerOpacity=function(e){if(e!==undefined){this.opacityLayer.setOpacity(e)}return this.opacityLayer.getOpacity()};F.Controller_.prototype.setLayer=function(e,t){this.bgLayer=e;this.backgroundLayerMgr_.set(this.map,e);if(!t&&this.select){this.select()}};F.Controller_.prototype.setOpacityBgLayer=function(e){this.backgroundLayerMgr_.setOpacityBgLayer(this.map,e)};F.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(x["e"]);this.listenerKeys_.length=0};F.controller("GmfBackgroundlayerselectorController",F.Controller_);var D=F;var k=r(237);var $=r(165);var O=r(296);var I=r(224);var N=r(38);var G=r(7);var U=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function j(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var V=function(){e.$inject=["$q","gmfEnumerateAttribute","ngeoDataSourcesHelper"];function e(t,r,a){j(this,e);this.q_=t;this.gmfEnumerateAttribute_=r;this.ngeoDataSourcesHelper_=a;this.collection_;this.cache_}e.prototype.getDataSource=function e(t){return this.ngeoDataSourcesHelper_.getDataSource(t)};e.prototype.prepareFiltrableDataSource=function e(t){var r=this;var a=this.q_.defer();this.ngeoDataSourcesHelper_.getDataSourceAttributes(t).then(function(e){var n=t.gmfLayer.metadata||{};var i=n.enumeratedAttributes;if(i&&i.length){var o=[];var s=function e(a){if(G["f"](i,a.name)&&a.type!==N["a"].SELECT&&(!a.choices||!a.choices.length)){o.push(r.gmfEnumerateAttribute_.getAttributeValues(t,a.name).then(function(e){var t=e.map(function(e){return e.value});a.type=N["a"].SELECT;a.choices=t}))}};for(var l=e,u=Array.isArray(l),c=0,l=u?l:l[Symbol.iterator]();;){var f;if(u){if(c>=l.length)break;f=l[c++]}else{c=l.next();if(c.done)break;f=c.value}var h=f;s(h)}return r.q_.all(o).then(a.resolve(t))}else{a.resolve(t)}});return a.promise};U(e,[{key:"collection",get:function e(){return this.ngeoDataSourcesHelper_.collection}}]);return e}();V.module=angular.module("gmfDataSourcesHelper",[I["a"].module.name,O["a"].module.name]);V.module.service("gmfDataSourcesHelper",V);var H=V;var W=r(50);var B=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function q(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function z(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function K(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var Y=function(e){K(t,e);function t(r){q(this,t);var a=z(this,e.call(this,r));a.gmfLayer_=r.gmfLayer;return a}B(t,[{key:"gmfLayer",get:function e(){return this.gmfLayer_}}]);return t}(W["a"]);var Q=Y;function X(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Z=function(){e.$inject=["ngeoDataSourcesHelper"];function e(t){X(this,e);this.ngeoDataSourcesHelper_=t}e.prototype.describe=function e(t){if(t.ogcServerType==="qgisserver"&&t.wfsUrl_&&t.getOGCLayerNames().length==1&&!t.attributes){this.ngeoDataSourcesHelper_.getDataSourceAttributes(t)}};return e}();Z.module=angular.module("gmfDatasourceWFSAliases",[I["a"].module.name]);Z.module.service("gmfWFSAliases",Z);var J=Z;var ee=r(168);var te=r(132);var re=r(167);var ae=r(164);var ne=r(133);var ie=r(93);var oe=r(9);var se=r(114);function le(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var ue=function(){e.$inject=["$q","$rootScope","$timeout","gmfThemes","gmfTreeManager","ngeoBackgroundLayerMgr","ngeoDataSources","ngeoLayerHelper","ngeoRuleHelper","ngeoWMSTime","gmfWFSAliases"];function e(t,r,a,n,i,o,s,l,u,c,f){le(this,e);this.q_=t;this.rootScope_=r;this.timeout_=a;this.gmfThemes_=n;this.gmfTreeManager_=i;this.ngeoBackgroundLayerMgr_=o;this.ngeoDataSources_=s;this.dataSources_=s.collection;this.ngeoLayerHelper_=l;this.ngeoRuleHelper_=u;this.ngeoWMSTime_=c;this.gmfWFSAliases_=f;this.dataSourcesCache_={};this.dimensions_;this.dimensionsWatcherUnregister=null;this.treeCtrlCache_={};this.treeCtrlsUnregister_=null;x["a"](this.ngeoBackgroundLayerMgr_,"change",this.handleNgeoBackgroundLayerChange_,this);x["a"](this.gmfThemes_,"change",this.handleThemesChange_,this)}e.prototype.setDatasourceMap=function e(t){this.ngeoDataSources_.map=t};e.prototype.setDimensions=function e(t){var r=this;if(this.dimensionsWatcherUnregister){this.dimensionsWatcherUnregister()}this.dimensions_=t;this.dimensionsWatcherUnregister=this.rootScope_.$watch(function(){return r.dimensions_},this.handleDimensionsChange_.bind(this),true);this.handleDimensionsChange_()};e.prototype.handleDimensionsChange_=function e(){var t=[];var r=[];var a=this.dataSources_.getArray();for(var n=a,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;if(l.dimensionsFiltersConfig){for(var u in l.dimensionsFiltersConfig){if(l.dimensionsFiltersConfig[u].value===null){var c=this.getDataSourceLayer_(l);if(c==undefined){return}var f=b["c"](c);if(r.indexOf(f)==-1){t.push(c);r.push(f)}}}}}t.forEach(this.updateLayerFilter_.bind(this))};e.prototype.handleThemesChange_=function e(){var t=this;this.clearDataSources_();if(this.treeCtrlsUnregister_){this.treeCtrlsUnregister_()}this.clearTreeCtrlCache_();this.gmfThemes_.getOgcServersObject().then(function(e){var r=t.gmfThemes_.getThemesObject().then(function(r){for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;for(var l=s.children,u=Array.isArray(l),c=0,l=u?l:l[Symbol.iterator]();;){var f;if(u){if(c>=l.length)break;f=l[c++]}else{c=l.next();if(c.done)break;f=c.value}var h=f;y["a"].assert(h);t.createDataSource_(h,h,e)}}});var a=t.gmfThemes_.getBackgroundLayersObject().then(function(r){for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;t.createDataSource_(null,s,e)}});t.q_.all([r,a]).then(function(){t.treeCtrlsUnregister_=t.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl){return t.gmfTreeManager_.rootCtrl.children}},t.handleTreeManagerRootChildrenChange_.bind(t))})})};e.prototype.handleTreeManagerRootChildrenChange_=function e(t){var r=this;this.timeout_(function(){if(!t){return}var e=[];var a=function e(t,r){var a=r.node;var n=a.children;if(!n){t.push(r)}};for(var n=0,i=t.length;n<i;n++){t[n].traverseDepthFirst(a.bind(r,e))}for(var o=0,s=e.length;o<s;o++){var l=e[o];var u=r.getTreeCtrlCacheItem_(l);if(!u){r.addTreeCtrlToCache_(l)}}var c=r.treeCtrlCache_;for(var f in r.treeCtrlCache_){var h=c[f];if(!e.includes(h.treeCtrl)){r.removeTreeCtrlCacheItem_(h)}}})};e.prototype.clearDataSources_=function e(){var t=this.dataSources_.getArray();for(var r=t.length-1,a=0;r>=a;r--){if(this.dataSourcesCache_[t[r].id]){this.dataSources_.remove(t[r])}}oe["b"](this.dataSourcesCache_)};e.prototype.createDataSource_=function e(t,r,a){var n=r.children;if(n){for(var i=n,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;y["a"].assert(u);this.createDataSource_(t,u,a)}return}var c=r;var f=b["c"](c);if(this.dataSourcesCache_[f]){return}var h=c.metadata;var p=c.type;var d=void 0;var g=void 0;var m=void 0;var _=void 0;var S=void 0;var C=void 0;var w=void 0;var T=void 0;if(p===v["a"].NodeType.WMTS){var E=c;S=E.layer;C=E.url;d=h.maxResolution;g=h.minResolution;var A=h.queryLayers||h.wmsLayers;if(A){m=A.split(",").map(function(e){return{maxResolution:d,minResolution:g,name:e,queryable:true}})}if(h.ogcServer&&a[h.ogcServer]){_=a[h.ogcServer]}w=E.imageType}else if(p===v["a"].NodeType.WMS){var L=c;d=L.maxResolutionHint;g=L.minResolutionHint;m=L.childLayers.map(function(e){return{maxResolution:e.maxResolutionHint,minResolution:e.minResolutionHint,name:e.name,queryable:e.queryable}});var P=!t||t.mixed?L.ogcServer:t.ogcServer;y["a"].assert(P);_=a[P];w=_.imageType;if(L.time){T=L.time}else if(t&&t.time){T=t.time}}var M=_?_.type:undefined;var x=_?_.isSingleTile:undefined;var F=_&&_.wfsSupport?_.urlWfs:undefined;var R=_?_.url:undefined;var D=W["a"].WFSOutputFormat.GML3;if(M===W["a"].ServerType.QGISSERVER){D=W["a"].WFSOutputFormat.GML2}var k=!!h.snappingConfig;var $=h.snappingConfig?h.snappingConfig.tolerance:undefined;var O=h.snappingConfig?h.snappingConfig.edge:undefined;var I=h.snappingConfig?h.snappingConfig.vertex:undefined;var N=this.dimensions_;var G=r.dimensions||t.dimensions;var U=r.dimensionsFilters;var j=void 0;var V=void 0;if(T){var H=this.ngeoWMSTime_.getOptions(T)["values"];if(Array.isArray(H)){j=H[0];V=H[1]}else{j=H}}var B=h.copyable;var q=h.identifierAttributeField;var z=c.name;var K=h.timeAttribute;var Y=h.isChecked===true;this.dataSourcesCache_[f]=new Q({copyable:B,dimensions:N,dimensionsConfig:G,dimensionsFiltersConfig:U,gmfLayer:c,id:f,identifierAttribute:q,maxResolution:d,minResolution:g,name:z,ogcImageType:w,ogcLayers:m,ogcServerType:M,ogcType:p,snappable:k,snappingTolerance:$,snappingToEdges:O,snappingToVertice:I,timeAttributeName:K,timeLowerValue:j,timeProperty:T,timeUpperValue:V,visible:Y,wfsOutputFormat:D,wfsUrl:F,wmsIsSingleTile:x,wmsUrl:R,wmtsLayer:S,wmtsUrl:C})};e.prototype.addTreeCtrlToCache_=function e(t){var r=b["c"](t.node);var a=this.dataSourcesCache_[r];y["a"].assert(a,"DataSource should be set");t.setDataSource(a);var n=this.rootScope_.$watch(function(){return t.getState()},this.handleTreeCtrlStateChange_.bind(this,t));var i=this.rootScope_.$watch(function(){var e=a.filterRules!==null;var t=a.visible;return e&&t},this.handleDataSourceFilterRulesChange_.bind(this,a));var o=void 0;var s=void 0;var l=void 0;if(a.timeProperty&&a.ogcType===W["a"].Type.WMS){o=this.rootScope_.$watch(function(){return a.timeLowerValue},this.handleDataSourceTimeValueChange_.bind(this,a));if(a.timeProperty.mode==="range"){s=this.rootScope_.$watch(function(){return a.timeUpperValue},this.handleDataSourceTimeValueChange_.bind(this,a))}l=y["a"].assertInstanceof(ee["a"].getLayer(t),se["a"])}this.treeCtrlCache_[r]={filterRulesWatcherUnregister:i,stateWatcherUnregister:n,timeLowerValueWatcherUnregister:o,timeUpperValueWatcherUnregister:s,treeCtrl:t,wmsLayer:l};this.dataSources_.push(a);this.gmfWFSAliases_.describe(a)};e.prototype.removeTreeCtrlCacheItem_=function e(t){var r=t.treeCtrl.getDataSource();y["a"].assert(r,"DataSource should be set");this.dataSources_.remove(r);t.treeCtrl.setDataSource(null);t.filterRulesWatcherUnregister();t.stateWatcherUnregister();if(t.timeLowerValueWatcherUnregister){t.timeLowerValueWatcherUnregister()}if(t.timeUpperValueWatcherUnregister){t.timeUpperValueWatcherUnregister()}delete this.treeCtrlCache_[b["c"](t.treeCtrl.node)]};e.prototype.clearTreeCtrlCache_=function e(){for(var t in this.treeCtrlCache_){this.removeTreeCtrlCacheItem_(this.treeCtrlCache_[t])}};e.prototype.handleTreeCtrlStateChange_=function e(t,r){var a=t.getDataSource();y["a"].assert(a,"DataSource should be set");var n=r==="on";a.visible=n;var i=this.getDataSourceLayer_(a);if(i==undefined){return}this.updateLayerFilter_(i)};e.prototype.getTreeCtrlCacheItem_=function e(t){return this.treeCtrlCache_[b["c"](t.node)]||null};e.prototype.getDataSourceLayer_=function e(t){t=t;if(t.gmfLayer==undefined){return}var r=b["c"](t.gmfLayer);if(r==undefined){return}var a=this.treeCtrlCache_[r];if(a==undefined){return}var n=a.treeCtrl;return ee["a"].getLayer(n)};e.prototype.updateLayerFilter_=function e(t){var r;y["a"].assert(t instanceof se["a"]||t instanceof ie["a"]);var a=t.getSource();if(!(a instanceof T["a"]||a instanceof E["a"])){return}var n=a.getParams();var i=n["LAYERS"];var o=i.split(",");y["a"].assert(o.length>=1);var s="FILTER";var l=[];var u=false;for(var c=o,f=Array.isArray(c),h=0,c=f?c:c[Symbol.iterator]();;){var p;if(f){if(h>=c.length)break;p=c[h++]}else{h=c.next();if(h.done)break;p=h.value}var d=p;var g="()";var m=this.dataSources_.getArray();for(var v=m,_=Array.isArray(v),S=0,v=_?v:v[Symbol.iterator]();;){var C;if(_){if(S>=v.length)break;C=v[S++]}else{S=v.next();if(S.done)break;C=S.value}var w=C;var A=this.getDataSourceLayer_(w);if(A==undefined){continue}if(b["c"](A)==b["c"](t)&&t.get("querySourceIds").indexOf(w.id)>=0&&w.gmfLayer.layers.split(",").indexOf(d)>=0){var L=b["c"](w.gmfLayer);var P=this.treeCtrlCache_[L];y["a"].assert(P);var M=P.treeCtrl;var x=M.map.getView().getProjection().getCode();var F=w.visible?this.ngeoRuleHelper_.createFilterString({dataSource:w,projCode:x,incDimensions:true}):null;if(F){g="("+F+")";u=true}}}l.push(g)}a.updateParams((r={},r[s]=u?l.join(""):null,r))};e.prototype.handleDataSourceFilterRulesChange_=function e(t){if(t.filtrable!==true||t.ogcType!==W["a"].Type.WMS){return}var r=this.getDataSourceLayer_(t);if(r===undefined){return}this.updateLayerFilter_(r)};e.prototype.handleDataSourceTimeValueChange_=function e(t){var r=b["c"](t.gmfLayer);var a=this.treeCtrlCache_[r];y["a"].assert(a);var n=y["a"].assert(a.wmsLayer);var i=y["a"].assertInstanceof(n.getSource(),T["a"]);var o=y["a"].assert(t.timeProperty);var s=void 0;var l=t.timeRangeValue;if(l){s=this.ngeoWMSTime_.formatWMSTimeParam(o,l)}var u=i.getParams();var c=u["TIME"];if(c===s){return}this.ngeoLayerHelper_.updateWMSLayerState(n,i.getParams()["LAYERS"],s)};e.prototype.handleNgeoBackgroundLayerChange_=function e(t){var r=t.detail.previous;var a=t.detail.current;var n=this.dataSourcesCache_;if(r){var i=r.get("querySourceIds");if(Array.isArray(i)){for(var o=i,s=Array.isArray(o),l=0,o=s?o:o[Symbol.iterator]();;){var u;if(s){if(l>=o.length)break;u=o[l++]}else{l=o.next();if(l.done)break;u=l.value}var c=u;var f=n[c];if(f){f.visible=false;this.dataSources_.remove(f)}}}}if(a){var h=a.get("querySourceIds");if(Array.isArray(h)){for(var p=h,d=Array.isArray(p),g=0,p=d?p:p[Symbol.iterator]();;){var m;if(d){if(g>=p.length)break;m=p[g++]}else{g=p.next();if(g.done)break;m=g.value}var v=m;var y=n[v];if(y){y.visible=true;this.dataSources_.push(y)}}}}};return e}();ue.module=angular.module("gmfDataSourcesManager",[J.module.name,ee["a"].module.name,te["a"].module.name,v["a"].module.name,ae["a"].module.name,re["a"].module.name,M.module.name,L["a"].module.name,ne["a"].module.name]);ue.module.service("gmfDataSourcesManager",ue);var ce=ue;var fe=angular.module("gmfDatasourceModule",[k["a"].module.name,$["a"].module.name,H.module.name,ce.module.name,J.module.name]);var he=fe;var pe=r(159);var de=r(48);var ge=r(327);var me=r(207);var ve=r(499);var ye=function e(t,r,a){this.sce_=t;this.gettextCatalog_=r;this.createPopup_=a;l["a"].call(this);var n=angular.element('<div class="ngeo-disclaimer"></div>');angular.element(document.body).append(n);this.container_=n;this.messages_={}};ye.$inject=["$sce","gettextCatalog","ngeoCreatePopup"];ye.$inject=["$sce","gettextCatalog","ngeoCreatePopup"];b["d"](ye,l["a"]);ye.prototype.alert=function(e){this.show(e)};ye.prototype.close=function(e){var t=this.getMessageObjects(e);t.forEach(this.closeMessage_,this)};ye.prototype.showMessage=function(e){var t=this;var r=this.gettextCatalog_;var a=e.type;y["a"].assertString(a,"Type should be set.");var n=this.getMessageUid_(e);if(this.messages_[n]!==undefined){return}var i=e.popup===true;if(i){var o=this.createPopup_();var s=this.sce_.trustAsHtml(e.msg);o.open({autoDestroy:true,content:s,title:"&nbsp;"});o.scope.$watch("open",function(r,a){if(!r){t.closeMessage_(e)}});this.messages_[n]=o}else{var u=["alert","fade","alert-dismissible"];switch(a){case l["a"].Type.ERROR:u.push("alert-danger");break;case l["a"].Type.INFORMATION:u.push("alert-info");break;case l["a"].Type.SUCCESS:u.push("alert-success");break;case l["a"].Type.WARNING:u.push("alert-warning");break;default:break}var c=angular.element('<div role="alert" class="'+u.join(" ")+'"></div>');var f=angular.element('<button type="button" class="close" data-dismiss="alert" aria-label="'+r.getString("Close")+'"><span aria-hidden="true" class="fa fa-times"></span></button>');var h=angular.element("<span />").html(e.msg);c.append(f).append(h);var p=void 0;if(e.target){p=angular.element(e.target)}else{p=this.container_}p.append(c);c.addClass("in");c.on("closed.bs.alert",function(){t.closeMessage_(e)});this.messages_[n]=c}};ye.prototype.getMessageUid_=function(e){return e.msg+"-"+e.type};ye.prototype.closeMessage_=function(e){var t=this.getMessageUid_(e);var r=this.messages_[t];if(r===undefined){return}if(r instanceof me["a"]){if(r.getOpen()){r.setOpen(false)}}else{if(r.hasClass("in")){r.alert("close")}}delete this.messages_[t]};ye.module=angular.module("ngeoDisclaimer",[me["a"].module.name]);ye.module.service("ngeoDisclaimer",ye);var _e=ye;var be=r(131);var Se=r(310);var Ce=angular.module("gmfDisclaimer",["ngSanitize",L["a"].module.name,_e.module.name,be["a"].module.name]);Ce.Controller_=function(e,t,r,a,n,i,o,s,l){this.map;this.external;this.popup;this.visibility=false;this.msg;this.msgs_=[];this.sce_=r;this.timeout_=a;this.gettextCatalog_=n;this.element_=e;this.createPopup_=i;this.disclaimer_=o;this.eventHelper_=s;this.ngeoLayerHelper_=l;this.dataLayerGroup_=null};Ce.Controller_.$inject=["$element","$scope","$sce","$timeout","gettextCatalog","ngeoCreatePopup","ngeoDisclaimer","ngeoEventHelper","ngeoLayerHelper"];Ce.Controller_.prototype.$onInit=function(){this.dataLayerGroup_=this.ngeoLayerHelper_.getGroupFromMap(this.map,de["a"].DATALAYERGROUP_NAME);this.registerLayer_(this.dataLayerGroup_)};Ce.Controller_.prototype.handleLayersAdd_=function(e){var t=this;this.timeout_(function(){var r=e.element;y["a"].assertInstanceof(r,pe["a"]);t.registerLayer_(r)})};Ce.Controller_.prototype.handleLayersRemove_=function(e){var t=e.element;y["a"].assertInstanceof(t,pe["a"]);this.unregisterLayer_(t)};Ce.Controller_.prototype.registerLayer_=function(e){var t=this;var r=b["c"](e);if(e instanceof C["a"]){this.eventHelper_.addListenerKey(r,x["a"](e.getLayers(),"add",this.handleLayersAdd_,this));this.eventHelper_.addListenerKey(r,x["a"](e.getLayers(),"remove",this.handleLayersRemove_,this));e.getLayers().forEach(function(e){t.registerLayer_(e)})}else{var a=e.get("disclaimers");if(a&&Array.isArray(a)){a.forEach(function(e){t.showDisclaimerMessage_(e)})}}};Ce.Controller_.prototype.unregisterLayer_=function(e){var t=this;var r=b["c"](e);if(e instanceof C["a"]){this.eventHelper_.clearListenerKey(r);e.getLayers().forEach(function(e){return t.unregisterLayer_(e)})}else{var a=e.get("disclaimers");if(a&&Array.isArray(a)){a.forEach(function(e){t.closeDisclaimerMessage_(e)})}}};Ce.Controller_.prototype.$onDestroy=function(){this.unregisterLayer_(this.dataLayerGroup_)};Ce.Controller_.prototype.showDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e);if(this.external){if(this.msgs_.indexOf(e)<0){this.msgs_.push(e)}this.msg=""+this.sce_.trustAsHtml(this.msgs_.join("<br />"));this.visibility=true}else{this.disclaimer_.alert({popup:this.popup,msg:e,target:this.element_,type:l["a"].Type.WARNING})}};Ce.Controller_.prototype.closeDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e);if(this.external){this.visibility=false;this.msgs_.length=0;this.msg=""}else{this.disclaimer_.close({popup:this.popup,msg:e,target:this.element_,type:l["a"].Type.WARNING})}};Ce.component_={controller:Ce.Controller_,bindings:{popup:"<?gmfDisclaimerPopup",map:"=gmfDisclaimerMap",external:"<?gmfDisclaimerExternal",visibility:"=?gmfDisclaimerExternalVisibility",msg:"=?gmfDisclaimerExternalMsg"}};Ce.component("gmfDisclaimer",Ce.component_);var we=Ce;var Te=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Ee(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Ae=function(){e.$inject=["$rootScope"];function e(t){var r=this;Ee(this,e);this.rootScope_=t;this.currentDataSourceId_=null;this.currentDataSourceItems_=[];this.localStorageKey_="gmf_savedfilters";this.useLocalStorage_=true;try{if("localStorage"in window){window.localStorage["test"]="";delete window.localStorage["test"]}else{this.useLocalStorage_=false}}catch(e){console.error(e);this.useLocalStorage_=false}this.items_=[];this.rootScope_.$watchCollection(function(){return r.items},function(){r.rePopulateCurrentDataSourceItems_()});if(this.useLocalStorage_){this.loadItemsFromLocalStorage_()}}e.prototype.loadItemsFromLocalStorage_=function e(){if(window.localStorage[this.localStorageKey_]){var t=JSON.parse(window.localStorage[this.localStorageKey_]);y["a"].assertArray(t);this.items_=t}};e.prototype.indexOfItem=function e(t,r){var a=void 0;var n=-1;for(var i=0,o=this.items_.length;i<o;i++){a=this.items[i];if(a.dataSourceId===r&&a.name===t){n=i;break}}return n};e.prototype.save=function e(t){var r=this.indexOfItem(t.name,t.dataSourceId);if(r!==-1){this.items[r]=t}else{this.items.push(t)}if(this.useLocalStorage_){this.saveItemsInLocalStorage_()}};e.prototype.remove=function e(t){var r=G["j"](this.items,t);if(r&&this.useLocalStorage_){this.saveItemsInLocalStorage_()}};e.prototype.saveItemsInLocalStorage_=function e(){window.localStorage[this.localStorageKey_]=JSON.stringify(this.items)};e.prototype.rePopulateCurrentDataSourceItems_=function e(){this.currentDataSourceItems_.length=0;if(this.currentDataSourceId_!==null){for(var t=this.items,r=Array.isArray(t),a=0,t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{a=t.next();if(a.done)break;n=a.value}var i=n;if(i.dataSourceId===this.currentDataSourceId_){this.currentDataSourceItems_.push(i)}}}};Te(e,[{key:"currentDataSourceItems",get:function e(){return this.currentDataSourceItems_}},{key:"currentDataSourceId",set:function e(t){this.currentDataSourceId_=t;this.rePopulateCurrentDataSourceItems_()}},{key:"items",get:function e(){return this.items_}}]);return e}();Ae.module=angular.module("gmfSavedFilters",[]);Ae.module.service("gmfSavedFilters",Ae);Ae.Item=function(){};Ae.Item.prototype.condition;Ae.Item.prototype.customRules;Ae.Item.prototype.dataSourceId;Ae.Item.prototype.directedRules;Ae.Item.prototype.name;var Le=Ae;var Pe=r(130);var Me=r(160);var xe=r(232);var Fe=r(271);var Re=r(20);var De=r(270);var ke=r(230);var $e=r(229);var Oe=r(208);var Ie=r(290);var Ne=r(140);var Ge=r(65);var Ue=r(69);var je=r(188);var Ve=r(47);var He=r(94);var We=r(185);var Be=r(22);var qe=r(18);var ze=r(13);var Ke=r(104);var Ye=r(45);var Qe=r(70);function Xe(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Ze=angular.module("ngeoRule",[Fe["a"].name,ae["a"].module.name,Oe["a"].module.name,Ie["a"].name,Ge["a"].module.name,je["a"].module.name]);Ze.run(["$templateCache",function(e){e.put("ngeo/filter/rulecomponent",r(418))}]);Ze.value("ngeoRuleTemplateUrl",function(e){var t=e["ngeoRuleTemplateUrl"];return t!==undefined?t:"ngeo/filter/rulecomponent"});Je.$inject=["$attrs","ngeoRuleTemplateUrl"];function Je(e,t){return t(e)}Ze.RuleController_=function(){e.$inject=["gettextCatalog","$scope","$timeout","ngeoFeatureHelper","ngeoRuleHelper","ngeoToolActivateMgr"];function e(t,r,a,n,i,o){var s,l;Xe(this,e);this.featureOverlay;this.map;this.rule;this.toolGroup;this.gettextCatalog_=t;this.scope_=r;this.timeout_=a;this.ngeoFeatureHelper_=n;this.ngeoRuleHelper_=i;this.ngeoToolActivateMgr_=o;this.clone;var u=Ve["a"].OperatorType;var c=Ve["a"].SpatialOperatorType;var f=Ve["a"].TemporalOperatorType;this.operators=(s={},s[u.EQUAL_TO]=t.getString("Is equal to"),s[u.GREATER_THAN]=t.getString("Is greater than"),s[u.GREATER_THAN_OR_EQUAL_TO]=t.getString("Is greater than or equal to"),s[u.LESSER_THAN]=t.getString("Is lesser than"),s[u.LESSER_THAN_OR_EQUAL_TO]=t.getString("Is lesser than or equal to"),s[u.NOT_EQUAL_TO]=t.getString("Is not equal to"),s[u.LIKE]=t.getString("Contains"),s[c.CONTAINS]=t.getString("Contains"),s[c.INTERSECTS]=t.getString("Intersects"),s[c.WITHIN]=t.getString("Is inside of"),s[f.BEGINS]=t.getString("Begins at"),s[f.DURING]=t.getString("During"),s[f.ENDS]=t.getString("Ends at"),s[f.EQUALS]=t.getString("Is equal to"),s);this.operatorsShortFormat=(l={},l[u.EQUAL_TO]="=",l[u.GREATER_THAN]=">",l[u.GREATER_THAN_OR_EQUAL_TO]=">=",l[u.LESSER_THAN]="<",l[u.LESSER_THAN_OR_EQUAL_TO]="<=",l[u.NOT_EQUAL_TO]="!=",l[u.LIKE]="~",l[f.BEGINS]=">=",l[f.ENDS]="<=",l[f.EQUALS]="=",l);this.timeRangeMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createWeekAgoDate_(),mode:"range",interval:[0,1,0,0]};this.timeValueMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createDate_(),mode:"value",interval:[0,1,0,0]};this.toolActivate_;this.unlisteners_=[];this.drawActive=false;this.drawToolActivate=new Ue["a"](this,"drawActive");this.drawnFeatures=new qe["b"];this.menu_=null;this.selectedFeatures=new qe["b"];this.interactions_=new qe["b"];this.modify_=new De["a"]({features:this.selectedFeatures,style:n.getVertexStyle(false)});this.interactions_.push(this.modify_);this.rotate_=new ke["a"]({features:this.selectedFeatures,style:new ze["c"]({text:new Ke["a"]({text:"",font:"normal 18px FontAwesome",fill:new Ye["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.rotate_);this.translate_=new $e["a"]({features:this.selectedFeatures,style:new ze["c"]({text:new Ke["a"]({text:"",font:"normal 18px FontAwesome",fill:new Ye["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.translate_);this.listenerKeys_=[];this.initializeInteractions_();this.modifyToolActivate=new Ue["a"](this.modify_,"active");this.rotateToolActivate=new Ue["a"](this.rotate_,"active");this.translateToolActivate=new Ue["a"](this.translate_,"active");this.geomType=null}e.prototype.$onInit=function e(){var t=this;this.clone=this.ngeoRuleHelper_.cloneRule(this.rule);this.toolActivate_=new Ue["a"](this.rule,"active");this.ngeoToolActivateMgr_.registerTool(this.toolGroup,this.toolActivate_);this.scope_.$watch(function(){return t.rule.active},this.handleActiveChange_.bind(this));if(this.clone.type===N["a"].DATE||this.clone.type===N["a"].DATETIME){this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.getExpression()},function(e){t.timeValueMode.minDefValue=e||t.createDate_()}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.lowerBoundary},function(e){t.timeRangeMode.minDefValue=e||t.createWeekAgoDate_()}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.upperBoundary},function(e){t.timeRangeMode.maxDefValue=e||t.createDate_()}))}else if(this.clone.type===N["a"].GEOMETRY){this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.operator},function(e){if(e&&e===Ve["a"].SpatialOperatorType.CONTAINS){var r=y["a"].assertInstanceof(t.clone,He["a"]);var a=r.feature.getGeometry();if(a){var n=t.ngeoFeatureHelper_.getType(r.feature);var i=[Re["a"].CIRCLE,Re["a"].POLYGON,Re["a"].RECTANGLE];if(!G["f"](i,n)){t.clone.setExpression(null)}}}}));this.unlisteners_.push(this.scope_.$watch(function(){return t.clone.expression},function(e){if(e){var r=y["a"].assertInstanceof(t.clone,He["a"]);t.geomType=t.ngeoFeatureHelper_.getType(r.feature)}else{t.geomType=null}}));this.unlisteners_.push(this.scope_.$watch(function(){var e=t.clone.getExpression()!==null;var r=t.rule.active===true;var a=t.modify_.getActive()||t.rotate_.getActive()||t.translate_.getActive();return e&&r&&a},function(e){if(e){var r=y["a"].assertInstanceof(t.clone,He["a"]);t.selectedFeatures.push(r.feature)}else{t.selectedFeatures.clear()}}))}};e.prototype.$onDestroy=function e(){if(this.rule.active){this.rule.active=false;this.handleActiveChange_(false,true)}this.ngeoToolActivateMgr_.unregisterTool(this.toolGroup,this.toolActivate_);for(var t=0,r=this.unlisteners_.length;t<r;t++){this.unlisteners_[t]()}this.unlisteners_.length=0;this.clone.destroy()};e.prototype.toggle=function e(){if(this.rule.active){this.cancel()}else{this.rule.active=true}};e.prototype.apply=function e(){this.ngeoRuleHelper_.extendRule(this.clone,this.rule);this.rule.active=false};e.prototype.cancel=function e(){this.ngeoRuleHelper_.extendRule(this.rule,this.clone);this.rule.active=false};e.prototype.reset=function e(){this.clone.reset();this.rule.reset()};e.prototype.toggleChoiceSelection=function e(t){var r=y["a"].assertInstanceof(this.clone,We["a"]);var a=r.getExpression()?r.getExpression().split(","):[];var n=a.indexOf(t);if(n>-1){a.splice(n,1)}else{a.push(t)}r.setExpression(a.length?a.join(","):null)};e.prototype.onDateSelected=function e(t){this.clone.setExpression(t["start"])};e.prototype.onDateRangeSelected=function e(t){this.clone.lowerBoundary=t["start"];this.clone.upperBoundary=t["end"]};e.prototype.createDate_=function e(t){var r=new Date;if(t!==undefined){var a=r.getTime()-t;r.setTime(a)}return r.toISOString()};e.prototype.createWeekAgoDate_=function e(){return this.createDate_(1e3*60*60*24*7)};e.prototype.timeToDate=function e(t){var r=new Date(t);return r.toLocaleDateString()};e.prototype.handleActiveChange_=function e(t,r){if(!(this.rule instanceof He["a"])||!(this.clone instanceof He["a"])||t===r){return}var a=this.listenerKeys_;var n=["ngeo-rule-",b["c"](this)].join("-");var i=this.ngeoToolActivateMgr_;var o=this.rule.feature;var s=this.clone.feature;var l=this.map.getViewport();y["a"].assertElement(l);if(t){a.push(x["a"](this.drawnFeatures,"add",this.handleFeaturesAdd_,this));a.push(x["a"](l,"contextmenu",this.handleMapContextMenu_,this));a.push(x["a"](this.translate_,"translateend",this.handleTranslateEnd_,this));a.push(x["a"](this.rotate_,"rotateend",this.handleRotateEnd_,this));this.featureOverlay.removeFeature(o);this.featureOverlay.addFeature(s);this.registerInteractions_();i.registerTool(n,this.drawToolActivate,false);i.registerTool(n,this.modifyToolActivate,true);i.registerTool(n,this.rotateToolActivate,false);i.registerTool(n,this.translateToolActivate,false);this.modify_.setActive(true);if(s.getGeometry()){this.ngeoFeatureHelper_.setStyle(s,true)}}else{s.setStyle(null);a.forEach(x["e"]);a.length=0;this.drawActive=false;i.unregisterTool(n,this.drawToolActivate);i.unregisterTool(n,this.modifyToolActivate);i.unregisterTool(n,this.rotateToolActivate);i.unregisterTool(n,this.translateToolActivate);this.modify_.setActive(false);this.unregisterInteractions_();if(this.selectedFeatures.getLength()){this.featureOverlay.removeFeature(s)}this.featureOverlay.addFeature(o);this.selectedFeatures.clear()}};e.prototype.initializeInteractions_=function e(){this.interactions_.forEach(function(e){e.setActive(false);Ne["a"].interaction(e)})};e.prototype.registerInteractions_=function e(){var t=this;this.interactions_.forEach(function(e){t.map.addInteraction(e)})};e.prototype.unregisterInteractions_=function e(){var t=this;this.interactions_.forEach(function(e){t.map.removeInteraction(e)})};e.prototype.handleFeaturesAdd_=function e(t){var r=this;this.timeout_(function(){var e=y["a"].assertInstanceof(r.clone,He["a"]);var a=e.feature;var n=y["a"].assertInstanceof(t.element,Be["a"]);var i=y["a"].assertInstanceof(n.getGeometry(),Qe["a"]);e.geometry=i;r.drawActive=false;var o=r.ngeoFeatureHelper_.getNonSpatialProperties(n);r.ngeoFeatureHelper_.clearNonSpatialProperties(a);a.setProperties(o);r.ngeoFeatureHelper_.setStyle(a,true);r.scope_.$apply()})};e.prototype.getRuleGeometryType=function e(){var t=y["a"].assertInstanceof(this.rule,He["a"]);return this.ngeoFeatureHelper_.getType(t.feature)};e.prototype.handleMapContextMenu_=function e(t){var r=this;this.removeMenu_();var a=this.map.getEventPixel(t);var n=this.map.getCoordinateFromPixel(a);var i=this.map.forEachFeatureAtPixel(a,function(e){var t=false;if(G["f"](r.selectedFeatures.getArray(),e)){t=e}return t});i=i?i:null;var o=[];if(i){var s=this.ngeoFeatureHelper_.getType(i);var l=this.gettextCatalog_;if(s==Re["a"].CIRCLE||s==Re["a"].LINE_STRING||s==Re["a"].POLYGON||s==Re["a"].RECTANGLE){o.push({cls:"fa fa-arrows",label:l.getString("Move"),name:"move"})}if(s==Re["a"].LINE_STRING||s==Re["a"].POLYGON||s==Re["a"].RECTANGLE){o.push({cls:"fa fa-rotate-right",label:l.getString("Rotate"),name:"rotate"})}}if(o.length){this.menu_=new xe["a"]({actions:o});x["a"](this.menu_,"actionclick",this.handleMenuActionClick_,this);this.map.addOverlay(this.menu_);this.menu_.open(n);t.preventDefault();t.stopPropagation();this.scope_.$apply()}};e.prototype.removeMenu_=function e(){if(this.menu_){x["c"](this.menu_,"actionclick",this.handleMenuActionClick_,this);this.map.removeOverlay(this.menu_);this.menu_=null}};e.prototype.handleMenuActionClick_=function e(t){var r=t.detail.action;switch(r){case"move":this.translate_.setActive(true);this.scope_.$apply();break;case"rotate":this.rotate_.setActive(true);this.scope_.$apply();break;default:console.log("FIXME - support: "+r);break}};e.prototype.handleRotateEnd_=function e(t){this.rotate_.setActive(false);this.scope_.$apply()};e.prototype.handleTranslateEnd_=function e(t){this.translate_.setActive(false);this.scope_.$apply()};return e}();Ze.component("ngeoRule",{bindings:{featureOverlay:"<",map:"<",rule:"<",toolGroup:"<"},controller:Ze.RuleController_,templateUrl:Je});var et=Ze;function tt(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var rt=angular.module("ngeoFilter",[ae["a"].module.name,et.name,Oe["a"].module.name,Pe["a"].module.name]);rt.run(["$templateCache",function(e){e.put("ngeo/filter",r(417))}]);rt.value("ngeoFilterTemplateUrl",function(e){var t=e["ngeoFilterTemplateUrl"];return t!==undefined?t:"ngeo/filter"});at.$inject=["$attrs","ngeoFilterTemplateUrl"];function at(e,t){return t(e)}rt.component("ngeoFilter",{bindings:{aRuleIsActive:"=",customRules:"<",datasource:"<",directedRules:"<",featureOverlay:"<",map:"<",toolGroup:"<"},controller:"ngeoFilterController",templateUrl:at});rt.FilterController_=function(){e.$inject=["gettextCatalog","$scope","$timeout","ngeoMapQuerent","ngeoRuleHelper"];function e(t,r,a,n,i){tt(this,e);this.aRuleIsActive;this.customRules;this.datasource;this.directedRules;this.featureOverlay;this.map;this.toolGroup;this.gettextCatalog_=t;this.scope_=r;this.timeout_=a;this.ngeoMapQuerent_=n;this.ngeoRuleHelper_=i;this.conditions=[{text:t.getString("All"),value:Me["a"].AND},{text:t.getString("At least one"),value:Me["a"].OR},{text:t.getString("None"),value:Me["a"].NOT}];this.geometryAttributes=[];this.otherAttributes=[];this.ruleUnlisteners_={}}e.prototype.$onInit=function e(){var t=this;this.scope_.$watch(function(){return t.aRuleIsActive},this.handleARuleIsActiveChange_.bind(this));var r=y["a"].assert(this.datasource.attributes);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.type===N["a"].GEOMETRY){this.geometryAttributes.push(s)}else{this.otherAttributes.push(s)}}var l=[].concat(this.customRules,this.directedRules);for(var u=l,c=Array.isArray(u),f=0,u=c?u:u[Symbol.iterator]();;){var h;if(c){if(f>=u.length)break;h=u[f++]}else{f=u.next();if(f.done)break;h=f.value}var p=h;this.registerRule_(p)}this.apply()};e.prototype.$onDestroy=function e(){if(this.datasource.filterRules!==null){this.datasource.filterRules=null}this.featureOverlay.clear()};e.prototype.hasARule=function e(){return[].concat(this.customRules,this.directedRules).length>0};e.prototype.apply=function e(){var t=this;this.datasource.filterRules=null;this.timeout_(function(){var e=t.getRulesWithValue_();if(e.length){t.datasource.filterRules=e;t.ngeoMapQuerent_.clear()}})};e.prototype.getData=function e(){var t=this.getRulesWithValue_();if(!t.length){return}var r=this.datasource;var a=1e3;var n=this.map;var i=n.getView().getProjection().getCode();var o=this.ngeoRuleHelper_.createFilter({dataSource:r,filterRules:t,srsName:i});y["a"].assert(o);this.ngeoMapQuerent_.issue({dataSources:[r],filter:o,limit:a,map:n})};e.prototype.getRulesWithValue_=function e(){var t=[];var r=[].concat(this.customRules,this.directedRules);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.value){t.push(s)}}return t};e.prototype.createAndAddCustomRule=function e(t){var r=this.ngeoRuleHelper_.createRuleFromAttribute(t,true);this.registerRule_(r);this.customRules.push(r);this.timeout_(function(){r.active=true},1)};e.prototype.setCondition=function e(t){if(this.datasource.filterCondition!==t.value){this.datasource.filterCondition=t.value}};e.prototype.removeCustomRule=function e(t){var r=this;t.active=false;this.timeout_(function(){G["j"](r.customRules,t);r.unregisterRule_(t);t.destroy()})};e.prototype.registerRule_=function e(t){var r=b["c"](t);this.ruleUnlisteners_[r]=this.scope_.$watch(function(){return t.active},this.handleRuleActiveChange_.bind(this));if(t instanceof He["a"]){this.featureOverlay.addFeature(t.feature)}};e.prototype.unregisterRule_=function e(t){var r=b["c"](t);var a=this.ruleUnlisteners_[r];y["a"].assert(a);a();delete this.ruleUnlisteners_[r];if(t instanceof He["a"]){this.featureOverlay.removeFeature(t.feature)}};e.prototype.handleRuleActiveChange_=function e(){var t=false;var r=[].concat(this.customRules,this.directedRules);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.active){t=true;break}}this.aRuleIsActive=t};e.prototype.handleARuleIsActiveChange_=function e(){if(this.aRuleIsActive){return}var t=[].concat(this.customRules,this.directedRules);for(var r=t,a=Array.isArray(r),n=0,r=a?r:r[Symbol.iterator]();;){var i;if(a){if(n>=r.length)break;i=r[n++]}else{n=r.next();if(n.done)break;i=n.value}var o=i;if(o.active){o.active=false;break}}};return e}();rt.controller("ngeoFilterController",rt.FilterController_);var nt=rt;var it=r(100);var ot=r(163);function st(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var lt=angular.module("gmfFilterselector",[s["a"].module.name,k["a"].module.name,H.module.name,it["a"].module.name,u["a"].module.name,c["a"].name,ae["a"].module.name,nt.name,Le.module.name]);lt.run(["$templateCache",function(e){e.put("gmf/filters/filterselectorcomponent",r(416))}]);lt.value("gmfFilterselectorTemplateUrl",function(e){var t=e["gmfFilterselectorTemplateUrl"];return t!==undefined?t:"gmf/filters/filterselectorcomponent"});ut.$inject=["$attrs","gmfFilterselectorTemplateUrl"];function ut(e,t){return t(e)}lt.Controller_=function(){e.$inject=["$scope","$timeout","gettextCatalog","gmfDataSourceBeingFiltered","gmfDataSourcesHelper","gmfSavedFilters","gmfUser","ngeoNotification","ngeoFeatureOverlayMgr","ngeoRuleHelper"];function e(t,r,a,n,i,o,s,l,u,c){var f=this;st(this,e);this.active;t.$watch(function(){return f.active},this.handleActiveChange_.bind(this));this.map;this.toolGroup;this.timeout_=r;this.gettextCatalog_=a;this.gmfDataSourceBeingFiltered=n;t.$watch(function(){return f.gmfDataSourceBeingFiltered.dataSource},this.handleSelectedDataSourceChange_.bind(this));this.gmfDataSourcesHelper_=i;this.gmfSavedFilters=o;t.$watchCollection(function(){return f.gmfSavedFilters.currentDataSourceItems},function(){if(f.gmfSavedFilters.currentDataSourceItems.length===0&&f.saveFilterManageModalShown){f.saveFilterManageModalShown=false}});this.gmfUser_=s;t.$watch(function(){return f.gmfUser_.functionalities},this.handleGmfUserFunctionalitiesChange_.bind(this));this.ngeoNotification_=l;this.featureOverlay=y["a"].assert(u.getFeatureOverlay());this.ngeoRuleHelper_=c;this.aRuleIsActive=false;this.customRules=null;this.directedRules=null;this.filtrableDataSources=[];this.filtrableLayerNodeNames_=null;this.gmfDataSources_=i.collection;this.listenerKeys_=[];this.readyDataSource=null;this.ruleCache_={};this.saveFilterSaveModalShown=false;t.$watch(function(){return f.saveFilterSaveModalShown},function(){f.saveFilterName=""});this.saveFilterName="";this.saveFilterManageModalShown=false;this.enableDataSourceRegistration_=false;t.$watch(function(){return f.enableDataSourceRegistration_},this.handleEnableDataSourceRegistrationChange_.bind(this));this.defaultFiltrableDataSourceName_;this.toggleDataSourceRegistration_()}e.prototype.handleGmfUserFunctionalitiesChange_=function e(){var t=this.gmfUser_.functionalities;if(t&&t["filterable_layers"]){this.filtrableLayerNodeNames_=t["filterable_layers"]}else{this.filtrableLayerNodeNames_=null}if(t&&t["preset_layer_filter"]&&t["preset_layer_filter"][0]){this.defaultFiltrableDataSourceName_=t["preset_layer_filter"][0]}else{this.defaultFiltrableDataSourceName_=undefined}this.toggleDataSourceRegistration_()};e.prototype.toggleDataSourceRegistration_=function e(){var t=!!this.filtrableLayerNodeNames_;if(this.enableDataSourceRegistration_!==t){this.enableDataSourceRegistration_=t}};e.prototype.handleActiveChange_=function e(t){var r=this;if(!t){this.aRuleIsActive=false;this.timeout_(function(){r.gmfDataSourceBeingFiltered.dataSource=null})}};e.prototype.handleEnableDataSourceRegistrationChange_=function e(t){var r=this.listenerKeys_;if(t){r.push(x["a"](this.gmfDataSources_,"add",this.handleDataSourcesAdd_,this),x["a"](this.gmfDataSources_,"remove",this.handleDataSourcesRemove_,this));this.gmfDataSources_.forEach(this.registerDataSource_.bind(this))}else{r.forEach(x["e"]);r.length=0;this.filtrableDataSources.length=0}};e.prototype.handleDataSourcesAdd_=function e(t){var r=t.element;if(r instanceof Q){this.registerDataSource_(r)}};e.prototype.handleDataSourcesRemove_=function e(t){var r=t.element;if(r instanceof Q){this.unregisterDataSource_(r)}};e.prototype.registerDataSource_=function e(t){if(t.filtrable===null){t.filtrable=this.isDataSourceFiltrable_(t)}if(t.filtrable){this.filtrableDataSources.push(t);if(this.defaultFiltrableDataSourceName_!==undefined&&t.name===this.defaultFiltrableDataSourceName_){this.gmfDataSourceBeingFiltered.dataSource=t}}};e.prototype.unregisterDataSource_=function e(t){if(t.filtrable){G["j"](this.filtrableDataSources,t);if(this.gmfDataSourceBeingFiltered.dataSource===t){this.gmfDataSourceBeingFiltered.dataSource=null}}};e.prototype.isDataSourceFiltrable_=function e(t,r){var a=true;var n=this.gettextCatalog_;var i=r!==false;var o=y["a"].assert(this.filtrableLayerNodeNames_);var s=[];if(G["f"](o,t.name)){if(!t.supportsWFS){s.push(n.getString("The data source doesn't support WFS, which is required "+"to fetch the attributes to build the filter rules."))}if(!t.ogcLayers||!t.ogcLayers.length){s.push(n.getString("The data source must have only 1 ogcLayer defined."))}else if(!t.ogcLayers[0].queryable){s.push(n.getString("The ogcLayer within the data source must be queryable."))}a=!s.length;if(i&&!a){var u=n.getString("The following data source is marked as being filtrable,\n          but is missing some requirements: ");var c=t.name+" ("+t.id+").";var f=n.getString("Please, contact your administrator about this.\n          Here are the reasons: ");s.unshift(u+" "+c+" "+f);console.warn(s.join(" "));this.ngeoNotification_.notify({msg:s.join(" "),type:l["a"].Type.WARNING})}}else{a=false}return a};e.prototype.handleSelectedDataSourceChange_=function e(t){var r=this;this.aRuleIsActive=false;this.customRules=null;this.directedRules=null;this.readyDataSource=null;this.gmfSavedFilters.currentDataSourceId=null;if(!t){return}if(!this.active){this.active=true}this.gmfDataSourcesHelper_.prepareFiltrableDataSource(t).then(function(e){var t=r.getRuleCacheItem_(e);if(!t){t={customRules:[],directedRules:[]};r.setRuleCacheItem_(e,t);if(e.gmfLayer.metadata&&e.gmfLayer.metadata.directedFilterAttributes&&e.gmfLayer.metadata.directedFilterAttributes.length){var a=e.gmfLayer.metadata.directedFilterAttributes;var n=y["a"].assert(e.attributes);for(var i=n,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;if(G["f"](a,u.name)){t.directedRules.push(r.ngeoRuleHelper_.createRuleFromAttribute(u))}}}}r.customRules=t.customRules;r.directedRules=t.directedRules;r.readyDataSource=e;r.gmfSavedFilters.currentDataSourceId=e.id})};e.prototype.getRuleCacheItem_=function e(t){return this.ruleCache_[t.id]||null};e.prototype.setRuleCacheItem_=function e(t,r){this.ruleCache_[t.id]=r};e.prototype.saveFilterShowModal=function e(){this.saveFilterSaveModalShown=true};e.prototype.saveFilterSave=function e(){var t=this.saveFilterName;var r=y["a"].assert(this.readyDataSource);var a=r.id;var n=this.gmfSavedFilters.indexOfItem(t,a)!==-1;var i=r.filterCondition;var o=this.gettextCatalog_.getString("A filter with the same name already exists.\n      Do you want to overwrite it?");if(!n||confirm(o)){var s=this.customRules?this.ngeoRuleHelper_.serializeRules(this.customRules):[];var l=this.directedRules?this.ngeoRuleHelper_.serializeRules(this.directedRules):[];var u={condition:i,customRules:s,dataSourceId:a,directedRules:l,name:t};this.gmfSavedFilters.save(u);this.saveFilterSaveModalShown=false}};e.prototype.saveFilterLoadItem=function e(t){var r=this;var a=y["a"].assert(this.readyDataSource);this.customRules=null;this.directedRules=null;var n=this.ngeoRuleHelper_.createRules(t.customRules);var i=this.ngeoRuleHelper_.createRules(t.directedRules);this.timeout_(function(){r.customRules=n;r.directedRules=i;a.filterCondition=t.condition;var e=y["a"].assert(r.getRuleCacheItem_(a));e.customRules=n;e.directedRules=i})};e.prototype.saveFilterManage=function e(){this.saveFilterManageModalShown=true};e.prototype.saveFilterRemoveItem=function e(t){this.gmfSavedFilters.remove(t)};return e}();lt.Controller_.RuleCache;lt.Controller_.RuleCacheItem;lt.component("gmfFilterselector",{bindings:{active:"=",map:"<",toolGroup:"<"},controller:lt.Controller_,templateUrl:ut});var ct=lt;var ft=angular.module("gmfFiltersModule",[ct.name,Le.module.name]);var ht=ft;var pt=r(358);var dt=r(287);var gt=r(411);var mt=r(410);var vt=r(462);var yt=angular.module("gmfLayertreeTimeSliderComponent",[ne["a"].module.name,"ui.slider"]);yt.run(["$templateCache",function(e){e.put("gmf/layertree/timesliderComponent",r(408))}]);yt.directive_=function(e,t){return{scope:{onDateSelected:"&gmfTimeSliderOnDateSelected",time:"=gmfTimeSliderTime"},bindToController:true,controller:"gmfTimeSliderController as sliderCtrl",restrict:"AE",templateUrl:"gmf/layertree/timesliderComponent",link:{pre:function e(t,r,a,n){n.init();n.sliderOptions["stop"]=i;n.sliderOptions["slide"]=o;function i(e,r){n.onDateSelected({time:o(e,r)});t.$apply()}function o(e,r){var a=void 0,i=void 0,o=void 0;if(r.values){a=new Date(n.getClosestValue_(r.values[0]));i=new Date(n.getClosestValue_(r.values[1]));n.dates=[a,i];o={start:a.getTime(),end:i.getTime()}}else{a=new Date(n.getClosestValue_(r.value));n.dates=a;o={start:a.getTime()}}t.$apply();return o}}}}};yt.directive_.$inject=["$timeout","$filter"];yt.directive("gmfTimeSlider",yt.directive_);yt.Controller_=function(e,t){this.ngeoWMSTime_=t;this.onDateSelected;this.time;this.isModeRange;this.minValue;this.maxValue;this.timeValueList;this.sliderOptions;this.dates};yt.Controller_.$inject=["$scope","ngeoWMSTime"];yt.Controller_.prototype.init=function(){this.timeValueList=this.getTimeValueList_();var e=this.ngeoWMSTime_.getOptions(this.time);this.isModeRange=this.time.mode==="range";this.minValue=e.minDate;this.maxValue=e.maxDate;this.dates=this.isModeRange?[e.values[0],e.values[1]]:e.values;this.sliderOptions={range:this.isModeRange,min:this.minValue,max:this.maxValue}};yt.Controller_.prototype.getTimeValueList_=function(){var e=this.time;var t=null;var r=new Date(this.minValue);var a=new Date(this.maxValue);if(e.values){t=[];e.values.forEach(function(e){t.push(new Date(e).getTime())})}else{var n=1024;var i=new Date(r.getTime());i.setFullYear(r.getFullYear()+n*e.interval[0]);i.setMonth(r.getMonth()+n*e.interval[1],r.getDate()+n*e.interval[2]);i.setSeconds(r.getSeconds()+n*e.interval[3]);if(i>a){t=[];for(var o=0;;o++){var s=new Date(r.getTime());s.setFullYear(r.getFullYear()+o*e.interval[0]);s.setMonth(r.getMonth()+o*e.interval[1],r.getDate()+o*e.interval[2]);s.setSeconds(r.getSeconds()+o*e.interval[3]);if(s<=a){t.push(s.getTime())}else{break}}}}return t};yt.Controller_.prototype.getClosestValue_=function(e){if(e<=this.minValue){return this.minValue}if(e>=this.maxValue){return this.maxValue}if(this.timeValueList){var t=void 0;var r=0;var a=this.timeValueList.length-1;while(a-r>1){t=Math.floor((r+a)/2);if(this.timeValueList[t]>=e){a=t}else{r=t}}var n=Math.abs(this.timeValueList[r]-e);var i=Math.abs(this.timeValueList[a]-e);return this.timeValueList[n<i?r:a]}else{var o=new Date(e);var s=new Date(this.minValue);var l=new Date(this.minValue);var u=new Date(this.maxValue);var c=Math.abs(o-l);for(var f=1;;f++){var h=new Date(s.getTime());h.setFullYear(s.getFullYear()+f*this.time.interval[0]);h.setMonth(s.getMonth()+f*this.time.interval[1],s.getDate()+f*this.time.interval[2]);h.setSeconds(s.getSeconds()+f*this.time.interval[3]);if(h>u){break}var p=Math.abs(o-h);if(p<=c){l=h;c=p}else{break}}return l.getTime()}};yt.Controller_.prototype.getLocalizedDate=function(e){return this.ngeoWMSTime_.formatTimeValue(e,this.time.resolution)};yt.controller("gmfTimeSliderController",yt.Controller_);var _t=yt;var bt=r(461);var St=angular.module("gmfLayertreeModule",[pt["a"].name,dt["a"].name,ee["a"].module.name,_t.name,te["a"].module.name]);var Ct=St;var wt=r(289);var Tt=r(243);var Et=r(286);var At=r(460);var Lt=angular.module("gmfPermalinkModule",[wt["a"].module.name,Tt["a"].module.name,Et["a"].name]);var Pt=Lt;var Mt=r(228);var xt=r(99);var Ft=angular.module("ngeoMap",[]);Ft.directive_=function(e){return{restrict:"A",link:function t(r,a,n){var i="ngeoMap";var o=n[i];var s=r.$eval(o);y["a"].assertInstanceof(s,xt["a"]);s.setTarget(a[0]);var l="ngeoMapManageResize";var u=n[l];var c=r.$eval(u);if(c){var f="ngeoMapResizeTransition";var h=n[f];var p=r.$eval(h);x["a"](e,"resize",function(){if(p){var t=Date.now();var r=true;var a=function a(){s.updateSize();s.renderSync();if(r){e.requestAnimationFrame(a)}if(Date.now()-t>p){r=false}};a()}else{s.updateSize()}})}}}};Ft.directive_.$inject=["$window"];Ft.directive("ngeoMap",Ft.directive_);var Rt=Ft;var Dt=r(353);var kt=r(285);var $t=angular.module("ngeoScaleselector",[]);$t.value("ngeoScaleselectorTemplateUrl",function(e,t){var r=t["ngeoScaleselectorTemplateurl"];return r!==undefined?r:"ngeo/map/scaleselector"});$t.run(["$templateCache",function(e){e.put("ngeo/map/scaleselector",r(406))}]);var Ot=function e(t){return{restrict:"A",scope:true,controller:"NgeoScaleselectorController",templateUrl:t}};Ot.$inject=["ngeoScaleselectorTemplateUrl"];Ot.$inject=["ngeoScaleselectorTemplateUrl"];$t.directive("ngeoScaleselector",Ot);var It=function e(t,r,a){var n=this;var i=a["ngeoScaleselector"];this.scales=t.$eval(i);y["a"].assert(this.scales!==undefined);this.zoomLevels;t.$watch(function(){return Object.keys(n.scales).length},function(e){n.zoomLevels=Object.keys(n.scales).map(Number);n.zoomLevels.sort(G["i"])});var o=a["ngeoScaleselectorMap"];this.map_=t.$eval(o);y["a"].assertInstanceof(this.map_,xt["a"]);var s=a["ngeoScaleselectorOptions"];var l=t.$eval(s);this.options=e.getOptions_(l);this.$scope_=t;this.resolutionChangeKey_=null;this.currentScale=undefined;var u=this.map_.getView();if(u!==null){var c=this.map_.getView().getZoom();if(c!==undefined){this.currentScale=this.getScale(c)}}x["a"](this.map_,"change:view",this.handleViewChange_,this);this.registerResolutionChangeListener_();t["scaleselectorCtrl"]=this};It.$inject=["$scope","$element","$attrs"];It.$inject=["$scope","$element","$attrs"];It.getOptions_=function(e){var t=false;if(e!==undefined){t=e["dropup"]==true}return{dropup:t}};It.prototype.getScale=function(e){return this.scales[e]};It.prototype.changeZoom=function(e){this.map_.getView().setZoom(e)};It.prototype.handleResolutionChange_=function(e){var t=this;var r=this.map_.getView();var a=this.scales[r.getZoom()];if(a!==undefined){this.$scope_.$applyAsync(function(){t.currentScale=a})}};It.prototype.handleViewChange_=function(e){this.registerResolutionChangeListener_();this.handleResolutionChange_(null)};It.prototype.registerResolutionChangeListener_=function(){if(this.resolutionChangeKey_!==null){x["e"](this.resolutionChangeKey_)}var e=this.map_.getView();this.resolutionChangeKey_=x["a"](e,"change:resolution",this.handleResolutionChange_,this)};$t.controller("NgeoScaleselectorController",It);var Nt=$t;var Gt=angular.module("ngeoMapModule",[M.module.name,Rt.name,it["a"].module.name,Dt["a"].name,kt["a"].name,Nt.name]);var Ut=Gt;var jt=angular.module("gmfMapComponent",[Pt.name,Mt["a"].module.name,Ut.name,it["a"].module.name]);jt.run(["$templateCache",function(e){e.put("gmf/map",r(405))}]);jt.directive_=function(){return{scope:{map:"<gmfMapMap",manageResize:"<gmfMapManageResize",resizeTransition:"<gmfMapResizeTransition"},controller:"GmfMapController as ctrl",bindToController:true,templateUrl:"gmf/map"}};jt.directive("gmfMap",jt.directive_);jt.Controller_=function(e,t,r){this.map;this.manageResize;this.resizeTransition;this.ngeoFeatureOverlayMgr_=e;this.gmfPermalink_=t;this.gmfSnapping_=r};jt.Controller_.$inject=["ngeoFeatureOverlayMgr","gmfPermalink","gmfSnapping"];jt.Controller_.prototype.$onInit=function(){this.ngeoFeatureOverlayMgr_.init(this.map);this.gmfPermalink_.setMap(this.map);this.gmfSnapping_.setMap(this.map)};jt.controller("GmfMapController",jt.Controller_);var Vt=jt;var Ht=r(134);var Wt=r(352);var Bt=r(11);var qt=angular.module("gmfMapMouseposition",[Ht["a"].name]);qt.run(["$templateCache",function(e){e.put("gmf/map/mousepositionComponent",r(404))}]);qt.value("gmfMapMousepositionTemplateUrl",function(e){var t=e["gmfMapMousepositionTemplateUrl"];return t!==undefined?t:"gmf/map/mousepositionComponent"});zt.$inject=["$attrs","gmfMapMousepositionTemplateUrl"];function zt(e,t){return t(e)}qt.component_={controller:"gmfMousepositionController as ctrl",bindings:{map:"<gmfMousepositionMap",projections:"<gmfMousepositionProjections"},templateUrl:zt};qt.component("gmfMouseposition",qt.component_);qt.Controller_=function(e,t,r,a){this.map;this.projections;this.projection;this.$scope_=r;this.gettextCatalog_=a;this.$element_=e;this.$filter_=t;this.control_=null};qt.Controller_.$inject=["$element","$filter","$scope","gettextCatalog"];qt.Controller_.prototype.$onInit=function(){var e=this;this.$scope_.$on("gettextLanguageChanged",function(){e.initOlControl_()});this.initOlControl_()};qt.Controller_.prototype.initOlControl_=function(){if(this.control_!==null){this.map.removeControl(this.control_)}var e=function e(t){var r=this.projection.filter.split(":");var a=this.$filter_(r.shift());y["a"].assertFunction(a);var n=r;n.unshift(t);return a.apply(this,n)};var t=this.gettextCatalog_;this.control_=new Wt["a"]({className:"gmf-mouseposition-control",coordinateFormat:e.bind(this),target:angular.element(".gmf-mouseposition-control-target",this.$element_)[0],undefinedHTML:t.getString("Coordinates")});this.setProjection(this.projections[0]);this.map.addControl(this.control_)};qt.Controller_.prototype.setProjection=function(e){this.control_.setProjection(Bt["g"](e.code));this.projection=e};qt.controller("gmfMousepositionController",qt.Controller_);var Kt=qt;var Yt=angular.module("gmfMapModule",[Vt.name,Kt.name]);var Qt=Yt;var Xt=r(284);var Zt=r(234);var Jt=function e(t,r){this.data=t;this.columnDefs=r;this.selectedRows={}};Jt.getRowUid=function(e){return""+b["c"](e)};Jt.prototype.isRowSelected=function(e){return!!this.selectedRows[Jt.getRowUid(e)]};Jt.prototype.getSelectedCount=function(){return Object.keys(this.selectedRows).length};Jt.prototype.getSelectedRows=function(){var e=this;return this.data.filter(function(t){return e.isRowSelected(t)})};Jt.prototype.selectRow=function(e){var t=Jt.getRowUid(e);this.selectedRows[t]=e};Jt.prototype.toggleRow=function(e){var t=Jt.getRowUid(e);var r=this.isRowSelected(e);if(r){delete this.selectedRows[t]}else{this.selectedRows[t]=e}};Jt.prototype.selectAll=function(){var e=this;this.data.forEach(function(t){e.selectRow(t)})};Jt.prototype.unselectAll=function(){for(var e in this.selectedRows){delete this.selectedRows[e]}};Jt.prototype.invertSelection=function(){var e=this;this.data.forEach(function(t){e.toggleRow(t)})};Jt.module=angular.module("ngeoGridConfig",[]);var er=Jt;var tr=r(58);var rr=r(403);var ar=r(402);var nr=angular.module("ngeoGrid",[er.module.name,Ht["a"].name,"floatThead"]);nr.run(["$templateCache",function(e){e.put("ngeo/grid",r(401))}]);nr.value("ngeoGridTemplateUrl",function(e){var t=e["ngeoGridTemplateurl"];return t!==undefined?t:"ngeo/grid"});ir.$inject=["$attrs","ngeoGridTemplateUrl"];function ir(e,t){return t(e)}nr.component_={controller:"ngeoGridController as ctrl",bindings:{configuration:"=ngeoGridConfiguration"},templateUrl:ir};nr.component("ngeoGrid",nr.component_);nr.Controller_=function(e){this.scope_=e;this.configuration;this.selectedRows;this.sortedBy;this.sortAscending=true;this.floatTheadConfig={scrollContainer:function e(t){return t.closest(".ngeo-grid-table-container")}}};nr.Controller_.$inject=["$scope"];nr.Controller_.prototype.$onInit=function(){this.selectedRows=this.configuration.selectedRows};nr.Controller_.prototype.sort=function(e){this.sortAscending=this.sortedBy===e?!this.sortAscending:true;this.sortedBy=e;var t=this.sortAscending?1:-1;this.configuration.data.sort(function(r,a){if(!r[e]){return 1}if(!a[e]){return-1}return r[e]>a[e]?t:-t})};nr.Controller_.prototype.clickRow=function(e,t){var r=this.isShiftKeyOnly_(t);var a=this.isPlatformModifierKeyOnly_(t);this.clickRow_(e,r,a)};nr.Controller_.prototype.clickRow_=function(e,t,r){if(t&&!r){this.selectRange_(e)}else if(!t&&r){this.configuration.toggleRow(e)}else{var a=this.configuration.isRowSelected(e);this.configuration.unselectAll();if(!a){this.configuration.selectRow(e)}}};nr.Controller_.prototype.selectRange_=function(e){var t=er.getRowUid(e);var r=this.configuration.data;if(this.configuration.isRowSelected(e)){return}var a=undefined;var n=[];for(var i=0;i<r.length;i++){var o=r[i];var s=er.getRowUid(o);if(t===s){a=i}else if(this.configuration.isRowSelected(o)){n.push(i)}}y["a"].assert(a!==undefined);if(n.length==0){this.configuration.selectRow(e)}var l=Infinity;var u=n[0];for(var c=0;c<n.length;c++){var f=n[c];var h=Math.abs(f-a);if(l>h){l=h;u=f}}var p=a<u?a:u;var d=a>u?a:u;for(var g=p;g<=d;g++){this.configuration.selectRow(r[g])}};nr.Controller_.prototype.preventTextSelection=function(e){var t=this.isShiftKeyOnly_(e);var r=this.isPlatformModifierKeyOnly_(e);if(t||r){e.preventDefault()}};nr.Controller_.prototype.isPlatformModifierKeyOnly_=function(e){return!e.altKey&&(tr["d"]?e.metaKey:e.ctrlKey)&&!e.shiftKey};nr.Controller_.prototype.isShiftKeyOnly_=function(e){return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey};nr.controller("ngeoGridController",nr.Controller_);var or=nr;var sr=r(4);var lr=r(79);var ur=r(53);var cr=angular.module("gmfQueryGridComponent",[Xt["a"].module.name,Zt["a"].name,or.name,er.module.name,it["a"].module.name,Pe["a"].module.name]);cr.value("gmfDisplayquerygridTemplateUrl",function(e,t){var r=t["gmfDisplayquerygridTemplateurl"];return r!==undefined?r:"gmf/query/gridComponent"});cr.run(["$templateCache",function(e){e.put("gmf/query/gridComponent",r(400))}]);fr.$inject=["$element","$attrs","gmfDisplayquerygridTemplateUrl"];function fr(e,t,r){return r(e,t)}cr.component_={controller:"GmfDisplayquerygridController as ctrl",bindings:{active:"=?gmfDisplayquerygridActive",featuresStyleFn:"&gmfDisplayquerygridFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerygridSelectedfeaturestyle",getMapFn:"&gmfDisplayquerygridMap",removeEmptyColumnsFn:"&?gmfDisplayquerygridRemoveemptycolumns",maxResultsFn:"&?gmfDisplayquerygridMaxresults",maxRecenterZoomFn:"&?gmfDisplayquerygridMaxrecenterzoom",mergeTabs:"<?gmfDisplayquerygridMergetabs"},templateUrl:fr};cr.component("gmfDisplayquerygrid",cr.component_);cr.Controller_=function(e,t,r,a,n,i,o,s){var l=this;var u=e.has("ngeoQueryOptions")?e.get("ngeoQueryOptions"):{};this.$scope_=t;this.$timeout_=i;this.ngeoQueryResult=r;this.ngeoMapQuerent_=a;this.ngeoCsvDownload_=o;this.$element_=s;this.maxResults=u.limit!==undefined?u.limit:50;this.active=false;this.pending=false;this.gridSources={};this.loadedGridSources=[];this.selectedTab=null;this.removeEmptyColumns_=false;this.maxRecenterZoom;this.mergeTabs={};this.featuresForSources_={};this.features_=new qe["b"];this.ngeoFeatureOverlayMgr_=n;this.highlightFeatures_=new qe["b"];this.filename_=e.has("gmfCsvFilename")?e.get("gmfCsvFilename"):"query-results.csv";this.map_=null;this.$scope_.$watchCollection(function(){return r},function(e,t){if(e!==t){l.updateData_()}});this.unregisterSelectWatcher_=null};cr.Controller_.$inject=["$injector","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr","$timeout","ngeoCsvDownload","$element"];cr.Controller_.prototype.$onInit=function(){this.removeEmptyColumns_=this["removeEmptyColumnsFn"]?this["removeEmptyColumnsFn"]()===true:false;this.maxRecenterZoom=this["maxRecenterZoomFn"]?this["maxRecenterZoomFn"]():undefined;var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this["featuresStyleFn"]();if(t!==undefined){y["a"].assertInstanceof(t,ze["c"]);e.setStyle(t)}var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this["selectedFeatureStyleFn"]();if(a!==undefined){y["a"].assertInstanceof(a,ze["c"])}else{var n=new Ye["a"]({color:[255,0,0,.6]});var i=new ur["a"]({color:[255,0,0,1],width:2});a=new ze["c"]({fill:n,image:new lr["a"]({fill:n,radius:5,stroke:i}),stroke:i,zIndex:10})}r.setStyle(a);var o=this["getMapFn"];if(o){var s=o();y["a"].assertInstanceof(s,xt["a"]);this.map_=s}};cr.Controller_.prototype.getGridSources=function(){var e=this;return this.loadedGridSources.map(function(t){return e.gridSources[t]})};cr.Controller_.prototype.updateData_=function(){var e=this;if(this.ngeoQueryResult.total===0&&!this.hasOneWithTooManyResults_()){var t=this.active;this.clear();if(t){this.active=this.ngeoQueryResult.pending;this.pending=this.ngeoQueryResult.pending}return}this.active=true;this.pending=false;var r=this.ngeoQueryResult.sources;if(Object.keys(this.mergeTabs).length>0){r=this.getMergedSources_(r)}r.forEach(function(t){if(t.tooManyResults){e.makeGrid_(null,t)}else{t.id=e.escapeValue(t.id);var r=t.features;if(r.length>0){e.collectData_(t)}}});if(this.loadedGridSources.length===0){this.active=false;return}if(this.selectedTab===null||!(""+this.selectedTab in this.gridSources)){this.$timeout_(function(){var t=e.loadedGridSources[0];e.selectTab(e.gridSources[t])},0)}};cr.Controller_.prototype.hasOneWithTooManyResults_=function(){return this.ngeoQueryResult.sources.some(function(e){return e.tooManyResults})};cr.Controller_.prototype.escapeValue=function(e){if(Number.isInteger(e)){return e}else{var t=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\ |]/g;if(e.match(t)!==null){return e.replace(t,"_")}else{return e}}};cr.Controller_.prototype.isSelected=function(e){return this.selectedTab===e.source.label};cr.Controller_.prototype.getMergedSources_=function(e){var t=this;var r=[];var a={};e.forEach(function(e){var n=t.getMergedSource_(e,a);if(n===null){r.push(e)}});for(var n in a){r.push(a[n])}return r};cr.Controller_.prototype.getMergedSource_=function(e,t){var r=null;for(var a in this.mergeTabs){var n=this.mergeTabs[a];var i=n.some(function(t){return t==e.label});if(i){r=a;break}}if(r===null){return null}var o=void 0;if(r in t){o=t[r]}else{o={features:[],id:r,label:r,limit:this.maxResults,pending:false,queried:true,tooManyResults:false,totalFeatureCount:undefined};t[r]=o}e.features.forEach(function(e){o.features.push(e)});o.tooManyResults=o.tooManyResults||e.tooManyResults;if(o.tooManyResults){o.totalFeatureCount=o.totalFeatureCount!==undefined?o.totalFeatureCount+o.features.length:o.features.length;o.features=[]}if(e.totalFeatureCount!==undefined){o.totalFeatureCount=o.totalFeatureCount!==undefined?o.totalFeatureCount+e.totalFeatureCount:e.totalFeatureCount}return o};cr.Controller_.prototype.collectData_=function(e){var t=e.features;var r=[];var a=[];var n={};var i=void 0,o=void 0;t.forEach(function(e){i=e.getProperties();if(i!==undefined){o=e.getGeometryName();if(a.indexOf(o)===-1){a.push(o)}r.push(i);n[er.getRowUid(i)]=e}});this.cleanProperties_(r,a);if(r.length>0){var s=this.makeGrid_(r,e);if(s){this.featuresForSources_[""+e.label]=n}}};cr.Controller_.prototype.cleanProperties_=function(e,t){e.forEach(function(e){t.forEach(function(t){delete e[t]});delete e["boundedBy"];delete e["ngeo_feature_type_"]});if(this.removeEmptyColumns_===true){this.removeEmptyColumnsFn_(e)}};cr.Controller_.prototype.removeEmptyColumnsFn_=function(e){var t=[];var r=void 0,a=void 0;for(a in e[0]){for(r=0;r<e.length;r++){if(e[r][a]!==undefined){t.push(a);break}}}var n=void 0;e.forEach(function(e){n=[];for(a in e){if(t.indexOf(a)===-1){n.push(a)}}n.forEach(function(t){delete e[t]})})};cr.Controller_.prototype.makeGrid_=function(e,t){var r=""+t.label;var a=null;if(e!==null){a=this.getGridConfiguration_(e);if(a===null){return false}}if(this.loadedGridSources.indexOf(r)==-1){this.loadedGridSources.push(r)}this.gridSources[r]={configuration:a,source:t};return true};cr.Controller_.prototype.getGridConfiguration_=function(e){y["a"].assert(e.length>0);var t={};Object.assign(t,e[0]);delete t.ol_uid;var r=Object.keys(t);var a=[];r.forEach(function(e){a.push({name:e})});if(a.length>0){return new er(e,a)}else{return null}};cr.Controller_.prototype.clear=function(){this.active=false;this.pending=false;this.gridSources={};this.loadedGridSources=[];this.selectedTab=null;this.tooManyResults=false;this.features_.clear();this.highlightFeatures_.clear();this.ngeoMapQuerent_.clear();this.featuresForSources_={};if(this.unregisterSelectWatcher_){this.unregisterSelectWatcher_()}};cr.Controller_.prototype.selectTab=function(e){var t=this;var r=e.source;this.selectedTab=r.label;if(this.unregisterSelectWatcher_){this.unregisterSelectWatcher_();this.unregisterSelectWatcher_=null}if(e.configuration!==null){this.unregisterSelectWatcher_=this.$scope_.$watchCollection(function(){return e.configuration.selectedRows},function(e,r){if(Object.keys(e)!==Object.keys(r)){t.onSelectionChanged_()}})}this.updateFeatures_(e);this.reflowGrid_()};cr.Controller_.prototype.reflowGrid_=function(){var e=this.escapeValue(this.selectedTab||"");var t=this.$element_.find("div.tab-pane#"+e);t.removeClass("active").addClass("active");this.$timeout_(function(){t.find("div.ngeo-grid-table-container table")["trigger"]("reflow")})};cr.Controller_.prototype.onSelectionChanged_=function(){if(this.selectedTab===null){return}var e=this.gridSources[""+this.selectedTab];this.updateFeatures_(e)};cr.Controller_.prototype.updateFeatures_=function(e){this.features_.clear();this.highlightFeatures_.clear();if(e.configuration===null){return}var t=""+e.source.label;var r=this.featuresForSources_[t];var a=e.configuration.selectedRows;for(var n in r){var i=r[n];if(n in a){this.highlightFeatures_.push(i)}else{this.features_.push(i)}}};cr.Controller_.prototype.getActiveGridSource=function(){if(this.selectedTab===null){return null}else{return this.gridSources[""+this.selectedTab]}};cr.Controller_.prototype.isOneSelected=function(){var e=this.getActiveGridSource();if(e===null||e.configuration===null){return false}else{return e.configuration.getSelectedCount()>0}};cr.Controller_.prototype.getSelectedRowCount=function(){var e=this.getActiveGridSource();if(e===null||e.configuration===null){return 0}else{return e.configuration.getSelectedCount()}};cr.Controller_.prototype.selectAll=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.selectAll()}};cr.Controller_.prototype.unselectAll=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.unselectAll()}};cr.Controller_.prototype.invertSelection=function(){var e=this.getActiveGridSource();if(e!==null){e.configuration.invertSelection()}};cr.Controller_.prototype.zoomToSelection=function(){var e=this.getActiveGridSource();if(e!==null){var t=sr["j"]();this.highlightFeatures_.forEach(function(e){sr["q"](t,e.getGeometry().getExtent())});var r=this.map_.getSize();y["a"].assert(r!==undefined);var a=this.maxRecenterZoom;this.map_.getView().fit(t,{size:r,maxZoom:a})}};cr.Controller_.prototype.downloadCsv=function(){var e=this.getActiveGridSource();if(e!==null){var t=e.configuration.columnDefs;y["a"].assert(t!==undefined);var r=e.configuration.getSelectedRows();this.ngeoCsvDownload_.startDownload(r,t,this.filename_)}};cr.controller("GmfDisplayquerygridController",cr.Controller_);var hr=cr;var pr=angular.module("ngeoMiscSwipe",[]);pr.factory("$verticalSwipe",[function(){var e=10;var t={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}};function r(e){var t=e.originalEvent||e;var r=t.touches&&t.touches.length?t.touches:[t];var a=t.changedTouches&&t.changedTouches[0]||r[0];return{x:a.clientX,y:a.clientY}}function a(e,r){var a=[];angular.forEach(e,function(e){var n=t[e][r];if(n){a.push(n)}});return a.join(" ")}return{bind:function t(n,i,o){var s=void 0,l=void 0;var u=void 0;var c=void 0;var f=false;o=o||["mouse","touch","pointer"];n.on(a(o,"start"),function(e){u=r(e);f=true;s=0;l=0;c=u;if(i["start"]){i["start"](u,e)}});var h=a(o,"cancel");if(h){n.on(h,function(e){f=false;if(i["cancel"]){i["cancel"](e)}})}n.on(a(o,"move"),function(t){if(!f){return}if(!u){return}var a=r(t);s+=Math.abs(a.x-c.x);l+=Math.abs(a.y-c.y);c=a;if(s<e&&l<e){return}if(s>l){f=false;if(i["cancel"]){i["cancel"](t)}return}else{t.preventDefault();if(i["move"]){i["move"](a,t)}}});n.on(a(o,"end"),function(e){if(!f){return}f=false;if(i["end"]){i["end"](r(e),e)}})}}}]);pr.makeSwipeDirective_=function(e,t,r){pr.directive(e,["$parse","$verticalSwipe",function(a,n){var i=75;var o=.3;var s=30;return function(l,u,c){var f=a(c[e]);var h=void 0,p=void 0;function d(e){if(!h){return false}var r=(e.y-h.y)*t;var a=Math.abs(e.x-h.x);return p&&a<i&&r>0&&r>s&&a/r<o}var g=["touch"];if(!angular.isDefined(c["ngeoSwipeDisableMouse"])){g.push("mouse")}n.bind(u,{start:function e(t,r){h=t;p=true},cancel:function e(t){p=false},end:function e(t,a){if(d(t)){l.$apply(function(){u.triggerHandler(r);f(l,{$event:a})})}}},g)}}])};pr.makeSwipeDirective_("ngeoSwipeDown",1,"swipedown");pr.makeSwipeDirective_("ngeoSwipeUp",-1,"swipeup");var dr=pr;var gr=r(320);var mr=r(398);var vr=r(396);var yr=r(265);var _r=angular.module("gmfQueryWindowComponent",[it["a"].module.name,Ge["a"].module.name,dr.name,Pe["a"].module.name,"ngAnimate","ngTouch"]);_r.config(["$animateProvider",function(e){e.classNameFilter(/gmf-animatable/)}]);_r.value("gmfDisplayquerywindowTemplateUrl",function(e,t){var r=t["gmfDisplayquerywindowTemplateurl"];return r!==undefined?r:"gmf/query/windowComponent"});_r.run(["$templateCache",function(e){e.put("gmf/query/windowComponent",r(394))}]);br.$inject=["$element","$attrs","gmfDisplayquerywindowTemplateUrl"];function br(e,t,r){return r(e,t)}_r.component_={controller:"GmfDisplayquerywindowController as ctrl",bindings:{draggableContainment:"<?gmfDisplayquerywindowDraggableContainment",featuresStyleFn:"&gmfDisplayquerywindowFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerywindowSelectedfeaturestyle",defaultCollapsedFn:"&?gmfDisplayquerywindowDefaultcollapsed",desktop:"=gmfDisplayquerywindowDesktop",showUnqueriedLayers:"=gmfDisplayquerywindowShowunqueriedlayers"},templateUrl:br};_r.component("gmfDisplayquerywindow",_r.component_);_r.Controller_=function(e,t,r,a,n){var i=this;this.draggableContainment;this.desktop=false;this.collapsed=!this.desktop;this.showUnqueriedLayers_=false;this.sourcesFilter={queried:true};this.ngeoQueryResult={sources:[],total:0,pending:false};this.ngeoMapQuerent_=a;this.selectedSource=null;this.features_=new qe["b"];this.ngeoFeatureOverlayMgr_=n;this.highlightFeatures_=new qe["b"];this.source=null;this.feature=null;this.currentResult=-1;this.isNext=true;this.animate=0;this.open=false;this.element_=e;t.$watchCollection(function(){return r},function(e,t){i.updateQueryResult_(e);if(e.total>0){i.show()}else if(t!==e){i.open=false;i.clear()}})};_r.Controller_.$inject=["$element","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr"];_r.Controller_.prototype.$onInit=function(){this.draggableContainment=this.draggableContainment||"document";this.desktop=this.desktop;this.collapsed=this["defaultCollapsedFn"]?this["defaultCollapsedFn"]()===true:!this.desktop;this.showUnqueriedLayers_=this["showUnqueriedLayers"]?this["showUnqueriedLayers"]===true:false;this.sourcesFilter=this.showUnqueriedLayers_?{}:{queried:true};var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this["featuresStyleFn"]();if(t!==undefined){y["a"].assertInstanceof(t,ze["c"]);e.setStyle(t)}var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this["selectedFeatureStyleFn"]();if(a!==undefined){y["a"].assertInstanceof(a,ze["c"])}else{var n=new Ye["a"]({color:[255,0,0,.6]});var i=new ur["a"]({color:[255,0,0,1],width:2});a=new ze["c"]({fill:n,image:new lr["a"]({fill:n,radius:5,stroke:i}),stroke:i})}r.setStyle(a);var o=this.element_.find(".gmf-displayquerywindow .windowcontainer");if(this.desktop){o.draggable({handle:".header",containment:this.draggableContainment});o.resizable({minHeight:240,minWidth:240})}};_r.Controller_.prototype.show=function(){this.clear();this.updateFeatures_()};_r.Controller_.prototype.updateFeatures_=function(){this.setCurrentResult_(0,false);if(this.source!==null){this.collectFeatures_();this.highlightCurrentFeature_();this.open=true}};_r.Controller_.prototype.setCurrentResult_=function(e,t){var r=false;if(e!==this.currentResult){var a=void 0,n=void 0,i=void 0;var o=this.feature;var s=this.ngeoQueryResult.sources;this.currentResult=e;for(a=0;a<s.length;a++){n=s[a];if(this.selectedSource!==null&&this.selectedSource!==n){continue}i=n.features;if(e>=i.length){e-=i.length}else{this.source=n;this.feature=n.features[e];r=true;break}}if(t){this.highlightCurrentFeature_(o)}}return r};_r.Controller_.prototype.previous=function(){var e=this.currentResult-1;if(e<0){e=this.getResultLength()-1}var t=this.setCurrentResult_(e,true);if(t){this.animate_(false)}};_r.Controller_.prototype.next=function(){var e=this.currentResult+1;var t=this.getResultLength()-1;if(e>t){e=0}var r=this.setCurrentResult_(e,true);if(r){this.animate_(true)}};_r.Controller_.prototype.updateQueryResult_=function(e){this.ngeoQueryResult.total=0;this.ngeoQueryResult.sources.length=0;for(var t=0;t<e.sources.length;t++){var r=e.sources[t];r.features=r.features.filter(function(e){y["a"].assert(e);return!oe["d"](Ge["a"].getFilteredFeatureValues(e))});this.ngeoQueryResult.sources.push(r);this.ngeoQueryResult.total+=r.features.length}};_r.Controller_.prototype.getResultLength=function(){if(this.selectedSource===null){return this.ngeoQueryResult.total}else{return this.selectedSource.features.length}};_r.Controller_.prototype.isFirst=function(){return this.currentResult==0};_r.Controller_.prototype.isLast=function(){return this.currentResult==this.getResultLength()-1};_r.Controller_.prototype.getFeatureValues=function(){if(!this.feature){return null}return Ge["a"].getFilteredFeatureValues(this.feature)};_r.Controller_.prototype.animate_=function(e){this.isNext=e;this.animate++};_r.Controller_.prototype.collectFeatures_=function(){var e=this.ngeoQueryResult.sources;this.features_.clear();for(var t=0;t<e.length;t++){var r=e[t];if(this.selectedSource!==null&&this.selectedSource!==r){continue}var a=r.features;for(var n=0;n<a.length;n++){this.features_.push(a[n])}}};_r.Controller_.prototype.highlightCurrentFeature_=function(e){this.highlightFeatures_.clear();this.features_.remove(this.feature);this.highlightFeatures_.push(this.feature);if(e!==undefined){this.features_.push(e)}};_r.Controller_.prototype.close=function(){this.open=false;this.clear();this.ngeoMapQuerent_.clear()};_r.Controller_.prototype.clear=function(){this.feature=null;this.source=null;this.currentResult=-1;this.features_.clear();this.highlightFeatures_.clear();this.selectedSource=null};_r.Controller_.prototype.setSelectedSource=function(e){if(e!==null&&e.features.length<=0){return}this.clear();this.selectedSource=e;this.updateFeatures_()};_r.controller("GmfDisplayquerywindowController",_r.Controller_);var Sr=_r;var Cr=r(459);var wr=r(458);var Tr=angular.module("gmfQueryExtraModule",[hr.name,Sr.name]);var Er=Tr;var Ar=r(351);var Lr=r(283);var Pr=r(457);var Mr=angular.module("gmfSearchModule",[Ar["a"].name,Lr["a"].module.name]);var xr=Mr;var Fr=r(177);var Rr=angular.module("gmfThemeSelectorComponent",[Fr["a"].module.name,v["a"].module.name]);Rr.run(["$templateCache",function(e){e.put("gmf/theme/selectorComponent",r(385))}]);Rr.value("gmfThemeSelectorTemplateUrl",function(e){var t=e["gmfThemeSelectorTemplateUrl"];return t!==undefined?t:"gmf/theme/selectorComponent"});Dr.$inject=["$attrs","gmfThemeSelectorTemplateUrl"];function Dr(e,t){return t(e)}Rr.component_={bindings:{filter:"<gmfThemeselectorFilter"},controller:"gmfThemeselectorController",templateUrl:Dr};Rr.component("gmfThemeselector",Rr.component_);Rr.Controller_=function(e,t,r){this.gmfThemeManager=t;this.gmfThemes_=r;this.themes;this.filter;this.listenerKeys_=[];this.listenerKeys_.push(x["a"](this.gmfThemes_,"change",this.setThemes_,this));e.$on("$destroy",this.handleDestroy_.bind(this))};Rr.Controller_.$inject=["$scope","gmfThemeManager","gmfThemes"];Rr.Controller_.prototype.setThemes_=function(){var e=this;this.gmfThemes_.getThemesObject().then(function(t){e.themes=e.filter?t.filter(e.filter):t})};Rr.Controller_.prototype.setTheme=function(e,t){if(e){this.gmfThemeManager.addTheme(e,t)}};Rr.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(x["e"]);this.listenerKeys_.length=0};Rr.controller("gmfThemeselectorController",Rr.Controller_);var kr=Rr;var $r=angular.module("gmfThemeModule",[kr.name,Fr["a"].module.name,v["a"].module.name]);var Or=$r;var Ir=r(326);var Nr=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function Gr(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var Ur=angular.module("ngeoMessageDisplaywindowComponent",["ngSanitize"]);Ur.run(["$templateCache",function(e){e.put("ngeo/message/displaywindowComponent",r(384))}]);Ur.value("ngeoMessageDisplaywindowTemplateUrl",function(e){var t=e["ngeoMessageDisplaywindowTemplateUrl"];return t!==undefined?t:"ngeo/message/displaywindowComponent"});jr.$inject=["$attrs","ngeoMessageDisplaywindowTemplateUrl"];function jr(e,t){return t(e)}Ur.Controller_=function(){e.$inject=["$element","$sce","$scope","$compile"];function e(t,r,a,n){Gr(this,e);this.clearOnClose;this.content=null;this.contentTemplate=null;this.contentScope=null;this.draggable;this.draggableContainment;this.desktop;this.height=null;this.open;this.resizable;this.title=null;this.url=null;this.width=null;this.element_=t;this.sce_=r;this.scope_=a;this.compile_=n}e.prototype.$onInit=function e(){var t=this;this.clearOnClose=this.clearOnClose!==false;this.content=this.content||null;this.contentTemplate=this.contentTemplate||null;this.contentScope=this.contentScope||null;this.desktop=this.desktop!==false;this.draggableContainment=this.draggableContainment||"document";this.open=this.open===true;this.height=this.height||"240px";this.width=this.width||"240px";this.draggable=this.draggable!==undefined?this.draggable:this.desktop;this.resizable=this.resizable!==undefined?this.resizable:this.desktop;if(this.draggable){this.element_.find(".ngeo-displaywindow .windowcontainer").draggable({containment:this.draggableContainment,handle:"div.header"})}if(this.resizable){this.element_.find(".ngeo-displaywindow .windowcontainer").resizable({minHeight:240,minWidth:240})}if(this.contentTemplate){this.updateContentTemplate_()}this.scope_.$watch(function(){return t.contentTemplate},function(){return t.updateContentTemplate_()})};e.prototype.updateContentTemplate_=function e(){var t=y["a"].assert(this.contentScope||this.scope_);var r=this.compile_(this.contentTemplate)(t);var a=this.element_.find(".ngeo-displaywindow .windowcontainer .animation-container .content-template-container");a.empty();a.append(r)};e.prototype.close=function e(){this.open=false;if(this.clearOnClose){this.clear_()}};e.prototype.clear_=function e(){this.content=null;this.title=null;this.url=null};Nr(e,[{key:"style",get:function e(){return{height:this.height,width:this.width}}},{key:"urlTrusted",get:function e(){if(this.url){return this.sce_.trustAsResourceUrl(this.url)}}}]);return e}();Ur.component("ngeoDisplaywindow",{bindings:{clearOnClose:"<?",content:"=?",contentTemplate:"=?",contentScope:"<?",desktop:"<?",draggable:"<?",draggableContainment:"<?",height:"=?",open:"=?",resizable:"<?",title:"=?",url:"=?",width:"=?"},controller:Ur.Controller_,templateUrl:jr});var Vr=Ur;var Hr=r(282);var Wr=r(189);var Br=r(54);var qr=angular.module("ngeoControl",[]);qr.component_=function(){return{restrict:"A",link:function e(t,r,a){var n=t.$eval(a["ngeoControl"]);y["a"].assertInstanceof(n,Br["a"]);var i=t.$eval(a["ngeoControlMap"]);y["a"].assertInstanceof(i,xt["a"]);n.setTarget(r[0]);i.addControl(n)}}};qr.directive("ngeoControl",qr.component_);var zr=qr;var Kr=r(187);var Yr=r(304);var Qr=angular.module("ngeoFilereader",[]);Qr.component_=function(e){return{restrict:"A",scope:{fileContent:"=ngeoFilereader",supported:"=?ngeoFilereaderSupported"},link:function t(r,a,n){var i="FileReader"in e;r["supported"]=i;if(!i){return}a.on("change",function(t){var a=new e.FileReader;a.onload=function(e){r.$apply(function(){r["fileContent"]=e.target.result})};a.readAsText(t.target.files[0])})}}};Qr.component_.$inject=["$window"];Qr.directive("ngeoFilereader",Qr.component_);var Xr=Qr;var Zr=angular.module("ngeoGetBrowserLanguage",[]);Zr.factory_=function(e){return function(t){var r=e.navigator;var a=r.languages||r.language||r.browserLanguage||r.systemLanguage||r.userLanguage;if(!Array.isArray(a)){a=[a]}a=a.map(function(e){return e.substring(0,2)});a=a.filter(function(e,t,r){return r.indexOf(e)==t});var n=a.filter(function(e){return t.indexOf(e)!=-1});return n[0]}};Zr.factory_.$inject=["$window"];Zr.factory("ngeoGetBrowserLanguage",Zr.factory_);var Jr=Zr;var ea=r(349);var ta=r(198);var ra=angular.module("ngeoMiscExtraModule",[Hr["a"].module.name,Wr["a"].name,zr.name,Ie["a"].name,Kr["a"].name,be["a"].module.name,Ge["a"].module.name,Yr["a"].module.name,Xr.name,Ht["a"].name,Jr.name,ea["a"].name,ta["a"].module.name,je["a"].module.name,ne["a"].module.name]);var aa=ra;var na=angular.module("ngeoMapQuery",[Pe["a"].module.name]);na.directive_=function(e,t){return{restrict:"A",scope:false,link:function r(a,n,i){var o=a.$eval(i["ngeoMapQueryMap"]);var s=null;var l=null;var u=function t(r){var a=r.coordinate;e.issue({coordinate:a,map:o})};var c=function e(t){if(!t.dragging){var r=o.getEventPixel(t.originalEvent);var a=function e(t){var r=t.get("visible");var a=t.get("querySourceIds");return r&&!!a};var n=o.forEachLayerAtPixel(r,function(){return true},undefined,a);o.getTargetElement().style.cursor=n?"pointer":""}};var f=function e(){s=x["a"](o,"singleclick",u);var r=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};if(r.cursorHover){l=x["a"](o,"pointermove",c)}};var h=function t(){if(s!==null){x["e"](s);s=null}if(l!==null){x["e"](l);l=null}if(a.$eval(i["ngeoMapQueryAutoclear"])!==false){e.clear()}};a.$watch(i["ngeoMapQueryActive"],function(e,t){if(e){f()}else{h()}})}}};na.directive_.$inject=["ngeoMapQuerent","$injector"];na.directive("ngeoMapQuery",na.directive_);var ia=na;var oa=r(288);var sa=r(60);var la=r(155);var ua=function e(t,r,a){var n=this;var i=a;this.url_=i.url;this.maxFeatures_=i.maxFeatures!==undefined?i.maxFeatures:50;this.wfsTypes_={};y["a"].assertArray(i.wfsTypes,"wfsTypes is not correctly set");i.wfsTypes.forEach(function(e){n.wfsTypes_[e.featureType]=e});this.defaultFeatureNS_=i.defaultFeatureNS;this.defaultFeaturePrefix_=i.defaultFeaturePrefix;this.pointRecenterZoom_=i.pointRecenterZoom;this.$http_=t;this.result_=r};ua.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"];ua.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"];ua.prototype.clear=function(){this.clearResult_()};ua.prototype.issue=function(e,t){y["a"].assert(this.url_,"url is not set. to use the wfs permalink service, "+"set the value `ngeoWfsPermalinkOptions`");this.clearResult_();var r=e.wfsType;if(!this.wfsTypes_.hasOwnProperty(r)){return}var a=this.wfsTypes_[r];var n=this.createFilters_(e.filterGroups);if(n===null){return}this.issueRequest_(a,n,t,e.showFeatures)};ua.prototype.issueRequest_=function(e,t,r,a){var n=this;var i=new la["a"];var o=i.writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:e.featureNS!==undefined?e.featureNS:this.defaultFeatureNS_,featurePrefix:e.featurePrefix!==undefined?e.featurePrefix:this.defaultFeaturePrefix_,featureTypes:[e.featureType],outputFormat:"GML3",filter:t,maxFeatures:this.maxFeatures_});var s=(new XMLSerializer).serializeToString(o);var l={headers:{"Content-Type":"text/xml; charset=UTF-8"}};this.$http_.post(this.url_,s,l).then(function(t){var o=i.readFeatures(t.data);if(o.length==0){return}var s=r.getSize();if(s!==undefined){var l=n.pointRecenterZoom_;var u=[10,10,10,10];r.getView().fit(n.getExtent_(o),{size:s,maxZoom:l,padding:u})}if(a){var c={features:o,id:e.featureType,identifierAttributeField:e.label,label:e.featureType,pending:false};n.result_.sources.push(c);n.result_.total=o.length}})};ua.prototype.getExtent_=function(e){return e.reduce(function(e,t){return sr["q"](e,t.getGeometry().getExtent())},sr["j"]())};ua.prototype.createFilters_=function(e){if(e.length==0){return null}var t=sa;var r=function e(r){var a=r.filters.map(function(e){var r=e.condition;if(Array.isArray(r)){return ua.or_(r.map(function(r){return t.equalTo(e.property,r)}))}else{return t.equalTo(e.property,e.condition)}});return ua.and_(a)};return ua.or_(e.map(r))};ua.and_=function(e){return ua.joinFilters_(e,sa["and"])};ua.or_=function(e){return ua.joinFilters_(e,sa["or"])};ua.joinFilters_=function(e,t){return e.reduce(function(e,r){if(e===null){return r}else{y["a"].assert(r!==null);return t(e,r)}},null)};ua.prototype.clearResult_=function(){this.result_.total=0;this.result_.sources.forEach(function(e){e.features.length=0})};ua.module=angular.module("ngeoWfsPermalink",[]);ua.module.value("ngeoWfsPermalinkOptions",{url:"",wfsTypes:[],defaultFeatureNS:"",defaultFeaturePrefix:""});ua.module.service("ngeoWfsPermalink",ua);var ca=ua;var fa=function e(t,r,a){var n=this;this.ngeoLocation=a.get("ngeoLocation");if(this.ngeoLocation.hasParam("debug")){window.injector=a}y["a"].assertInstanceof(this.map,xt["a"]);var i=a.get("ngeoFeatureHelper");i.setProjection(y["a"].assert(this.map.getView().getProjection()));this.gmfThemeManager=a.get("gmfThemeManager");this.gmfTreeManager_=a.get("gmfTreeManager");this.gmfThemes_=a.get("gmfThemes");this.permalink_=a.get("gmfPermalink");var o=a.get("gmfAuthenticationService");this.hasEditableLayers=false;this.updateHasEditableLayers_=function(){var e=this;this.gmfThemes_.hasEditableLayers().then(function(t){e.hasEditableLayers=t})};this.loginRedirectUrl=null;this.loginInfoMessage=null;this.userMustChangeItsPassword=false;r.$on("authenticationrequired",function(e,t){var i=a.get("gettextCatalog");n.loginInfoMessage=i.getString("Some layers in this link are not accessible to unauthenticated users. "+"Please log in to see whole data.");n.loginRedirectUrl=t.url;n.loginActive=true;var o=r.$watch(function(){return n.loginActive},function(){if(!n.loginActive){n.loginInfoMessage=null;n.loginRedirectUrl=null;o()}})});var s=function e(t){if(n.loginRedirectUrl){window.location=n.loginRedirectUrl;return}var r=t.detail.user;var a=r.username!==null?r.role_id:undefined;var i=n.gmfUser.functionalities;if(i&&"filterable_layers"in i&&i["filterable_layers"].length>0){n.filterSelectorEnabled=true}n.gmfThemes_.getThemesObject().then(function(e){if(i&&i.open_panel&&i.open_panel[0]==="layer_filter"){n.filterSelectorActive=true}});var o=n.gmfThemeManager.getThemeName();n.gmfThemeManager.setThemeName("",true);n.gmfThemes_.loadThemes(a);if(t.type!=="ready"){var s=n.permalink_.defaultThemeNameFromFunctionalities();n.gmfThemeManager.updateCurrentTheme(s,o,true)}n.setDefaultBackground_(null);n.updateHasEditableLayers_()};x["a"](o,"ready",s);x["a"](o,"login",s);x["a"](o,"logout",s);this.searchDatasources=[{labelKey:"label",groupValues:a.get("gmfSearchGroups"),groupActions:a.get("gmfSearchActions"),projection:"EPSG:"+(t.srid||21781),url:a.get("fulltextsearchUrl")}];this.dimensions={};this.permalink_.setDimensions(this.dimensions);var l=a.get("gmfDataSourcesManager");l.setDatasourceMap(this.map);l.setDimensions(this.dimensions);if(a.has("gmfDefaultDimensions")){var u=a.get("gmfDefaultDimensions");for(var c in u){if(this.dimensions[c]===undefined){this.dimensions[c]=u[c]}}}this.backgroundLayerMgr_=a.get("ngeoBackgroundLayerMgr");r.$watchCollection(function(){return n.dimensions},function(){n.backgroundLayerMgr_.updateDimensions(n.map,n.dimensions)});this.backgroundLayerMgr_.on("change",function(){n.backgroundLayerMgr_.updateDimensions(n.map,n.dimensions)});this.leftNavVisible=false;this.rightNavVisible=false;var f=new Ye["a"]({color:[255,170,0,.6]});var h=new ur["a"]({color:[255,170,0,1],width:2});this.queryFeatureStyle=new ze["c"]({fill:f,image:new lr["a"]({fill:f,radius:5,stroke:h}),stroke:h});this.filterSelectorEnabled=false;this.filterSelectorActive=false;this.queryActive=true;this.queryAutoClear=true;this.printPanelActive=false;this.printActive=false;this.ngeoMapQuerent_=a.get("ngeoMapQuerent");r.$watch(function(){return n.printPanelActive},function(e){if(!e&&!n.queryActive){n.ngeoMapQuerent_.clear()}n.queryAutoClear=!e;n.printActive=e});this.measurePointActive=false;this.measureLengthActive=false;this.drawFeatureActive=false;this.drawProfilePanelActive=false;this.gmfUser=a.get("gmfUser");r.$watch(function(){return n.gmfUser.is_password_changed},function(e){n.userMustChangeItsPassword=e===false});this.getBrowserLanguage=a.get("ngeoGetBrowserLanguage");this.stateManager=a.get("ngeoStateManager");this.tmhDynamicLocale=a.get("tmhDynamicLocale");this.$scope=r;this.lang;this.defaultLang=a.get("defaultLang");this.langUrls=a.get("langUrls");this.gettextCatalog=a.get("gettextCatalog");this.initLanguage();var p="mapTools";this.mapToolsGroup=p;var d=a.get("ngeoFeatureOverlayMgr");d.init(this.map);var g=a.get("ngeoToolActivateMgr");var m=new Ue["a"](this,"queryActive");g.registerTool(p,m,true);var v=new Ue["a"](this,"measurePointActive");g.registerTool(p,v,false);var _=new Ue["a"](this,"measureLengthActive");g.registerTool(p,_,false);var b=new Ue["a"](this,"drawFeatureActive");g.registerTool(p,b,false);var S=new Ue["a"](this,"drawProfilePanelActive");g.registerTool(p,S,false);var C=new Ue["a"](this,"printPanelActive");g.registerTool(p,C,false);r.$root.$on(Fr["a"].EventType.THEME_NAME_SET,function(e,t){n.gmfThemes_.getThemeObject(t).then(function(e){n.setDefaultBackground_(e)})});this.updateCurrentBackgroundLayer_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;if(!e){a=t.permalink_.getBackgroundLayer(r)}if(!a){var n=t.gmfUser.functionalities;if(n){var i=n.default_basemap;if(i.length>0){var o=i[0];a=G["d"](r,function(e){return e.get("label")===o})}}}if(!a&&r[1]){a=r[1]}if(a){t.backgroundLayerMgr_.set(t.map,a)}})}.bind(this);this.updateCurrentBackgroundLayer_(false);var w=window.gmfx||{};window.gmfx=w;w.openIframePopup=function(e,t,r,a,i){n.displaywindowUrl=e;w.openPopup_(t,r,a,i)};w.openTextPopup=function(e,t,r,a,i){n.displaywindowContent=e;w.openPopup_(t,r,a,i)};w.openPopup_=function(e,t,r,a){n.displaywindowTitle=e;n.displaywindowOpen=true;if(t){n.displaywindowWidth=t+"px"}if(r){n.displaywindowHeight=r+"px"}if(a!==false){n.$scope.$apply()}};this.manageResize=false;this.resizeTransition;var T=window.cgxp||{};window.cgxp=T;T.tools=window.cgxp.tools||{};T.tools.openInfoWindow=function(e,t,r,a,n){w.openIframePopup(e,t,r,a,n)};this.displaywindowContent=null;this.displaywindowDraggableContainment=".gmf-map";this.displaywindowHeight="50vh";this.displaywindowOpen=false;this.displaywindowTitle=null;this.displaywindowUrl=null;this.displaywindowWidth="50vw"};fa.$inject=["config","$scope","$injector"];fa.$inject=["config","$scope","$injector"];fa.getLayerByLabels=function(e,t){if(t&&t.length>0){return G["d"](e,function(e){return e.get("label")===t[0]})}return null};fa.prototype.switchLanguage=function(e){y["a"].assert(e in this.langUrls);this.gettextCatalog.setCurrentLanguage(e);this.gettextCatalog.loadRemote(this.langUrls[e]);this.tmhDynamicLocale.set(e);this.lang=e};fa.prototype.initLanguage=function(){var e=this;this.$scope.$watch(function(){return e.lang},function(t){e.stateManager.updateState({lang:t})});var t=this.getBrowserLanguage(Object.keys(this.langUrls));var r=this.stateManager.getInitialValue("lang");if(r!==undefined&&r in this.langUrls){this.switchLanguage(r);return}else if(t!==undefined&&t in this.langUrls){this.switchLanguage(t);return}else{this.switchLanguage(this.defaultLang);return}};fa.prototype.setDefaultBackground_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;a=t.permalink_.getBackgroundLayer(r);if(!a&&t.gmfUser.functionalities){a=fa.getLayerByLabels(r,t.gmfUser.functionalities.default_basemap)}if(!a&&e){a=fa.getLayerByLabels(r,e.functionalities.default_basemap)}if(!a){a=r[r.length>1?1:0]}y["a"].assert(a);t.backgroundLayerMgr_.set(t.map,a)})};fa.prototype.getLocationIcon=function(){var e=document.createElement("span");e.className="fa fa-location-arrow";e.style.transform="rotate(-0.82rad)";var t=document.createElement("span");t.appendChild(e);return t};fa.module=angular.module("GmfAbstractAppControllerModule",["gettext","tmh.dynamicLocale",m.name,D.name,he.name,we.name,ht.name,Ct.name,Qt.name,Er.name,xr.name,Or.name,Vr.name,aa.name,Ge["a"].module.name,Pe["a"].module.name,ia.name,oa["a"].name,ca.module.name]);fa.module.controller("AbstractController",fa);fa.module.value("ngeoExportFeatureFormats",[Ge["a"].FormatType.KML,Ge["a"].FormatType.GPX]);fa.module.config(["tmhDynamicLocaleProvider","angularLocaleScript",function(e,t){e.localeLocationPattern(t)}]);var ha=t["a"]=fa},,,,,,,function(e,t,r){"use strict";var a=r(2);var n=r(52);var i=r(27);var o=r(82);var s=r(192);var l=r(206);var u=r(1);var c=r(22);var f=r(107);var h=r(25);var p=r(3);var d=r(4);var g=r(199);var m=r(39);var v=r(30);var y=r(34);var _=r(24);var b=r(64);var S=r(57);var C=r(178);var w=function e(t){var r=this;a["a"].assert(t.features);_["b"].call(this,{handleDownEvent:e.handleDownEvent_,handleDragEvent:e.handleDragEvent_,handleEvent:e.handleEvent,handleUpEvent:e.handleUpEvent_});this.vertexFeature_=null;this.lastPixel_=[0,0];this.modified_=false;this.rBush_=new C["a"];this.pixelTolerance_=t.pixelTolerance!==undefined?t.pixelTolerance:10;this.snappedToVertex_=false;this.changingFeature_=false;this.dragSegments_=null;this.overlay_=new b["a"]({source:new S["b"]({useSpatialIndex:false,wrapX:!!t.wrapX}),style:t.style||s["a"].getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.features_=t.features;this.features_.forEach(function(e){return r.addFeature_(e)});p["a"](this.features_,"add",this.handleFeatureAdd_,this);p["a"](this.features_,"remove",this.handleFeatureRemove_,this)};u["d"](w,_["b"]);w.prototype.addFeature_=function(e){if(e.getGeometry().getType()==="Polygon"&&!!e.get(i["a"].IS_CIRCLE)){var t=e.getGeometry();this.writeCircleGeometry_(e,t);var r=this.getMap();if(r){this.handlePointerAtPixel_(this.lastPixel_,r)}}};w.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new o["a"]("modifystart",{features:this.features_});this.dispatchEvent(t)}};w.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e);if(this.vertexFeature_&&this.features_.getLength()===0){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};w.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_;var r=[];t.forEach(function(t){if(e===t.feature){r.push(t)}});for(var a=r.length-1;a>=0;--a){t.remove(r[a])}};w.prototype.setMap=function(e){this.overlay_.setMap(e);_["b"].prototype.setMap.call(this,e)};w.prototype.handleFeatureAdd_=function(e){var t=e.element;a["a"].assertInstanceof(t,c["a"],"feature should be an ol.Feature");this.addFeature_(t)};w.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};w.prototype.writeCircleGeometry_=function(e,t){var r=t.getCoordinates();var a=void 0,n=void 0,i=void 0,o=void 0,s=void 0,l=void 0,u=void 0;for(o=0,s=r.length;o<s;++o){a=r[o];for(n=0,i=a.length-1;n<i;++n){l=a.slice(n,n+2);u={feature:e,geometry:t,depth:[o],index:n,segment:l};this.rBush_.insert(d["b"](l),u)}}};w.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;if(!t){t=new c["a"](new v["a"](e));this.vertexFeature_=t;this.overlay_.getSource().addFeature(t)}else{var r=t.getGeometry();r.setCoordinates(e)}return t};w.compareIndexes_=function(e,t){return e.index-t.index};w.handleDownEvent_=function(e){this.handlePointerAtPixel_(e.pixel,e.map);this.dragSegments_=[];this.modified_=false;var t=this.vertexFeature_;if(t){var r=t.getGeometry();var a=r.getCoordinates();var n=d["b"]([a]);var i=this.rBush_.getInExtent(n);var o={};i.sort(w.compareIndexes_);for(var s=0,l=i.length;s<l;++s){var c=i[s];var f=c.segment;var p=u["c"](c.feature);var g=c.depth;if(g){p+="-"+g.join("-")}if(!o[p]){o[p]=new Array(2)}if(h["e"](f[0],a)&&!o[p][0]){this.dragSegments_.push([c,0]);o[p][0]=c}else if(h["e"](f[1],a)&&!o[p][1]){this.dragSegments_.push([c,1]);o[p][1]=c}}}return!!this.vertexFeature_};w.handleDragEvent_=function(e){this.willModifyFeatures_(e);var t=e.coordinate;var r=this.dragSegments_[0][0].geometry;var a=d["x"](r.getExtent());var n=new m["a"]([a,t]);var o=new g["a"](a,n.getLength());var s=Object(y["b"])(o,64).getCoordinates();this.setGeometryCoordinates_(r,s);var u=l["a"].getAzimut(n);this.features_.getArray()[0].set(i["a"].AZIMUT,u);this.createOrUpdateVertexFeature_(t)};w.handleUpEvent_=function(e){this.rBush_.clear();this.writeCircleGeometry_(this.dragSegments_[0][0].feature,this.dragSegments_[0][0].geometry);if(this.modified_){var t=new o["a"]("modifyend",{features:this.features_});this.dispatchEvent(t);this.modified_=false}return false};w.handleEvent=function(e){if(!(e instanceof f["a"])){return true}var t=void 0;if(!e.map.getView().getInteracting()&&e.type=="pointermove"&&!this.handlingDownUpSequence){this.handlePointerMove_(e)}return _["c"].call(this,e)&&!t};w.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel;this.handlePointerAtPixel_(e.pixel,e.map)};w.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e);var a=function e(t,a){return h["i"](r,t.segment)-h["i"](r,a.segment)};var n=t.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]);var i=t.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]);var o=d["b"]([n,i]);var s=this.rBush_;var l=s.getInExtent(o);if(l.length>0){l.sort(a);var c=l[0];var f=c.segment;var p=h["c"](r,f);var g=t.getPixelFromCoordinate(p);if(Math.sqrt(h["h"](e,g))<=this.pixelTolerance_){var m=t.getPixelFromCoordinate(f[0]);var v=t.getPixelFromCoordinate(f[1]);var y=h["h"](g,m);var _=h["h"](g,v);var b=Math.sqrt(Math.min(y,_));this.snappedToVertex_=b<=this.pixelTolerance_;if(this.snappedToVertex_){p=y>_?f[1]:f[0];this.createOrUpdateVertexFeature_(p);var S={};S[u["c"](f)]=true;var C=void 0;for(var w=1,T=l.length;w<T;++w){C=l[w].segment;if(h["e"](f[0],C[0])&&h["e"](f[1],C[1])||h["e"](f[0],C[1])&&h["e"](f[1],C[0])){S[u["c"](C)]=true}else{break}}return}}}if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};w.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=true;e.setCoordinates(t);this.changingFeature_=false};var T=w;var E=function e(t){var r=this;a["a"].assert(t.features);_["b"].call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_});this.modified_=false;this.vectorPoints_=new b["a"]({source:new S["b"]({wrapX:!!t.wrapX}),visible:this.getActive(),style:t.style||s["a"].getDefaultModifyStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});this.features_=t.features;this.feature_=null;this.cache_={};this.params_=null;p["a"](this.features_,"add",this.handleFeatureAdd_,this);p["a"](this.features_,"remove",this.handleFeatureRemove_,this);this.features_.forEach(function(e){r.addFeature_(e)})};u["d"](E,_["b"]);E.prototype.setActive=function(e){_["b"].prototype.setActive.call(this,e);if(this.vectorPoints_){this.vectorPoints_.setVisible(e)}};E.prototype.addFeature_=function(e){var t=e.getGeometry();if(t instanceof y["a"]){var r=u["c"](e);var a=this.cache_[r];if(a){return}var n=this.vectorPoints_.getSource();var i=t.getCoordinates()[0];while(i.length>4){if(i[0][0]<i[1][0]&&i[0][1]<=i[1][1]){i.pop()}else{i.shift()}}var o=[];var s=void 0;var l=void 0;i.forEach(function(t){s=new v["a"](t);l=new c["a"]({corner:true,geometry:s,siblingX:null,siblingY:null,boxFeature:e});o.push(l)},this);a={corners:o};this.cache_[r]=a;var f=void 0;var h=void 0;o.forEach(function(e,t){f=o[t-1];if(!f){f=o[o.length-1]}h=o[t+1];if(!h){h=o[0]}if(t%2===0){e.set("siblingX",h);e.set("siblingY",f)}else{e.set("siblingX",f);e.set("siblingY",h)}},this);n.addFeatures(o)}};E.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=true;var t=new o["a"]("modifystart",{features:this.features_});this.dispatchEvent(t);this.params_=this.initializeParams_()}};E.prototype.initializeParams_=function(){var e=this.feature_;var t=e.get("siblingX");a["a"].assertInstanceof(t,c["a"]);var r=t.get("siblingY");a["a"].assertInstanceof(r,c["a"]);var n=r.getGeometry();a["a"].assertInstanceof(n,v["a"]);var i=n.getCoordinates();var o=this.getMap().getPixelFromCoordinate(i);var s=r.get("siblingX");a["a"].assertInstanceof(s,c["a"]);var l=s.getGeometry();a["a"].assertInstanceof(l,v["a"]);var u=l.getCoordinates();var f=this.getMap().getPixelFromCoordinate(u);var h=[f[0]-o[0],f[1]-o[1]];var p=Math.sqrt(h[0]*h[0]+h[1]*h[1]);h[0]/=p;h[1]/=p;var d=t.getGeometry();a["a"].assertInstanceof(d,v["a"]);var g=d.getCoordinates();var m=this.getMap().getPixelFromCoordinate(g);var y=[m[0]-o[0],m[1]-o[1]];var _=Math.sqrt(y[0]*y[0]+y[1]*y[1]);y[0]/=_;y[1]/=_;if(isNaN(h[0])&&isNaN(y[0])){h=[0,1];y=[1,0]}else if(isNaN(h[0])){h=[y[1],-y[0]]}else if(isNaN(y[0])){y=[h[1],-h[0]]}return{originCoordinate:i,originPixel:o,siblingXPoint:l,siblingYPoint:d,vectorX:h,vectorY:y}};E.prototype.removeFeature_=function(e){var t=u["c"](e);var r=this.cache_[t];var a=r.corners;for(var n=0;n<a.length;n++){this.vectorPoints_.getSource().removeFeature(a[n])}this.feature_=null;a.length=0;delete this.cache_[t]};E.prototype.setMap=function(e){this.vectorPoints_.setMap(e);_["b"].prototype.setMap.call(this,e)};E.prototype.handleFeatureAdd_=function(e){var t=e.element;a["a"].assertInstanceof(t,c["a"],"feature should be an ol.Feature");this.addFeature_(t)};E.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};E.prototype.handleDown_=function(e){var t=e.map;var r=t.forEachFeatureAtPixel(e.pixel,function(e){return e.get("siblingX")&&e.get("siblingY")?e:undefined});if(r){this.feature_=r;return true}return false};E.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_;var r=t.getGeometry();if(r instanceof v["a"]){r.setCoordinates(e.coordinate);var n=e.pixel;var i=this.params_.originPixel;var o=this.params_.siblingXPoint;var s=this.params_.siblingYPoint;var l=this.params_.vectorX;var u=this.params_.vectorY;var c=this.params_.originCoordinate;var f=this.calculateNewPixel_(i,n,l);var h=this.getMap().getCoordinateFromPixel(f);o.setCoordinates(h);var p=this.calculateNewPixel_(i,n,u);var d=this.getMap().getCoordinateFromPixel(p);s.setCoordinates(d);var g=t.get("boxFeature");var m=g.getGeometry();a["a"].assertInstanceof(m,y["a"]);m.setCoordinates([[e.coordinate,h,c,d,e.coordinate]])}};E.prototype.calculateNewPixel_=function(e,t,r){var a=[t[0]-e[0],t[1]-e[1]];var n=a[0]*r[0]+a[1]*r[1];var i=[r[0]*n,r[1]*n];return[i[0]+e[0],i[1]+e[1]]};E.prototype.handleUp_=function(e){if(this.modified_){var t=new o["a"]("modifyend",{features:this.features_});this.dispatchEvent(t);this.params_=null;this.modified_=false}return false};E.CacheItem;E.ModifyParams;var A=E;var L=r(17);var P=r(32);var M=r(18);var x=r(223);var F=function e(t){a["a"].assert(t.features);this.features_=t.features;this.listenerKeys_=[];this.interactions_=[];this.otherFeatures_=new M["b"];this.interactions_.push(new x["a"]({deleteCondition:n["b"].deleteCondition,features:this.otherFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));this.circleFeatures_=new M["b"];this.interactions_.push(new T({features:this.circleFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));this.rectangleFeatures_=new M["b"];this.interactions_.push(new A({features:this.rectangleFeatures_,pixelTolerance:t.pixelTolerance,style:t.style,wrapX:t.wrapX}));P["a"].call(this,{handleEvent:L["b"]})};u["d"](F,P["a"]);F.prototype.setActive=function(e){P["a"].prototype.setActive.call(this,e);this.setState_()};F.prototype.setMap=function(e){var t=this.interactions_;var r=this.getMap();if(r){t.forEach(function(e){r.removeInteraction(e)})}P["a"].prototype.setMap.call(this,e);if(e){t.forEach(function(t){e.addInteraction(t)})}this.setState_()};F.prototype.setState_=function(){var e=this;var t=this.getMap();var r=this.getActive();var a=this.interactions_;var n=this.listenerKeys_;a.forEach(function(e){e.setActive(r&&!!t)});if(r&&t){this.features_.forEach(function(t){return e.addFeature_(t)});n.push(p["a"](this.features_,"add",this.handleFeaturesAdd_,this),p["a"](this.features_,"remove",this.handleFeaturesRemove_,this))}else{n.forEach(p["e"]);n.length=0;this.features_.forEach(function(t){return e.removeFeature_(t)})}};F.prototype.handleFeaturesAdd_=function(e){var t=e.element;a["a"].assertInstanceof(t,c["a"],"feature should be an ol.Feature");this.addFeature_(t)};F.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)};F.prototype.addFeature_=function(e){var t=this.getFeatureCollection_(e);t.push(e)};F.prototype.removeFeature_=function(e){var t=this.getFeatureCollection_(e);t.remove(e)};F.prototype.getFeatureCollection_=function(e){var t=void 0;var r=e.get(i["a"].IS_CIRCLE);var a=e.get(i["a"].IS_RECTANGLE);if(r===true||r==="true"){t=this.circleFeatures_}else if(a===true||a==="true"){t=this.rectangleFeatures_}else{t=this.otherFeatures_}return t};var R=t["a"]=F},function(e,t,r){"use strict";var a=r(2);var n=r(231);var i=r(27);var o=r(20);var s=r(189);var l=r(140);var u=r(131);var c=r(65);var f=r(52);var h=r(22);var p=r(1);var d=r(3);var g=function e(t,r,a,n,i,o){var s=this;this.active;if(this.active===undefined){this.active=false}this.features;this.map;this.showMeasure;this.gettextCatalog_=a;a.getString("Point");a.getString("LineString");a.getString("Polygon");a.getString("Circle");a.getString("Rectangle");a.getString("Text");this.featureHelper_=n;this.ngeoFeatures_=o;this.interactions_=[];this.drawPoint;this.measureLength;this.measureArea;this.measureAzimut;this.drawRectangle;this.drawText;this.ngeoEventHelper_=i;t.$watch(function(){return s.active},function(e){if(e===false){s.interactions_.forEach(function(e){e.setActive(false)})}})};g.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoEventHelper","ngeoFeatures"];g.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoEventHelper","ngeoFeatures"];g.prototype.handleEscapeKeyDown_=function(e){var t=e.keyCode===27;if(!f["a"].mousedown&&t&&this.interaction_.getActive()){var r=this.interaction_;r.setActive(false);r.setActive(true)}};g.prototype.registerInteraction=function(e){this.interactions_.push(e);e.setActive(false);l["a"].interaction(e);this.map.addInteraction(e)};g.prototype.handleActiveChange=function(e){this.active=this.interactions_.some(function(e){return e.getActive()},this);this.interaction_=this.interactions_.find(function(e){return e.getActive()===true});var t=Object(p["c"])(this);if(this.interaction_){this.ngeoEventHelper_.addListenerKey(t,Object(d["a"])(document.body,"keydown",this.handleEscapeKeyDown_,this))}else{this.ngeoEventHelper_.clearListenerKey(t)}};g.prototype.handleDrawEnd=function(e,t){var r=void 0;if(t.feature){r=t.feature}else{r=t.detail.feature}a["a"].assert(r);var n=r.get("azimut");var s=this.features||this.ngeoFeatures_;var l=new h["a"](r.getGeometry());var u=i["a"];switch(e){case o["a"].CIRCLE:l.set(u.IS_CIRCLE,true);if(n!==undefined){l.set(u.AZIMUT,n)}break;case o["a"].TEXT:l.set(u.IS_TEXT,true);break;case o["a"].RECTANGLE:l.set(u.IS_RECTANGLE,true);break;default:break}var c=this.gettextCatalog_.getString(e);l.set(u.NAME,c+" "+(s.getLength()+1));var f=e!==o["a"].TEXT?"#DB4436":"#000000";l.set(u.COLOR,f);l.set(u.ANGLE,0);l.set(u.OPACITY,.2);l.set(u.SHOW_MEASURE,this.showMeasure?true:false);l.set(u.SHOW_LABEL,false);l.set(u.SIZE,10);l.set(u.STROKE,2);this.featureHelper_.setStyle(l);s.push(l)};g.module=angular.module("ngeoDrawfeatureController",[n["a"].name,s["a"].name,c["a"].module.name,u["a"].module.name]);g.module.controller("ngeoDrawfeatureController",g);var m=g;var v=r(110);var y=angular.module("ngeoDrawpoint",[]);y.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new v["a"]({type:"Point"});n.registerInteraction(i);n.drawPoint=i;d["a"](i,"drawend",n.handleDrawEnd.bind(n,o["a"].POINT),n);d["a"](i,"change:active",n.handleActiveChange,n)}}};y.directive("ngeoDrawpoint",y.directive_);var _=y;var b=r(34);var S=angular.module("ngeoDrawrectangle",[]);S.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new v["a"]({type:"LineString",geometryFunction:function e(t,r){if(!r){r=new b["a"](null)}var a=t[0];var n=t[1];r.setCoordinates([[a,[a[0],n[1]],n,[n[0],a[1]],a]]);return r},maxPoints:2});n.registerInteraction(i);n.drawRectangle=i;d["a"](i,"drawend",n.handleDrawEnd.bind(n,o["a"].RECTANGLE),n);d["a"](i,"change:active",n.handleActiveChange,n)}}};S.directive("ngeoDrawrectangle",S.directive_);var C=S;var w=angular.module("ngeoDrawtext",[]);w.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function e(t,r,a,n){var i=new v["a"]({type:"Point"});n.registerInteraction(i);n.drawText=i;d["a"](i,"drawend",n.handleDrawEnd.bind(n,o["a"].TEXT),n);d["a"](i,"change:active",n.handleActiveChange,n)}}};w.directive("ngeoDrawtext",w.directive_);var T=w;var E=r(253);var A=r(13);var L=angular.module("ngeoMeasurearea",[m.module.name]);L.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,s,l,u){var c=t.getString("Click to start drawing polygon");var f=t.getString("Click to continue drawing<br>"+"Double-click or click starting point to finish");var h=new E["a"](r("ngeoUnitPrefix"),t,{style:new A["c"],startMsg:e("<div translate>"+c+"</div>")(i)[0],continueMsg:e("<div translate>"+f+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined});u.registerInteraction(h);u.measureArea=h;d["a"](h,"measureend",u.handleDrawEnd.bind(u,o["a"].POLYGON),u);d["a"](h,"change:active",u.handleActiveChange,u)}}};L.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];L.directive("ngeoMeasurearea",L.directive_);var P=L;var M=r(134);var x=r(206);var F=angular.module("ngeoMeasureazimut",[m.module.name,M["a"].name]);F.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,s,l,u){var c=t.getString("Click to start drawing circle");var f=t.getString("Click to finish");var p=new x["a"](r("ngeoUnitPrefix"),r("number"),{style:new A["c"],startMsg:e("<div translate>"+c+"</div>")(i)[0],continueMsg:e("<div translate>"+f+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined,decimals:a.has("ngeoMeasureDecimals")?a.get("ngeoMeasureDecimals"):undefined});u.registerInteraction(p);u.measureAzimut=p;d["a"](p,"measureend",function(e){var t=e.detail.feature.getGeometry();var r=t.getGeometries()[1];var a=Object(b["b"])(r,64);e.detail.feature=new h["a"](a);var n=x["a"].getAzimut(t.getGeometries()[0]);e.detail.feature.set("azimut",n);u.handleDrawEnd(o["a"].CIRCLE,e)},u);d["a"](p,"change:active",u.handleActiveChange,u)}}};F.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];F.directive("ngeoMeasureazimut",F.directive_);var R=F;var D=r(252);var k=angular.module("ngeoMeasurelength",[m.module.name,M["a"].name]);k.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function n(i,s,l,u){var c=t.getString("Click to start drawing line");var f=t.getString("Click to continue drawing<br>"+"Double-click or click last point to finish");var h=new D["a"](r("ngeoUnitPrefix"),t,{style:new A["c"],startMsg:e("<div translate>"+c+"</div>")(i)[0],continueMsg:e("<div translate>"+f+"</div>")(i)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):undefined,tolerance:a.has("ngeoSnappingTolerance")?a.get("ngeoSnappingTolerance"):undefined,source:a.has("ngeoSnappingSource")?a.get("ngeoSnappingSource"):undefined});u.registerInteraction(h);u.measureLength=h;d["a"](h,"measureend",u.handleDrawEnd.bind(u,o["a"].LINE_STRING),u);d["a"](h,"change:active",u.handleActiveChange,u)}}};k.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"];k.directive("ngeoMeasurelength",k.directive_);var $=k;var O=angular.module("ngeoDrawfeature",[m.module.name,_.name,C.name,T.name,P.name,R.name,$.name]);O.directive_=function(){return{controller:"ngeoDrawfeatureController as dfCtrl",scope:true,bindToController:{active:"=ngeoDrawfeatureActive",features:"=?ngeoDrawfeatureFeatures",map:"=ngeoDrawfeatureMap",showMeasure:"=?ngeoDrawfeatureShowmeasure"}}};O.directive("ngeoDrawfeature",O.directive_);var I=t["a"]=O},,,function(e,t,r){"use strict";var a=r(212);var n=function e(t,r){this.http_=t;this.baseUrl_=r;this.promises_={}};n.$inject=["$http","gmfLayersUrl"];n.$inject=["$http","gmfLayersUrl"];n.prototype.getAttributes=function(e){if(!this.promises_[e]){var t=this.baseUrl_+"/"+e+"/md.xsd";this.promises_[e]=this.http_.get(t).then(this.handleGetAttributes_.bind(this))}return this.promises_[e]};n.prototype.handleGetAttributes_=function(e){return(new a["a"]).read(e.data)};n.module=angular.module("gmfXSDAttributes",[]);n.module.service("gmfXSDAttributes",n);t["a"]=n},function(e,t,r){"use strict";var a=r(135);var n=r(112);var i=function e(t,r){this.http_=t;this.baseUrl_=r};i.$inject=["$http","gmfLayersUrl"];i.$inject=["$http","gmfLayersUrl"];i.prototype.getFeaturesInExtent=function(e,t){var r=n["a"](this.baseUrl_+"/"+e.join(","),{bbox:t.join(",")});return this.http_.get(r).then(this.handleGetFeatures_.bind(this))};i.prototype.getFeaturesWithComparisonFilters=function(e,t){var r=[];var a={};for(var i=t,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;a[u.property+"__"+u.operator]=u.value;r.push(u.property)}a["queryable"]=r.join(",");var c=n["a"](this.baseUrl_+"/"+e.join(","),a);return this.http_.get(c).then(this.handleGetFeatures_.bind(this))};i.prototype.handleGetFeatures_=function(e){return(new a["a"]).readFeatures(e.data)};i.prototype.insertFeatures=function(e,t){var r=this.baseUrl_+"/"+e;var n=(new a["a"]).writeFeatures(t);return this.http_.post(r,n,{headers:{"Content-Type":"application/json"},withCredentials:true})};i.prototype.updateFeature=function(e,t){var r=this.baseUrl_+"/"+e.toString()+"/"+t.getId();var n=(new a["a"]).writeFeature(t);return this.http_.put(r,n,{headers:{"Content-Type":"application/json"},withCredentials:true})};i.prototype.deleteFeature=function(e,t){var r=this.baseUrl_+"/"+e.toString()+"/"+t.getId();return this.http_.delete(r,{headers:{"Content-Type":"application/json"},withCredentials:true})};i.module=angular.module("gmfEditFeature",[]);i.module.service("gmfEditFeature",i);t["a"]=i},function(e,t,r){"use strict";var a=function e(t,r){this.$http_=t;this.url_=r};a.$inject=["$http","gmfRasterUrl"];a.$inject=["$http","gmfRasterUrl"];a.prototype.getRaster=function(e,t){var r=t||{};r[a.Param.X]=e[0];r[a.Param.Y]=e[1];return this.$http_.get(this.url_,{params:r}).then(this.handleGetRaster_.bind(this))};a.prototype.handleGetRaster_=function(e){return e.data};a.Param={X:"lon",Y:"lat"};a.module=angular.module("gmfRaster",[]);a.module.service("gmfRaster",a);t["a"]=a},,,function(e,t,r){"use strict";var a=r(196);var n=r(277);a["a"].Proj.projections.add(n["a"]);var i="somerc";t["a"]=i},,function(e,t,r){"use strict";var a=angular.module("ngeoColorpicker",[]);a.value("ngeoColorpickerTemplateUrl",function(e,t){var r=t["ngeoColorpickerTemplateurl"];return r!==undefined?r:"ngeo/misc/colorpickerComponent"});a.run(["$templateCache",function(e){e.put("ngeo/misc/colorpickerComponent",r(393))}]);a.component_=function(e){return{restrict:"A",scope:{colors:"<?ngeoColorpicker",color:"=?ngeoColorpickerColor"},controller:"NgeoColorpickerController as ctrl",bindToController:true,templateUrl:e}};a.component_.$inject=["ngeoColorpickerTemplateUrl"];a.directive("ngeoColorpicker",a.component_);a.DEFAULT_COLORS=[["#F4EB37","#CDDC39","#62AF44","#009D57","#0BA9CC","#4186F0","#3F5BA9","#7C3592","#A61B4A","#DB4436","#F8971B","#F4B400","#795046"],["#F9F7A6","#E6EEA3","#B7DBAB","#7CCFA9","#93D7E8","#9FC3FF","#A7B5D7","#C6A4CF","#D698AD","#EE9C96","#FAD199","#FFDD5E","#B29189"],["#ffffff","#CCCCCC","#777","#000000"]];a.Controller_=function(e,t,r){this.colors=this.colors||a.DEFAULT_COLORS;this.color};a.Controller_.$inject=["$scope","$element","$attrs"];a.Controller_.prototype.setColor=function(e){this.color=e};a.controller("NgeoColorpickerController",a.Controller_);t["a"]=a},function(e,t,r){"use strict";var a=r(11);var n=r(4);var i=function e(){};i.prototype.stringToCoordinates=function(e){var t=e.match(/([\d\.']+)[\s,]+([\d\.']+)/);if(t){var r=parseFloat(t[1].replace("'",""));var a=parseFloat(t[2].replace("'",""));if(!isNaN(r)&&!isNaN(a)){return[r,a]}}return null};i.prototype.getProjectionList=function(e){var t=void 0,r=void 0;var n=[];e.forEach(function(e){t=e.toUpperCase();if(t.substr(0,5)!="EPSG:"){t="EPSG:"+t}r=a["g"](t);if(r!==null){n.push(r)}else{console.error("The projection "+t+" is not defined in ol.proj.")}});return n};i.prototype.tryProjections=function(e,t,r,i){var o=void 0;if(i===undefined){i=[r]}i.some(function(i){try{o=a["l"](e,i,r);if(n["f"](t,o)){return true}}catch(e){}o=null});return o};i.prototype.tryProjectionsWithInversion=function(e,t,r,a){var n=this.tryProjections(e,t,r,a);if(n===null){n=this.tryProjections(e.reverse(),t,r,a)}return n};i.module=angular.module("ngeoAutoProjection",[]);i.module.service("ngeoAutoProjection",i);t["a"]=i},function(e,t,r){"use strict";var a=r(52);var n=function e(t,r){this.$http_=r;this.url_=t.get("fulltextsearchUrl");var n=this.url_.split("?");this.baseUrl_=n[0];var i=n.length==2?"?"+n[1]:"";this.defaultParams_=a["b"].decodeQueryString(i)};n.$inject=["$injector","$http"];n.$inject=["$injector","$http"];n.prototype.search=function(e,t){var r=this;var n=Object.assign({},this.defaultParams_,t);n["query"]=e;var i=this.baseUrl_+"?"+a["b"].encodeQueryString(n);return new Promise(function(e,t){r.$http_.get(i).then(function(t){return e(t["data"])}).catch(t)})};n.module=angular.module("gmfSearchFulltextSearch",[]);n.module.service("gmfSearchFulltextSearch",n);t["a"]=n},function(e,t,r){"use strict";var a=r(234);var n=function e(t,r){this.gettextCatalog_=r;this.encoding_=t.has("ngeoCsvEncoding")?t.get("ngeoCsvEncoding"):"utf-8";this.extension_=t.has("ngeoCsvExtension")?t.get("ngeoCsvExtension"):".csv";this.includeHeader_=t.has("ngeoCsvIncludeHeader")?t.get("ngeoCsvIncludeHeader"):true;this.quote_=t.has("ngeoCsvQuote")?t.get("ngeoCsvQuote"):'"';this.separator_=t.has("ngeoCsvSeparator")?t.get("ngeoCsvSeparator"):",";this.download_=t.get("ngeoDownload")};n.$inject=["$injector","gettextCatalog"];n.$inject=["$injector","gettextCatalog"];n.prototype.generateCsv=function(e,t){var r=this;if(e.length==0||t.length==0){return""}var a=t.map(function(e){return r.gettextCatalog_.getString(e.name)});var n=this.getRow_(a);var i=e.map(function(e){var a=t.map(function(t){return e[t.name]});return r.getRow_(a)});return this.includeHeader_?n+i.join(""):i.join("")};n.prototype.getRow_=function(e){var t=this;var r=new RegExp(this.quote_,"g");var a=this.quote_+this.quote_;var n=e.map(function(e){if(e!==undefined&&e!==null){e=""+e;return t.quote_+e.replace(r,a)+t.quote_}else{return""}});return n.join(this.separator_)+"\n"};n.prototype.startDownload=function(e,t,r){var a=this.generateCsv(e,t);this.download_(a,r,"text/csv;charset="+this.encoding_)};n.module=angular.module("ngeoCsvDownload",[a["a"].name]);n.module.service("ngeoCsvDownload",n);t["a"]=n},function(e,t,r){"use strict";var a=r(2);var n=r(99);var i=angular.module("ngeoResizemap",[]);i.directive_=function(e){var t=1e3;return{restrict:"A",link:function r(i,o,s){var l="ngeoResizemap";var u=s[l];var c=i.$eval(u);a["a"].assertInstanceof(c,n["a"]);var f=s["ngeoResizemapState"];a["a"].assert(f!==undefined);var h=void 0;var p=void 0;var d=function r(){c.updateSize();c.renderSync();if(Date.now()-h<t){p=e.requestAnimationFrame(r)}};o.on("transitionend",function(){c.updateSize();c.renderSync()});i.$watch(f,function(t,r){if(t!=r){h=Date.now();e.cancelAnimationFrame(p);p=e.requestAnimationFrame(d)}})}}};i.directive_.$inject=["$window"];i.directive("ngeoResizemap",i.directive_);t["a"]=i},function(e,t,r){"use strict";var a=r(243);var n=r(233);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=angular.module("gmfPermalinkShareComponent",[a["a"].module.name,n["a"].module.name]);o.run(["$templateCache",function(e){e.put("gmf/permalink/shareComponent",r(407))}]);o.value("gmfPermalinkShareTemplateUrl",function(e){var t=e["gmfPermalinkShareTemplateUrl"];return t!==undefined?t:"gmf/permalink/shareComponent"});s.$inject=["$attrs","gmfPermalinkShareTemplateUrl"];function s(e,t){return t(e)}o.component_={bindings:{enableEmail:"<gmfShareEmail"},controller:"GmfShareController",templateUrl:s};o.component("gmfShare",o.component_);var l=function(){e.$inject=["$scope","ngeoLocation","gmfShareService","$q","$attrs"];function e(t,r,n,o,s){i(this,e);this.$scope_=t;this.gmfShareService_=n;this.$q_=o;this.ngeoLocation_=r;this.enableEmail;this.shortLink;this.email;this.message;this.permalink_=this.ngeoLocation_.getUriString();this.showLengthWarning=this.permalink_.length>a["a"].URL_MAX_LEN||r.getPath()>a["a"].URL_PATH_MAX_LEN;this.successfullySent=false;this.errorOnsend=false;this.errorOnGetShortUrl=false;this.getShortUrl()}e.prototype.getShortUrl=function e(){var t=this;this.$q_.when(this.gmfShareService_.getShortUrl(this.permalink_)).then(function(e){t.shortLink=e.data.short_url;t.errorOnGetShortUrl=false},function(e){t.shortLink=t.permalink;t.errorOnGetShortUrl=true})};e.prototype.sendShortUrl=function e(){var t=this;if(this.$scope_["gmfShareForm"].$valid){this.$q_.when(this.gmfShareService_.sendShortUrl(this.permalink_,this.email,this.message)).then(function(e){t.successfullySent=true},function(e){t.errorOnsend=true})}};return e}();o.controller("GmfShareController",l);t["a"]=o},function(e,t,r){"use strict";var a=r(167);var n=r(1);function i(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=angular.module("gmfLayertreeDatasourceGroupTreeComponent",[a["a"].module.name]);o.run(["$templateCache",function(e){e.put("gmf/layertree/datasourceGroupTreeComponent",r(414))}]);o.value("gmfLayertreeDatasourceGroupTreeTemplateUrl",function(e){var t=e["gmfLayertreeDatasourceGroupTreeTemplateUrl"];return t!==undefined?t:"gmf/layertree/datasourceGroupTreeComponent"});s.$inject=["$attrs","gmfLayertreeDatasourceGroupTreeTemplateUrl"];function s(e,t){return t(e)}o.Controller_=function(){e.$inject=["$scope","ngeoDataSources"];function e(t,r){i(this,e);this.group;this.scope_=t;this.dataSources_=r.collection}e.prototype.getGroupUid=function e(){return"datasourcegrouptree-"+n["c"](this.group)};e.prototype.toggle=function e(){this.group.toggleVisibilityState()};e.prototype.toggleDataSource=function e(t){t.visible=!t.visible};e.prototype.remove=function e(){for(var t=this.group.dataSources.length-1,r=0;t>=r;t--){this.dataSources_.remove(this.group.dataSources[t])}};e.prototype.removeDataSource=function e(t){this.dataSources_.remove(t)};return e}();o.component("gmfDatasourcegrouptree",{bindings:{group:"<"},controller:o.Controller_,templateUrl:s});t["a"]=o},function(e,t,r){"use strict";var a=r(233);var n=r(190);var i=angular.module("ngeoStatemanagerModule",[a["a"].module.name,n["a"].module.name]);t["a"]=i},function(e,t,r){"use strict";(function(e){var a=r(48);var n=r(177);var i=r(46);var o=r(357);var s=r(231);var l=r(214);var u=r(50);var c=r(356);var f=r(332);var h=r(27);var p=r(187);var d=r(131);var g=r(288);var m=r(190);var v=r(106);var y=r(2);var _=r(1);var b=r(7);var S=r(3);var C=r(22);var w=r(92);var T=r(30);var E=r(195);var A=r(13);var L=r(78);var P=function e(t,a,i,o,s,l,u,c,p,d){var g=this;this.q_=t;this.rootScope_=i;this.$timeout_=a;this.mapViewPropertyChangeEventKey_=null;this.ngeoDebounce_=s;this.ngeoEventHelper_=u;this.ngeoStateManager_=c;this.ngeoFeatures_=o.has("ngeoFeatures")?o.get("ngeoFeatures"):null;this.ngeoBackgroundLayerMgr_=o.has("ngeoBackgroundLayerMgr")?o.get("ngeoBackgroundLayerMgr"):null;var m=o.has("ngeoFeatureOverlayMgr")?o.get("ngeoFeatureOverlayMgr"):null;this.featureOverlay_=m?m.getFeatureOverlay():null;this.featureHelper_=o.has("ngeoFeatureHelper")?o.get("ngeoFeatureHelper"):null;this.ngeoQuerent_=o.has("ngeoQuerent")?o.get("ngeoQuerent"):null;var v=o.has("gmfPermalinkOptions")?o.get("gmfPermalinkOptions"):{};if(v.useLocalStorage===true){this.ngeoStateManager_.setUseLocalStorage(true)}this.crosshairEnabledByDefault_=!!v.crosshairEnabledByDefault;this.pointRecenterZoom_=v.pointRecenterZoom;this.gmfExternalDataSourcesManager_=o.has("gmfExternalDataSourcesManager")?o.get("gmfExternalDataSourcesManager"):null;this.gmfThemes_=o.has("gmfThemes")?o.get("gmfThemes"):null;this.gmfObjectEditingManager_=o.has("gmfObjectEditingManager")?o.get("gmfObjectEditingManager"):null;this.gmfThemeManager_=o.has("gmfThemeManager")?o.get("gmfThemeManager"):null;this.defaultTheme_=o.has("defaultTheme")?o.get("defaultTheme"):undefined;this.gmfTreeManager_=o.has("gmfTreeManager")?o.get("gmfTreeManager"):null;this.user_=d;this.ngeoLocation_=p;this.ngeoWfsPermalink_=o.has("ngeoWfsPermalink")?o.get("ngeoWfsPermalink"):null;this.gmfUser_=o.has("gmfUser")?o.get("gmfUser"):null;this.map_=null;this.ngeoAutoProjection_=o.has("ngeoAutoProjection")?o.get("ngeoAutoProjection"):null;this.sourceProjections_=null;if(v.projectionCodes!==undefined&&this.ngeoAutoProjection_){var _=this.ngeoAutoProjection_.getProjectionList(v.projectionCodes);if(_.length>0){this.sourceProjections_=_}}this.crosshairFeature_=null;this.crosshairStyle_;if(v.crosshairStyle!==undefined){this.crosshairStyle_=v.crosshairStyle}else{this.crosshairStyle_=[new A["c"]({image:new E["a"]({src:r(415)})})]}this.mapTooltip_=null;this.featureHashFormat_=new f["a"]({setStyle:false,encodeStyles:false,propertiesType:{fillColor:h["a"].COLOR,fillOpacity:h["a"].OPACITY,fontColor:h["a"].COLOR,fontSize:h["a"].SIZE,isBox:h["a"].IS_RECTANGLE,isCircle:h["a"].IS_CIRCLE,isLabel:h["a"].IS_TEXT,name:h["a"].NAME,pointRadius:h["a"].SIZE,showLabel:h["a"].SHOW_LABEL,showMeasure:h["a"].SHOW_MEASURE,strokeColor:h["a"].COLOR,strokeWidth:h["a"].STROKE},defaultValues:{name:function e(t){return l.getString(t.getGeometry().getType())},fillOpacity:function e(){return.5},showLabel:function e(){return false},showMeasure:function e(){return false}}});if(this.ngeoBackgroundLayerMgr_){S["a"](this.ngeoBackgroundLayerMgr_,"change",this.handleBackgroundLayerManagerChange_,this)}this.rootScope_.$on("ngeo-layertree-state",function(t,r,a){var n={};if(a.node.mixed){var i=r.getState();y["a"].assert(i==="on"||i==="off");var o=i==="on";r.traverseDepthFirst(function(t){if(t.node.children===undefined){var r=e.ParamPrefix.TREE_ENABLE+t.node.name;n[r]=o}})}else{var s=[];a.traverseDepthFirst(function(e){if(e.node.children===undefined&&e.getState()==="on"){s.push(e.node.name)}});n[e.ParamPrefix.TREE_GROUP_LAYERS+a.node.name]=s.join(",")}g.ngeoStateManager_.updateState(n)});this.rootScope_.$on("ngeo-layertree-opacity",function(t,r){var a={};var n=r.layer.getOpacity();var i=(r.parent.node.mixed?e.ParamPrefix.TREE_OPACITY:e.ParamPrefix.TREE_GROUP_OPACITY)+r.node.name;a[i]=n;g.ngeoStateManager_.updateState(a)});var b=this.getFeatures();if(this.ngeoFeatures_){b.forEach(function(e){if(g.featureHelper_){g.featureHelper_.setStyle(e)}g.addNgeoFeature_(e)});this.ngeoFeatures_.extend(b);S["a"](this.ngeoFeatures_,"add",this.handleNgeoFeaturesAdd_,this);S["a"](this.ngeoFeatures_,"remove",this.handleNgeoFeaturesRemove_,this)}if(this.featureHelper_){this.rootScope_.$on("$localeChangeSuccess",function(){b.forEach(function(e){g.featureHelper_.setStyle(e)})})}if(this.gmfThemeManager_){this.rootScope_.$on(n["a"].EventType.THEME_NAME_SET,function(e,t){g.setThemeInUrl_(t)})}this.setExternalDataSourcesStatePromise_=null;if(this.ngeoQuerent_&&this.gmfExternalDataSourcesManager_){this.initExternalDataSources_().then(function(){S["a"](g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g);S["a"](g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g);S["a"](g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g);S["a"](g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g);for(var e=g.gmfExternalDataSourcesManager_.wmsGroups,t=Array.isArray(e),r=0,e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{r=e.next();if(r.done)break;a=r.value}var n=a;g.registerExternalDSGroup_(n)}for(var i=g.gmfExternalDataSourcesManager_.wmtsGroups,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var u=l;g.registerExternalDSGroup_(u)}})}this.initLayers_()};P.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation","gmfUser"];P.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation","gmfUser"];P.prototype.getMapCenter=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_X);var t=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_Y);if(!isNaN(e)&&!isNaN(t)){var r=[e,t];if(this.sourceProjections_!==null&&this.ngeoAutoProjection_){var n=this.map_.getView().getProjection();var i=this.ngeoAutoProjection_.tryProjectionsWithInversion(r,n.getExtent(),n,this.sourceProjections_);if(i){return i}}return r}return null};P.prototype.getMapZoom=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.MAP_Z);return isNaN(e)?undefined:e};P.prototype.getMapCrosshair=function(){var e=this.ngeoStateManager_.getInitialBooleanValue(a["a"].PermalinkParam.MAP_CROSSHAIR);return e===undefined?this.crosshairEnabledByDefault_:e};P.prototype.setMapCrosshair=function(e){var t=void 0;if(e){t=e}else{t=this.map_.getView().getCenter()}y["a"].assertArray(t);if(this.crosshairFeature_){this.featureOverlay_.removeFeature(this.crosshairFeature_)}this.crosshairFeature_=new C["a"](new T["a"](t));this.crosshairFeature_.setStyle(this.crosshairStyle_);this.featureOverlay_.addFeature(this.crosshairFeature_)};P.prototype.getMapTooltip=function(){return this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.MAP_TOOLTIP)};P.prototype.setMapTooltip=function(t,r){var a=void 0;if(r){a=r}else{a=this.map_.getView().getCenter()}y["a"].assertArray(a);var n=e("<div/>",{class:"gmf-permalink-tooltip",text:t})[0];if(this.mapTooltip_!==null){this.map_.removeOverlay(this.mapTooltip_)}this.mapTooltip_=new o["a"]({element:n,position:a});this.map_.addOverlay(this.mapTooltip_)};P.prototype.getFeatures=function(){var e=this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.FEATURES);if(e!==undefined&&e!==""){return y["a"].assert(this.featureHashFormat_.readFeatures(e))}return[]};P.prototype.setDimensions=function(e){var t=this;var r=this.ngeoLocation_.getParamKeysWithPrefix(P.ParamPrefix.DIMENSIONS);for(var a=0;a<r.length;a++){var n=r[a];var i=this.ngeoLocation_.getParam(n);y["a"].assert(i);e[n.slice(P.ParamPrefix.DIMENSIONS.length)]=i}this.rootScope_.$watchCollection(function(){return e},function(e){var r={};for(var a in e){r[P.ParamPrefix.DIMENSIONS+a]=e[a]}t.ngeoLocation_.updateParams(r)})};P.prototype.setMap=function(e){var t=this;if(e===this.map_){return}if(this.map_){this.unregisterMap_();this.map_=null}if(e){this.map_=e;if(this.gmfObjectEditingManager_){this.gmfObjectEditingManager_.getFeature().then(function(r){t.registerMap_(e,r)})}else{this.registerMap_(e,null)}}};P.prototype.registerMap_=function(e,t){var r=this;var n=e.getView();var i=void 0;var o=typeof t!=="undefined"&&t!==null?t.getGeometry():undefined;if(o){var s=e.getSize();y["a"].assert(s);var l=void 0;if(o instanceof T["a"]||o instanceof w["a"]){l=this.pointRecenterZoom_}n.fit(o.getExtent(),{size:s,maxZoom:l})}else{var u=this.ngeoStateManager_.getInitialBooleanValue(c["a"].Permalink3dParam.ENABLED);if(!u){i=this.getMapCenter();if(i){n.setCenter(i)}var f=this.getMapZoom();if(f!==undefined){n.setZoom(f)}}}this.mapViewPropertyChangeEventKey_=S["a"](n,"propertychange",this.ngeoDebounce_(function(){var e=n.getCenter();var t=n.getZoom();var i={};i[a["a"].PermalinkParam.MAP_X]=Math.round(e[0]);i[a["a"].PermalinkParam.MAP_Y]=Math.round(e[1]);i[a["a"].PermalinkParam.MAP_Z]=t;r.ngeoStateManager_.updateState(i)},300,true),this);if(this.getMapCrosshair()&&this.featureOverlay_){this.setMapCrosshair(i)}var h=this.getMapTooltip();if(h){this.setMapTooltip(h,i)}var p=this.getWfsPermalinkData_();if(p!==null&&this.ngeoWfsPermalink_){this.ngeoWfsPermalink_.issue(p,e)}};P.prototype.unregisterMap_=function(){y["a"].assert(this.mapViewPropertyChangeEventKey_,"Key should be thruthy");S["e"](this.mapViewPropertyChangeEventKey_);this.mapViewPropertyChangeEventKey_=null};P.prototype.getBackgroundLayer=function(e){var t=this.ngeoStateManager_.getInitialStringValue(a["a"].PermalinkParam.BG_LAYER);if(t!==undefined){for(var r=e,n=Array.isArray(r),i=0,r=n?r:r[Symbol.iterator]();;){var o;if(n){if(i>=r.length)break;o=r[i++]}else{i=r.next();if(i.done)break;o=i.value}var s=o;if(s.get("label")===t){return s}}}return null};P.prototype.getBackgroundLayerOpacity=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a["a"].PermalinkParam.BG_LAYER_OPACITY);return e===undefined?undefined:e/100};P.prototype.handleBackgroundLayerManagerChange_=function(){var e=this;if(!this.map_||!this.ngeoBackgroundLayerMgr_){return}var t=this.ngeoBackgroundLayerMgr_.get(this.map_);var r=t.get("label");y["a"].assertString(r);var n={};n[a["a"].PermalinkParam.BG_LAYER]=r;this.ngeoStateManager_.updateState(n);var i=this.ngeoBackgroundLayerMgr_.getOpacityBgLayer(this.map_);if(i){var o=this.getBackgroundLayerOpacity();if(o!==undefined){i.setOpacity(o)}else{var s=i.getOpacity();var l={};l[a["a"].PermalinkParam.BG_LAYER_OPACITY]=""+s*100;this.ngeoStateManager_.updateState(l)}S["a"](i,"change:opacity",function(){var t=i.getOpacity();var r={};r[a["a"].PermalinkParam.BG_LAYER_OPACITY]=""+t*100;e.ngeoStateManager_.updateState(r)})}};P.prototype.refreshFirstLevelGroups=function(){if(!this.gmfTreeManager_){return}var e=this.gmfTreeManager_.rootCtrl.node.children;var t=e.map(function(e){return e.name});var r={};r[a["a"].PermalinkParam.TREE_GROUPS]=t.join(",");this.ngeoStateManager_.updateState(r)};P.prototype.themeInUrl_=function(e){var t=e.indexOf("theme");return t!=-1&&t==e.length-2};P.prototype.setThemeInUrl_=function(e){if(e){var t=this.ngeoLocation_.getPath().split("/");y["a"].assert(t.length>1);if(t[t.length-1]===""){t.splice(t.length-1)}if(this.themeInUrl_(t)){t[t.length-1]=e}else{t.push("theme",e)}this.ngeoLocation_.setPath(t.join("/"))}};P.prototype.defaultThemeName=function(){var e=this.ngeoLocation_.getPath().split("/");if(this.themeInUrl_(e)){return decodeURI(e[e.length-1])}var t=this.ngeoStateManager_.getInitialStringValue("theme");if(t){return t}var r=this.defaultThemeNameFromFunctionalities();if(r!==null){return r}if(this.defaultTheme_){return this.defaultTheme_}return null};P.prototype.defaultThemeNameFromFunctionalities=function(){if(!this.gmfUser_){return null}var e=this.gmfUser_.functionalities;if(e&&"default_theme"in e){var t=e.default_theme;if(t.length>0){return t[0]}}return null};P.prototype.initLayers_=function(){var e=this;var t=window.location.href;var r=false;if(!this.gmfThemes_){return}this.gmfThemes_.getThemesObject().then(function(n){var o=e.defaultThemeName();y["a"].assert(o!==null);if(e.gmfThemeManager_){e.gmfThemeManager_.setThemeName(e.gmfThemeManager_.modeFlush?o:"")}var s=[];var l=void 0;var u=e.ngeoLocation_.getParam(a["a"].PermalinkParam.TREE_GROUPS);if(u===undefined){y["a"].assertString(o);l=i["a"].findThemeByName(n,o);if(l){s=l.children}}else{u.split(",").forEach(function(e){var t=i["a"].findGroupByName(n,e);if(t){s.push(t)}else{r=true}})}if(e.gmfTreeManager_){e.gmfTreeManager_.setFirstLevelGroups(s)}e.$timeout_(function(){if(!e.gmfTreeManager_||!e.gmfTreeManager_.rootCtrl){if(r&&e.user_.role_id===null){e.rootScope_.$broadcast("authenticationrequired",{url:t})}return}e.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(t){if(t.isRoot){return}var a=e.ngeoStateManager_.getInitialNumberValue((t.parent.node.mixed?P.ParamPrefix.TREE_OPACITY:P.ParamPrefix.TREE_GROUP_OPACITY)+t.node.name);if(a!==undefined&&t.layer){t.layer.setOpacity(a)}if(t.parent.node&&t.parent.node.mixed&&t.node.children==undefined){var n=e.ngeoStateManager_.getInitialBooleanValue(P.ParamPrefix.TREE_ENABLE+t.node.name);if(n!==undefined){t.setState(n?"on":"off",false)}}else if(!t.node.mixed&&t.depth==1){var i=e.ngeoStateManager_.getInitialStringValue(P.ParamPrefix.TREE_GROUP_LAYERS+t.node.name);if(i!==undefined){var o=i==""?[]:i.split(",");t.traverseDepthFirst(function(e){if(e.node.children===undefined){var t=b["f"](o,e.node.name);if(t){o.splice(o.indexOf(e.node.name),1)}e.setState(t?"on":"off",false)}});if(o.length>0){r=true}}}});var a=e.gmfTreeManager_.rootCtrl.children;a.forEach(function(t){t.traverseDepthFirst(function(r){if(r.getState()!=="indeterminate"){e.rootScope_.$broadcast("ngeo-layertree-state",r,t);return v["a"].VisitorDecision.STOP}})});if(r&&e.user_.role_id===null){e.rootScope_.$broadcast("authenticationrequired",{url:t})}})})};P.prototype.handleNgeoFeaturesAdd_=function(e){var t=e.element;y["a"].assertInstanceof(t,C["a"]);this.addNgeoFeature_(t)};P.prototype.handleNgeoFeaturesRemove_=function(e){var t=e.element;y["a"].assertInstanceof(t,C["a"]);this.removeNgeoFeature_(t)};P.prototype.addNgeoFeature_=function(e){var t=_["c"](e);this.ngeoEventHelper_.addListenerKey(t,S["a"](e,"change",this.ngeoDebounce_(this.handleNgeoFeaturesChange_,250,true),this))};P.prototype.removeNgeoFeature_=function(e){var t=_["c"](e);this.ngeoEventHelper_.clearListenerKey(t);this.handleNgeoFeaturesChange_()};P.prototype.handleNgeoFeaturesChange_=function(){if(!this.ngeoFeatures_){return}var e=this.ngeoFeatures_.getArray();var t=this.featureHashFormat_.writeFeatures(e);var r={};r[a["a"].PermalinkParam.FEATURES]=t;this.ngeoStateManager_.updateState(r)};P.prototype.getWfsPermalinkData_=function(){var e=this.ngeoLocation_.getParam(a["a"].PermalinkParam.WFS_LAYER);if(!e){return null}var t=this.ngeoLocation_.getParamAsInt(a["a"].PermalinkParam.WFS_NGROUPS);var r=this.ngeoLocation_.getParamKeysWithPrefix(P.ParamPrefix.WFS);var n=[];var i=void 0;if(t===undefined){i=this.createFilterGroup_(P.ParamPrefix.WFS,r);if(i!==null){n.push(i)}}else{for(var o=0;o<t;o++){i=this.createFilterGroup_(P.ParamPrefix.WFS+o+"_",r);if(i!==null){n.push(i)}}}if(n.length==0){return null}var s=this.ngeoLocation_.getParam(a["a"].PermalinkParam.WFS_SHOW_FEATURES);var l=!(s==="0"||s==="false");return{wfsType:e,showFeatures:l,filterGroups:n}};P.prototype.createFilterGroup_=function(e,t){var r=this;var n=[];t.forEach(function(t){if(t==a["a"].PermalinkParam.WFS_LAYER||t==a["a"].PermalinkParam.WFS_SHOW_FEATURES||t==a["a"].PermalinkParam.WFS_NGROUPS||t.indexOf(e)!=0){return}var i=r.ngeoLocation_.getParam(t);if(!i){return}var o=i;if(i.indexOf(",")>-1){o=i.split(",")}var s={property:t.replace(e,""),condition:o};n.push(s)});return n.length>0?{filters:n}:null};P.prototype.initExternalDataSources_=function(){var e=this;var t=y["a"].assert(this.ngeoQuerent_);var r=y["a"].assert(this.gmfExternalDataSourcesManager_);var n=[];var i=this.ngeoStateManager_.getInitialValue(a["a"].PermalinkParam.EXTERNAL_DATASOURCES_NAMES);var o=this.ngeoStateManager_.getInitialValue(a["a"].PermalinkParam.EXTERNAL_DATASOURCES_URLS);if(i&&o){var s=i.split(P.ExtDSSeparator.LIST);var l=o.split(P.ExtDSSeparator.LIST);var c=function r(a,i){var o=s[a];if(!o){return"break"}var c=o.split(P.ExtDSSeparator.NAMES);var f=l[a];var h=u["a"].guessServiceTypeByUrl(f);var p=e.q_.defer();n.push(p.promise);if(h===u["a"].Type.WMS){t.wmsGetCapabilities(f).then(function(e){p.resolve({capabilities:e,groupLayerNames:c,serviceType:h,url:f})},function(){p.reject({groupLayerNames:c,serviceType:h,url:f})})}else if(h===u["a"].Type.WMTS){t.wmtsGetCapabilities(f).then(function(e){p.resolve({capabilities:e,groupLayerNames:c,serviceType:h,url:f})},function(){p.reject({groupLayerNames:c,serviceType:h,url:f})})}else{p.reject({groupLayerNames:c,serviceType:h,url:f})}};for(var f=0,h=l.length;f<h;f++){var p=c(f,h);if(p==="break")break}}return this.q_.all(n).then(function(e){for(var a=e,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.serviceType===u["a"].Type.WMS){for(var l=s.groupLayerNames,c=Array.isArray(l),f=0,l=c?l:l[Symbol.iterator]();;){var h;if(c){if(f>=l.length)break;h=l[f++]}else{f=l.next();if(f.done)break;h=f.value}var p=h;var d=t.wmsFindLayerCapability(s.capabilities["Capability"]["Layer"]["Layer"],p);if(d){r.createAndAddDataSourceFromWMSCapability(d,s.capabilities,s.url)}else{}}}else if(s.serviceType===u["a"].Type.WMTS){for(var g=s.groupLayerNames,m=Array.isArray(g),v=0,g=m?g:g[Symbol.iterator]();;){var y;if(m){if(v>=g.length)break;y=g[v++]}else{v=g.next();if(v.done)break;y=v.value}var _=y;var b=t.wmtsFindLayerCapability(s.capabilities["Contents"]["Layer"],_);if(b){r.createAndAddDataSourceFromWMTSCapability(b,s.capabilities,s.url)}else{}}}}},function(e){})};P.prototype.handleExternalDSGroupCollectionAdd_=function(e){var t=e.element;y["a"].assertInstanceof(t,l["a"]);this.registerExternalDSGroup_(t);this.setExternalDataSourcesState_()};P.prototype.registerExternalDSGroup_=function(e){S["a"](e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this);S["a"](e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)};P.prototype.containsLayerName=function(e,t){if(e instanceof L["a"]){for(var r=e.getLayers().getArray(),a=Array.isArray(r),n=0,r=a?r:r[Symbol.iterator]();;){var i;if(a){if(n>=r.length)break;i=r[n++]}else{n=r.next();if(n.done)break;i=n.value}var o=i;y["a"].assert(o);if(this.containsLayerName(o,t)){return true}}return false}else{return e.get("layerNodeName")==t}};P.prototype.handleExternalDSGroupCollectionRemove_=function(e){var t=e.element;y["a"].assertInstanceof(t,l["a"]);this.unregisterExternalDSGroup_(t);this.setExternalDataSourcesState_()};P.prototype.unregisterExternalDSGroup_=function(e){S["c"](e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this);S["c"](e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)};P.prototype.setExternalDataSourcesState_=function(){var e=this;if(this.setExternalDataSourcesStatePromise_){this.$timeout_.cancel(this.setExternalDataSourcesStatePromise_)}this.setExternalDataSourcesStatePromise_=this.$timeout_(function(){var t;var r=[];var n=[];for(var i=e.gmfExternalDataSourcesManager_.wmsGroups,o=Array.isArray(i),s=0,i=o?i:i[Symbol.iterator]();;){var l;if(o){if(s>=i.length)break;l=i[s++]}else{s=i.next();if(s.done)break;l=s.value}var c=l;n.push(c.url);var f=[];for(var h=c.dataSources,p=Array.isArray(h),d=0,h=p?h:h[Symbol.iterator]();;){var g;if(p){if(d>=h.length)break;g=h[d++]}else{d=h.next();if(d.done)break;g=d.value}var m=g;y["a"].assertInstanceof(m,u["a"]);var v=m.getOGCLayerNames()[0];f.push(v)}r.push(f.join(P.ExtDSSeparator.NAMES))}for(var _=e.gmfExternalDataSourcesManager_.wmtsGroups,b=Array.isArray(_),S=0,_=b?_:_[Symbol.iterator]();;){var C;if(b){if(S>=_.length)break;C=_[S++]}else{S=_.next();if(S.done)break;C=S.value}var w=C;n.push(w.url);var T=[];for(var E=w.dataSources,A=Array.isArray(E),L=0,E=A?E:E[Symbol.iterator]();;){var M;if(A){if(L>=E.length)break;M=E[L++]}else{L=E.next();if(L.done)break;M=L.value}var x=M;y["a"].assert(x.wmtsLayer);T.push(x.wmtsLayer)}r.push(T.join(P.ExtDSSeparator.NAMES))}e.ngeoStateManager_.updateState((t={},t[a["a"].PermalinkParam.EXTERNAL_DATASOURCES_NAMES]=r.join(P.ExtDSSeparator.LIST),t[a["a"].PermalinkParam.EXTERNAL_DATASOURCES_URLS]=n.join(P.ExtDSSeparator.LIST),t));e.setExternalDataSourcesStatePromise_=null})};P.prototype.cleanParams=function(e){var t=this;var r=y["a"].assert(this.ngeoLocation_.getParamKeys());for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.startsWith(P.ParamPrefix.TREE_GROUP_LAYERS)){var l=s.substring(P.ParamPrefix.TREE_GROUP_LAYERS.length);for(var u=e,c=Array.isArray(u),f=0,u=c?u:u[Symbol.iterator]();;){var h;if(c){if(f>=u.length)break;h=u[f++]}else{f=u.next();if(f.done)break;h=f.value}var p=h;if(p.name==l){this.ngeoStateManager_.deleteParam(s);break}}}if(s.startsWith(P.ParamPrefix.TREE_GROUP_OPACITY)){var d=s.substring(P.ParamPrefix.TREE_GROUP_OPACITY.length);for(var g=e,m=Array.isArray(g),v=0,g=m?g:g[Symbol.iterator]();;){var _;if(m){if(v>=g.length)break;_=g[v++]}else{v=g.next();if(v.done)break;_=v.value}var b=_;if(b.name==d){this.ngeoStateManager_.deleteParam(s);break}}}}this.$timeout_(function(){if(!t.map_){return}var e=t.map_.getLayerGroup();y["a"].assert(e);for(var a=r,n=Array.isArray(a),i=0,a=n?a:a[Symbol.iterator]();;){var o;if(n){if(i>=a.length)break;o=a[i++]}else{i=a.next();if(i.done)break;o=i.value}var s=o;if(s.startsWith(P.ParamPrefix.TREE_ENABLE)){var l=s.substring(P.ParamPrefix.TREE_ENABLE.length);if(!t.containsLayerName(e,l)){t.ngeoStateManager_.deleteParam(s)}}if(s.startsWith(P.ParamPrefix.TREE_OPACITY)){var u=s.substring(P.ParamPrefix.TREE_OPACITY.length);if(!t.containsLayerName(e,u)){t.ngeoStateManager_.deleteParam(s)}}}})};P.module=angular.module("gmfPermalink",[n["a"].module.name,i["a"].module.name,s["a"].name,v["a"].module.name,p["a"].name,d["a"].module.name,g["a"].name]);P.module.service("gmfPermalink",P);P.OpenLayersLayerProperties={OPACITY:"opacity"};P.ParamPrefix={DIMENSIONS:"dim_",TREE_ENABLE:"tree_enable_",TREE_GROUP_LAYERS:"tree_group_layers_",TREE_GROUP_OPACITY:"tree_group_opacity_",TREE_OPACITY:"tree_opacity_",WFS:"wfs_"};P.ExtDSSeparator={LIST:",",NAMES:";"};P.module.value("gmfPermalinkOptions",{});(function(){var e=[];for(var t in P.ParamPrefix){e.push(new RegExp(P.ParamPrefix[t]+".*"))}for(var r in a["a"].PermalinkParam){e.push(new RegExp(P.ParamPrefix[r]))}m["a"].module.value("ngeoUsedKeyRegexp",e)})();t["a"]=P}).call(this,r(36))},function(e,t,r){"use strict";(function(e){var a=r(2);var n=r(198);var i=r(424);var o=r.n(i);var s=r(490);var l=r.n(s);var u=r(423);var c=r.n(u);var f=r(422);var h=r.n(f);var p=r(421);var d=r.n(p);var g=r(420);var m=r.n(g);var v=angular.module("ngeoDatePicker",[n["a"].module.name,"ui.date"]);v.value("ngeoDatePickerTemplateUrl",function(e,t){var r=t["ngeoDatePickerTemplateUrl"];return r!==undefined?r:"ngeo/misc/datepickerComponent"});v.run(["$templateCache",function(e){e.put("ngeo/misc/datepickerComponent",r(419))}]);v.component_=function(t,r){return{scope:{onDateSelected:"&",time:"="},bindToController:true,controller:"ngeoDatePickerController as datepickerCtrl",restrict:"AE",templateUrl:t,link:function t(a,n,i,o){o.init();var s=o.gettextCatalog_.getCurrentLanguage();e["datepicker"]["setDefaults"](e["datepicker"]["regional"][s]);o.sdateOptions=angular.extend({},o.sdateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function t(r){if(r){e(n[0]).find('input[name="edate"]').datepicker("option","minDate",r)}}});o.edateOptions=angular.extend({},o.edateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function t(r){if(r){e(n[0]).find('input[name="sdate"]').datepicker("option","maxDate",r)}}});angular.element("body").on("hidden.bs.popover",function(){var t=angular.element("#ui-datepicker-div");if(t&&t.css("display")==="block"){e(n[0]).find('input[name$="date"]').datepicker("hide")}});r(function(){angular.element("#ui-datepicker-div").on("mousedown",function(e){e.stopPropagation()})})}}};v.component_.$inject=["ngeoDatePickerTemplateUrl","$timeout"];v.directive("ngeoDatePicker",v.component_);v.Controller_=function(e,t,r,a){var n=this;this.ngeoTime_=r;this.time;this.gettextCatalog_=a;this.isModeRange;this.onDateSelected;this.initialMinDate;this.initialMaxDate;this.edateOptions={changeMonth:true,changeYear:true};this.sdateOptions={changeMonth:true,changeYear:true};this.sdate;this.edate;e.$watchGroup(["datepickerCtrl.sdate","datepickerCtrl.edate"],function(e,t){var r=e[0];var a=e[1];if(angular.isDate(r)&&(!n.isModeRange||angular.isDate(a))){n.onDateSelected({time:{start:n.ngeoTime_.getTime(r),end:n.ngeoTime_.getTime(a)}})}})};v.Controller_.$inject=["$scope","$injector","ngeoTime","gettextCatalog"];v.Controller_.prototype.init=function(){var e=this.ngeoTime_.getOptions(this.time);this.initialMinDate=this.ngeoTime_.createDate(e.minDate);this.initialMaxDate=this.ngeoTime_.createDate(e.maxDate);this.isModeRange=this.time.mode==="range";if(this.isModeRange){a["a"].assertArray(e.values);this.sdate=this.ngeoTime_.createDate(e.values[0]);this.edate=this.ngeoTime_.createDate(e.values[1])}else{a["a"].assertNumber(e.values);this.sdate=this.ngeoTime_.createDate(e.values)}};v.controller("ngeoDatePickerController",v.Controller_);t["a"]=v}).call(this,r(36))},,,,,function(e,t,r){"use strict";var a=r(38);var n={};n.setGeometryType=function(e,t){var r=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;if(r.exec(t)){e.type=a["a"].GEOMETRY;if(/^gml:Point/.exec(t)){e.geomType="Point"}else if(/^gml:LineString|^gml:Curve/.exec(t)){e.geomType="LineString"}else if(/^gml:Polygon|^gml:Surface/.exec(t)){e.geomType="Polygon"}else if(/^gml:MultiPoint/.exec(t)){e.geomType="MultiPoint"}else if(/^gml:MultiLineString|^gml:MultiCurve/.exec(t)){e.geomType="MultiLineString"}else if(/^gml:MultiPolygon|^gml:MultiSurface/.exec(t)){e.geomType="MultiPolygon"}}return!!e.type&&!!e.geomType};t["a"]=n},function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=function(){e.$inject=["$http","gmfLayersUrl"];function e(t,r){a(this,e);this.http_=t;this.baseUrl_=r;this.promises_={}}e.prototype.getAttributeValues=function e(t,r){var a=t.id+"_"+r;var n=t.name;if(!this.promises_[a]){var i=this.baseUrl_+"/"+n+"/values/"+r;this.promises_[a]=this.http_.get(i).then(this.handleGetAttributeValues_.bind(this))}return this.promises_[a]};e.prototype.handleGetAttributeValues_=function e(t){var r=t.data;return r.items};return e}();n.module=angular.module("gmfEnumerateAttribute",[]);n.module.service("gmfEnumerateAttribute",n);t["a"]=n},,,,,,,,function(e,t,r){"use strict";var a=function e(t,r,a){var n=void 0,i=void 0;this.isValidFileSize=function(e){return!(e>2e7)};this.isWmsGetCap=function(e){return/<(WMT_MS_Capabilities|WMS_Capabilities)/.test(e)};this.isWmtsGetCap=function(e){return/<Capabilities/.test(e)};this.isKml=function(e){return/<kml/.test(e)&&/<\/kml>/.test(e)};this.isGpx=function(e){return/<gpx/.test(e)&&/<\/gpx>/.test(e)};this.read=function(e){var r=t.defer();if(n&&n.readyState===FileReader.LOADING){n.abort()}n=new FileReader;n.onload=function(e){r.resolve(e.target.result)};n.onerror=function(e){var t=e.target.error;console.error("Reading file failed: ",t);r.reject({message:t.code==20?a("Operation canceled"):a("Read failed"),reason:t.message})};n.onprogress=function(e){r.notify(e)};n.readAsText(e);return r.promise};this.load=function(e,n){if(i){i.resolve()}i=n||t.defer();var o=t.defer();r.get(e,{timeout:i.promise}).then(function(e){o.resolve(e.data)},function(e){console.error("Uploading file failed: ",e);o.reject({message:a("Upload failed"),reason:e})});return o.promise}};a.$inject=["$q","$http","gettext"];a.$inject=["$q","$http","gettext"];a.module=angular.module("ngeoFile",[]);a.module.service("ngeoFile",a);t["a"]=a},,,,,function(e,t,r){"use strict";(function(e){var a=r(263);var n=r(329);var i=r(333);var o=r(330);var s=r(286);var l=r(344);var u=r(336);var c=r(341);var f=r(231);var h=r(285);var p=r(69);var d=r(340);var g=r(334);var m=r(1);var v=r(11);var y=r(9);var _=r(18);var b=r(99);var S=r(226);var C=r(267);var w=r(221);var T=r(222);var E=r(272);var A=r(64);var L=r(57);var P=r(45);var M=r(53);var x=r(13);var F=r(104);var R=function t(r,n,i){var o=this;var s={projection:v["g"]("EPSG:"+(r.srid||21781))};y["a"](s,r.mapViewConfig||{});var l=a["a"].prototype.getLocationIcon();this.map=new b["a"]({pixelRatio:r.mapPixelRatio,layers:[],view:new S["a"](s),controls:r.mapControls||[new C["a"]({target:document.getElementById("scaleline")}),new w["a"]({zoomInTipLabel:"",zoomOutTipLabel:""}),new T["a"]({label:l,tipLabel:""})],interactions:r.mapInteractions||E["a"]({pinchRotate:true,altShiftDragRotate:true}),loadTilesWhileAnimating:true,loadTilesWhileInteracting:true});this.loginActive=false;this.toolsActive=false;this.modalShareShown=false;this.editFeatureActive=false;this.routingfeatureActive=false;this.googleStreetViewActive=false;this.googleStreetViewStyle=new x["c"]({text:new F["a"]({fill:new P["a"]({color:"#279B61"}),font:"normal 30px FontAwesome",offsetY:-15,stroke:new M["a"]({color:"#ffffff",width:3}),text:""})});this.importDataSourceActive=false;var u=e("body");u.tooltip({container:"body",trigger:"hover",selector:'[data-toggle="tooltip"]'});u.on("touchstart.detectTouch",function(){u.tooltip("destroy");u.off("touchstart.detectTouch")});var c=i.get("ngeoFeatures");this.drawFeatureLayer=i.get("ngeoFeatureOverlayMgr").getFeatureOverlay();this.drawFeatureLayer.setFeatures(c);var f=i.get("ngeoFeatureHelper");this.editFeatureVectorLayer=new A["a"]({source:new L["b"]({wrapX:false,features:new _["b"]}),style:function e(t,r){return f.createEditingStyles(t)}});this.editFeatureVectorLayer.setMap(this.map);var h=i.get("ngeoToolActivateMgr");var d=new p["a"](this,"editFeatureActive");h.registerTool("mapTools",d,false);var g=new p["a"](this,"googleStreetViewActive");h.registerTool("mapTools",g,false);this.scaleSelectorOptions={dropup:true};this.profileLine=null;a["a"].call(this,r,n,i);n.$watch(function(){return o.gmfUser.username},function(e){if(e!==null&&o.loginActive){o.loginActive=false}})};R.$inject=["config","$scope","$injector"];R.$inject=["config","$scope","$injector"];m["d"](R,a["a"]);R.module=angular.module("GmfAbstractDesktopControllerModule",[a["a"].module.name,n["a"].name,i["a"].name,o["a"].name,s["a"].name,l["a"].name,u["a"].name,c["a"].name,f["a"].name,h["a"].name,d["a"].name,g["a"].name]);R.module.controller("AbstractDesktopController",R);R.module.value("isDesktop",true);R.module.value("ngeoQueryOptions",{limit:20});R.module.value("ngeoSnappingTolerance",20);R.module.value("ngeoSnappingSource",new L["b"]);R.module.value("ngeoMeasurePrecision",3);R.module.value("ngeoMeasureDecimals",0);t["a"]=R}).call(this,r(36))},,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(276);var n=r(2);var i=r(113);var o=r(11);var s=r(3);var l=r(9);var u=angular.module("gmfContextualdata",[a["a"].module.name]);u.directive_=function(){return{restrict:"A",scope:false,controller:"GmfContextualdataController as cdCtrl",bindToController:{map:"<gmfContextualdataMap",projections:"<gmfContextualdataProjections",callback:"<gmfContextualdataCallback"},link:function e(t,r,a,n){n.init()}}};u.directive("gmfContextualdata",u.directive_);u.Controller_=function(e,t,r,a,n){this.map;this.projections;this.callback;this.overlay_;this.$compile_=e;this.timeout_=t;this.$scope_=r;this.gmfRaster_=a;this.gmfContextualdataOptions_=n.has("gmfContextualdataOptions")?n.get("gmfContextualdataOptions"):{};angular.element("body").on("mousedown",this.hidePopover.bind(this))};u.Controller_.$inject=["$compile","$timeout","$scope","gmfRaster","$injector"];u.Controller_.prototype.init=function(){this.preparePopover_();var e=this.map.getTargetElement();n["a"].assertElement(e);s["a"](e,"contextmenu",this.handleMapContextMenu_,this)};u.Controller_.prototype.handleMapContextMenu_=function(e){var t=this;this.$scope_.$apply(function(){var r=t.map.getEventPixel(e);var a=t.map.getCoordinateFromPixel(r);t.setContent_(a);e.preventDefault();t.hidePopover();t.showPopover();t.timeout_(function(){t.overlay_.setPosition(a)})})};u.Controller_.prototype.setContent_=function(e){var t=this.$scope_.$new(true);this.$compile_(this.content_)(t);var r=this.map.getView().getProjection().getCode();this.projections.forEach(function(a){var n=o["l"](e,r,"EPSG:"+a);t["coord_"+a]=n;t["coord_"+a+"_eastern"]=n[0];t["coord_"+a+"_northern"]=n[1]});var a=function(r){l["a"](t,r);if(this.callback){l["a"](t,this.callback.call(this,e,r))}}.bind(this);var n=function e(t){console.error("Error on getting the raster.")};this.gmfRaster_.getRaster(e,this.gmfContextualdataOptions_.rasterParams).then(a,n)};u.Controller_.prototype.preparePopover_=function(){var e=document.createElement("DIV");e.classList.add("popover");e.classList.add("bottom");e.classList.add("gmf-contextualdata");angular.element(e).css("position","relative");var t=document.createElement("DIV");t.classList.add("arrow");e.appendChild(t);this.content_=document.createElement("DIV");this.content_.setAttribute("gmf-contextualdatacontent","");this.content_.classList.add("popover-content");e.appendChild(this.content_);this.overlay_=new i["a"]({element:e,stopEvent:true,autoPan:true,autoPanAnimation:{duration:250},positioning:"top-center"});this.map.addOverlay(this.overlay_)};u.Controller_.prototype.showPopover=function(){var e=this.overlay_.getElement();angular.element(e).css("display","block")};u.Controller_.prototype.hidePopover=function(){var e=this.overlay_.getElement();angular.element(e).css("display","none")};u.controller("GmfContextualdataController",u.Controller_);u.contentDirective_=function(e){return{restrict:"A",scope:true,templateUrl:e}};u.contentDirective_.$inject=["gmfContextualdatacontentTemplateUrl"];u.directive("gmfContextualdatacontent",u.contentDirective_);var c=u;var f=r(456);var h=angular.module("gmfContextualdataModule",[c.name]);var p=t["a"]=h},function(e,t,r){"use strict";var a=r(275);var n=r(173);var i=r(2);var o=r(132);var s=r(46);var l=angular.module("GmfEditingFeatureSelectorComponent",[n["a"].name,o["a"].module.name,s["a"].module.name]);l.run(["$templateCache",function(e){e.put("gmf/editing/editFeatureSelectorComponent",r(376))}]);l.component_=function(){return{controller:"GmfEditfeatureselectorController as efsCtrl",scope:{active:"=gmfEditfeatureselectorActive",map:"<gmfEditfeatureselectorMap",tolerance:"<?gmfEditfeatureselectorTolerance",vectorLayer:"<gmfEditfeatureselectorVector",selectedEditableTreeCtrl:"=?gmfEditfeatureselectorTree",closeAfterSave:"=?gmfEditfeatureselectorCloseaftersave"},bindToController:true,templateUrl:"gmf/editing/editFeatureSelectorComponent"}};l.directive("gmfEditfeatureselector",l.component_);l.Controller_=function(e,t,r,a){var o=this;this.active=this.active===true;e.$watch(function(){return o.active},this.handleActiveChange_.bind(this));this.map;this.tolerance;this.vectorLayer;this.closeAfterSave;this.scope_=e;this.$timeout_=t;this.gmfThemes_=r;this.gmfTreeManager_=a;var s=function e(t){var r=this;this.$timeout_(function(){if(t){var e=r.editableTreeCtrls;e.length=0;r.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(t){if(t.node.editable){i["a"].assert(t.children.length===0);e.push(t)}})}},0)};this.treeCtrlsWatcherUnregister_=e.$watchCollection(function(){if(a.rootCtrl){return a.rootCtrl.children}},s.bind(this));this.dirty=false;this.editableTreeCtrls=[];this.selectedEditableTreeCtrl=null;e.$watch(function(){return o.selectedEditableTreeCtrl},function(e,t){o.dirty=false;o.state=n["a"].State.IDLE});this.state=n["a"].State.IDLE;e.$watch(function(){return o.state},function(e,t){if(e===n["a"].State.STOP_EDITING_EXECUTE||e===n["a"].State.DEACTIVATE_EXECUTE){o.selectedEditableTreeCtrl=null}if(e===n["a"].State.DEACTIVATE_EXECUTE){o.active=false}});e.$on("$destroy",this.handleDestroy_.bind(this))};l.Controller_.$inject=["$scope","$timeout","gmfThemes","gmfTreeManager"];l.Controller_.prototype.stopEditing=function(){this.state=n["a"].State.STOP_EDITING_PENDING};l.Controller_.prototype.handleActiveChange_=function(e){var t=this;if(!e){if(!this.dirty){this.stopEditing()}else{this.$timeout_(function(){t.active=true;t.stopEditing()})}}};l.Controller_.prototype.handleDestroy_=function(){this.treeCtrlsWatcherUnregister_()};l.controller("GmfEditfeatureselectorController",l.Controller_);var u=l;var c=r(296);var f=r(228);var h=r(274);var p=angular.module("gmfEditingModule",[a["a"].module.name,n["a"].name,u.name,c["a"].module.name,f["a"].module.name,h["a"].module.name]);var d=t["a"]=p},function(e,t,r){"use strict";var a=r(2);var n=r(52);var i=r(1);var o=r(135);var s=r(57);var l=r(179);var u=r(12);var c=r(195);var f=r(79);var h=r(72);var p=function e(){this.geojsonFormat=new o["a"]};p.PrintStyleType={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"};p.PrintStyleTypes_={LineString:p.PrintStyleType.LINE_STRING,Point:p.PrintStyleType.POINT,Polygon:p.PrintStyleType.POLYGON,MultiLineString:p.PrintStyleType.LINE_STRING,MultiPoint:p.PrintStyleType.POINT,MultiPolygon:p.PrintStyleType.POLYGON};p.prototype.encodeVectorLayer=function(e,t,r){var n=t.getSource();a["a"].assertInstanceof(n,s["b"]);var o=n.getFeatures();var l=[];var u={version:2};for(var c=0,f=o.length;c<f;++c){var h=o[c];var p=null;var d=h.getStyleFunction()||t.getStyleFunction();if(d!==undefined){p=d.call(t,h,r)}var g=this.geojsonFormat.writeFeatureObject(h);var m=p!==null&&!Array.isArray(p)?[p]:p;a["a"].assert(Array.isArray(m));if(m!==null&&m.length>0){var v=false;for(var y=0,_=m.length;y<_;++y){var b=m[y];var S=b.getGeometry();var C=void 0;if(!S){C=g;S=h.getGeometry();if(!S){continue}if(!v){l.push(C);v=true}}else{var w=h.clone();w.setGeometry(S);C=this.geojsonFormat.writeFeatureObject(w);S=w.getGeometry();w=null;l.push(C)}var T=S.getType();if(C.properties===null){C.properties={}}var E="_ngeo_style_"+y;var A=i["c"](b).toString()+"-"+T;this.encodeVectorStyle(u,T,b,A,E);C.properties[E]=A}}}if(l.length>0){var L={type:"FeatureCollection",features:l};var P={geoJson:L,opacity:t.getOpacity(),style:u,type:"geojson"};e.push(P)}};p.prototype.encodeVectorStyle=function(e,t,r,a,n){if(!(t in p.PrintStyleTypes_)){return}var i=p.PrintStyleTypes_[t];var o="["+n+" = '"+a+"']";if(o in e){return}var s={symbolizers:[]};e[o]=s;var l=r.getFill();var u=r.getImage();var c=r.getStroke();var f=r.getText();if(i===p.PrintStyleType.POLYGON){if(l!==null){this.encodeVectorStylePolygon(s.symbolizers,l,c)}}else if(i===p.PrintStyleType.LINE_STRING){if(c!==null){this.encodeVectorStyleLine(s.symbolizers,c)}}else if(i===p.PrintStyleType.POINT){if(u!==null){this.encodeVectorStylePoint(s.symbolizers,u)}}if(f!==null){this.encodeTextStyle(s.symbolizers,f)}};p.prototype.encodeVectorStyleFill=function(e,t){var r=t.getColor();if(r!==null){a["a"].assert(typeof r==="string"||Array.isArray(r));r=h["a"](r);a["a"].assert(Array.isArray(r),"only supporting fill colors");e.fillColor=n["b"].rgbArrayToHex(r);e.fillOpacity=r[3]}};p.prototype.encodeVectorStyleLine=function(e,t){var r={type:"line"};this.encodeVectorStyleStroke(r,t);e.push(r)};p.prototype.encodeVectorStylePoint=function(e,t){var r=void 0;if(t instanceof f["a"]){r={type:"point"};r.pointRadius=t.getRadius();var a=t.getFill();if(a!==null){this.encodeVectorStyleFill(r,a)}var n=t.getStroke();if(n!==null){this.encodeVectorStyleStroke(r,n)}}else if(t instanceof c["a"]){var i=new URL(t.getSrc(),window.location.href).href;if(i!==undefined){r={type:"point",externalGraphic:i};var o=t.getOpacity();if(o!==null){r.graphicOpacity=o}var s=t.getSize();if(s!==null){var h=t.getScale();if(isNaN(h)){h=1}r.graphicWidth=s[0]*h;r.graphicHeight=s[1]*h}var p=t.getRotation();if(isNaN(p)){p=0}r.rotation=u["h"](p)}}else if(t instanceof l["a"]){var d=t.getPoints();if(d!==null){r={type:"point"};if(d===4){r.graphicName="square"}else if(d===3){r.graphicName="triangle"}else if(d===5){r.graphicName="star"}else if(d===8){r.graphicName="cross"}var g=t.getSize();if(g!==null){r.graphicWidth=g[0];r.graphicHeight=g[1]}var m=t.getRotation();if(!isNaN(m)&&m!==0){r.rotation=u["h"](m)}var v=t.getOpacity();if(v!==null){r.graphicOpacity=v}var y=t.getStroke();if(y!==null){this.encodeVectorStyleStroke(r,y)}var _=t.getFill();if(_!==null){this.encodeVectorStyleFill(r,_)}}}if(r!==undefined){e.push(r)}};p.prototype.encodeVectorStylePolygon=function(e,t,r){var a={type:"polygon"};this.encodeVectorStyleFill(a,t);if(r!==null){this.encodeVectorStyleStroke(a,r)}e.push(a)};p.prototype.encodeVectorStyleStroke=function(e,t){var r=t.getColor();if(r!==null){a["a"].assert(typeof r==="string"||Array.isArray(r));var i=h["a"](r);a["a"].assert(Array.isArray(i),"only supporting stroke colors");e.strokeColor=n["b"].rgbArrayToHex(i);e.strokeOpacity=i[3]}var o=t.getLineDash();if(o!==null){e.strokeDashstyle=o.join(" ")}var s=t.getWidth();if(s!==undefined){e.strokeWidth=s}var l=t.getLineCap();if(l){e.strokeLinecap=t.getLineCap()}};p.prototype.encodeTextStyle=function(e,t){var r={type:"Text"};var i=t.getText();if(i!==undefined){r.label=i;var o="c";var s="m";var l=t.getTextAlign();if(l==="left"||l==="start"){o="l"}else if(l==="right"||l==="end"){o="r"}var u=t.getTextBaseline();if(u==="bottom"){s="l"}else if(u==="top"){s="t"}r.labelAlign=""+o+s;var c=t.getRotation();if(c!==undefined){r.labelRotation=(c*180/Math.PI).toString();r.labelAlign="cm"}var f=t.getFont();if(f!==undefined){var p=f.split(" ");if(p.length>=3){r.fontWeight=p[0];r.fontSize=p[1];r.fontFamily=p.splice(2).join(" ")}}var d=t.getStroke();if(d!==null){var g=d.getColor();a["a"].assert(typeof g==="string"||Array.isArray(g));var m=h["a"](g);a["a"].assert(Array.isArray(m),"only supporting stroke colors");r.haloColor=n["b"].rgbArrayToHex(m);r.haloOpacity=m[3];var v=d.getWidth();if(v!==undefined){r.haloRadius=v/2}}var y=t.getFill();if(y!==null){var _=y.getColor();a["a"].assert(typeof _==="string"||Array.isArray(_));var b=h["a"](_);a["a"].assert(Array.isArray(b),"only supporting fill colors");r.fontColor=n["b"].rgbArrayToHex(b)}if(r.labelAlign!==undefined){r.labelXOffset=t.getOffsetX();r.labelYOffset=-t.getOffsetY()}e.push(r)}};var d=p;var g=r(101);var m=r(7);var v=r(9);var y=r(114);var _=r(93);var b=r(64);var S=r(89);var C=r(126);var w=r(156);var T=r(149);var E=r(305);var A=function e(t,r,a,n){this.url_=t;this.$http_=r;this.gettextCatalog_=a;this.ngeoLayerHelper_=n;this.vectorEncoder=new d;this.printNativeAngle_=true};A.$inject=["url","$http","gettextCatalog","ngeoLayerHelper"];A.prototype.cancel=function(e,t){var r=t!==undefined?t:{};var a=this.url_+"/cancel/"+e;return this.$http_["delete"](a,r)};A.prototype.createSpec=function(e,t,r,a,n,i){var o={dpi:r,rotation:i["rotation"]};this.encodeMap_(e,t,o);var s={map:o};v["a"](s,i);var l=this.gettextCatalog_.currentLanguage;var u={attributes:s,format:n,lang:l,layout:a};return u};A.prototype.encodeMap_=function(e,t,r){var n=this;var i=e.getView();var o=i.getCenter();var s=i.getProjection();var l=i.getResolution();var c=r.rotation||u["h"](i.getRotation());a["a"].assert(o!==undefined);a["a"].assert(s!==undefined);r.center=o;r.projection=s.getCode();r.rotation=c;r.scale=t;r.layers=[];var f=e.getLayerGroup();a["a"].assert(f);this.printNativeAngle_=!(f.get("printNativeAngle")===false);var h=this.ngeoLayerHelper_.getFlatLayers(f);m["l"](h,function(e,t){return e.getZIndex()-t.getZIndex()});h=h.slice().reverse();h.forEach(function(e){if(e.getVisible()){a["a"].assert(l!==undefined);n.encodeLayer(r.layers,e,l)}})};A.prototype.encodeLayer=function(e,t,r){if(t instanceof y["a"]){this.encodeImageLayer_(e,t)}else if(t instanceof _["a"]){this.encodeTileLayer_(e,t)}else if(t instanceof b["a"]){this.encodeVectorLayer(e,t,r)}};A.prototype.encodeVectorLayer=function(e,t,r){this.vectorEncoder.encodeVectorLayer(e,t,r)};A.prototype.encodeImageLayer_=function(e,t){a["a"].assertInstanceof(t,y["a"]);var r=t.getSource();if(r instanceof C["a"]){this.encodeImageWmsLayer_(e,t)}};A.prototype.encodeImageWmsLayer_=function(e,t){var r=t.getSource();a["a"].assertInstanceof(t,y["a"]);a["a"].assertInstanceof(r,C["a"]);var n=r.getUrl();if(n!==undefined){this.encodeWmsLayer_(e,t,n,r.getParams())}};A.prototype.encodeWmsLayer_=function(e,t,r,a){if(r.startsWith("//")){r=window.location.protocol+r}var n=new URL(r);var i={TRANSPARENT:true};if(n.searchParams){n.searchParams.forEach(function(e,t){i[t]=e})}for(var o in a){var s=a[o];if(s!==null&&s!==undefined){i[o]=s}}delete i["LAYERS"];delete i["FORMAT"];delete i["SERVERTYPE"];delete i["VERSION"];var l={baseURL:A.getAbsoluteUrl_(n.origin+n.pathname),imageFormat:"FORMAT"in a?a["FORMAT"]:"image/png",layers:a["LAYERS"].split(","),customParams:i,serverType:a["SERVERTYPE"],type:"wms",opacity:this.getOpacityOrInherited_(t),version:a["VERSION"],useNativeAngle:this.printNativeAngle_};e.push(l)};A.getAbsoluteUrl_=function(e){var t=document.createElement("a");t.href=encodeURI(e);return decodeURI(t.href)};A.prototype.encodeTileLayer_=function(e,t){a["a"].assertInstanceof(t,_["a"]);var r=t.getSource();if(r instanceof T["a"]){this.encodeTileWmtsLayer_(e,t)}else if(r instanceof w["a"]){this.encodeTileWmsLayer_(e,t)}};A.prototype.encodeTileWmtsLayer_=function(e,t){a["a"].assertInstanceof(t,_["a"]);var r=t.getSource();a["a"].assertInstanceof(r,T["a"]);var n=r.getProjection();var i=r.getTileGrid();a["a"].assertInstanceof(i,E["b"]);var o=i.getMatrixIds();var s=[];for(var l=0,u=o.length;l<u;++l){var c=i.getFullTileRange(l);s.push({identifier:o[l],scaleDenominator:i.getResolution(l)*n.getMetersPerUnit()/28e-5,tileSize:S["d"](i.getTileSize(l)),topLeftCorner:i.getOrigin(l),matrixSize:[c.maxX-c.minX,c.maxY-c.minY]})}var f=r.getDimensions();var h=Object.keys(f);var p={baseURL:this.getWmtsUrl_(r),dimensions:h,dimensionParams:f,imageFormat:r.getFormat(),layer:r.getLayer(),matrices:s,matrixSet:r.getMatrixSet(),opacity:this.getOpacityOrInherited_(t),requestEncoding:r.getRequestEncoding(),style:r.getStyle(),type:"WMTS",version:r.getVersion()};e.push(p)};A.prototype.encodeTileWmsLayer_=function(e,t){var r=t.getSource();a["a"].assertInstanceof(t,_["a"]);a["a"].assertInstanceof(r,w["a"]);this.encodeWmsLayer_(e,t,r.getUrls()[0],r.getParams())};A.prototype.getWmtsUrl_=function(e){var t=e.getUrls();a["a"].assert(t.length>0);return A.getAbsoluteUrl_(t[0])};A.prototype.getOpacityOrInherited_=function(e){if(e.get("inheritedOpacity")!==undefined){return e.get("inheritedOpacity")}return e.getOpacity()};A.prototype.createReport=function(e,t){var r=e.format||"pdf";var a=this.url_+"/report."+r;var n={headers:{"Content-Type":"application/json; charset=UTF-8"}};v["a"](n,t!==undefined?t:{});return this.$http_.post(a,e,n)};A.prototype.getStatus=function(e,t){var r=t!==undefined?t:{};var a=this.url_+"/status/"+e+".json";return this.$http_.get(a,r)};A.prototype.getReportUrl=function(e){return this.url_+"/report/"+e};A.prototype.getCapabilities=function(e){var t=e!==undefined?e:{withCredentials:true};var r=this.url_+"/capabilities.json";return this.$http_.get(r,t)};A.createPrintServiceFactory=function(e,t,r){return function(a){return new A(a,e,t,r)}};A.createPrintServiceFactory.$inject=["$http","gettextCatalog","ngeoLayerHelper"];A.module=angular.module("ngeoPrint",[g["a"].module.name]);A.module.service("ngeoPrintService",A);A.module.factory("ngeoCreatePrint",A.createPrintServiceFactory);var L=t["a"]=A},function(e,t,r){"use strict";var a=r(2);var n=r(27);var i={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"};var o=i;var s=r(52);var l=r(1);var u=r(22);var c=r(72);var f=r(7);var h=r(63);var p=r(314);var d=r(19);var g=r(39);var m=r(87);var v=r(92);var y=r(102);var _=r(30);var b=r(34);var S=r(79);var C=r(45);var w=r(53);var T=r(13);var E=r(104);var A=function e(t){p["a"].call(this);var r=t!==undefined?t:{};this.accuracy_=r.accuracy!==undefined?r.accuracy:e.ACCURACY_;this.encodeStyles_=r.encodeStyles!==undefined?r.encodeStyles:true;this.propertiesFunction_=r.properties!==undefined?r.properties:e.defaultPropertiesFunction_;this.setStyle_=r.setStyle!==undefined?r.setStyle:true;this.prevX_=0;this.prevY_=0;e.LegacyProperties_=r.propertiesType!==undefined&&r.propertiesType;this.defaultValues_=r.defaultValues!==undefined?r.defaultValues:{}};l["d"](A,p["a"]);A.StyleTypes_={LineString:o.LINE_STRING,Point:o.POINT,Polygon:o.POLYGON,MultiLineString:o.LINE_STRING,MultiPoint:o.POINT,MultiPolygon:o.POLYGON};A.LegacyProperties_={};A.prototype.readFeature;A.prototype.readFeatures;A.prototype.readGeometry;A.prototype.writeFeature;A.prototype.writeFeatures;A.prototype.writeGeometry;A.CHAR64_=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz";A.ACCURACY_=.1;A.defaultPropertiesFunction_=function(e){return e.getProperties()};A.encodeSignedNumber_=function(e){var t=e<<1;if(e<0){t=~t}return A.encodeNumber_(t)};A.encodeNumber_=function(e){var t="";while(e>=32){t+=A.CHAR64_.charAt(32|e&31);e>>=5}t+=A.CHAR64_.charAt(e);return t};A.encodeStyles_=function(e,t,r){var n=A.StyleTypes_[t];a["a"].assert(n!==undefined);for(var i=0;i<e.length;++i){var s=e[i];var l=s.getFill();var u=s.getImage();var c=s.getStroke();var f=s.getText();if(n==o.POLYGON){if(l!==null){A.encodeStylePolygon_(l,c,r)}}else if(n==o.LINE_STRING){if(c!==null){A.encodeStyleLine_(c,r)}}else if(n==o.POINT){if(u!==null){A.encodeStylePoint_(u,r)}}if(f!==null){A.encodeStyleText_(f,r)}}};A.encodeStyleLine_=function(e,t){A.encodeStyleStroke_(e,t)};A.encodeStylePoint_=function(e,t){if(e instanceof S["a"]){var r=e.getRadius();if(t.length>0){t.push("'")}t.push(encodeURIComponent("pointRadius*"+r));var a=e.getFill();if(a!==null){A.encodeStyleFill_(a,t)}var n=e.getStroke();if(n!==null){A.encodeStyleStroke_(n,t)}}};A.encodeStylePolygon_=function(e,t,r){A.encodeStyleFill_(e,r);if(t!==null){A.encodeStyleStroke_(t,r)}};A.encodeStyleFill_=function(e,t,r){var n=r!==undefined?r:"fillColor";var i=e.getColor();if(i!==null){a["a"].assert(Array.isArray(i),"only supporting fill colors");var o=c["a"](i);a["a"].assert(Array.isArray(o),"fill color must be an array");var l=s["b"].rgbArrayToHex(o);if(t.length>0){t.push("'")}t.push(encodeURIComponent(n+"*"+l))}};A.encodeStyleStroke_=function(e,t){var r=e.getColor();if(r!==null){a["a"].assert(Array.isArray(r));var n=c["a"](r);a["a"].assert(Array.isArray(n),"only supporting stroke colors");var i=s["b"].rgbArrayToHex(n);if(t.length>0){t.push("'")}t.push(encodeURIComponent("strokeColor*"+i))}var o=e.getWidth();if(o!==undefined){if(t.length>0){t.push("'")}t.push(encodeURIComponent("strokeWidth*"+o))}};A.encodeStyleText_=function(e,t){var r=e.getFont();if(r!==undefined){var a=r.split(" ");if(a.length>=3){if(t.length>0){t.push("'")}t.push(encodeURIComponent("fontSize*"+a[1]))}}var n=e.getFill();if(n!==null){A.encodeStyleFill_(n,t,"fontColor")}};A.readLineStringGeometry_=function(e){a["a"].assert(e.substring(0,2)==="l(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);var r=new g["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};A.readMultiLineStringGeometry_=function(e){a["a"].assert(e.substring(0,2)==="L(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split("'");for(var i=0,o=n.length;i<o;++i){t=this.decodeCoordinates_(n[i],t);r[i]=t.length}var s=new m["a"](null);s.setFlatCoordinates(d["a"].XY,t,r);return s};A.readPointGeometry_=function(e){a["a"].assert(e.substring(0,2)==="p(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);a["a"].assert(t.length===2);var r=new _["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};A.readMultiPointGeometry_=function(e){a["a"].assert(e.substring(0,2)==="P(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);var r=new v["a"](null);r.setFlatCoordinates(d["a"].XY,t);return r};A.readPolygonGeometry_=function(e){a["a"].assert(e.substring(0,2)==="a(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split("'");for(var i=0,o=n.length;i<o;++i){t=this.decodeCoordinates_(n[i],t);var s=t.length;if(i===0){t[s++]=t[0];t[s++]=t[1]}else{t[s++]=t[r[i-1]];t[s++]=t[r[i-1]+1]}r[i]=s}var l=new b["a"](null);l.setFlatCoordinates(d["a"].XY,t,r);return l};A.readMultiPolygonGeometry_=function(e){a["a"].assert(e.substring(0,2)==="A(");a["a"].assert(e[e.length-1]==")");e=e.substring(2,e.length-1);var t=[];var r=[];var n=e.split(")(");for(var i=0,o=n.length;i<o;++i){var s=n[i].split("'");var l=r[i]=[];for(var u=0,c=s.length;u<c;++u){t=this.decodeCoordinates_(s[u],t);var f=t.length;if(u===0){t[f++]=t[0];t[f++]=t[1]}else{t[f++]=t[l[u-1]];t[f++]=t[l[u-1]+1]}l[u]=f}}var h=new y["a"](null);h.setFlatCoordinates(d["a"].XY,t,r);return h};A.setStyleInFeature_=function(e,t){if(e==""){return}var r=A.getStyleProperties_(e,t);var a=r["fillColor"];var n=r["fontSize"];var i=r["fontColor"];var o=r["pointRadius"];var s=r["strokeColor"];var l=r["strokeWidth"];var u=null;if(a!==undefined){u=new C["a"]({color:a})}var c=null;if(s!==undefined&&l!==undefined){c=new w["a"]({color:s,width:l})}var f=null;if(o!==undefined){f=new S["a"]({radius:o,fill:u,stroke:c});u=c=null}var h=null;if(n!==undefined&&i!==undefined){h=new E["a"]({font:n+" sans-serif",fill:new C["a"]({color:i})})}var p=new T["c"]({fill:u,image:f,stroke:c,text:h});t.setStyle(p)};A.setStyleProperties_=function(e,t){var r=A.getStyleProperties_(e,t);var a=t.getGeometry();if(a instanceof _["a"]){if(r["isLabel"]||r[n["a"].IS_TEXT]){delete r["strokeColor"];delete r["fillColor"]}else{delete r["fontColor"];delete r["fontSize"]}}else{delete r["fontColor"];if(a instanceof g["a"]){delete r["fillColor"];delete r["fillOpacity"]}}if(r["fontSize"]){var i=parseFloat(r["fontSize"]);if(r["fontSize"].indexOf("px")!==-1){i=Math.round(i/1.333333)}r["fontSize"]=i}var o={};for(var s in r){var l=r[s];if(A.LegacyProperties_[s]){o[A.LegacyProperties_[s]]=l}else{o[s]=l}}t.setProperties(o)};A.castValue_=function(e,t){var r=[n["a"].ANGLE,n["a"].OPACITY,n["a"].SIZE,n["a"].STROKE,"pointRadius","strokeWidth"];var a=[n["a"].IS_CIRCLE,n["a"].IS_RECTANGLE,n["a"].IS_TEXT,n["a"].SHOW_MEASURE,n["a"].SHOW_LABEL,"isCircle","isRectangle","isLabel","showMeasure","showLabel"];if(f["f"](r,e)){return+t}else if(f["f"](a,e)){return t==="true"?true:false}else{return t}};A.getStyleProperties_=function(e,t){var r=e.split("'");var n={};for(var i=0;i<r.length;++i){var o=decodeURIComponent(r[i]);var s=o.split("*");a["a"].assert(s.length===2);var l=s[0];var u=s[1];n[l]=A.castValue_(l,u)}return n};A.writeLineStringGeometry_=function(e){a["a"].assertInstanceof(e,g["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"l("+this.encodeCoordinates_(t,r,0,n)+")"};A.writeMultiLineStringGeometry_=function(e){a["a"].assertInstanceof(e,m["a"]);var t=e.getEnds();var r=t.length;var n=e.getFlatCoordinates();var i=e.getStride();var o=0;var s=["L("];for(var l=0;l<r;++l){var u=t[l];var c=this.encodeCoordinates_(n,i,o,u);if(l!==0){s.push("'")}s.push(c);o=u}s.push(")");return s.join("")};A.writePointGeometry_=function(e){a["a"].assertInstanceof(e,_["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"p("+this.encodeCoordinates_(t,r,0,n)+")"};A.writeMultiPointGeometry_=function(e){a["a"].assertInstanceof(e,v["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=t.length;return"P("+this.encodeCoordinates_(t,r,0,n)+")"};A.encodeRings_=function(e,t,r,a,n){var i=a.length;for(var o=0;o<i;++o){var s=a[o]-t;var l=this.encodeCoordinates_(e,t,r,s);if(o!==0){n.push("'")}n.push(l);r=a[o]}return r};A.writePolygonGeometry_=function(e){a["a"].assertInstanceof(e,b["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=e.getEnds();var i=0;var o=["a("];A.encodeRings_.call(this,t,r,i,n,o);o.push(")");return o.join("")};A.writeMultiPolygonGeometry_=function(e){a["a"].assertInstanceof(e,y["a"]);var t=e.getFlatCoordinates();var r=e.getStride();var n=e.getEndss();var i=n.length;var o=0;var s=["A"];for(var l=0;l<i;++l){var u=n[l];s.push("(");o=A.encodeRings_.call(this,t,r,o,u,s);s.push(")")}return s.join("")};A.GEOMETRY_READERS_={P:A.readMultiPointGeometry_,L:A.readMultiLineStringGeometry_,A:A.readMultiPolygonGeometry_,l:A.readLineStringGeometry_,p:A.readPointGeometry_,a:A.readPolygonGeometry_};A.GEOMETRY_WRITERS_={MultiLineString:A.writeMultiLineStringGeometry_,MultiPoint:A.writeMultiPointGeometry_,MultiPolygon:A.writeMultiPolygonGeometry_,LineString:A.writeLineStringGeometry_,Point:A.writePointGeometry_,Polygon:A.writePolygonGeometry_};A.prototype.decodeCoordinates_=function(e,t){var r=e.length;var a=0;var n=t!==undefined?t:[];var i=n.length;while(a<r){var o=void 0;var s=0;var l=0;do{o=A.CHAR64_.indexOf(e.charAt(a++));l|=(o&31)<<s;s+=5}while(o>=32);var u=l&1?~(l>>1):l>>1;this.prevX_+=u;s=0;l=0;do{o=A.CHAR64_.indexOf(e.charAt(a++));l|=(o&31)<<s;s+=5}while(o>=32);var c=l&1?~(l>>1):l>>1;this.prevY_+=c;n[i++]=this.prevX_*this.accuracy_;n[i++]=this.prevY_*this.accuracy_}return n};A.prototype.encodeCoordinates_=function(e,t,r,a){var n="";for(var i=r;i<a;i+=t){var o=e[i];var s=e[i+1];o=Math.floor(o/this.accuracy_);s=Math.floor(s/this.accuracy_);var l=o-this.prevX_;var u=s-this.prevY_;this.prevX_=o;this.prevY_=s;n+=A.encodeSignedNumber_(l)+A.encodeSignedNumber_(u)}return n};A.prototype.readFeatureFromText=function(e,t){a["a"].assert(e.length>2);a["a"].assert(e[1]==="(");a["a"].assert(e[e.length-1]===")");var r=e.indexOf("~");var n=r>=0?e.substring(0,r)+")":e;var i=this.readGeometryFromText(n,t);var o=new u["a"](i);if(r>=0){var s=e.substring(r+1,e.length-1);r=s.indexOf("~");var l=r>=0?s.substring(0,r):s;if(l!=""){var c=l.split("'");for(var f=0;f<c.length;++f){var h=decodeURIComponent(c[f]);var p=h.split("*");a["a"].assert(p.length===2);var d=p[0];var g=p[1];if(!this.setStyle_&&A.LegacyProperties_[d]){d=A.LegacyProperties_[d]}o.set(d,A.castValue_(d,g))}}if(r>=0){var m=s.substring(r+1);if(this.setStyle_){A.setStyleInFeature_(m,o)}else{A.setStyleProperties_(m,o)}}}return o};A.prototype.readFeaturesFromText=function(e,t){var r=this;a["a"].assert(e[0]==="F");this.prevX_=0;this.prevY_=0;var n=[];e=e.substring(1);while(e.length>0){var i=e.indexOf(")");a["a"].assert(i>=0);var o=this.readFeatureFromText(e.substring(0,i+1),t);n.push(o);e=e.substring(i+1)}n.forEach(function(e){for(var t in r.defaultValues_){var a=A.LegacyProperties_[t];if(e.get(a)===undefined){e.set(a,r.defaultValues_[t].call(null,e))}}});return n};A.prototype.readGeometryFromText=function(e,t){var r=A.GEOMETRY_READERS_[e[0]];a["a"].assert(r!==undefined);return r.call(this,e)};A.prototype.writeFeatureText=function(e,t){var r=[];var n="";var i=e.getGeometry();if(i){n=this.writeGeometryText(i,t)}if(n.length>0){a["a"].assert(n[n.length-1]===")");n=n.substring(0,n.length-1);r.push(n)}var o=[];var s=this.propertiesFunction_(e);for(var l in s){var u=s[l];if(u!==undefined&&u!==null&&l!==e.getGeometryName()){if(o.length!==0){o.push("'")}var c=encodeURIComponent(l.replace(/[()'*]/g,"_")+"*"+u.toString().replace(/[()'*]/g,"_"));o.push(c)}}if(o.length>0){r.push("~");Array.prototype.push.apply(r,o)}if(this.encodeStyles_){var f=e.getStyleFunction();if(f!==undefined){var h=f.call(e,0);if(h!==null){var p=[];h=Array.isArray(h)?h:[h];A.encodeStyles_(h,i.getType(),p);if(p.length>0){r.push("~");Array.prototype.push.apply(r,p)}}}}r.push(")");return r.join("")};A.prototype.writeFeaturesText=function(e,t){this.prevX_=0;this.prevY_=0;var r=[];if(e.length>0){r.push("F");for(var a=0,n=e.length;a<n;++a){r.push(this.writeFeatureText(e[a],t))}}return r.join("")};A.prototype.writeGeometryText=function(e,t){var r=A.GEOMETRY_WRITERS_[e.getType()];a["a"].assert(r!==undefined);var n=h["b"](e,true,t);return r.call(this,n)};var L=t["a"]=A},function(e,t,r){"use strict";var a=r(2);var n=r(3);var i=r(27);var o=r(281);var s=r(65);var l=angular.module("gmfDrawingFeatureStyle",[o["a"].name,s["a"].module.name]);l.run(["$templateCache",function(e){e.put("gmf/drawing/featureStyleComponent",r(381))}]);l.directive_=function(){return{controller:"GmfFeaturestyleController as fsCtrl",scope:{feature:"=gmfFeaturestyleFeature"},bindToController:true,templateUrl:"gmf/drawing/featureStyleComponent"}};l.directive("gmfFeaturestyle",l.directive_);l.Controller_=function(e,t){var r=this;this.feature;this.scope_=e;this.featureHelper_=t;this.color=undefined;this.label=undefined;this.measure=undefined;e.$watch(function(){return r.color},this.handleColorSet_.bind(this));this.featureListenerKeys_=[];this.type;e.$watch(function(){return r.feature},this.handleFeatureSet_.bind(this))};l.Controller_.$inject=["$scope","ngeoFeatureHelper"];l.Controller_.prototype.handleFeatureSet_=function(e,t){var r=this.featureListenerKeys_;if(t){r.forEach(n["e"]);r.length=0;this.type=undefined;this.color=undefined;this.measure=undefined;this.label=undefined}if(e){[i["a"].ANGLE,i["a"].COLOR,i["a"].NAME,i["a"].SHOW_LABEL,i["a"].OPACITY,i["a"].SHOW_MEASURE,i["a"].SIZE,i["a"].STROKE].forEach(function(t){r.push(n["a"](e,"change:"+t,this.handleFeatureChange_,this))},this);var o=e.getGeometry();a["a"].assert(o,"Geometry should be thruthy");r.push(n["a"](o,"change",this.handleGeometryChange_,this));this.type=this.featureHelper_.getType(e);this.color=this.featureHelper_.getColorProperty(e);this.measure=this.featureHelper_.getMeasure(e)}};l.Controller_.prototype.handleColorSet_=function(e){if(this.feature&&e){var t=this.feature.get(i["a"].COLOR);if(t!==e){this.feature.set(i["a"].COLOR,e)}}};l.Controller_.prototype.getSetAngle=function(e){return a["a"].assertNumber(this.getSetProperty_(i["a"].ANGLE,e))};l.Controller_.prototype.getSetName=function(e){return a["a"].assertString(this.getSetProperty_(i["a"].NAME,e))};l.Controller_.prototype.getSetShowLabel=function(e){return a["a"].assertBoolean(this.getSetProperty_(i["a"].SHOW_LABEL,e))};l.Controller_.prototype.getSetOpacity=function(e){return a["a"].assertNumber(this.getSetProperty_(i["a"].OPACITY,e))};l.Controller_.prototype.getSetShowMeasure=function(e){return a["a"].assertBoolean(this.getSetProperty_(i["a"].SHOW_MEASURE,e))};l.Controller_.prototype.getSetSize=function(e){return a["a"].assertNumber(this.getSetProperty_(i["a"].SIZE,e))};l.Controller_.prototype.getSetStroke=function(e){return a["a"].assertNumber(this.getSetProperty_(i["a"].STROKE,e))};l.Controller_.prototype.getSetProperty_=function(e,t){if(t!==undefined){this.feature.set(e,t)}return this.feature.get(e)};l.Controller_.prototype.handleFeatureChange_=function(){var e=this.feature;if(!e){return}this.featureHelper_.setStyle(e,true)};l.Controller_.prototype.handleGeometryChange_=function(){a["a"].assert(this.feature);this.measure=this.featureHelper_.getMeasure(this.feature);var e=this.featureHelper_.getShowMeasureProperty(this.feature);if(e){this.handleFeatureChange_()}this.scope_.$apply()};l.controller("GmfFeaturestyleController",l.Controller_);var u=l;var c=r(20);var f=r(232);var h=r(348);var p=r(189);var d=r(271);var g=r(270);var m=r(230);var v=r(229);var y=r(140);var _=r(69);var b=r(188);var S=r(52);var C=r(1);var w=r(7);var T=r(18);var E=r(45);var A=r(13);var L=r(104);var P=r(163);var M=angular.module("GmfDrawFeatureComponent",[u.name,h["a"].name,p["a"].name,d["a"].name,s["a"].module.name,b["a"].module.name]);M.run(["$templateCache",function(e){e.put("gmf/drawing/drawFeatureComponent",r(380))}]);M.component_=function(){return{controller:"GmfDrawfeatureController as efCtrl",scope:{active:"=gmfDrawfeatureActive",map:"<gmfDrawfeatureMap",showMeasure:"=?gmfDrawfeatureShowmeasure"},bindToController:true,templateUrl:"gmf/drawing/drawFeatureComponent"}};M.directive("gmfDrawfeature",M.component_);M.Controller_=function(e,t,r,a,n,o){var s=this;this.map;this.active;if(this.active===undefined){this.active=false}this.drawActive=false;this.drawToolActivate=new _["a"](this,"drawActive");this.mapSelectActive=true;this.longPressTimeout_=null;this.mapSelectToolActivate=new _["a"](this,"mapSelectActive");this.scope_=e;this.timeout_=t;this.featureHelper_=a;this.features=n;this.ngeoToolActivateMgr_=o;this.selectedFeature=null;this.selectedFeatures=new T["b"];this.interactions_=new T["b"];this.modify_=new g["a"]({features:this.selectedFeatures,style:a.getVertexStyle(false)});this.interactions_.push(this.modify_);this.menu_=null;this.modifyToolActivate=new _["a"](this.modify_,"active");this.translate_=new v["a"]({features:this.selectedFeatures,style:new A["c"]({text:new L["a"]({text:"",font:"normal 18px FontAwesome",fill:new E["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.translate_);this.rotate_=new m["a"]({features:this.selectedFeatures,style:new A["c"]({text:new L["a"]({text:"",font:"normal 18px FontAwesome",fill:new E["a"]({color:"#7a7a7a"})})})});this.interactions_.push(this.rotate_);this.initializeInteractions_();this.rotateToolActivate=new _["a"](this.rotate_,"active");this.translateToolActivate=new _["a"](this.translate_,"active");this.listenerKeys_=[];this.listSelectionInProgress_=false;e.$watch(function(){return s.active},this.handleActiveChange_.bind(this));e.$watch(function(){return s.drawActive},function(e){if(e){s.selectedFeature=null}});e.$watch(function(){return s.selectedFeature},function(e,t){s.selectedFeatures.clear();if(t){s.featureHelper_.setStyle(t);s.unregisterInteractions_()}if(e){s.featureHelper_.setStyle(e,true);s.selectedFeatures.push(e);s.registerInteractions_();if(s.listSelectionInProgress_){s.featureHelper_.panMapToFeature(e,s.map);s.listSelectionInProgress_=false}}else if(s.menu_){s.map.removeOverlay(s.menu_);s.menu_=null}});e.$watch(function(){return s.mapSelectActive},this.handleMapSelectActiveChange_.bind(this));this.nameProperty=i["a"].NAME;this.gettextCatalog_=r};M.Controller_.$inject=["$scope","$timeout","gettextCatalog","ngeoFeatureHelper","ngeoFeatures","ngeoToolActivateMgr"];M.Controller_.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(false);y["a"].interaction(e)})};M.Controller_.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})};M.Controller_.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})};M.Controller_.prototype.handleActiveChange_=function(e){var t=this.listenerKeys_;var r=["draw-",C["c"](this)].join("-");var a=["other-",C["c"](this)].join("-");var i=this.ngeoToolActivateMgr_;if(e){t.push(n["a"](this.features,"add",this.handleFeaturesAdd_,this),n["a"](this.features,"remove",this.handleFeaturesRemove_,this));t.push(n["a"](this.translate_,"translateend",this.handleTranslateEnd_,this));t.push(n["a"](this.rotate_,"rotateend",this.handleRotateEnd_,this));i.registerTool(r,this.drawToolActivate,false);i.registerTool(r,this.mapSelectToolActivate,true);i.registerTool(a,this.drawToolActivate,false);i.registerTool(a,this.modifyToolActivate,true);i.registerTool(a,this.translateToolActivate,false);i.registerTool(a,this.rotateToolActivate,false);this.mapSelectActive=true;this.modify_.setActive(true)}else{t.forEach(n["e"]);t.length=0;i.unregisterTool(r,this.drawToolActivate);i.unregisterTool(r,this.mapSelectToolActivate);i.unregisterTool(a,this.drawToolActivate);i.unregisterTool(a,this.modifyToolActivate);i.unregisterTool(a,this.translateToolActivate);i.unregisterTool(a,this.rotateToolActivate);this.drawActive=false;this.modify_.setActive(false);this.mapSelectActive=false;this.selectedFeature=null;if(this.menu_){this.map.removeOverlay(this.menu_);this.menu_=null}}};M.Controller_.prototype.selectFeatureFromList=function(e){this.listSelectionInProgress_=true;this.selectedFeature=e;this.drawActive=false};M.Controller_.prototype.getFeaturesArray=function(){return this.features.getArray()};M.Controller_.prototype.clearFeatures=function(){var e=this.gettextCatalog_;var t=e.getString("Do you really want to delete all the features?");if(confirm(t)){this.features.clear()}};M.Controller_.prototype.removeFeature=function(e){var t=this.gettextCatalog_;var r=t.getString("Do you really want to delete the selected feature?");if(confirm(r)){this.features.remove(e)}};M.Controller_.prototype.handleFeaturesAdd_=function(e){var t=this;this.timeout_(function(){t.selectedFeature=e.element;t.drawActive=false;t.scope_.$apply()})};M.Controller_.prototype.handleFeaturesRemove_=function(e){this.selectedFeature=null};M.Controller_.prototype.handleMapSelectActiveChange_=function(e){var t=this.map.getViewport();a["a"].assertElement(t);if(e){n["a"](this.map,"click",this.handleMapClick_,this);n["a"](t,"contextmenu",this.handleMapContextMenu_,this);n["a"](t,"touchstart",this.handleMapTouchStart_,this);n["a"](t,"touchmove",this.handleMapTouchEnd_,this);n["a"](t,"touchend",this.handleMapTouchEnd_,this);n["a"](document.body,"keydown",this.handleCancelKeyEvent_,this)}else{n["c"](this.map,"click",this.handleMapClick_,this);n["c"](t,"contextmenu",this.handleMapContextMenu_,this);n["c"](t,"touchstart",this.handleMapTouchStart_,this);n["c"](t,"touchmove",this.handleMapTouchEnd_,this);n["c"](t,"touchend",this.handleMapTouchEnd_,this);n["c"](document.body,"keydown",this.handleCancelKeyEvent_,this)}};M.Controller_.prototype.handleMapClick_=function(e){var t=this;var r=e.pixel;var a=this.map.forEachFeatureAtPixel(r,function(e){var r=false;if(w["f"](t.features.getArray(),e)){r=e}return r},{hitTolerance:5});a=a?a:null;if(a===this.selectedFeature){return}this.selectedFeature=a;this.scope_.$apply()};M.Controller_.prototype.handleCancelKeyEvent_=function(){var e=this;n["a"](document.body,"keydown",function(t){var r=t.keyCode===27;if(!S["a"].mousedown&&r&&e.selectedFeature){e.selectedFeature=null;e.scope_.$apply()}})};M.Controller_.prototype.handleMapTouchStart_=function(e){var t=this;this.longPressTimeout_=setTimeout(function(){t.handleMapContextMenu_(e)},500)};M.Controller_.prototype.handleMapTouchEnd_=function(e){clearTimeout(this.longPressTimeout_)};M.Controller_.prototype.handleMapContextMenu_=function(e){var t=this;var r=this.gettextCatalog_;var a=this.map.getEventPixel(e);var i=this.map.getCoordinateFromPixel(a);var o=this.map.forEachFeatureAtPixel(a,function(e){var r=false;if(w["f"](t.features.getArray(),e)){r=e}return r},{hitTolerance:7});o=o?o:null;if(o){var s=[];var l=this.featureHelper_.getType(o);if(l==c["a"].CIRCLE||l==c["a"].LINE_STRING||l==c["a"].POLYGON||l==c["a"].RECTANGLE){s=s.concat([{cls:"fa fa-arrows",label:r.getString("Move"),name:"move"},{cls:"fa fa-rotate-right",label:r.getString("Rotate"),name:"rotate"}])}s=s.concat([{cls:"fa fa-trash-o",label:r.getString("Delete"),name:"delete"}]);this.menu_=new f["a"]({actions:s});n["a"](this.menu_,"actionclick",this.handleMenuActionClick_,this);this.map.addOverlay(this.menu_);this.menu_.open(i);e.preventDefault();e.stopPropagation()}if(o===this.selectedFeature){return}this.modify_.setActive(true);this.selectedFeature=o;this.scope_.$apply()};M.Controller_.prototype.handleMenuActionClick_=function(e){var t=e.detail.action;switch(t){case"delete":a["a"].assert(this.selectedFeature,"Selected feature should be truthy");this.removeFeature(this.selectedFeature);this.scope_.$apply();break;case"move":this.translate_.setActive(true);this.scope_.$apply();break;case"rotate":this.rotate_.setActive(true);this.scope_.$apply();break;default:console.log("FIXME - support: "+t);break}};M.Controller_.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(false);this.scope_.$apply()};M.Controller_.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(false);this.scope_.$apply()};M.controller("GmfDrawfeatureController",M.Controller_);var x=M;var F=angular.module("gmfDrawingModule",[x.name,u.name]);var R=t["a"]=F},function(e,t,r){"use strict";var a=r(165);var n=r(207);var i=r(1);var o=r(265);function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var l=angular.module("gmfWmscapabilitylayertreenode",[a["a"].module.name,n["a"].module.name]);l.run(["$templateCache",function(e){e.put("gmf/import/wmsCapabilityLayertreeComponent",r(372))}]);l.value("gmfWmscapabilitylayertreenodeTemplateUrl",function(e){var t=e["gmfWmscapabilitylayertreenodeTemplateUrl"];return t!==undefined?t:"gmf/import/wmsCapabilityLayertreeComponent"});u.$inject=["$attrs","gmfWmscapabilitylayertreenodeTemplateUrl"];function u(e,t){return t(e)}l.Controller_=function(){e.$inject=["gmfExternalDataSourcesManager"];function e(t){s(this,e);this.capabilities;this.layer;this.url;this.gmfExternalDataSourcesManager_=t}e.prototype.createAndAddDataSource=function e(t){this.gmfExternalDataSourcesManager_.createAndAddDataSourceFromWMSCapability(t,this.capabilities,this.url)};e.prototype.getUid=function e(t){return i["c"](t)};return e}();l.component("gmfWmscapabilitylayertreenode",{bindings:{capabilities:"<",layer:"<",url:"<"},controller:l.Controller_,templateUrl:u});var c=l;function f(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var h=angular.module("gmfWmtscapabilitylayertree",[a["a"].module.name,n["a"].module.name]);h.run(["$templateCache",function(e){e.put("ngeo/import/wmtsCapabilityLayertreeComponent",r(371))}]);h.value("gmfWmtscapabilitylayertreTemplateUrl",function(e){var t=e["gmfWmtscapabilitylayertreTemplateUrl"];return t!==undefined?t:"ngeo/import/wmtsCapabilityLayertreeComponent"});p.$inject=["$attrs","gmfWmtscapabilitylayertreTemplateUrl"];function p(e,t){return t(e)}h.Controller_=function(){e.$inject=["gmfExternalDataSourcesManager"];function e(t){f(this,e);this.capabilities;this.layers;this.url;this.gmfExternalDataSourcesManager_=t}e.prototype.createAndAddDataSource=function e(t){var r=this.gmfExternalDataSourcesManager_;r.createAndAddDataSourceFromWMTSCapability(t,this.capabilities,this.url)};e.prototype.getUid=function e(t){return i["c"](t)};return e}();h.component("gmfWmtscapabilitylayertree",{bindings:{capabilities:"<",layers:"<",url:"<"},controller:h.Controller_,templateUrl:p});var d=h;var g=r(2);var m=r(225);var v=r(50);var y=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}return function(t,r,a){if(r)e(t.prototype,r);if(a)e(t,a);return t}}();function _(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var b=angular.module("gmfImportdatasource",[a["a"].module.name,c.name,d.name,m["a"].module.name]);b.run(["$templateCache",function(e){e.put("gmf/import/importdatasourceComponent",r(370))}]);b.value("gmfImportdatasourceTemplateUrl",function(e){var t=e["gmfImportdatasourceTemplateUrl"];return t!==undefined?t:"gmf/import/importdatasourceComponent"});S.$inject=["$attrs","gmfImportdatasourceTemplateUrl"];function S(e,t){return t(e)}b.Controller_=function(){e.$inject=["$element","$filter","$injector","$scope","$timeout","gmfExternalDataSourcesManager","ngeoQuerent"];function e(t,r,a,n,i,o,s){var l=this;_(this,e);this.map;this.element_=t;this.scope_=n;this.timeout_=i;this.gmfExternalDataSourcesManager_=o;this.ngeoQuerent_=s;this.file;this.url;this.fileInput_=t.find("input[type=file]");this.hasError=false;this.hasErrorPromise_=null;this.mode=b.Controller_.Mode.ONLINE;this.modes=[b.Controller_.Mode.LOCAL,b.Controller_.Mode.ONLINE];this.pending=false;this.unitPrefixFormat_=r("ngeoUnitPrefix");this.wmsCapabilities=null;this.wmtsCapabilities=null;this.serversEngine_;var u=a.has("gmfExternalOGCServers")?a.get("gmfExternalOGCServers"):undefined;if(u){var c=u.map(function(e){return e["url"]});this.serversEngine_=new Bloodhound({datumTokenizer:function e(t){g["a"].assertString(t);var r=Bloodhound.tokenizers.whitespace(t);g["a"].assert(r);var a=[];for(var n=r,i=Array.isArray(n),o=0,n=i?n:n[Symbol.iterator]();;){var s;if(i){if(o>=n.length)break;s=n[o++]}else{o=n.next();if(o.done)break;s=o.value}var l=s;var u=0;while(u+1<l.length){a.push(l.substr(u,l.length));u++}}return a},queryTokenizer:Bloodhound.tokenizers.whitespace,identify:false,local:c})}this.fileInput_.on("change",function(){l.file=l.fileInput_[0].files&&l.fileInput_[0].files[0]?l.fileInput_[0].files[0]:undefined;l.scope_.$apply()})}e.prototype.$onInit=function e(){var t=this;this.gmfExternalDataSourcesManager_.map=this.map;if(this.serversEngine_){this.timeout_(function(){g["a"].assert(t.serversEngine_);var e=t.element_.find("input[name=url]");var r=t.element_.find("button.gmf-importdatasource-connect-btn");e.typeahead({hint:true,highlight:true,minLength:1},{name:"url",source:t.serversEngine_.ttAdapter()}).bind("typeahead:select",function(e,a){t.timeout_(function(){t.url=a;t.scope_.$apply();r.focus()})})})}};e.prototype.browse=function e(){this.hasError=false;this.element_.find("input[type=file][name=file]").click()};e.prototype.connect=function e(){var t=this;var r=g["a"].assertString(this.url);var a=v["a"].guessServiceTypeByUrl(r);this.startWorking_();if(a===v["a"].Type.WMS){this.ngeoQuerent_.wmsGetCapabilities(r).then(function(e){t.wmsCapabilities=e;t.stopWorking_()},function(){t.stopWorking_(true)})}else if(a===v["a"].Type.WMTS){this.ngeoQuerent_.wmtsGetCapabilities(r).then(function(e){t.wmtsCapabilities=e;t.stopWorking_()},function(){t.stopWorking_(true)})}else{this.timeout_(function(){t.stopWorking_(true)})}};e.prototype.load=function e(){var t=this;var r=g["a"].assert(this.file);this.gmfExternalDataSourcesManager_.createAndAddDataSourceFromFile(r,function(e){if(!e){t.hasError=true}})};e.prototype.startWorking_=function e(){this.pending=true;this.hasError=false;this.wmsCapabilities=null;this.wmtsCapabilities=null};e.prototype.stopWorking_=function e(){var t=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.pending=false;if(r){this.hasError=true;if(this.hasErrorPromise_){this.timeout_.cancel(this.hasErrorPromise_)}this.hasErrorPromise_=this.timeout_(function(){t.hasError=false;t.hasErrorPromise_=null},3e3)}};y(e,[{key:"fileNameAndSize",get:function e(){var t="";var r=this.file;if(r!==undefined){var a=this.unitPrefixFormat_(r.size,"o");t=r.name+", "+a}return t}}]);return e}();b.Controller_.Mode={LOCAL:"Local",ONLINE:"Online"};b.component("gmfImportdatasource",{bindings:{map:"<"},controller:b.Controller_,templateUrl:S});var C=b;var w=r(453);var T=angular.module("gmfImportModule",[C.name,c.name,d.name]);var E=t["a"]=T},function(e,t,r){"use strict";var a=function e(){return{restrict:"A",link:function t(r,a,n){var i=n["ngeoSearch"];var o=r.$eval(i);var s=n["ngeoSearchDatasets"];var l=r.$eval(s);var u=l.slice();u.unshift(o);a.typeahead.apply(a,u);var c=n["ngeoSearchListeners"];var f=r.$eval(c);var h=e.adaptListeners_(f);a.on("typeahead:open",function(){r.$apply(function(){h.open()})});a.on("typeahead:close",function(){r.$apply(function(){h.close()})});a.on("typeahead:cursorchange",function(e,t,a){r.$apply(function(){h.cursorchange(e,t,a)})});a.on("typeahead:select",function(e,t,a){r.$apply(function(){h.select(e,t,a)})});a.on("typeahead:autocomplete",function(e,t,a){r.$apply(function(){h.autocomplete(e,t,a)})});a.on("typeahead:asyncreceive",function(e,t,n){r.$apply(function(){var t=a.data("tt-typeahead")["menu"]["_allDatasetsEmpty"]();h.datasetsempty(e,n,t)})})}}};a.adaptListeners_=function(e){var t=void 0;if(e===undefined){t={open:function e(){},close:function e(){},cursorchange:function e(){},datasetsempty:function e(){},select:function e(){},autocomplete:function e(){}}}else{t={open:e.open!==undefined?e.open:function(){},close:e.close!==undefined?e.close:function(){},cursorchange:e.cursorchange!==undefined?e.cursorchange:function(){},datasetsempty:e.datasetsempty!==undefined?e.datasetsempty:function(){},select:e.select!==undefined?e.select:function(){},autocomplete:e.autocomplete!==undefined?e.autocomplete:function(){}}}return t};a.module=angular.module("ngeoSearchDirective",[]);a.module.directive("ngeoSearch",a);var n=a;var i=r(135);var o=r(9);var s=r(319);var l=function e(t,r,a,n,s,l){var u=new i["a"];var c={remote:{url:t,prepare:function e(t,r){r.url=r.url.replace("%QUERY",t);return r},transform:function e(t){var i=t;if(r!==undefined){i={type:"FeatureCollection",features:i.features.filter(r)}}return u.readFeatures(i,{featureProjection:a,dataProjection:n})}},datumTokenizer:function e(){},queryTokenizer:Bloodhound.tokenizers.whitespace};var f=o["a"]({},s||{});var h=o["a"]({},l||{});if(f.remote){o["a"](h,f.remote);delete f.remote}o["a"](c,f);o["a"](c.remote,h);return new Bloodhound(c)};l.module=angular.module("ngeoSearchCreategeojsonbloodhound",[]);l.module.value("ngeoSearchCreateGeoJSONBloodhound",l);l.Function;var u=l;var c=r(11);var f=r(251);var h=r(30);var p=r(22);var d=function e(t){var r=t||{};var a=c["g"](f["a"]);var n=r.targetProjection;var i=function e(t){var r=/BOX\((.*?) (.*?),(.*?) (.*?)\)/g;var a=r.exec(t);if(a!==null){return[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])]}else{return null}};var s=function e(t){return t.replace(/<\/?[ib]>/g,"")};var l=function e(t){var r=/<b>(.*?)<\/b>/g;var a=r.exec(t);if(a!==null){return a[1]}else{return t}};var u={remote:{url:"https://api3.geo.admin.ch/rest/services/api/SearchServer?type=locations&searchText=%QUERY",prepare:function e(t,a){a.url=a.url.replace("%QUERY",t);if(r.limit!==undefined){a.url+="&limit="+r.limit}if(r.origins!==undefined){a.url+="&origins="+r.origins}return r.prepare!==undefined?r.prepare(t,a):a},transform:function e(t){var r=t.results.map(function(e){var t=e.attrs;var r=new h["a"]([t.y,t.x]);var o=i(t.geom_st_box2d);if(n!==undefined){r.transform(a,n);if(o!==null){o=c["m"](o,a,n)}}t["geometry"]=r;t["bbox"]=o;var u=t.label;t["label_no_html"]=s(u);t["label_simple"]=l(u);var f=new p["a"](t);f.setId(t.featureId);return f});return r}},datumTokenizer:function e(){},queryTokenizer:Bloodhound.tokenizers.whitespace};var d=o["a"]({},r.options||{});var g=o["a"]({},r.remoteOptions||{});if(d.remote){o["a"](g,d.remote);delete d.remote}o["a"](u,d);o["a"](u.remote,g);return new Bloodhound(u)};d.module=angular.module("ngeoCreateLocationSearchBloodhound",[]);d.module.value("ngeoCreateLocationSearchBloodhound",d);d.Function;var g=d;var m=angular.module("ngeoSearchModule",[n.module.name,u.module.name,g.module.name]);var v=t["a"]=m},function(e,t,r){"use strict";var a=r(2);var n=r(3);var i=r(22);var o=r(113);var s=r(39);var l=r(30);var u=r(9);var c=r(79);var f=r(45);var h=r(13);var p=r(284);var d=r(100);var g=r(187);var m=r(364);var v=r(66);var y=r(311);var _=r(337);var b=r(62);var S=r(312);var C={bisector:v["c"],extent:v["d"],axisBottom:y["a"],axisLeft:y["b"],scaleLinear:_["a"],mouse:b["b"],select:b["d"],selectAll:b["e"],area:S["a"],line:S["b"]};var w=function e(t){var r=t.light!==undefined?t.light:false;var n=r?{top:0,right:0,bottom:0,left:0}:{top:10,right:20,bottom:30,left:40};var i=t.hoverCallback!==undefined?t.hoverCallback:function(){};var o=t.outCallback!==undefined?t.outCallback:function(){};var s=t.distanceExtractor;var l=t.linesConfiguration;var c=Object.keys(l).length;var f=C.bisector(function(e){return s(e)}).left;var h=t.poiExtractor;var p=t.styleDefs;var d=t.poiLabelAngle!==undefined?t.poiLabelAngle:-60;var g=t.i18n||{};var m=g.xAxis||"Distance";var v=g.yAxis||"Elevation";var y={xhover:function e(t,r){return parseFloat(t.toPrecision(3))+" "+r},yhover:function e(t,r){return t!==null?Math.round(t)+" m":""},xtick:function e(t,r){return t},ytick:function e(t,r){return t}};if(t.formatter!==undefined){u["a"](y,t.formatter)}var _=t.lightXAxis!==undefined?t.lightXAxis:false;var b=void 0;var S=void 0;var w=void 0;var T=t.scaleModifier;var E=void 0;var A=void 0;var L=void 0;var P=void 0;var M=void 0;var x=void 0;var F=function e(t){t.each(function(t){C.select(this).selectAll("svg").remove();if(t===undefined){return}L=Math.max(this.clientWidth-n.right-n.left,0);S=C.scaleLinear().range([0,L]);A=Math.max(this.clientHeight-n.top-n.bottom,0);w=C.scaleLinear().range([A,0]);var a=C.axisBottom(S);var i=C.axisLeft(w);var o=void 0;if(c===1){o=C.area().x(function(e){return S(s(e))}).y0(A).y1(function(e){var t=Object.keys(l)[0];return w(l[t].zExtractor(e))})}b=C.select(this).selectAll("svg").data([t]);var u=b.enter().append("svg");b=C.select(this).selectAll("svg").data([t]);if(p!==undefined){u.append("defs").append("style").attr("type","text/css").text(p)}var f=u.append("g");R();f.style("font","11px Arial");if(c===1){f.append("path").attr("class","area").style("fill","rgba(222, 222, 222, 0.5)")}f.insert("g",":first-child").attr("class","grid-y");if(!r){f.append("g").attr("class","x axis").attr("transform","translate(0,"+A+")");f.append("text").attr("class","x label").attr("text-anchor","end").attr("x",L-4).attr("y",A-4);f.append("g").attr("class","y axis");f.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","grey").text(v+" [m]");f.append("g").attr("class","metas").attr("transform","translate("+(L+3)+", 0)")}f.append("g").attr("class","pois");var h=f.append("g").attr("class","x grid-hover");h.append("svg:line").attr("stroke-dasharray","5,5");h.append("text");f.append("rect").attr("class","overlay").attr("width",L).attr("height",A).style("fill","none").style("pointer-events","all");b.attr("width",L+n.left+n.right).attr("height",A+n.top+n.bottom);E=b.select("g").attr("transform","translate("+n.left+","+n.top+")");x=C.extent(t,function(e){return s(e)});S.domain(x);var d=function(){var e=[];var r=function r(a){var n=C.extent(t,function(e){return l[a].zExtractor(e)});if(n.every(Number.isFinite)){e=e.concat(n)}};for(var a in l){r(a)}return[Math.min.apply(null,e),Math.max.apply(null,e)]}();w.domain(d);if(T!==undefined){T(S,w,L,A)}else{var g=(d[1]-d[0])*.1;w.domain([d[0]-g,d[1]+g])}if(c===1){E.select(".area").transition().attr("d",o)}var F=void 0,D=void 0,k=void 0;for(D in l){f.append("path").attr("class","line "+D).style("stroke",l[D].color||"#F00").style("fill","none");k=f.append("g").attr("class","y grid-hover "+D);k.append("svg:line").attr("stroke-dasharray","5,5");k.append("text");F=C.line().x(function(e){return S(s(e))}).y(function(e){return w(l[D].zExtractor(e))}).defined(function(e){return l[D].zExtractor(e)!==null});E.select(".line."+D).transition().attr("d",F)}if(x[1]>2e3){P=1e3;M="km"}else{P=1;M="m"}if(!r){a.tickFormat(function(e){return y.xtick(e/P,M)});if(_){a.tickValues([0,S.domain()[1]])}i.tickFormat(function(e){return y.ytick(e,"m")});E.select(".x.axis").transition().call(a);E.select(".x.label").text(m+" ["+M+"]").style("fill","grey").style("shape-rendering","crispEdges");if(A/15<10){i.ticks(A/15)}E.select(".y.axis").transition().call(i)}E.select(".grid-y").transition().call(i.tickSize(-L,0).tickFormat("")).selectAll(".tick line").style("stroke","#ccc").style("opacity",.7);E.selectAll(".axis").selectAll("path, line").style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges");E.select(".grid-y").select("path").style("stroke","none");E.selectAll(".grid-hover line").style("stroke","#222").style("opacity",.8);E.select(".overlay").on("mouseout",O).on("mousemove",$);function $(){var t=C.mouse(this)[0];var r=S.invert(t);e.highlight(r)}function O(){e.clearHighlight()}})};F.clearHighlight=function(){E.selectAll(".grid-hover").style("display","none");o.call(null)};F.highlight=function(e){var t=b.datum();var r=f(t,e);if(r>=t.length){return}var a=t[r];var n=s(a);var o=void 0;var u=[];var h={};var p=void 0;for(p in l){o=l[p].zExtractor(a);if(Number.isFinite(o)){u.push(o);h[p]=o;E.select(".y.grid-hover."+p).style("display","inline").select("line").attr("x1",S(0)).attr("y1",w(o)).attr("x2",L).attr("y2",w(o))}else{E.select(".y.grid-hover."+p).style("display","none")}}var d=w(Math.max.apply(null,u));E.select(".x.grid-hover").style("display","inline").select("line").attr("x1",S(n)).attr("y1",A).attr("x2",S(n)).attr("y2",Number.isFinite(d)?d:0);var g=n>x[1]/2;var m=S(n);m+=g?-10:10;E.select(".x.grid-hover text").text(y.xhover(n/P,M)).style("text-anchor",g?"end":"start").attr("transform","translate("+m+","+(A-10)+")");var v="m";if(c===1){var _=u[0]===null?"no value":y.yhover(u[0],"m");E.select(".y.grid-hover text").text(_).style("text-anchor",g?"end":"start").attr("transform","translate("+m+","+(w(u[0])-10)+")")}i.call(null,a,n/P,M,h,v)};F.showPois=function(e){e=e!==undefined?e:[];a["a"].assert(e.length===0||h!==undefined);var t=h;var n=b.select("g");var i=b.datum();var o=n.select(".pois");var s=o.selectAll(".poi").data(e,function(e){var r=f(i,Math.round(t.dist(e)*10)/10,1);var a=i[r];if(a){var n=void 0;var o=[];for(n in l){o.push(l[n].zExtractor(a))}var s=Math.max.apply(null,o);t.z(e,s)}return t.id(e)});var u=s.enter().append("g").attr("class","poi");u.append("text").attr("x",r?0:9).attr("dy",".35em").attr("text-anchor",r?"middle":"start");u.append("line").style("shape-rendering","crispEdges");u.style("opacity",0).transition().duration(1e3).delay(100).style("opacity",1);u.selectAll("text").attr("transform",function(e){if(r){return["translate("+S(t.dist(e))+","+(w(t.z(e))-10)+")"]}else{return["translate("+S(t.dist(e))+","+(w(t.z(e))-20)+") rotate("+d+")"]}}).text(function(e){return t.sort(e)+(r?"":" - "+t.title(e))});u.selectAll("line").style("stroke","grey").attr("x1",function(e){return S(t.dist(e))}).attr("y1",function(e){return w(w.domain()[0])}).attr("x2",function(e){return S(t.dist(e))}).attr("y2",function(e){return w(t.z(e))});u.exit().remove()};function R(){F.showPois([])}return F};var T=w;var E={select:b["d"]};var A=angular.module("ngeoProfile",[g["a"].name]);A.directive_=function(e){return{restrict:"A",link:function t(r,i,o){var s=o["ngeoProfileOptions"];a["a"].assert(s!==undefined);var l=E.select(i[0]);var c=void 0,f=void 0,h=void 0;r.$watchCollection(s,function(e){var t=u["a"]({},e);if(t!==undefined){if(t.hoverCallback!==undefined){var a=t.hoverCallback;t.hoverCallback=function(){a.apply(undefined,arguments);r.$applyAsync()}}if(t.outCallback!==undefined){var n=t.outCallback;t.outCallback=function(){n();r.$applyAsync()}}c=T(t);p()}});r.$watch(o["ngeoProfile"],function(e,t){f=e;p()});r.$watch(o["ngeoProfilePois"],function(e,t){h=e;p()});r.$watch(o["ngeoProfileHighlight"],function(e,t){if(e===undefined){return}if(e>0){c.highlight(e)}else{c.clearHighlight()}});n["a"](window,"resize",e(p,50,true));function p(){if(c!==undefined){l.datum(f).call(c);if(f!==undefined){c.showPois(h)}}}}}};A.directive_.$inject=["ngeoDebounce"];A.directive("ngeoProfile",A.directive_);var L=A;var P=r(163);var M=angular.module("gmfProfile",[p["a"].module.name,d["a"].module.name,L.name]);M.value("gmfProfileTemplateUrl",function(e,t){var r=t["gmfProfileTemplateurl"];return r!==undefined?r:"gmf/profile"});M.run(["$templateCache",function(e){e.put("gmf/profile",r(374))}]);x.$inject=["$element","$attrs","gmfProfileTemplateUrl"];function x(e,t,r){return r(e,t)}M.component_={controller:"GmfProfileController as ctrl",bindings:{active:"=gmfProfileActive",line:"=gmfProfileLine",getMapFn:"&?gmfProfileMap",getLinesConfigurationFn:"&gmfProfileLinesconfiguration",getHoverPointStyleFn:"&?gmfProfileHoverpointstyle",getNbPointsFn:"&?gmfProfileNumberofpoints",getOptionsFn:"&?gmfProfileOptions"},templateUrl:x};M.component("gmfProfile",M.component_);M.Controller_=function(e,t,r,a,n,o,s,l){var u=this;this.$scope_=e;this.$http_=t;this.$element_=r;this.$filter_=a;this.gettextCatalog_=n;this.pointHoverOverlay_=o.getFeatureOverlay();this.gmfProfileJsonUrl_=s;this.ngeoCsvDownload_=l;this.map_=null;this.linesConfiguration_=null;this.layersNames_=[];this.nbPoints_=100;this.line;this.profileData=[];this.currentPoint={coordinate:undefined,distance:undefined,elevations:{},xUnits:undefined,yUnits:undefined};this.profileHighlight=-1;this.measureTooltip_=null;this.measureTooltipElement_=null;this.snappedPoint_=new i["a"];this.pointHoverOverlay_.addFeature(this.snappedPoint_);this.profileLabels_={xAxis:n.getString("Distance"),yAxis:n.getString("Elevation")};this.profileOptions=null;this.active=false;this.pointerMoveKey_;this.isErrored=false;e.$watch(function(){return u.active},function(e,t){if(t!==e){u.updateEventsListening_()}});e.$watch(function(){return u.line},function(e,t){if(t!==e){u.update_()}});this.updateEventsListening_()};M.Controller_.$inject=["$scope","$http","$element","$filter","gettextCatalog","ngeoFeatureOverlayMgr","gmfProfileJsonUrl","ngeoCsvDownload"];M.Controller_.prototype.$onInit=function(){this.map_=this["getMapFn"]?this["getMapFn"]():null;this.nbPoints_=this["getNbPointsFn"]?this["getNbPointsFn"]():100;var e=void 0;var t=this["getHoverPointStyleFn"];if(t){e=t();a["a"].assertInstanceof(e,h["c"])}else{e=new h["c"]({image:new c["a"]({fill:new f["a"]({color:"#ffffff"}),radius:3})})}this.pointHoverOverlay_.setStyle(e);var r=this["getLinesConfigurationFn"]();a["a"].assertInstanceof(r,Object);this.linesConfiguration_=r;for(var n in this.linesConfiguration_){this.layersNames_.push(n);var i=this.linesConfiguration_[n];if(!i.zExtractor){this.linesConfiguration_[n].zExtractor=this.getZFactory_(n)}}this.profileOptions={linesConfiguration:this.linesConfiguration_,distanceExtractor:this.getDist_,hoverCallback:this.hoverCallback_.bind(this),outCallback:this.outCallback_.bind(this),i18n:this.profileLabels_};var o=this["getOptionsFn"];if(o){var s=o();a["a"].assertObject(s);u["a"](this.profileOptions,s)}};M.Controller_.prototype.update_=function(){this.isErrored=false;if(this.line){this.getJsonProfile_()}else{this.profileData=[]}this.active=!!this.line};M.Controller_.prototype.updateEventsListening_=function(){if(this.active&&this.map_!==null){this.pointerMoveKey_=n["a"](this.map_,"pointermove",this.onPointerMove_.bind(this))}else{n["e"](this.pointerMoveKey_)}};M.Controller_.prototype.onPointerMove_=function(e){if(e.dragging||!this.line){return}var t=this.map_.getEventCoordinate(e.originalEvent);var r=this.line.getClosestPoint(t);var a=new s["a"]([r,t]);var n=a.getLength()/this.map_.getView().getResolution();if(n<16){this.profileHighlight=this.getDistanceOnALine_(r,this.line)}else{this.profileHighlight=-1}this.$scope_.$apply()};M.Controller_.prototype.getDistanceOnALine_=function(e,t){var r=void 0;var a=0;var n=[e[0]-.5,e[1]-.5,e[0]+.5,e[1]+.5];this.line.forEachSegment(function(t,i){r=new s["a"]([t,i]);if(r.intersectsExtent(n)){r.setCoordinates([t,e]);return a+=r.getLength()}else{a+=r.getLength()}});return a};M.Controller_.prototype.hoverCallback_=function(e,t,r,a,n){var i=[e.x,e.y];this.currentPoint.elevations=a;this.currentPoint.distance=t;this.currentPoint.xUnits=r;this.currentPoint.yUnits=n;this.currentPoint.coordinate=i;var o=new l["a"](i);this.createMeasureTooltip_();this.measureTooltipElement_.innerHTML=this.getTooltipHTML_();this.measureTooltip_.setPosition(i);this.snappedPoint_.setGeometry(o)};M.Controller_.prototype.outCallback_=function(){this.currentPoint.coordinate=undefined;this.currentPoint.distance=undefined;this.currentPoint.elevations={};this.currentPoint.xUnits=undefined;this.currentPoint.yUnits=undefined;this.removeMeasureTooltip_();this.snappedPoint_.setGeometry(null)};M.Controller_.prototype.getTooltipHTML_=function(){var e=this.gettextCatalog_;var t="&nbsp;: ";var r=void 0,a=void 0;var n=[];var i=this.$filter_("number");var o=this.currentPoint.xUnits==="m"?0:2;var s=i(this.currentPoint.distance,o);n.push(this.profileLabels_.xAxis+" "+t+" "+s+"&nbsp;"+this.currentPoint.xUnits);for(r in this.currentPoint.elevations){a=e.getString(r);var l=this.currentPoint.elevations[r];var u=l===null?e.getString("no value"):i(l,0)+"&nbsp;"+this.currentPoint.yUnits;n.push(a+" "+t+" "+u)}return n.join("</br>")};M.Controller_.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_();this.measureTooltipElement_=document.createElement("div");this.measureTooltipElement_.className+="tooltip ngeo-tooltip-measure";this.measureTooltip_=new o["a"]({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center"});this.map_.addOverlay(this.measureTooltip_)};M.Controller_.prototype.removeMeasureTooltip_=function(){if(this.measureTooltipElement_!==null){this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_);this.measureTooltipElement_=null;this.map_.removeOverlay(this.measureTooltip_)}};M.Controller_.prototype.getStyle=function(e){var t=this.linesConfiguration_[e];if(!t){return{}}return{color:t.color||"#F00"}};M.Controller_.prototype.getLayersNames=function(){return this.layersNames_.slice(0)};M.Controller_.prototype.getZFactory_=function(e){var t=function t(r){if("values"in r&&e in r["values"]&&r["values"][e]){return parseFloat(r["values"][e])}return null};return t};M.Controller_.prototype.getDist_=function(e){if("dist"in e){return e["dist"]}return 0};M.Controller_.prototype.getJsonProfile_=function(){var e={type:"LineString",coordinates:this.line.getCoordinates()};var t={layers:this.layersNames_.join(","),geom:JSON.stringify(e),nbPoints:this.nbPoints_};this.$http_({url:this.gmfProfileJsonUrl_,method:"POST",params:t,paramSerializer:"$httpParamSerializerJQLike",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(this.getProfileDataSuccess_.bind(this),this.getProfileDataError_.bind(this))};M.Controller_.prototype.getProfileDataSuccess_=function(e){var t=e.data["profile"];if(t instanceof Array){this.profileData=t}};M.Controller_.prototype.getProfileDataError_=function(e){this.isErrored=true;console.error("Can not get JSON profile.")};M.Controller_.prototype.downloadCsv=function(){if(this.profileData.length===0){return}var e=[];var t=false;var r=this.profileData[0];if("dist"in r){e.push({name:"distance"});t=true}var a=[];for(var n in r["values"]){e.push({name:n});a.push(n)}e.push({name:"x"});e.push({name:"y"});var i=this.profileData.map(function(e){var r={};if(t){r["distance"]=e["dist"]}a.forEach(function(t){r[t]=e["values"][t]});r["x"]=e["x"];r["y"]=e["y"];return r});this.ngeoCsvDownload_.startDownload(i,e,"profile.csv")};M.controller("GmfProfileController",M.Controller_);var F=M;var R=r(18);var D=r(110);var k=r(99);var $=r(53);var O=r(140);var I=angular.module("gmfDrawProfileLine",[d["a"].module.name]);I.directive_=function(){return{scope:true,controller:"GmfDrawprofilelineController as ctrl",restrict:"A",bindToController:{getMapFn:"&gmfDrawprofilelineMap",line:"=gmfDrawprofilelineLine",active:"=gmfDrawprofilelineActive",getStyleFn:"&?gmfDrawprofilelineStyle"}}};I.directive("gmfDrawprofileline",I.directive_);I.Controller_=function(e,t,r,n){var i=this;this.line;this.map_=null;this.active;this.features_=new R["b"];var o=n.getFeatureOverlay();o.setFeatures(this.features_);var s=void 0;var l=this["getStyleFn"];if(l){s=l();a["a"].assertInstanceof(s,h["c"])}else{s=new h["c"]({stroke:new $["a"]({color:"#ffcc33",width:2})})}o.setStyle(s);this.interaction=new D["a"]({type:"LineString",features:this.features_});O["a"].interaction(this.interaction);this.interaction.on("change:active",function(){if(i.interaction.getActive()){i.clear_()}});this.interaction.on("drawend",function(e){i.line=e.feature.getGeometry();r(function(){i.interaction.setActive(false)},0)});e.$watch(function(){return i.line},function(e,t){if(e===null){i.clear_()}});e.$watch(function(){return i.active},function(e){if(e===false){i.clear_()}i.interaction.setActive(i.active)})};I.Controller_.$inject=["$scope","$element","$timeout","ngeoFeatureOverlayMgr"];I.Controller_.prototype.$onInit=function(){var e=this["getMapFn"]();a["a"].assertInstanceof(e,k["a"]);this.map_=e;this.map_.addInteraction(this.interaction)};I.Controller_.prototype.clear_=function(){this.features_.clear();this.line=null};I.controller("GmfDrawprofilelineController",I.Controller_);var N=I;var G=r(454);var U=angular.module("gmfProfileModule",[F.name,N.name]);var j=t["a"]=U},,,,function(e,t,r){"use strict";var a=r(130);var n=r(205);var i=r(43);var o=angular.module("ngeoBboxQuery",[a["a"].module.name]);o.directive_=function(e){return{restrict:"A",scope:false,link:function t(r,a,o){var s=r.$eval(o["ngeoBboxQueryMap"]);var l=new n["a"]({condition:i["h"]});var u=function t(a){var n=l.getGeometry().getExtent();e.issue({limit:r.$eval(o["ngeoBboxQueryLimit"]),extent:n,map:s})};l.on("boxend",u);r.$watch(o["ngeoBboxQueryActive"],function(t,a){if(t){s.addInteraction(l)}else{s.removeInteraction(l);if(r.$eval(o["ngeoBboxQueryAutoclear"])!==false){e.clear()}}})}}};o.directive_.$inject=["ngeoMapQuerent"];o.directive("ngeoBboxQuery",o.directive_);t["a"]=o},function(e,t,r){"use strict";var a=r(276);var n=r(2);var i=r(187);var o=r(3);var s=r(163);var l=r.n(s);var u=angular.module("gmfRasterComponent",[a["a"].module.name,i["a"].name]);u.run(["$templateCache",function(e){e.put("gmf/raster/widgetComponent",r(373))}]);u.value("gmfElevationwidgetTemplateUrl",function(e){var t=e["gmfElevationwidgetTemplateUrl"];return t!==undefined?t:"gmf/raster/widgetComponent"});c.$inject=["$attrs","gmfElevationwidgetTemplateUrl"];function c(e,t){return t(e)}u.component_=function(){return{restrict:"A",controller:"GmfElevationController as ctrl",bindToController:true,scope:{active:"<gmfElevationActive",elevation:"=gmfElevationElevation",layersconfig:"=gmfElevationLayersconfig",loading:"=?gmfElevationLoading",layer:"<gmfElevationLayer",map:"=gmfElevationMap"},link:function e(t,r,a){var n=t["ctrl"];t.$watch(function(){return n.active},function(e){this.toggleActive_(e)}.bind(n));t.$watch(function(){return n.layer},function(e){this.layer=e;this.elevation=null}.bind(n))}}};u.directive("gmfElevation",u.component_);u.Controller_=function(e,t,r,a,n){this.filter_=t;this.ngeoDebounce_=r;this.gmfRaster_=a;this.gettextCatalog=n;this.layersConfig;this.active;this.elevation;this.layer;this.map;this.listenerKeys_=[];this.scope_=e;this.inViewport_=false;this.loading=false};u.Controller_.$inject=["$scope","$filter","ngeoDebounce","gmfRaster","gettextCatalog"];u.Controller_.prototype.toggleActive_=function(e){var t=this;this.elevation=undefined;if(e){n["a"].assert(this.listenerKeys_.length===0);this.listenerKeys_.push(o["a"](this.map,"pointermove",function(e){var t=this;this.scope_.$apply(function(){t.inViewport_=true;t.elevation=undefined;t.loading=false})},this));this.listenerKeys_.push(o["a"](this.map,"pointermove",this.ngeoDebounce_(this.pointerStop_.bind(this),500,true)));this.listenerKeys_.push(o["a"](this.map.getViewport(),"mouseout",function(){t.scope_.$apply(function(){t.elevation=undefined;t.inViewport_=false;t.loading=false})}))}else{this.elevation=undefined;this.listenerKeys_.forEach(o["e"]);this.listenerKeys_.length=0}};u.Controller_.prototype.pointerStop_=function(e){if(this.inViewport_){this.loading=true;var t={layers:this.layer};this.gmfRaster_.getRaster(e.coordinate,t).then(this.getRasterSuccess_.bind(this),this.getRasterError_.bind(this))}};u.Controller_.prototype.getRasterSuccess_=function(e){n["a"].assert(this.layer,"A layer should be selected");var t=e[this.layer];if(t!==undefined&&t!==null){var r=this.layersconfig[this.layer]||{};var a=r.filter||"number";var i=r.args||[];var o=r.hasOwnProperty("postfix")?r.postfix:"m";var s=o.length>0?r.hasOwnProperty("separator")?r.separator:" ":"";var l=Array.prototype.concat([t],i);this.elevation=this.filter_(a).apply(undefined,l)+s+o}else{var u=this.gettextCatalog;this.elevation=u.getString("No value")}this.loading=false};u.Controller_.prototype.getRasterError_=function(){console.error("Error on getting the raster.");this.elevation=undefined;this.loading=false};u.controller("GmfElevationController",u.Controller_);u.widgetComponent_={controller:"gmfElevationwidgetController as ctrl",bindings:{map:"<gmfElevationwidgetMap",layers:"<gmfElevationwidgetLayers",layersconfig:"=gmfElevationwidgetLayersconfig",active:"<gmfElevationwidgetActive"},templateUrl:c};u.component("gmfElevationwidget",u.widgetComponent_);u.WidgetController_=function(){this.map;this.layers;this.layersconfig;this.active;this.selectedElevationLayer};u.WidgetController_.prototype.$onInit=function(){this.selectedElevationLayer=this.layers[0]};u.controller("gmfElevationwidgetController",u.WidgetController_);u.LayerConfig;t["a"]=u},,,function(e,t,r){"use strict";(function(e){var a=r(48);var n=r(194);var i=r(46);var o=r(2);var s=r(101);var l=r(100);var u=r(65);var c=r(331);var f=r(248);var h=r(130);var p=r(7);var d=r(3);var g=r(114);var m=r(93);var v=r(78);var y=r(99);var _=r(12);var b=r(163);var S=r.n(b);function C(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var w=angular.module("gmfPrintComponent",[n["a"].module.name,i["a"].module.name,s["a"].module.name,l["a"].module.name,u["a"].module.name,c["a"].module.name,f["a"].module.name,h["a"].module.name]);w.value("gmfPrintTemplateUrl",function(e,t){var r=t["gmfPrintTemplateurl"];return r!==undefined?r:"gmf/print"});w.run(["$templateCache",function(e){e.put("gmf/print",r(375))}]);w.PrintStateEnum={NOT_IN_USE:"notInUse",PRINTING:"printing",ERROR_ON_REPORT:"errorOnReport",CAPABILITIES_NOT_LOADED:"capabilitiesNotLoaded",ERROR_ON_GETCAPABILITIES:"errorOnGetCapabilities"};w.value("gmfPrintState",{state:w.PrintStateEnum.CAPABILITIES_NOT_LOADED});T.$inject=["$element","$attrs","gmfPrintTemplateUrl"];function T(e,t,r){return r(e,t)}w.component_={bindings:{map:"<gmfPrintMap",active:"=gmfPrintActive",rotateMask:"<?gmfPrintRotatemask",fieldValues:"<?gmfPrintFieldvalues",hiddenAttributeNames:"<?gmfPrintHiddenattributes",attributesOut:"=?gmfPrintAttributesOut"},controller:"GmfPrintController",templateUrl:T,transclude:true};w.component("gmfPrint",w.component_);w.optionsLegendType;w.optionsType;w.Controller_=function(){t.$inject=["$element","$rootScope","$scope","$timeout","$q","$injector","gettextCatalog","ngeoLayerHelper","ngeoFeatureOverlayMgr","ngeoPrintUtils","ngeoCreatePrint","gmfPrintUrl","gmfAuthenticationService","ngeoQueryResult","$filter","gmfPrintState","gmfThemes"];function t(r,a,n,i,o,s,l,u,c,f,h,p,d,g,m,v,y){var _=this;C(this,t);this.gmfPrintState_=v;this.translate_=m("translate");this.map;this.active;this.rotateMask=false;this.fieldValues={};this.attributesOut;this.$rootScope_=a;this.$scope_=n;this.$timeout_=i;this.$q_=o;this.gettextCatalog_=l;this.ngeoLayerHelper_=u;this.featureOverlayLayer_=c.getLayer();this.ngeoPrintUtils_=f;this.ngeoPrint_=h(p);this.ngeoQueryResult_=g;this.gmfAuthenticationService_=d;this.gmfThemes_=y;this.cacheVersion_="0";if(s.has("cacheVersion")){this.cacheVersion_=s.get("cacheVersion")}this.scaleInput=false;this.gmfLegendOptions_={useBbox:true,label:{},params:{}};if(s.has("gmfPrintOptions")){var b=s.get("gmfPrintOptions");if(b.scaleInput){this.scaleInput=b.scaleInput}if(b.legend){Object.assign(this.gmfLegendOptions_,b.legend)}}this.requestCanceler_=null;this.statusTimeoutPromise_=null;this.onDragPreviousMousePosition_=null;this.rotationTimeoutPromise_=null;this.postComposeListenerKey_;this.pointerDragListenerKey_;this.mapViewResolutionChangeKey_;this.curRef_="";this.formats_=[];this.layouts_=[];this.layout_={};this.paperSize_=[];this.layoutInfo={};this.rotation=0;this.hiddenAttributeNames;this.scaleManuallySelected_=false;this.rotationInput_=r.find(".gmf-print-rotation-input");this.rotationInput_.on("input",function(t){var r=e(t.target).val();if(r!==""){_.setRotation(r)}});this.rotationInput_.on("change",function(t){var r=e(t.target).val();if(r!==""){_.setRotation(r)}});this.postcomposeListener_;this.capabilities_;this.ogcServers_;this.currentThemes_}t.prototype.$onInit=function e(){var t=this;d["a"](this.map.getView(),"change:rotation",function(e){t.updateRotation_(Math.round(_["h"](e.target.getRotation())))});this.$scope_.$watch(function(){return t.gmfAuthenticationService_.getRoleId()},function(){t.gmfPrintState_.state=w.PrintStateEnum.CAPABILITIES_NOT_LOADED;t.capabilities_=null});this.$scope_.$watch(function(){return t.active},function(e){t.togglePrintPanel_(e)});this.$rootScope_.$on("gmfStartPrint",function(e,r){t.print(""+r)});this.$rootScope_.$on("gmfCancelPrint",function(){t.cancel()});this.gmfThemes_.getOgcServersObject().then(function(e){t.ogcServers_=e});this.gmfThemes_.getThemesObject().then(function(e){t.currentThemes_=e});var r=function e(){return t.paperSize_};var a=void 0;if(this.rotateMask){a=function e(){return t.rotation}}this.postcomposeListener_=this.ngeoPrintUtils_.createPrintMaskPostcompose(r,this.getScaleFn.bind(this),a)};t.prototype.getScaleFn=function e(t){o["a"].assert(this.layoutInfo.scales);o["a"].assert(this.layoutInfo.scale!==undefined);if(!this.scaleManuallySelected_&&(this.layoutInfo.scale===-1||p["f"](this.layoutInfo.scales,this.layoutInfo.scale))){var r=t.size;var a=t.viewState.resolution;this.layoutInfo.scale=this.getOptimalScale_(r,a)}return this.layoutInfo.scale};t.prototype.togglePrintPanel_=function e(t){var r=this;if(t){if(!this.capabilities_){this.getCapabilities_()}this.capabilities_.then(function(e){if(!r.active){return}r.gmfPrintState_.state=w.PrintStateEnum.NOT_IN_USE;r.parseCapabilities_(e);r.postComposeListenerKey_=d["a"](r.map,"postcompose",r.postcomposeListener_);r.pointerDragListenerKey_=d["a"](r.map,"pointerdrag",r.onPointerDrag_,r);r.mapViewResolutionChangeKey_=d["a"](r.map.getView(),"change:resolution",function(){r.scaleManuallySelected_=false});r.map.render()},function(e){r.gmfPrintState_.state=w.PrintStateEnum.ERROR_ON_GETCAPABILITIES;r.capabilities_=null})}else{d["e"](this.postComposeListenerKey_);d["e"](this.pointerDragListenerKey_);d["e"](this.mapViewResolutionChangeKey_);this.setRotation(0);this.map.render()}};t.prototype.getCapabilities_=function e(t){this.capabilities_=this.ngeoPrint_.getCapabilities({withCredentials:true,params:t?{role:t,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_}})};t.prototype.parseCapabilities_=function e(t){var r=this;var a=t["data"];this.formats_=a["formats"]||[];this.layouts_=a["layouts"];this.layout_=a["layouts"][0];this.layoutInfo.layouts=[];this.layouts_.forEach(function(e){r.layoutInfo.layouts.push(e.name)});this.updateFields_()};t.prototype.updateFields_=function e(){var t=this;this.layoutInfo.layout=this.layout_.name;var r=this.isAttributeInCurrentLayout_("map");o["a"].assertObject(r);var a=r["clientInfo"];o["a"].assertObject(a);this.paperSize_=[a["width"],a["height"]];this.updateCustomFields_();this.layoutInfo.legend=this.fieldValues["legend"]!==false;this.layoutInfo.scales=a["scales"]||[];this.layoutInfo.dpis=a["dpiSuggestions"]||[];var n=this.map.getSize();var i=this.map.getView().getResolution();this.layoutInfo.scale=this.getOptimalScale_(n,i);this.layoutInfo.dpi=this.layoutInfo.dpi&&this.layoutInfo.dpis.indexOf(this.layoutInfo.dpi)>0?this.layoutInfo.dpi:this.layoutInfo.dpis[0];this.layoutInfo.formats={};this.formats_.forEach(function(e){t.layoutInfo.formats[e]=true});this.attributesOut=this.layoutInfo["simpleAttributes"];this.map.render()};t.prototype.updateCustomFields_=function e(){var t=this;var r=void 0,a=void 0,n=void 0,i=void 0;if(!this.layoutInfo.simpleAttributes){this.layoutInfo.simpleAttributes=[]}if(!this.layoutInfo.attributes){this.layoutInfo.attributes=[]}var o=this.layoutInfo.simpleAttributes;var s=o.splice(0,o.length);this.layout_.attributes.forEach(function(e){t.layoutInfo.attributes.push(e.name);if(!e["clientParams"]){r=""+e.name;var o=e.default;n=o!==undefined&&o!==""?o:t.fieldValues[r];a=""+e.type;switch(a){case"String":i=r==="comments"?"textarea":"text";break;case"Boolean":i="checkbox";break;case"Number":i="number";n=parseFloat(n);n=isNaN(n)?0:n;break;default:i=a}s.forEach(function(e){if(e.name===r&&e.type===i){return n=e.value}});t.layoutInfo.simpleAttributes.push({name:r,type:i,value:n})}})};t.prototype.isAttributeInCurrentLayout_=function e(t){var r=null;this.layout_.attributes.forEach(function(e){if(e.name===t){return r=e}});return r};t.prototype.setRotation=function e(t){this.updateRotation_(t);if(this.rotateMask){this.map.render()}else{this.map.getView().setRotation(_["i"](this.rotation))}};t.prototype.updateRotation_=function e(t){this.rotation=_["a"](t,-180,180);this.rotationInput_.val(this.rotation.toString())};t.prototype.onPointerDrag_=function e(t){var r=this;var a=t.originalEvent;var n=this.map.getView().getCenter();if(this.active&&a.altKey&&a.shiftKey&&n){var i=this.map.getPixelFromCoordinate(n);var o=t.pixel;if(this.rotationTimeoutPromise_===null){this.onDragPreviousMousePosition_=null}else{this.$timeout_.cancel(this.rotationTimeoutPromise_);var s=this.onDragPreviousMousePosition_[0]-i[0];var l=this.onDragPreviousMousePosition_[1]-i[1];var u=o[0]-i[0];var c=o[1]-i[1];var f=Math.sqrt(Math.pow(s,2)+Math.pow(l,2));var h=Math.sqrt(Math.pow(u,2)+Math.pow(c,2));var p=s*c-l*u>0?1:-1;var d=(s*u+l*c)/(f*h);d=d<=1?p*Math.acos(d):0;var g=h/200;var m=Math.round(_["h"](d)*g);this.setRotation(this.rotation+m);this.$scope_.$digest()}this.rotationTimeoutPromise_=this.$timeout_(function(){r.rotationTimeoutPromise_=null},500);this.onDragPreviousMousePosition_=o}};t.prototype.print=function e(t){if(this.gmfPrintState_.state===w.PrintStateEnum.PRINTING){return}this.requestCanceler_=this.$q_.defer();this.gmfPrintState_.state=w.PrintStateEnum.PRINTING;var r=this.map.getSize();var a=this.map.getView().getResolution()||0;var n=this.layoutInfo.scale||this.getOptimalScale_(r,a);var i=this.getDataSource_();var s={};if(this.layoutInfo.attributes.indexOf("datasource")>=0){s["datasource"]=i}if(this.layoutInfo.simpleAttributes){this.layoutInfo.simpleAttributes.forEach(function(e){s[e.name]=e.value})}if(this.layoutInfo.legend){var l=this.map.getView().getCenter();var u=this.paperSize_[0]*n/2/f["a"].INCHES_PER_METER_/f["a"].DOTS_PER_INCH_;var c=this.paperSize_[1]*n/2/f["a"].INCHES_PER_METER_/f["a"].DOTS_PER_INCH_;var h=[l[0]-u,l[1]-c,l[0]+u,l[1]+c];var p=this.getLegend_(n,this.layoutInfo.dpi,h);if(p!==null){s["legend"]=p}}o["a"].assertNumber(this.layoutInfo.dpi);o["a"].assertString(this.layoutInfo.layout);var d=new y["a"]({});d.setView(this.map.getView());var m=this.ngeoLayerHelper_.getFlatLayers(this.map.getLayerGroup());var _=[];var b=true;for(var S=0,C=m.length;S<C;S++){var T=m[S];var E=T.get("metadata");if(E){var A=E.ogcServer;var L=E.printLayers||E.layers;if(A&&L){var P=this.ogcServers_[A];if(P){T=this.ngeoLayerHelper_.createBasicWMSLayer(P.url,L,P.imageType,P.type,undefined,undefined,undefined,undefined,{opacity:m.opacity});T.setZIndex(-200)}else{console.error("Missing ogcServer:",A)}}}if(T instanceof g["a"]&&T.get("printNativeAngle")===false){b=false}_.push(T)}d.setLayerGroup(new v["a"]({layers:_,printNativeAngle:b}));var M=this.ngeoPrint_.createSpec(d,n,this.layoutInfo.dpi,this.layoutInfo.layout,t,s);var x=[];this.ngeoPrint_.encodeLayer(x,this.featureOverlayLayer_,a);if(x.length>0){M.attributes.map.layers.unshift(x[0])}this.ngeoPrint_.createReport(M,{timeout:this.requestCanceler_.promise}).then(this.handleCreateReportSuccess_.bind(this),this.handleCreateReportError_.bind(this));d.setTarget(null)};t.prototype.cancel=function e(){if(this.requestCanceler_!==null){this.requestCanceler_.resolve()}if(this.statusTimeoutPromise_!==null){this.$timeout_.cancel(this.statusTimeoutPromise_)}if(this.curRef_.length>0){this.ngeoPrint_.cancel(this.curRef_)}this.resetPrintStates_()};t.prototype.resetPrintStates_=function e(t){this.gmfPrintState_.state=t||w.PrintStateEnum.NOT_IN_USE;this.curRef_=""};t.prototype.getDataSource_=function e(){var t=void 0,r=void 0,a=void 0;var n=[];var i=this.ngeoQueryResult_.sources;i.forEach(function(e){r=[];a=[];e.features.forEach(function(e,t){o["a"].assert(e);var n=u["a"].getFilteredFeatureValues(e);if(t===0){a=Object.keys(n).map(function e(t){return this.translate_(t)},this)}r.push(Object.keys(n).map(function(e){return n[e]}))},this);if(a.length){t={title:this.translate_(e.label),table:{columns:a,data:r}};n.push(t)}},this);return n};t.prototype.getOptimalScale_=function e(t,r){var a=this.layoutInfo.scales.slice();if(t!==undefined&&r!==undefined){return this.ngeoPrintUtils_.getOptimalScale(t,r,this.paperSize_,a.reverse())}return this.layoutInfo.scales[0]};t.prototype.handleCreateReportSuccess_=function e(t){var r=t.data;var a=r.ref;o["a"].assert(a.length>0);this.curRef_=a;this.getStatus_(a)};t.prototype.getStatus_=function e(t){this.requestCanceler_=this.$q_.defer();this.ngeoPrint_.getStatus(t,{timeout:this.requestCanceler_.promise}).then(this.handleGetStatusSuccess_.bind(this,t),this.handleCreateReportError_.bind(this))};t.prototype.handleGetStatusSuccess_=function e(t,r){var a=this;var n=r.data;var i=n.done;if(i){if(n.status!="error"){window.location.href=this.ngeoPrint_.getReportUrl(t);this.resetPrintStates_()}else{console.error(n.error);this.handleCreateReportError_()}}else{this.statusTimeoutPromise_=this.$timeout_(function(){a.getStatus_(t)},1e3,false)}};t.prototype.handleCreateReportError_=function e(){this.resetPrintStates_(w.PrintStateEnum.ERROR_ON_REPORT)};t.prototype.getLegend_=function e(t,r,n){var i=this;var o={classes:[]};var s=this.gettextCatalog_;var l=this.ngeoLayerHelper_.getGroupFromMap(this.map,a["a"].DATALAYERGROUP_NAME);var u=this.ngeoLayerHelper_.getFlatLayers(l);u.reverse().forEach(function(e){var a=[];if(e.getVisible()&&e.getSource()){if(e instanceof m["a"]){var l=""+e.get("layerNodeName");var u=i.getMetadataLegendImage_(l);if(!u){u=i.ngeoLayerHelper_.getWMTSLegendURL(e)}if(u){a.push({name:s.getString(l),icons:[u]})}}else{var c=e.getSource();var f=c.getParams()["LAYERS"].split(",");f.forEach(function(o){var l=i.getMetadataLegendImage_(o);if(!l){l=i.ngeoLayerHelper_.getWMSLegendURL(c.getUrl(),o,t,undefined,undefined,undefined,c.serverType_,r,i.gmfLegendOptions_.useBbox?n:undefined,i.map.getView().getProjection().getCode(),i.gmfLegendOptions_.params[e.getSource().serverType_])}var u=l?"image":c.serverType_;if(l&&o.length!==0){a.push(Object.assign({name:i.gmfLegendOptions_.label[u]===false?"":s.getString(o),icons:[l]},u==="qgis"?{dpi:r}:{}))}})}}if(a.length>0){o["classes"].push({classes:a})}});return o["classes"].length>0?o:null};t.prototype.getMetadataLegendImage_=function e(t){var r=i["a"].findGroupByLayerNodeName(this.currentThemes_,t);var a=void 0;if(r&&r.children){a=i["a"].findObjectByName(r.children,t)}var n=void 0;if(a&&a.metadata){n=a.metadata.legendImage}return n};t.prototype.setLayout=function e(t){var r=void 0;this.layouts_.forEach(function(e){if(e.name===t){r=e;return true}});this.layout_=r;this.updateFields_()};t.prototype.getSetScale=function e(t){if(t!==undefined){var r=this.map.getSize()||[0,0];this.layoutInfo.scale=t;var a=this.ngeoPrintUtils_.getOptimalResolution(r,this.paperSize_,t);var n=this.map.getView().constrainResolution(a,0,1);this.map.getView().setResolution(n);this.map.render();this.scaleManuallySelected_=true}return this.layoutInfo.scale};t.prototype.setDpi=function e(t){this.layoutInfo.dpi=t};t.prototype.isState=function e(t){return this.gmfPrintState_.state===w.PrintStateEnum[t]};return t}();w.controller("GmfPrintController",w.Controller_);t["a"]=w}).call(this,r(36))},function(e,t,r){"use strict";var a=r(2);var n=r(134);var i=r(20);var o=r(253);var s=r(252);var l=r(131);var u=r(52);var c=r(1);var f=r(18);var h=r(3);var p=r(22);var d=r(110);var g=r(13);var m=angular.module("ngeoCreatefeature",[l["a"].module.name,n["a"].name]);m.directive_=function(){return{controller:"ngeoCreatefeatureController",bindToController:true,scope:{active:"=ngeoCreatefeatureActive",features:"=ngeoCreatefeatureFeatures",geomType:"=ngeoCreatefeatureGeomType",map:"=ngeoCreatefeatureMap"}}};m.directive("ngeoCreatefeature",m.directive_);m.Controller_=function(e,t,r,a,n,i,o){var s=this;this.active;this.features;this.geomType;this.map;this.gettextCatalog_=e;this.compile_=t;this.filter_=r;this.scope_=n;this.timeout_=i;this.ngeoEventHelper_=o;this.injector_=a;this.interaction_;n.$watch(function(){return s.active},function(e){s.interaction_.setActive(e)})};m.Controller_.$inject=["gettextCatalog","$compile","$filter","$injector","$scope","$timeout","ngeoEventHelper"];m.Controller_.prototype.$onInit=function(){this.active=this.active===true;var e=this.gettextCatalog_;var t=void 0;if(this.geomType===i["a"].POINT||this.geomType===i["a"].MULTI_POINT){t=new d["a"]({type:"Point"})}else if(this.geomType===i["a"].LINE_STRING||this.geomType===i["a"].MULTI_LINE_STRING){var r=e.getString("Click to start drawing length");var n=e.getString("Click to continue drawing<br/>"+"Double-click or click last point to finish");t=new s["a"](this.filter_("ngeoUnitPrefix"),e,{style:new g["c"],startMsg:this.compile_("<div translate>"+r+"</div>")(this.scope_)[0],continueMsg:this.compile_("<div translate>"+n+"</div>")(this.scope_)[0],tolerance:this.injector_.has("ngeoSnappingTolerance")?this.injector_.get("ngeoSnappingTolerance"):undefined,source:this.injector_.has("ngeoSnappingSource")?this.injector_.get("ngeoSnappingSource"):undefined})}else if(this.geomType===i["a"].POLYGON||this.geomType===i["a"].MULTI_POLYGON){var l=e.getString("Click to start drawing area");var u=e.getString("Click to continue drawing<br/>"+"Double-click or click starting point to finish");t=new o["a"](this.filter_("ngeoUnitPrefix"),e,{style:new g["c"],startMsg:this.compile_("<div translate>"+l+"</div>")(this.scope_)[0],continueMsg:this.compile_("<div translate>"+u+"</div>")(this.scope_)[0]})}a["a"].assert(t);t.setActive(this.active);this.interaction_=t;this.map.addInteraction(t);var f=c["c"](this);this.ngeoEventHelper_.addListenerKey(f,h["a"](document.body,"keydown",this.handleEscapeKeyDown_,this));if(t instanceof d["a"]){this.ngeoEventHelper_.addListenerKey(f,h["a"](t,"drawend",this.handleDrawEnd_,this))}else if(t instanceof s["a"]||t instanceof o["a"]){this.ngeoEventHelper_.addListenerKey(f,h["a"](t,"measureend",this.handleDrawEnd_,this))}};m.Controller_.prototype.handleEscapeKeyDown_=function(e){var t=this.interaction_;var r=e.keyCode===27;if(!u["a"].mousedown&&r&&t.getActive()){t.setActive(false);t.setActive(true)}};m.Controller_.prototype.handleDrawEnd_=function(e){var t=void 0;if(e.feature){t=e.feature}else{t=e.detail.feature}a["a"].assert(t);var r=t.getGeometry();var n=r.getType();if(this.geomType.indexOf("Multi")!=n.indexOf("Multi")){r=u["b"].toMulti(r)}var i=new p["a"](r);if(this.features instanceof f["b"]){this.features.push(i)}else{this.features.addFeature(i)}};m.Controller_.prototype.$onDestroy=function(){var e=this;this.timeout_(function(){var t=c["c"](e);e.ngeoEventHelper_.clearListenerKey(t);e.interaction_.setActive(false);e.map.removeInteraction(e.interaction_)},0)};m.controller("ngeoCreatefeatureController",m.Controller_);t["a"]=m},function(e,t,r){"use strict";(function(e){var a=r(242);var n=r(317);var i=r.n(n);var o=r(455);var s=r.n(o);var l=angular.module("ngeoDateTimePicker",["gettext"]);l.component_=function(){return{restrict:"A",controller:l.Controller_,bindToController:true,scope:{options:"<ngeoDatetimepickerOptions"}}};l.directive("ngeoDatetimepicker",l.component_);l.Controller_=function(e,t){this.element_=e;this.gettextCatalog_=t;this.options};l.Controller_.$inject=["$element","gettextCatalog"];l.Controller_.prototype.$onInit=function(){var t=this.gettextCatalog_.getCurrentLanguage();e.datetimepicker.setLocale(t);e.datetimepicker.setDateFormatter(new a["a"]);if(typeof this.options==="string"){this.options=angular.fromJson(this.options)}this.element_.datetimepicker(this.options)};l.controller("ngeoDateTimePickerController",l.Controller_);t["a"]=l}).call(this,r(36))},function(e,t,r){"use strict";var a=r(1);var n=r(3);var i=r(131);var o=r(346);var s=angular.module("ngeoAttributes",[o["a"].name,i["a"].module.name]);s.run(["$templateCache",function(e){e.put("ngeo/editing/attributescomponent",r(378))}]);s.value("ngeoAttributesTemplateUrl",function(e){var t=e["ngeoAttributesTemplateUrl"];return t!==undefined?t:"ngeo/editing/attributescomponent"});l.$inject=["$attrs","ngeoAttributesTemplateUrl"];function l(e,t){return t(e)}s.component_={controller:"ngeoAttributesController as attrCtrl",bindings:{attributes:"=ngeoAttributesAttributes",disabled:"<ngeoAttributesDisabled",feature:"=ngeoAttributesFeature"},require:{form:"^"},templateUrl:l};s.component("ngeoAttributes",s.component_);s.Controller_=function(e,t){this.attributes;this.disabled=false;this.feature;this.properties;this.scope_=e;this.ngeoEventHelper_=t;this.updating_=false};s.Controller_.$inject=["$scope","ngeoEventHelper"];s.Controller_.prototype.$onInit=function(){this.properties=this.feature.getProperties();var e=a["c"](this);this.ngeoEventHelper_.addListenerKey(e,n["a"](this.feature,"propertychange",this.handleFeaturePropertyChange_,this))};s.Controller_.prototype.handleInputChange=function(e){this.updating_=true;var t=this.properties[e];this.feature.set(e,t);this.updating_=false};s.Controller_.prototype.$onDestroy=function(){var e=a["c"](this);this.ngeoEventHelper_.clearListenerKey(e)};s.Controller_.prototype.handleFeaturePropertyChange_=function(e){if(this.updating_){return}this.properties[e.key]=e.target.get(e.key);this.scope_.$apply()};s.controller("ngeoAttributesController",s.Controller_);t["a"]=s},function(e,t,r){"use strict";(function(e){var a=r(65);var n=r(1);var i=r(30);var o=r(39);var s=angular.module("ngeoExportfeatures",[a["a"].module.name]);s.directive_=function(){return{controller:"ngeoExportfeaturesController as efCtrl",scope:true,bindToController:{features:"=ngeoExportfeaturesFeatures"}}};s.directive("ngeoExportfeatures",s.directive_);s.Controller_=function(t,r,i,o){var s=this;this.features;this.element_=t;var l=n["c"](this);var u=["ngeo-exportfeature",l].join("-");this.id_=u;this.featureHelper_=o;var c=void 0;if(r.has("ngeoExportFeatureFormats")){c=r.get("ngeoExportFeatureFormats")}else{c=[a["a"].FormatType.KML]}this.menu_=null;this.items_=[];if(c.length>1){t.attr("id",u);var f=e("<ul />",{class:"dropdown-menu","aria-labelledby":u}).appendTo(t.parent()[0]);this.menu_=f;var h=void 0;c.forEach(function(t){h=e("<li />").appendTo(f).append(e("<a />",{href:"#",text:t}).on(["click",u].join("."),s.handleMenuItemClick_.bind(s,t)));s.items_.push(h)})}this.formats_=c;t.on(["click",u].join("."),this.handleElementClick_.bind(this));i.$on("$destroy",this.handleDestroy_.bind(this))};s.Controller_.$inject=["$element","$injector","$scope","ngeoFeatureHelper"];s.Controller_.prototype.handleElementClick_=function(){var e=this;var t=this.features.getArray();if(this.formats_.length===1){this.featureHelper_.export(t,this.formats_[0])}else if(t.length===1){var r=t[0];var n=r.getGeometry();var s=void 0;this.formats_.forEach(function(t,r){s=e.items_[r];if(t===a["a"].FormatType.GPX){if(n instanceof i["a"]||n instanceof o["a"]){s.removeClass("disabled")}else{s.addClass("disabled")}}})}};s.Controller_.prototype.handleMenuItemClick_=function(t,r){if(!e(r.target.parentElement).hasClass("disabled")){var a=this.features.getArray();this.featureHelper_.export(a,t)}};s.Controller_.prototype.handleDestroy_=function(){var e=this.id_;this.element_.off(["click",e].join("."));if(this.menu_){this.menu_.remove();this.items_.forEach(function(t){t.off(["click",e].join("."))});this.items_.length=0;this.menu_=null}};s.controller("ngeoExportfeaturesController",s.Controller_);t["a"]=s}).call(this,r(36))},function(e,t,r){"use strict";(function(e){var a=r(383);var n=r.n(a);var i=r(382);var o=r.n(i);var s=r(2);var l=angular.module("ngeoSortable",[]);l.component_=function(t){return{restrict:"A",link:function r(a,n,i){var o=a.$eval(i["ngeoSortable"])||[];s["a"].assert(Array.isArray(o));a.$watchCollection(function(){return o},function(){o.length&&t(h,0)});var l=a.$eval(i["ngeoSortableOptions"]);var u=p(l);var c=a.$eval(i["ngeoSortableCallback"]);var f=a.$eval(i["ngeoSortableCallbackCtx"]);function h(){var t=n.children();for(var r=0;r<t.length;++r){angular.element(t[r]).data("idx",r)}var i=e(n);if(i.data("ui-sortable")){i.off("sortupdate");i.sortable("destroy")}var s={axis:"y",classes:{"ui-sortable-helper":u["draggerClassName"]}};if(u["handleClassName"]){s["handle"]="."+u["handleClassName"]}if(u["placeholderClassName"]){s["placeholder"]=u["placeholderClassName"];s["forcePlaceholderSize"]=true}i.sortable(s);i.on("sortupdate",function(t,r){var i=e(r.item[0]).data("idx");var s=r.item.index();e(r.item[0]).data("idx",s);a.$apply(function(){o.splice(s,0,o.splice(i,1)[0])});if(c instanceof Function){c.apply(f,[n,o])}})}function p(e){var t=void 0;var r="ngeo-sortable-handle";if(e===undefined){t={handleClassName:r}}else{if(e["handleClassName"]===undefined){e["handleClassName"]=r}t=e}return t}}}};l.component_.$inject=["$timeout"];l.directive("ngeoSortable",l.component_);t["a"]=l}).call(this,r(36))},function(e,t,r){"use strict";(function(e){var a=r(392);var n=r.n(a);var i=r(391);var o=r.n(i);var s=angular.module("ngeoPopover",[]);s.component_=function(){return{restrict:"A",scope:true,controller:"NgeoPopoverController as popoverCtrl",link:function t(r,a,n,i){i.anchorElm.on("hidden.bs.popover",function(){var e=i.anchorElm.data("bs.popover");e["inState"].click=false});i.anchorElm.on("inserted.bs.popover",function(){i.bodyElm.show();i.shown=true});i.anchorElm.popover({container:"body",html:true,content:i.bodyElm,placement:n["ngeoPopoverPlacement"]||"right"});if(n["ngeoPopoverDismiss"]){e(n["ngeoPopoverDismiss"]).on("scroll",function(){i.dismissPopover()})}r.$on("$destroy",function(){i.anchorElm.popover("destroy");i.anchorElm.unbind("inserted.bs.popover");i.anchorElm.unbind("hidden.bs.popover")})}}};s.anchorComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function e(t,r,a,n){n.anchorElm=r}}};s.contentComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function e(t,r,a,n){n.bodyElm=r;r.hide()}}};s.PopoverController_=function(e){this.shown=false;this.anchorElm=undefined;this.bodyElm=undefined;function t(e){if(this.anchorElm[0]!==e.target&&this.bodyElm.parent()[0]!==e.target&this.bodyElm.parent().find(e.target).length===0&&this.shown){this.dismissPopover()}}angular.element("body").on("mousedown",t.bind(this));e.$on("$destroy",function(){angular.element("body").off("mousedown",t)})};s.PopoverController_.$inject=["$scope"];s.PopoverController_.prototype.dismissPopover=function(){this.shown=false;this.anchorElm.popover("hide")};s.controller("NgeoPopoverController",s.PopoverController_);s.directive("ngeoPopover",s.component_);s.directive("ngeoPopoverAnchor",s.anchorComponent);s.directive("ngeoPopoverContent",s.contentComponent);t["a"]=s}).call(this,r(36))},function(e,t,r){"use strict";(function(e){var a=r(48);var n=r(132);var i=r(283);var o=r(46);var s=r(2);var l=r(100);var u=r(282);var c=r(281);var f=r(350);var h=r(335);var p=r(22);var d=r(72);var g=r(30);var m=r(9);var v=r(135);var y=r(11);var _=r(79);var b=r(45);var S=r(179);var C=r(53);var w=r(13);var T=r(112);function E(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var A=angular.module("gmfSearch",[n["a"].module.name,i["a"].module.name,o["a"].module.name,u["a"].module.name,c["a"].name,h["a"].name,l["a"].module.name,f["a"].name]);A.gmfSearchTemplateUrl_=function(e,t){var r=t["gmfSearchTemplateurl"];return r!==undefined?r:"gmf/search"};A.run(["$templateCache",function(e){e.put("gmf/search",r(386))}]);L.$inject=["$element","$attrs","gmfSearchTemplateUrl"];function L(e,t,r){return r(e,t)}A.component_={bindings:{inputValue:"=?gmfSearchInputValue",placeholder:"@?gmfSearchPlaceholder",map:"<gmfSearchMap",datasources:"<gmfSearchDatasources",typeaheadOptions:"<?gmfSearchOptions",featuresStyles:"<?gmfSearchStyles",clearButton:"=?gmfSearchClearbutton",colorChooser:"<?gmfSearchColorchooser",coordinatesProjections:"<?gmfSearchCoordinatesprojections",additionalListeners:"<gmfSearchListeners",maxZoom:"<?gmfSearchMaxzoom",delay:"<?gmfSearchDelay",onInitCallback:"<?gmfSearchOnInit",searchActionCallback:"&?gmfSearchAction"},controller:"gmfSearchController",templateUrl:L};A.value("gmfSearchTemplateUrl",A.gmfSearchTemplateUrl_);A.component("gmfSearch",A.component_);A.SearchController_=function(){t.$inject=["$element","$scope","$compile","$timeout","$injector","gettextCatalog","ngeoAutoProjection","ngeoSearchCreateGeoJSONBloodhound","ngeoFeatureOverlayMgr","gmfThemes","gmfTreeManager","gmfSearchFulltextSearch"];function t(e,r,a,n,i,o,s,l,u,c,f,h){E(this,t);this.element_=e;this.scope_=r;this.compile_=a;this.timeout_=n;this.gettextCatalog_=o;this.gmfThemes_=c;this.gmfTreeManager_=f;this.fullTextSearch_=h;this.ngeoSearchCreateGeoJSONBloodhound_=l;this.ngeoFeatureOverlayMgr=u;this.ngeoLocation_;if(i.has("ngeoLocation")){this.ngeoLocation_=i.get("ngeoLocation")}this.ngeoAutoProjection_=s;this.map;this.styles_={};this.onInitCallback;this.searchActionCallback;this.clearButton;this.colorChooser;this.placeholder;this.delay;this.maxZoom=16;this.coordinatesProjections;this.featureOverlay_=u.getFeatureOverlay();this.datasources=[];this.typeaheadOptions;this.options={highlight:true};this.featuresStyles;this.datasets=[];this.inputValue="";this.color;this.displayColorPicker=false;this.listeners;this.additionalListeners}t.prototype.$onInit=function e(){var t=this;var r=this.gettextCatalog_;this.clearButton=this.clearButton!==false;this.colorChooser=this.colorChooser===true;if(this.delay===undefined){this.delay=50}this.placeholder=this.placeholder!==undefined?this.placeholder:r.getString("Search…");var a=this.coordinatesProjections;if(a===undefined){a=[this.map.getView().getProjection()]}else{a=this.ngeoAutoProjection_.getProjectionList(a)}this.coordinatesProjections=a;if(!this.clearButton){this.element_.find("input").on("focus blur",function(){t.clear()})}if(this.onInitCallback){this.onInitCallback()}this.initStyles_();this.featureOverlay_.setStyle(this.getSearchStyle_.bind(this));if(this.typeaheadOptions){m["a"](this.options,this.typeaheadOptions)}this.initDatasets_();this.scope_.$watch(function(){return t.color},this.setStyleColor.bind(this));this.listeners=this.mergeListeners_(this.additionalListeners,{select:this.select_.bind(this),close:this.close_.bind(this),datasetsempty:this.datasetsempty_.bind(this)});if(this.ngeoLocation_){var n=this.ngeoLocation_.getParam("search");if(n){var i=1;if(this.ngeoLocation_.getParam("search-select-index")){i=parseInt(this.ngeoLocation_.getParam("search-select-index"),10)}var o=void 0;if(this.ngeoLocation_.getParam("search-maxzoom")){o=parseInt(this.ngeoLocation_.getParam("search-maxzoom"),10)}else if(this.ngeoLocation_.getParam("map_zoom")){o=parseInt(this.ngeoLocation_.getParam("map_zoom"),10)}this.fulltextsearch_(n,i,o)}}};t.prototype.mergeListeners_=function e(t,r){if(t===undefined){return r}return{open:t.open,close:t.close===undefined?r.close:function(){r.close();t.close()},cursorchange:t.cursorchange,datasetsempty:t.datasetsempty,select:t.select===undefined?r.select:function(e,a,n){r.select(e,a,n);t.select(e,a,n)},autocomplete:t.autocomplete}};t.prototype.initDatasets_=function e(){var t=this;var r=this.gettextCatalog_;var a=function e(a){var n=t.datasources[a];var i=n.groupValues!==undefined?n.groupValues:[];var o=n.groupActions?n.groupActions:[];var s=[];if(i.length===0){s.push({title:"",filter:t.filterLayername_()})}else{i.forEach(function(e){s.push({title:e,filter:this.filterLayername_(e)})},t)}o.forEach(function(e){s.push({title:r.getString(e["title"]),filter:this.filterAction_(e["action"])})},t);s.forEach(function(e){this.datasets.push(this.createDataset_({bloodhoundOptions:n.bloodhoundOptions,datasetTitle:e["title"],groupsKey:"layer_name",labelKey:n.labelKey,projection:n.projection,typeaheadDatasetOptions:n.typeaheadDatasetOptions,url:n.url},e["filter"]))},t)};for(var n=0;n<this.datasources.length;n++){a(n)}this.datasets.push({source:this.createSearchCoordinates_(this.map.getView()),name:"coordinates",display:"label",templates:{header:function e(){var e=r.getString("Recenter to");return'<div class="gmf-search-header" translate>'+e+"</div>"},suggestion:function e(t){var r=t["label"];var a='<p class="gmf-search-label">'+r+"</p>";a='<div class="gmf-search-datum">'+a+"</div>";return a}}})};t.prototype.createDataset_=function e(t,r){var a=this.gettextCatalog_;var n=this.scope_;var i=this.compile_;var o=this.createAndInitBloodhound_(t,r);var s={limit:Infinity,source:o.ttAdapter(),display:function e(r){var a=r;return a.get(t.labelKey)},templates:{header:function e(){if(t.datasetTitle===undefined){return""}else{var e=a.getString(t.datasetTitle);return'<div class="gmf-search-header">'+e+"</div>"}},suggestion:function e(r){var a=r;var o=n.$new(true);o["feature"]=a;var s='<p class="gmf-search-label" translate>'+a.get(t.labelKey)+"</p>";s+='<p class="gmf-search-group" translate>'+(a.get("layer_name")||t.datasetTitle)+"</p>";s='<div class="gmf-search-datum">'+s+"</div>";return i(s)(o)}}};if(t.typeaheadDatasetOptions){m["a"](s,t.typeaheadDatasetOptions)}return s};t.prototype.filterAction_=function e(t){return function(e){var r=e["properties"];if(r["actions"]){return!r["layer_name"]&&r["actions"].some(function(e){return e.action===t})}else{return false}}};t.prototype.filterLayername_=function e(t){return function(e){var r=e["properties"]["layer_name"];if(r===undefined){return false}if(t===undefined){return true}return r===t}};t.prototype.createAndInitBloodhound_=function e(t,r){var a=this.map.getView().getProjection().getCode();var n=this.getBloodhoudRemoteOptions_();var i=this.ngeoSearchCreateGeoJSONBloodhound_(t.url,r,y["g"](a),y["g"](t.projection),t.bloodhoundOptions,n);i.initialize();return i};t.prototype.getBloodhoudRemoteOptions_=function e(){var t=this.gettextCatalog_;return{rateLimitWait:this.delay,prepare:function e(r,a){var n=a.url;var i=t.currentLanguage;a.xhrFields={withCredentials:true};a.url=T["a"](n,{query:r,lang:i});return a}}};t.prototype.createSearchCoordinates_=function e(t){var r=t.getProjection();var a=r.getExtent();return function(e,t){var n=[];var i=this.ngeoAutoProjection_.stringToCoordinates(e);if(i===null){return}var o=this.ngeoAutoProjection_.tryProjectionsWithInversion(i,a,r,this.coordinatesProjections);if(o===null){return}n.push({label:i.join(" "),position:o,tt_source:"coordinates"});t(n)}.bind(this)};t.prototype.initStyles_=function e(){this.styles_[a["a"].COORDINATES_LAYER_NAME]=new w["c"]({image:new S["a"]({stroke:new C["a"]({color:[0,0,0,.7],width:2}),points:4,radius:8,radius2:0,angle:0})});var t=new b["a"]({color:[65,134,240,.5]});var r=new C["a"]({color:[65,134,240,1],width:2});this.styles_["default"]=new w["c"]({fill:t,image:new _["a"]({fill:t,radius:5,stroke:r}),stroke:r});var n=this.featuresStyles||{};m["a"](this.styles_,n)};t.prototype.getSearchStyle_=function e(t,r){s["a"].assert(t);var a=this.styles_[t.get("layer_name")]||this.styles_["default"];if(this.color){var n=d["a"](this.color);var i=n.slice();i[3]=1;var o=n.slice();o[3]=.5;var l=a.getStroke();if(l){l.setColor(i)}var u=a.getFill();if(u){u.setColor(o)}var c=a.getImage();if(c){c=c.clone();var f=c.getStroke();if(f){f.setColor(i)}var h=c.getFill();if(h){h.setColor(o)}a.setImage(c)}}return a};t.prototype.setStyleColor=function e(t){if(t){this.color=t;this.ngeoFeatureOverlayMgr.getLayer().changed()}};t.prototype.setTTDropdownVisibility_=function e(){if(this.clearButton){var t=this.element_.find(".twitter-typeahead .tt-menu");this.inputValue?t.show():t.hide()}};t.prototype.onClearButton=function e(){this.featureOverlay_.clear();this.clear()};t.prototype.clear=function t(){var r=this.element_.find(".twitter-typeahead");var a=r.children(".tt-menu");var n=r.children("input");this.inputValue="";e(n[1]).typeahead("val","");a.children(".tt-dataset").empty();this.setTTDropdownVisibility_();this.displayColorPicker=false};t.prototype.blur=function t(){var r=this.element_.find(".twitter-typeahead");var a=r.children("input");this.timeout_(function(){e(a[1]).blur()})};t.prototype.select_=function e(t,r,n){if(r["tt_source"]==="coordinates"){var i=new g["a"](r["position"]);this.featureOverlay_.clear();this.featureOverlay_.addFeature(new p["a"]({geometry:i,layer_name:a["a"].COORDINATES_LAYER_NAME}));this.map.getView().setCenter(r["position"]);this.leaveSearch_()}else{s["a"].assertInstanceof(r,p["a"]);this.selectFromGMF_(t,r,n)}};t.prototype.selectFromGMF_=function e(t,r,a){var n=this;var i=r.get("actions");var s=r.getGeometry();if(i){var l=function e(t,r){var a=i[t];var l=a["action"];var u=a["data"];if(l=="add_theme"){n.gmfThemes_.getThemesObject().then(function(e){var t=o["a"].findThemeByName(e,u);if(t){n.gmfTreeManager_.addFirstLevelGroups(t.children)}})}else if(l=="add_group"){n.gmfTreeManager_.addGroupByName(u,true)}else if(l=="add_layer"){var c=n.datasources[0].groupActions;var f=void 0;c.forEach(function(e){if(e["action"]==="add_layer"){return f=true}});if(f){var h=!!s;n.gmfTreeManager_.addGroupByLayerName(u,true,h)}}else{if(n.searchActionCallback){n.searchActionCallback(a)}}};for(var u=0,c=i.length;u<c;u++){l(u,c)}}var f=this.map.getSize();if(s&&f){var h=this.map.getView();this.featureOverlay_.clear();this.featureOverlay_.addFeature(r);this.displayColorPicker=true;var p=s.getType()==="GeometryCollection"?s.getExtent():s;h.fit(p,{size:f,maxZoom:this.maxZoom})}this.leaveSearch_()};t.prototype.leaveSearch_=function e(){if(!this.clearButton){this.clear()}this.blur()};t.prototype.close_=function e(t){if(!this.clearButton){this.setTTDropdownVisibility_()}};t.prototype.datasetsempty_=function t(r,a,n){var i=this.element_.find(".twitter-typeahead .tt-menu");var o=i.children(".gmf-search-no-results");if(o.length==0){var s=e('<div class="gmf-search-no-results" translate>No result found</div>');i.append(s)}if(n){o.show();i.addClass("gmf-search-no-results")}else{i.removeClass("gmf-search-no-results");o.hide()}};t.prototype.fulltextsearch_=function e(t,r,a){var n=this;if(r<1){r=1}this.fullTextSearch_.search(t,{limit:r}).then(function(e){if(e&&e.features[r-1]){var t=new v["a"];var i=t.readFeature(e.features[r-1]);n.featureOverlay_.addFeature(i);var o={};if(a!==undefined){o.maxZoom=a;o.size=n.map.getSize()}n.map.getView().fit(i.getGeometry().getExtent(),o);n.inputValue=i.get("label")}})};return t}();A.controller("gmfSearchController",A.SearchController_);t["a"]=A}).call(this,r(36))},,function(e,t,r){"use strict";(function(e){var r=angular.module("ngeoRecenter",[]);r.directive_=function(){return{restrict:"A",link:function t(r,a,n){var i=n["ngeoRecenterMap"];var o=r.$eval(i);function s(e){var t=e.attr("ngeo-extent");if(t!==undefined){var a=o.getSize();o.getView().fit(r.$eval(t),{size:a})}var n=e.attr("ngeo-zoom");if(n!==undefined){o.getView().setZoom(r.$eval(n))}}a.on("click","*",function(t){s(angular.element(e(this)))});a.on("change",function(e){var t=e.target.options[e.target.selectedIndex];s(angular.element(t))})}}};r.directive("ngeoRecenter",r.directive_);t["a"]=r}).call(this,r(36))},function(e,t,r){"use strict";var a=r(2);var n=function e(t,r,n,i,o){var s=i.$watchCollection(function(){return t},function(){var e=void 0,a=void 0,i=void 0;if(n){for(e=t.length-1,i=0;e>=0;--e){if(o(t[e])){r[i++]=t[e]}}}else{for(e=0,a=t.length,i=0;e<a;++e){if(o(t[e])){r[i++]=t[e]}}}r.length=i});var l=i.$watchCollection(function(){return r},function(){var e=void 0,i=void 0,s=void 0;if(n){for(e=0,i=t.length,s=r.length-1;e<i;++e){if(o(t[e])){t[e]=r[s--]}}a["a"].assert(s==-1)}else{for(e=0,i=t.length,s=0;e<i;++e){if(o(t[e])){t[e]=r[s++]}}a["a"].assert(s==r.length)}});return function(){s();l()}};t["a"]=n},function(e,t,r){"use strict";var a=r(106);var n=r(265);var i=r.n(n);var o=angular.module("ngeoLayertree",[a["a"].module.name]);o.value("ngeoLayertreeTemplateUrl",function(e,t){var r=t["ngeoLayertreeTemplateurl"];return r!==undefined?r:"ngeo/layertree"});o.run(["$templateCache",function(e){e.put("ngeo/layertree",r(413))}]);o.directive_=function(e){return{restrict:"A",scope:true,templateUrl:e,controller:a["a"]}};o.directive_.$inject=["ngeoLayertreeTemplateUrl"];o.directive("ngeoLayertree",o.directive_);t["a"]=o},function(e,t,r){"use strict";var a={};a.Permalink3dParam={ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"};t["a"]=a},function(e,t,r){"use strict";(function(e){var a=r(1);var n=r(113);var i=function t(r){var a=r!==undefined?r:{};var i=void 0;if(a.element){i=a.element;delete a.element}else{i=e("<div />")[0]}this.closeEl_=e("<button>",{class:"close",html:"&times;"});this.contentEl_=e("<div/>").append(this.closeEl_).append(i);a.element=e("<div />")[0];n["a"].call(this,a)};a["d"](i,n["a"]);i.prototype.setMap=function(t){var r=this;var a=this.getElement();var i=this.getMap();if(i){e(a).popover("destroy")}n["a"].prototype.setMap.call(this,t);if(t){var o=this.contentEl_;window.setTimeout(function(){e(a).popover({content:o,html:true,placement:"top",template:['<div class="popover ngeo-popover" role="tooltip">','  <div class="arrow"></div>','  <h3 class="popover-title"></h3>','  <div class="popover-content"></div>',"</div>"].join("")}).popover("show")},0);this.closeEl_.one("click",function(){var e=r.getMap();if(e){e.removeOverlay(r)}})}};t["a"]=i}).call(this,r(36))},function(e,t,r){"use strict";(function(e){var a=r(48);var n=r(237);var i=r(165);var o=r(289);var s=r(287);var l=r(168);var u=r(132);var c=r(46);var f=r(2);var h=r(50);var p=r(355);var d=r(106);var g=r(101);var m=r(354);var v=r(133);var y=r(93);var _=r(74);var b=r(9);var S=r(126);var C=r(156);var w=r(149);var T=r(265);var E=r.n(T);var A=angular.module("gmfLayertreeComponent",[n["a"].module.name,i["a"].module.name,o["a"].module.name,s["a"].name,l["a"].module.name,u["a"].module.name,c["a"].module.name,p["a"].name,d["a"].module.name,g["a"].module.name,v["a"].module.name]);A.value("ngeoLayertreeTemplateUrl",function(e,t){return"gmf/layertree"});A.run(["$templateCache",function(e){e.put("gmf/layertree",r(412))}]);A.value("gmfLayertreeTemplate",function(e,t){var r="gmf/layertree";return'<div ngeo-layertree="gmfLayertreeCtrl.root" '+'ngeo-layertree-map="gmfLayertreeCtrl.map" '+'ngeo-layertree-nodelayer="gmfLayertreeCtrl.getLayer(treeCtrl)" '+'ngeo-layertree-listeners="gmfLayertreeCtrl.listeners(treeScope, treeCtrl)" '+('ngeo-layertree-templateurl="'+r+'">')+"</div>"});L.$inject=["$element","$attrs","gmfLayertreeTemplate"];function L(e,t,r){return r(e,t)}A.component_={controller:"GmfLayertreeController as gmfLayertreeCtrl",bindings:{map:"=gmfLayertreeMap",dimensions:"=?gmfLayertreeDimensions",openLinksInNewWindow:"<?gmfLayertreeOpenlinksinnewwindow"},template:L};A.component("gmfLayertree",A.component_);A.Controller_=function(e,t,r,a,n,i,o,s,l,u){var c=this;this.map;this.dimensions;this.scope_=t;this.layerHelper_=r;this.gmfDataSourceBeingFiltered=a;this.gmfExternalDataSourcesManager=n;this.gmfPermalink_=i;this.gmfTreeManager_=o;var h=o.root;f["a"].assert(h);this.root=h;this.gmfSyncLayertreeMap_=s;this.ngeoWMSTime_=l;this.groupNodeStates_={};this.openLinksInNewWindow;this.dataLayerGroup_=null;this.layers=[];this.gmfThemes_=u;e.on("shown.bs.collapse",function(){c.scope_.$apply()})};A.Controller_.$inject=["$element","$scope","ngeoLayerHelper","gmfDataSourceBeingFiltered","gmfExternalDataSourcesManager","gmfPermalink","gmfTreeManager","gmfSyncLayertreeMap","ngeoWMSTime","gmfThemes"];A.Controller_.prototype.$onInit=function(){var e=this;this.openLinksInNewWindow=this.openLinksInNewWindow===true;this.dataLayerGroup_=this.layerHelper_.getGroupFromMap(this.map,a["a"].DATALAYERGROUP_NAME);Object(m["a"])(this.dataLayerGroup_.getLayers().getArray(),this.layers,true,this.scope_,function(){return true});this.scope_.$watchCollection(function(){return e.layers},function(){e.map.render()});this.scope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl){return e.dimensions}},function(t){if(t){e.updateDimensions_(e.gmfTreeManager_.rootCtrl)}})};A.Controller_.prototype.updateDimensions_=function(e){var t=this;e.traverseDepthFirst(function(e){if(e.node.dimensions){var r=e.layer;f["a"].assertInstanceof(r,_["a"]);t.updateLayerDimensions_(r,e.node)}})};A.Controller_.prototype.updateLayerDimensions_=function(e,t){var r=this;if(this.dimensions&&t.dimensions){var a={};for(var n in t.dimensions){if(t.dimensions[n]===null){var i=this.dimensions[n];if(i!==undefined){a[n]=i}}else{a[n]=t.dimensions[n]}}if(!b["d"](a)){var o=e.getSource();if(o instanceof w["a"]){o.updateDimensions(a)}else if(o instanceof C["a"]||o instanceof S["a"]){o.updateParams(a)}else{e.once("change:source",function(){f["a"].assertInstanceof(e,_["a"]);r.updateLayerDimensions_(e,t)})}}}};A.Controller_.prototype.getLayer=function(e){var t=void 0;if(e.parent.isRoot){this.gmfTreeManager_.rootCtrl=e.parent;t=this.gmfTreeManager_.root.children.length-this.gmfTreeManager_.numberOfGroupsToAddInThisDigestLoop||0}var r=this.gmfSyncLayertreeMap_.createLayer(e,this.map,this.dataLayerGroup_,t);if(r instanceof _["a"]){var a=e.node;this.updateLayerDimensions_(r,a)}return r};A.Controller_.prototype.listeners=function(e,t){var r=this.dataLayerGroup_;e.$on("$destroy",function(){r.getLayers().remove(t.layer)})};A.Controller_.prototype.toggleActive=function(e){e.setState(e.getState()==="on"?"off":"on")};A.Controller_.prototype.getNodeState=function(e){return e.getState()};A.Controller_.prototype.updateWMSTimeLayerState=function(e,t){if(!t){return}var r=e.getDataSource();if(r){f["a"].assertInstanceof(r,h["a"]);r.timeRangeValue=t}else if(e.children){for(var a=0,n=e.children.length;a<n;a++){this.updateWMSTimeLayerState(e.children[a],t)}}};A.Controller_.prototype.getLegendIconURL=function(e){var t=e.node.metadata.iconUrl;if(t!==undefined){return t}if(e.node.children!==undefined){return undefined}var r=e.node;if(r.type!=="WMS"){return undefined}var a=r;var n=a.metadata.legendRule;if(n===undefined){return undefined}var i=a.layers.split(",")[0];var o=this.gmfTreeManager_.getOgcServer(e);return this.layerHelper_.getWMSLegendURL(o.url,i,undefined,n,20,20)};A.Controller_.prototype.getLegendsObject=function(e){var t=this;var r={};if(e.node.children!==undefined){return null}var a=e.node;var n=a.name;if(a.metadata.legendImage){r[n]=a.metadata.legendImage;return r}var i=e.layer;if(a.type==="WMTS"){f["a"].assertInstanceof(i,y["a"]);var o=this.layerHelper_.getWMTSLegendURL(i);r[n]=o;return o?r:null}else{var s=a;var l=s.layers;var u=this.gmfTreeManager_.getOgcServer(e);var c=this.getScale_();if(u.type===h["a"].ServerType.QGISSERVER){l=[l]}else{l=l.split(",")}l.forEach(function(e){r[e]=t.layerHelper_.getWMSLegendURL(u.url,e,c)});return r}};A.Controller_.prototype.getNumberOfLegendsObject=function(e){var t=this.getLegendsObject(e);return t?Object.keys(t).length:0};A.Controller_.prototype.getScale_=function(){var e=this.map.getView();var t=e.getResolution();var r=e.getProjection().getMetersPerUnit();var a=25.4/.28;return t*r*39.37*a};A.Controller_.prototype.displayMetadata=function(e){var t=e.node;var r=t.metadata["metadataUrl"];if(r!==undefined){var a=window.gmfx;if(a.openIframePopup){a.openIframePopup(r,t.name,undefined,undefined,false)}}};A.Controller_.prototype.afterReorder=function(){var e=this;var t=this.gmfTreeManager_.rootCtrl.node.children;var r=this.gmfTreeManager_.rootCtrl.children;var a=[];t.forEach(function(e){r.some(function(t){if(t.node===e){a.push(t);return}})});this.gmfTreeManager_.rootCtrl.children=a;this.layers.length=0;this.gmfTreeManager_.rootCtrl.children.forEach(function(t){e.layers.push(t.layer)});this.gmfPermalink_.refreshFirstLevelGroups()};A.Controller_.prototype.removeNode=function(e){this.gmfTreeManager_.removeGroup(e)};A.Controller_.prototype.removeAllNodes=function(){this.gmfTreeManager_.removeAll()};A.Controller_.prototype.nodesCount=function(){return this.gmfTreeManager_.root.children.length};A.Controller_.prototype.getResolutionStyle=function(e){var t=this.map.getView().getResolution();var r=c["a"].getNodeMinResolution(e);if(r!==undefined&&t<r){return"out-of-resolution"}var a=c["a"].getNodeMaxResolution(e);if(a!==undefined&&t>a){return"out-of-resolution"}return undefined};A.Controller_.prototype.zoomToResolution=function(e){var t=e.node;var r=this.map.getView();var a=r.getResolution();var n=c["a"].getNodeMinResolution(t);if(n!==undefined&&a<n){r.setResolution(r.constrainResolution(n,0,1))}else{var i=c["a"].getNodeMaxResolution(t);if(i!==undefined&&a>i){r.setResolution(r.constrainResolution(i,0,-1))}}};A.Controller_.prototype.toggleNodeLegend=function(t){e(t).toggle({toggle:true})};A.Controller_.prototype.toggleFiltrableDataSource=function(e){this.gmfDataSourceBeingFiltered.dataSource=e};A.Controller_.prototype.isNodeLegendVisible=function(t){return e(t).is(":visible")};A.Controller_.prototype.supportsCustomization=function(e){return!e.isRoot&&(this.supportsLegend(e)||this.supportsOpacityChange(e))};A.Controller_.prototype.supportsLegend=function(e){var t=e.node;return!!t.metadata&&!!t.metadata.legend&&!!this.getLegendsObject(e)};A.Controller_.prototype.supportsOpacityChange=function(e){var t=e.node;var r=e.parent.node;return!!e.layer&&(e.depth===1&&!t.mixed||e.depth>1&&r.mixed)};A.controller("GmfLayertreeController",A.Controller_);t["a"]=A}).call(this,r(36))},,,,,function(e,t,r){"use strict";r.r(t);var a=r(309);var n=r(452);var i=r(52);var o={};o.module=angular.module("app",[]);o.module.config(["$compileProvider",function(e){if(!("debug"in i["b"].decodeQueryString(window.location.search))){e.debugInfoEnabled(false)}}]);var s=o;var l=r(11);var u=r(280);var c=r(279);var f=r(196);var h=["+proj="+c["a"],"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=2600000","+y_0=1200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");var p=[242e4,103e4,29e5,135e4];f["a"].defs("EPSG:2056",h);u["a"](f["a"]);l["g"]("EPSG:2056").setExtent(p);var d="EPSG:2056";var g=d;var m=r(251);var v=r(1);var y=r(339);var _=r.n(y);var b=r(338);var S=r.n(b);if(!window.requestAnimationFrame){alert("Your browser is not supported, please update it or use another one. You will be redirected.\n\n"+"Votre navigateur n'est pas supporté, veuillez le mettre à jour ou en utiliser un autre. Vous allez être redirigé.\n\n"+"Ihr Browser wird nicht unterstützt, bitte aktualisieren Sie ihn oder verwenden Sie einen anderen. Sie werden weitergeleitet.");window.location="http://geomapfish.org/"}var C=function e(t,r){a["a"].call(this,{srid:21781,mapViewConfig:{center:[632464,185457],zoom:3,resolutions:[250,100,50,20,10,5,2,1,.5,.25,.1,.05]}},t,r);this.searchCoordinatesProjections=[m["a"],g,"EPSG:4326"];this.scaleSelectorValues=[25e4,1e5,5e4,2e4,1e4,5e3,2e3,1e3,500,250,100,50];this.elevationLayers=["aster","srtm"];this.selectedElevationLayer=this.elevationLayers[0];this.profileLinesconfiguration={aster:{color:"#0000A0"},srtm:{color:"#00A000"}};this.mousePositionProjections=[{code:g,label:"CH1903+ / LV95",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:m["a"],label:"CH1903 / LV03",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:"EPSG:4326",label:"WGS84",filter:"ngeoDMSCoordinates:2"}];var n=r.get("gettextCatalog");n.getString("Add a theme");n.getString("Add a sub theme");n.getString("Add a layer");if(r.has("sentryUrl")){var i=r.has("sentryOptions")?r.get("sentryOptions"):undefined;var o=new _.a;o.config(r.get("sentryUrl"),i).addPlugin(S.a).install()}};C.$inject=["$scope","$injector"];C.$inject=["$scope","$injector"];v["d"](C,a["a"]);C.module=angular.module("Appoeview",[s.module.name,a["a"].module.name]);C.module.value("gmfContextualdatacontentTemplateUrl","gmf/contextualdata");C.module.run(["$templateCache",function(e){e.put("gmf/contextualdata",r(365))}]);C.module.controller("DesktopController",C);var w=t["default"]=C},,function(e,t){e.exports="<table> <tr> <td translate> Swiss grid (LV03) </td> <td> {{coord_21781|ngeoNumberCoordinates:0:'{x} / {y}'}} </td> </tr> <tr> <td translate> Wgs Coord. </td> <td> {{coord_4326|ngeoNumberCoordinates:2:'{y} / {x}'}} </td> </tr> <tr> <td translate> Wgs Coord. DMS </td> <td> {{coord_4326|ngeoDMSCoordinates:0:'{y} {x}'}} </td> </tr> <tr> <td translate> Elevation (SRTM) </td> <td ng-if=srtm> {{srtm | number}} [m] </td> </tr> <tr> <td translate> Elevation (Aster) </td> <td ng-if=aster> {{aster | number}} [m] </td> </tr> </table> <a ng-href=\"https://maps.google.ch/?ie=UTF8&ll={{coord_4326_northern}},{{coord_4326_eastern}}&layer=c&cbll={{coord_4326_northern}},{{coord_4326_eastern}}&cbp=12,57.78,,0,8.1\" target=_blank>Google StreetView</a> "},,,,,function(e,t){e.exports='<div class=form-group> <select class=form-control ng-model=$ctrl.mode ng-options="mode | translate for mode in $ctrl.modes" ng-click="$ctrl.hasError = false"> </select> </div> <div> <form name=idsl_form novalidate ng-show="$ctrl.mode === \'Local\'"> <div class=form-group> <div class=input-group> <input name=file type=file required/> <input class=form-control placeholder="{{\'No file\' | translate}}" readonly=readonly type=text value={{$ctrl.fileNameAndSize}} ng-click=$ctrl.browse() /> <span class=input-group-btn> <button class="btn btn-default" type=button ng-click=$ctrl.browse() translate>Browse</button> </span> </div> </div> <div class=form-group> <button class="btn btn-sm btn-default form-control" ng-class="{\'has-error\': $ctrl.hasError}" title="{{\'Load a file from local\' | translate}}" type=submit ng-click="idsl_form.$valid && $ctrl.load()" ng-disabled="$ctrl.file === undefined || $ctrl.hasError"> <span ng-if=!$ctrl.hasError>{{\'Load local file\' | translate}}</span> <span ng-if=$ctrl.hasError>{{\'Unable to load the file\' | translate}}</span> </button> </div> </form> <form name=idsc_form novalidate ng-show="$ctrl.mode === \'Online\'"> <div class="form-group gmf-importdatasource-url-form-group"> <input autocomplete=off class=form-control name=url placeholder="{{\'Choose or enter online resource URL\' | translate}}" required type=url ng-disabled=$ctrl.pending ng-model=$ctrl.url /> </div> <div class=form-group> <button class="btn btn-sm btn-default form-control gmf-importdatasource-connect-btn" ng-class="{\'has-error\': $ctrl.hasError}" title="{{\'Connect to online resource\' | translate}}" type=submit ng-click="idsc_form.$valid && $ctrl.connect()" ng-disabled="idsc_form.$invalid || $ctrl.pending"> <span ng-if=$ctrl.pending>{{\'Connecting, please wait...\' | translate}}</span> <span ng-if="!$ctrl.pending && $ctrl.hasError">{{\'Failed to connect\' | translate}}</span> <span ng-if="!$ctrl.pending && !$ctrl.hasError">{{\'Connect\' | translate}}</span> </button> </div> </form> </div> <div class=gmf-importdatasource-layers ng-if="$ctrl.wmsCapabilities !== null || $ctrl.wmtsCapabilities !== null"> <hr/> <gmf-wmscapabilitylayertreenode capabilities=::$ctrl.wmsCapabilities layer=::$ctrl.wmsCapabilities.Capability.Layer url=::$ctrl.url ng-if="$ctrl.wmsCapabilities !== null"> </gmf-wmscapabilitylayertreenode> <gmf-wmtscapabilitylayertree capabilities=::$ctrl.wmtsCapabilities layers=::$ctrl.wmtsCapabilities.Contents.Layer url=::$ctrl.url ng-if="$ctrl.wmtsCapabilities !== null"> </gmf-wmtscapabilitylayertree> </div> '},function(e,t){e.exports='<ul> <li ng-repeat="layer in ::$ctrl.layers"> <div class=gmf-wmscapabilitylayertreenode-header> <span class=gmf-wmscapabilitylayertreenode-popover-container ngeo-popover ngeo-popover-dismiss=.content ngeo-popover-placement=left> <span ngeo-popover-anchor class="fa fa-cog gmf-wmscapabilitylayertreenode-actions"> </span> <div class=gmf-wmscapabilitylayertreenode-popover-content ngeo-popover-content> <ul> <li> <i class="fa fa-plus fa-fw"></i> <a href="" ng-click="$ctrl.createAndAddDataSource(layer); popoverCtrl.dismissPopover()"> <span translate>Add layer</span> </a> </li> <li ng-if="::(layer.Abstract !== undefined)"> <i class="fa fa-th-list fa-fw"></i> <a aria-expanded=false data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-click=popoverCtrl.dismissPopover()> <span translate>Open/Close description</span> </a> </li> </ul> </div> </span> <a class="fa fa-circle-thin gmf-wmscapabilitylayertreenode-no-icon fa-fw"></a> <span class=gmf-wmscapabilitylayertreenode-title>{{ ::layer.Title }}</span> <div class="collapse gmf-wmscapabilitylayertreenode-description" id=gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Abstract !== undefined)"> <a aria-expanded=false class=gmf-wmscapabilitylayertreenode-description-toggle data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}}> <span translate>Hide description</span> </a> <span class=gmf-wmscapabilitylayertreenode-description-content>{{ ::layer.Abstract }}</span> </div> </div> </li> </ul> '},function(e,t){e.exports='<ul> <li ng-repeat="layer in ::$ctrl.layer.Layer"> <div class=gmf-wmscapabilitylayertreenode-header> <span class=gmf-wmscapabilitylayertreenode-popover-container ng-if="::(layer.Name !== undefined || layer.Abstract !== undefined)" ngeo-popover ngeo-popover-dismiss=.content ngeo-popover-placement=left> <span ngeo-popover-anchor class="fa fa-cog gmf-wmscapabilitylayertreenode-actions"> </span> <div class=gmf-wmscapabilitylayertreenode-popover-content ngeo-popover-content> <ul> <li ng-if="::(layer.Name !== undefined)"> <i class="fa fa-plus fa-fw"></i> <a href="" ng-click="$ctrl.createAndAddDataSource(layer); popoverCtrl.dismissPopover()"> <span translate>Add layer</span> </a> </li> <li ng-if="::(layer.Abstract !== undefined)"> <i class="fa fa-th-list fa-fw"></i> <a aria-expanded=false data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-click=popoverCtrl.dismissPopover()> <span translate>Open/Close description</span> </a> </li> </ul> </div> </span> <a aria-expanded=false class="fa gmf-wmscapabilitylayertreenode-expand-node fa-fw" data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-children-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Layer !== undefined && layer.Layer.length)"></a> <span ng-if="::(layer.Layer !== undefined && layer.Layer.length)" class="fa fa-fw gmf-wmscapabilitylayertreenode-group"> </span> <a class="fa fa-circle-thin gmf-wmscapabilitylayertreenode-no-icon fa-fw" ng-if="::(layer.Layer === undefined || layer.Layer.length === 0)"></a> <span class=gmf-wmscapabilitylayertreenode-title>{{ ::layer.Title }}</span> <div class="collapse gmf-wmscapabilitylayertreenode-description" id=gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Abstract !== undefined)"> <a aria-expanded=false class=gmf-wmscapabilitylayertreenode-description-toggle data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}}> <span translate>Hide description</span> </a> <span class=gmf-wmscapabilitylayertreenode-description-content>{{ ::layer.Abstract }}</span> </div> </div> <gmf-wmscapabilitylayertreenode class=collapse id=gmf-wmscapabilitylayertreenode-children-{{::$ctrl.getUid(layer)}} capabilities=::$ctrl.capabilities layer=::layer ng-if="::(layer.Layer !== undefined)"> </gmf-wmscapabilitylayertreenode> </li> </ul> '},function(e,t){e.exports='<div class="text-center btn-group dropup" gmf-elevation gmf-elevation-active=ctrl.active gmf-elevation-elevation=ctrl.elevationValue gmf-elevation-loading=ctrl.elevationLoading gmf-elevation-layer=ctrl.selectedElevationLayer gmf-elevation-layersconfig=ctrl.layersconfig gmf-elevation-map=::ctrl.map> <a type=button class="btn btn-default" aria-expanded=false ng-class="::{\'dropdown-toggle\': ctrl.layers.length > 1}" ng-attr-data-toggle="{{::(ctrl.layers.length > 1) ? \'dropdown\' : \'\'}}"> <span class=gmf-elevationwidget-value> {{ctrl.elevationValue}} <span ng-show=ctrl.elevationLoading class="fa fa-spinner"></span> <span ng-show="!ctrl.elevationValue && !ctrl.elevationLoading" translate>Elevation…</span> </span><span class=caret ng-if="::ctrl.layers.length > 1"></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu ng-if="::ctrl.layers.length > 1"> <li class=dropdown-header translate>Elevation data sources</li> <li ng-repeat="elevationItem in ::ctrl.layers"> <a href ng-click="ctrl.selectedElevationLayer = elevationItem"> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedElevationLayer === elevationItem}"></span> {{elevationItem | translate}} </a> </li> </ul> </div> '},function(e,t){e.exports='<div class="gmf-profile-container panel" ng-show=ctrl.active> <div class=ngeo-profile ng-show=!ctrl.isErrored ngeo-profile=ctrl.profileData ngeo-profile-highlight=ctrl.profileHighlight ngeo-profile-options=::ctrl.profileOptions> </div> <ul class=gmf-profile-legend ng-show=!ctrl.isErrored> <li ng-repeat="name in ::ctrl.getLayersNames()"> <i class="fa fa-minus" ng-style=ctrl.getStyle(name)></i> {{name | translate}} <span ng-if="ctrl.currentPoint.elevations[name] != null"> {{ctrl.currentPoint.elevations[name]}}&nbsp;{{ctrl.currentPoint.yUnits}} </span> </li> </ul> <div class="gmf-profile-export btn-group dropup" ng-show=!ctrl.isErrored> <a class=dropdown-toggle href="" ng-show="ctrl.profileData.length !== 0" data-toggle=dropdown aria-expanded=false> {{\'Export\' | translate}}&nbsp;<i class="fa fa-caret-up"></i> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href="" ng-click=::ctrl.downloadCsv()> <i class="fa fa-table"></i>&nbsp;{{\'Download CSV\' | translate}}</a> </li> </ul> </div> <div class=gmf-profile-error ng-show=ctrl.isErrored> <p>{{\'The profile service does not respond, please try later.\' | translate}}</p> </div> <div class=close ng-click="ctrl.line = null">&times;</div> </div> '},function(e,t){e.exports='<div class=gmf-print> <div ng-show="$ctrl.isState(\'CAPABILITIES_NOT_LOADED\') !== true && $ctrl.isState(\'ERROR_ON_GETCAPABILITIES\') !== true"> <div class="gmf-print-layout-selector form-horizontal"><ng-transclude/></div> <div ng-repeat="attribute in $ctrl.layoutInfo.simpleAttributes" class="gmf-print-layoutinfo form-group"> <div ng-if="$ctrl.hiddenAttributeNames === undefined || $ctrl.hiddenAttributeNames.indexOf(attribute.name) < 0"> <input ng-if="attribute.type === \'number\'" ng-model=attribute.value class=form-control type=number ng-attr-placeholder="{{attribute.name | translate}}"> <input ng-if="attribute.type === \'text\'" ng-model=attribute.value class=form-control type=text ng-attr-placeholder="{{attribute.name | translate}}"> <textarea ng-if="attribute.type === \'textarea\'" ng-model=attribute.value class=form-control row=3 ng-attr-placeholder="{{attribute.name | translate}}"></textarea> <div ng-if="attribute.type === \'checkbox\'" class=checkbox> <label> <input ng-model=attribute.value type=checkbox> <span>{{attribute.name | translate}}</span> </label> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.legend !== undefined" class="gmf-print-legend checkbox"> <label> <input ng-model=$ctrl.layoutInfo.legend type=checkbox> <span translate>Legend</span> </label> </div> <div class="gmf-print-layout-selector form-horizontal"> <div ng-show="$ctrl.layoutInfo.layouts.length !== 1" class=form-group> <label class="control-label col-md-5" translate>Layout</label> <div class=col-md-7> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown> <span>{{$ctrl.layoutInfo.layout | translate}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="layout in $ctrl.layoutInfo.layouts"> <a ng-click=$ctrl.setLayout(layout) href="">{{layout | translate}}</a> </li> </ul> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.scales.length !== 1" class="gmf-print-scale-selector form-group"> <label class="control-label col-md-5" translate>Scale</label> <div class=col-md-7> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown aria-expanded=false> <span>{{$ctrl.layoutInfo.scale | ngeoScalify}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="scale in $ctrl.layoutInfo.scales"> <a ng-click=$ctrl.getSetScale(scale) href="">{{scale | ngeoScalify}}</a> </li> <span ng-if=$ctrl.scaleInput> <li class=dropdown-header translate>Manual entry</li> <li> <div class=gmf-print-custom-scale> 1 : <input class=gmf-print-custom-scale-input type=number min=1 ng-model=$ctrl.getSetScale ng-model-options="{getterSetter: true}"> </div> </li> </span> </ul> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.dpis.length !== 1" class="gmf-print-dpi-selector form-group"> <label class="control-label col-md-3" translate>DPI</label> <div class=col-md-5> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown aria-expanded=false> <span>{{$ctrl.layoutInfo.dpi}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="dpi in $ctrl.layoutInfo.dpis"> <a href="" ng-click=$ctrl.setDpi(dpi)>{{dpi}}</a> </li> </ul> </div> </div> </div> <div class="gmf-print-rotation-selector form-group"> <label class="control-label col-md-3" translate>Rotation</label> <div class=col-md-5> <input class="form-control gmf-print-rotation-input" type=range value=0 min=-180 max=180 data-toggle=tooltip title="{{\'You can also use Alt+Shift on the map\' | translate}}"> </div> <div class=col-md-4> <input class="form-control gmf-print-rotation-input" type=number min=-180 max=180 value=0> </div> </div> </div> <div class="gmf-print-actions form-group pull-right"> <span ng-show="$ctrl.isState(\'PRINTING\')"> <i class="fa fa-refresh fa-spin"></i> </span> <a ng-show="$ctrl.isState(\'PRINTING\')" class="gmf-print-cancel btn btn-link" href="" ng-click=$ctrl.cancel() translate>Abort</a> <button ng-show=$ctrl.layoutInfo.formats.png class="gmf-print-image btn btn-primary" ng-disabled="$ctrl.isState(\'PRINTING\')" ng-click="$ctrl.print(\'png\')" translate>Image</button> <button ng-show=$ctrl.layoutInfo.formats.pdf class="gmf-print-pdf btn btn-primary" ng-disabled="$ctrl.isState(\'PRINTING\')" ng-click="$ctrl.print(\'pdf\')" translate>PDF</button> </div> <div ng-show="$ctrl.isState(\'ERROR_ON_REPORT\')" class="gmf-print-error-report form-group pull-left text-danger"> <p>{{\'Error during the print, please try again.\' | translate}}</p> </div> </div> <div ng-show="$ctrl.isState(\'CAPABILITIES_NOT_LOADED\')" class="gmf-print-wait form-group pull-left"> <p>{{\'Connecting to the print server, please wait.\' | translate}}</p> </div> <div ng-show="$ctrl.isState(\'ERROR_ON_GETCAPABILITIES\')" class="gmf-print-error-capabilities form-group pull-left text-danger"> <p>{{\'The print server is unavailable. Please, try later.\' | translate}}</p> </div> </div> '},function(e,t){e.exports='<div ng-switch=efsCtrl.selectedEditableTreeCtrl> <div ng-switch-when=null> <select class=form-control ng-model=efsCtrl.selectedEditableTreeCtrl ng-show="efsCtrl.editableTreeCtrls.length > 0" ng-options="treeCtrl.node.name | translate for treeCtrl in efsCtrl.editableTreeCtrls"> <option value="" translate>-- Choose a layer --</option> </select> <span ng-show="efsCtrl.editableTreeCtrls.length == 0" translate>No editable layer available!</span> </div> <div ng-switch-default> <div class=row> <div class=col-sm-12> <span translate>Currently editing: </span> <b>{{ efsCtrl.selectedEditableTreeCtrl.node.name | translate }}</b> <span class="fa fa-pencil"></span> <br> <button ng-click=efsCtrl.stopEditing() class="btn btn-link btn-xs pull-right"> <span class="fa fa-times"></span> {{\'Stop editing\' | translate}} </button> </div> </div> <gmf-editfeature gmf-editfeature-dirty=efsCtrl.dirty gmf-editfeature-editabletreectrl=::efsCtrl.selectedEditableTreeCtrl gmf-editfeature-map=::efsCtrl.map gmf-editfeature-state=efsCtrl.state gmf-editfeature-tolerance=::efsCtrl.tolerance gmf-editfeature-vector=::efsCtrl.vectorLayer gmf-editfeature-closeaftersave=::efsCtrl.closeAfterSave> </gmf-editfeature> </div> </div> '},function(e,t){e.exports='<div> <div ng-switch=efCtrl.feature> <a ng-switch-when=null ng-if=efCtrl.geomType href ngeo-btn ngeo-createfeature ngeo-createfeature-active=efCtrl.createActive ngeo-createfeature-features=::efCtrl.features ngeo-createfeature-geom-type=::efCtrl.geomType ngeo-createfeature-map=::efCtrl.map class="btn btn-default" ng-class="{active: efCtrl.createActive}" ng-model=efCtrl.createActive> <span ng-switch=::efCtrl.geomType> <span ng-switch-when=Point> <span class="gmf-icon gmf-icon-point"></span> {{\'Draw new point\' | translate}} </span> <span ng-switch-when=MultiPoint> <span class="gmf-icon gmf-icon-point"></span> {{\'Draw new point\' | translate}} </span> <span ng-switch-when=LineString> <span class="gmf-icon gmf-icon-line"></span> {{\'Draw new linestring\' | translate}} </span> <span ng-switch-when=MultiLineString> <span class="gmf-icon gmf-icon-line"></span> {{\'Draw new linestring\' | translate}} </span> <span ng-switch-when=Polygon> <span class="gmf-icon gmf-icon-polygon"></span> {{\'Draw new polygon\' | translate}} </span> <span ng-switch-when=MultiPolygon> <span class="gmf-icon gmf-icon-polygon"></span> {{\'Draw new polygon\' | translate}} </span> </span> </a> <div ng-switch-default> <form novalidate name=form class="form gmf-editfeature-attributes-container" ng-if=efCtrl.attributes> <div class=row> <div class=col-sm-12> <a class=close ng-click=efCtrl.cancel() ng-disabled=efCtrl.pending title="{{\'Cancel modifications\' | translate}}" href>&times;</a> </div> </div> <ngeo-attributes ngeo-attributes-attributes=::efCtrl.attributes ngeo-attributes-disabled=efCtrl.pending ngeo-attributes-feature=::efCtrl.feature> </ngeo-attributes> <input type=submit value="{{\'Save\' | translate}}" class="btn btn-sm btn-default gmf-editfeature-btn-save" ng-click="form.$valid && efCtrl.save()" ng-disabled="!efCtrl.dirty || efCtrl.pending" title="{{\'Save modifications\' | translate}}"> <a class="btn btn-sm btn-default gmf-editfeature-btn-cancel" ng-click=efCtrl.confirmCancel() ng-disabled=efCtrl.pending title="{{\'Cancel modifications\' | translate}}" href>{{\'Cancel\' | translate}}</a> <button class="btn btn-sm btn-link gmf-editfeature-btn-delete" ng-click=efCtrl.delete() ng-disabled=efCtrl.pending ng-show=efCtrl.featureId title="{{\'Delete this feature\' | translate}}"> <span class="fa fa-trash"></span> {{\'Delete\' | translate}} </button> </form> </div> </div> <ngeo-modal ng-model=efCtrl.unsavedModificationsModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Unsaved modifications!\' | translate}} </h4> </div> <div class=modal-body> {{\'There are unsaved changes.\' | translate}} </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal ng-click=efCtrl.continueWithoutSaving()> {{\'Continue without saving\' | translate}} </button> <button type=button class="btn btn-primary" data-dismiss=modal> {{\'Cancel\' | translate}} </button> <button type=button class="btn btn-default" data-dismiss=modal ng-click=efCtrl.submit()> {{\'Save\' | translate}} </button> </div> </ngeo-modal> <ngeo-modal ng-model=efCtrl.showServerError> <div class=modal-header>{{\'Server error.\' | translate}}</div> <div class=modal-body>{{efCtrl.serverErrorType}}<br> {{efCtrl.serverErrorMessage || (\'Unexpected server error.\' | translate)}}</div> </ngeo-modal> </div> '},function(e,t){e.exports='<fieldset ng-disabled=attrCtrl.disabled> <div class=form-group ng-repeat="attribute in ::attrCtrl.attributes"> <div ng-if="attribute.type !== \'geometry\'"> <label ng-if="::attribute.type !== \'boolean\'" class=control-label>{{ ::attribute.name | translate }} <span class=text-muted>{{::attribute.required ? "*" : ""}}</span> </label> <div ng-switch=::attribute.type> <div ng-switch-when=boolean class=checkbox> <label> <input name={{::attribute.name}} ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); type=checkbox>  <span> {{ ::attribute.name | translate }} <span class=text-muted>{{::attribute.required ? "*" : ""}}</span></span> </label> </div> <select name={{::attribute.name}} ng-required=attribute.required ng-switch-when=select ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control type=text> <option ng-repeat="attribute in ::attribute.choices" value="{{ ::attribute }}"> {{ ::attribute | translate }} </option> </select> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=date ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;timepicker&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;allowBlank&quot;: true, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;}\'" class=form-control type=text>  <input name={{::attribute.name}} id=time ng-required=attribute.required ng-switch-when=time ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;datepicker&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;, &quot;defaultTime&quot;: &quot;00:00&quot;}\'" class=form-control type=text>  <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=datetime ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;scrollTime&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;allowBlank&quot;: true, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;, &quot;defaultTime&quot;: &quot;00:00&quot;}\'" class=form-control type=text>  <div ng-switch-when=number ng-switch=::attribute.numType> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=integer ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control step=1 type=number>  <input name={{::attribute.name}} ng-required=attribute.required ng-switch-default ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control type=number>  </div> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-default ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ng-maxlength=attribute.maxLength class=form-control type=text>  <div ng-show="attrCtrl.form.$submitted || attrCtrl.form[attribute.name].$touched"> <p class=text-danger ng-show=attrCtrl.form[attribute.name].$error.required> {{\'This field is required\' | translate}} </p> </div> </div> </div> </div> </fieldset> '},,function(e,t){e.exports='<ngeo-drawfeature ngeo-btn-group class=btn-group ngeo-drawfeature-active=efCtrl.drawActive ngeo-drawfeature-map=efCtrl.map ngeo-drawfeature-showmeasure=efCtrl.showMeasure> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-default ngeo-drawfeature-point" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-default ngeo-drawfeature-linestring" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a text label on the map\' | translate}}" href ngeo-btn ngeo-drawtext class="btn btn-default ngeo-drawfeature-text" ng-class="{active: dfCtrl.drawText.active}" ng-model=dfCtrl.drawText.active> <span class="gmf-icon gmf-icon-text"></span> </a> </ngeo-drawfeature> <div ng-switch=efCtrl.selectedFeature> <hr class=gmf-drawfeature-separator ng-show="efCtrl.getFeaturesArray().length > 0"> <div ng-switch-when=null> <div ng-show="efCtrl.getFeaturesArray().length > 0"> <div class=ngeo-drawfeature-actionbuttons> <button type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false ngeo-exportfeatures ngeo-exportfeatures-features=efCtrl.features class="btn btn-link btn-sm"> <span class="fa fa-mail-forward"></span> {{\'Export\' | translate}} <span class=caret></span> </button> <button ng-click=efCtrl.clearFeatures() class="btn btn-link btn-xs"> <span class="fa fa-trash"></span> {{\'Delete All\' | translate}} </button> </div> <div class=gmf-eol></div> <div class="gmf-drawfeature-featurelist list-group list-group-sm"> <button role=button class=list-group-item ng-repeat="feature in efCtrl.getFeaturesArray()" ng-click=efCtrl.selectFeatureFromList(feature);> {{ feature.get(efCtrl.nameProperty) }} </button> </div> </div> </div> <div ng-switch-default> <button ng-click="efCtrl.selectedFeature = null;" class="btn btn-link btn-xs"> <span class="fa fa-arrow-left"></span> {{\'List\' | translate}} </button> <div class=ngeo-drawfeature-actionbuttons> <button type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false ngeo-exportfeatures ngeo-exportfeatures-features=efCtrl.selectedFeatures class="btn btn-link btn-xs"> <span class="fa fa-mail-forward"></span> {{\'Export\' | translate}} <span class=caret></span> </button> <button ng-click=efCtrl.removeFeature(efCtrl.selectedFeature); class="btn btn-link btn-xs"> <span class="fa fa-trash"></span> {{\'Delete\' | translate}} </button> </div> <div class=gmf-eol></div> <gmf-featurestyle gmf-featurestyle-feature=efCtrl.selectedFeature> </gmf-featurestyle> </div> </div> '},function(e,t){e.exports='<div ng-if="fsCtrl.feature && fsCtrl.type"> <div class=form-group> <input ng-model=fsCtrl.getSetName ng-model-options="{getterSetter: true}" ng-attr-placeholder="{{\'Name\' | translate}}" class=form-control /> </div> <div ng-if="fsCtrl.type !== \'Text\'" class=form-group> <input id=gmf-featurestyle-showlabel type=checkbox ng-model=fsCtrl.getSetShowLabel ng-model-options="{getterSetter: true}"/> <label ng-switch=fsCtrl.type for=gmf-featurestyle-showlabel class=control-label> {{\'Display label\' | translate}} </label> </div> <div ng-if="fsCtrl.type !== \'Text\'" class=form-group> <input id=gmf-featurestyle-showmeasure type=checkbox ng-model=fsCtrl.getSetShowMeasure ng-model-options="{getterSetter: true}"/> <label ng-switch=fsCtrl.type for=gmf-featurestyle-showmeasure class=control-label> <span ng-switch-when=Circle> {{\'Display azimuth and radius\' | translate}} </span> <span ng-switch-when=Polygon> {{\'Display surface\' | translate}} </span> <span ng-switch-when=Rectangle> {{\'Display surface\' | translate}} </span> <span ng-switch-when=LineString> {{\'Display length\' | translate}} </span> <span ng-switch-when=Point> {{\'Display coordinates\' | translate}} </span> </label> <em class=text-muted> ({{ fsCtrl.measure }}) </em> </div> </div> <div ng-if="fsCtrl.feature && fsCtrl.type" class=form-horizontal> <div class=form-group> <div ngeo-colorpicker="" ngeo-colorpicker-color=fsCtrl.color class=col-md-12> </div> </div> <div ng-if="fsCtrl.type === \'Point\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Size\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=3 max=20 step=1 ng-model=fsCtrl.getSetSize ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Text\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Size\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=8 max=30 step=1 ng-model=fsCtrl.getSetSize ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Circle\' || fsCtrl.type === \'LineString\' || fsCtrl.type === \'Polygon\' || fsCtrl.type === \'Rectangle\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Stroke\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=0.5 max=5 step=0.5 ng-model=fsCtrl.getSetStroke ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Circle\' || fsCtrl.type === \'Polygon\' || fsCtrl.type === \'Rectangle\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Opacity\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=0 max=1 step=0.05 ng-model=fsCtrl.getSetOpacity ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Text\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Angle\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=-180 max=180 step=22.5 ng-model=fsCtrl.getSetAngle ng-model-options="{getterSetter: true}"/> </div> </div> </div> '},,,function(e,t){e.exports='<div class=ngeo-displaywindow ng-show=$ctrl.open title=""> <div class=windowcontainer ng-style=$ctrl.style> <button type=button class="btn fa-close close" ng-click=$ctrl.close()> </button> <div class=animation-container> <div class=slide-animation> <div class="header ui-draggable-handle" ng-if="$ctrl.title !== null"> <p class=title>{{$ctrl.title | translate}}</p> </div> <div class="details content" ng-if=$ctrl.content ng-bind-html=$ctrl.content> </div> <div class="details iframe" ng-if="$ctrl.url !== null"> <iframe frameborder=0 type=text/html height=100% width=100% ng-src="{{ $ctrl.urlTrusted }}"></iframe> </div> <div class=content-template-container></div> </div> </div> </div> </div> '},function(e,t){e.exports='<ul class=gmf-theme-selector> <li ng-repeat="theme in $ctrl.themes" ng-click=$ctrl.setTheme(theme) ng-class="{\'gmf-theme-selector-active\': $ctrl.gmfThemeManager.getThemeName() == theme.name}"> <img class=gmf-thumb ng-src={{::theme.icon}} /> <span class=gmf-text>{{theme.name | translate}}</span> </li> </ul> '},function(e,t){e.exports='<div class=gmf-search> <input type=text ng-attr-placeholder={{$ctrl.placeholder|translate}} class=form-control ng-model=$ctrl.inputValue ngeo-search=$ctrl.options ngeo-search-datasets=$ctrl.datasets ngeo-search-listeners=$ctrl.listeners> <span class="gmf-clear-button ng-hide" ng-hide="!$ctrl.clearButton || $ctrl.inputValue == \'\'" ng-click=$ctrl.onClearButton()> </span> </div> <span ng-if=$ctrl.colorChooser> <span ng-show=$ctrl.displayColorPicker ngeo-popover ngeo-popover-placement=bottom> <button class="gmf-color-button fa fa-tint" ngeo-popover-anchor data-original-title="{{\'Change the color of the search result\'|translate}}"></button> <div ngeo-popover-content> <div ngeo-colorpicker ngeo-colorpicker-color=$ctrl.color></div> </div> </span> </span> '},,,,,,,function(e,t){e.exports='<table class=ngeo-colorpicker-palette> <tr ng-repeat="colors in ::ctrl.colors"> <td ng-repeat="color in ::colors" ng-click=ctrl.setColor(color) ng-class="{\'ngeo-colorpicker-selected\': color == ctrl.color}"> <div ng-style="::{\'background-color\': color}"></div> </td> </tr> </table> '},function(e,t){e.exports='<div class=gmf-displayquerywindow ng-class="{\'desktop\': ctrl.desktop, \'mobile\': !ctrl.desktop}" ng-show=ctrl.open> <button class=collapse-button type=button ng-show=::!ctrl.desktop ngeo-swipe-up="ctrl.collapsed = false" ngeo-swipe-down="ctrl.collapsed = true" ngeo-swipe-disable-mouse ng-click="ctrl.collapsed = !ctrl.collapsed" ng-class="[ctrl.collapsed ? \'collapse-button-up\' : \'collapse-button-down\']"> </button> <div class=windowcontainer ng-swipe-disable-mouse ng-swipe-left=ctrl.next() ng-swipe-right=ctrl.previous()> <button type=button class="btn fa-close close" ng-click=ctrl.close()> </button> <div class=animation-container ng-class="[ctrl.collapsed ? \'\' : \'animation-container-detailed\', ctrl.isNext ? \'next\' : \'previous\']"> <div ng-animate-swap=ctrl.animate class="slide-animation gmf-animatable"> <div class="header ui-draggable-handle"> <p class=title>{{ctrl.source.label | translate}}</p> <p class=subtitle>{{ctrl.getFeatureValues()[ctrl.source.identifierAttributeField]}}</p> </div> <div class=details> <table> <tr ng-repeat="(key, value) in ctrl.getFeatureValues()" ng-if="value !== undefined"> <td class=details-key ng-bind-html="key | translate | ngeoTrustHtml"></td> <td class=details-value ng-bind-html="value | removeCDATA | ngeoTrustHtml"></td> </tr> </table> </div> </div> </div> <div class=navigate> <div class=placeholder> <button type=button class="previous btn" ng-disabled=ctrl.isFirst() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.previous()> <span ng-show=::ctrl.desktop>{{\'Prev.\' | translate}}</span> </button> </div> <div class=results> <span ng-show=::!ctrl.desktop>{{\'Result\' | translate}}</span> <span>{{ctrl.currentResult + 1}}</span> <span>/</span> <span>{{ctrl.getResultLength()}}</span> <div ng-show=::ctrl.desktop class=dropup> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class="fa fa-filter"></span> <span class="fa fa-caret-up"></span> </button> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href=# ng-click=ctrl.setSelectedSource(null)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === null}"> </i> <span>{{\'All layers\' | translate}} ({{ctrl.ngeoQueryResult.total}})</span> </a> </li> <li role=separator class=divider> </li> <li ng-repeat-start="source in ctrl.ngeoQueryResult.sources | filter: ctrl.sourcesFilter" ng-repeat-end ng-class="{\'disabled\': source.features.length <= 0}"> <a href=# ng-click=ctrl.setSelectedSource(source)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === source}"> </i> <span>{{source.label | translate}} ({{source.features.length}})</span> </a> </li> </ul> </div> </div> <div class=placeholder> <button type=button class="next btn" ng-disabled=ctrl.isLast() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.next()> <span ng-show=::ctrl.desktop>{{\'Next\' | translate}}</span> </button> </div> </div> </div> </div> '},,,,,,function(e,t){e.exports='<div class="gmf-displayquerygrid panel" ng-show=ctrl.active> <div class=close ng-click=ctrl.clear()> &times; </div> <ul class="nav nav-pills" role=tablist> <li ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=presentation ng-class="{\'active\' : ctrl.isSelected(gridSource)}" ng-click=ctrl.selectTab(gridSource)> <a href=#{{ctrl.escapeValue(gridSource.source.label)}} data-target=#{{ctrl.escapeValue(gridSource.source.label)}} aria-controls={{ctrl.escapeValue(gridSource.source.label)}} role=tab data-toggle=tab> <span ng-if="gridSource.source.tooManyResults !== true"> {{gridSource.source.label | translate}} ({{gridSource.source.features.length}}) </span> <span ng-if="gridSource.source.tooManyResults === true"> {{gridSource.source.label | translate}} ({{gridSource.source.totalFeatureCount}}*) </span> </a> </li> </ul> <div class=tab-content> <div ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=tabpanel class=tab-pane ng-class="{\'active\' : ctrl.isSelected(gridSource)}" id={{ctrl.escapeValue(gridSource.source.label)}}> <ngeo-grid ngeo-grid-configuration=gridSource.configuration ng-if="gridSource.source.tooManyResults !== true"> </ngeo-grid> <div ng-if="gridSource.source.tooManyResults === true"> <div class="gmf-displayquerygrid-message alert alert-warning"> <p><span translate>The results can not be displayed because the maximum number has been reached</span> ({{gridSource.source.limit}}).</p> <p translate>Please refine your query.</p> </div> </div> </div> </div> <div class=navbar ng-show="!ctrl.pending && ctrl.getActiveGridSource() && ctrl.getActiveGridSource().configuration !== null"> <ul class="nav navbar-nav navbar-right"> <li class=ng-hide ng-show=ctrl.isOneSelected()> <p class="navbar-text ng-binding"> {{ctrl.getSelectedRowCount()}} <span translate>selected element(s)</span> </p> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Zoom to selection\' | translate}}" ng-click=ctrl.zoomToSelection()> <i class="fa fa-search-plus"></i> <span translate>Zoom to</span> </button> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Export selection as CSV\' | translate}}" ng-click=ctrl.downloadCsv()> <i class="fa fa-download"></i> <span translate>Export as CSV</span> </button> </li> <li class="dropdown navbar-link dropup"> <button type=button class="dropup btn btn-default btn-xs" data-toggle=dropdown aria-haspopup=true aria-expanded=false> <span translate>Select</span> <span class=caret></span> </button> <ul class=dropdown-menu aria-labelledby=dLabel> <li> <a href="" ng-click=ctrl.selectAll() translate>All</a> </li> <li> <a href="" ng-click=ctrl.unselectAll() translate>None</a> </li> <li> <a href="" ng-click=ctrl.invertSelection() translate>Reverse selection</a> </li> </ul> </li> </ul> </div> <div ng-show=ctrl.pending class=gmf-displayquerygrid-pending> <span class="fa fa-spinner fa-spin"></span> </div> </div> '},function(e,t){e.exports='<div class=ngeo-grid-table-container> <table float-thead=ctrl.floatTheadConfig ng-model=ctrl.configuration.data class="table table-bordered table-striped table-hover"> <thead class=table-header> <tr> <th ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-click=ctrl.sort(columnDefs.name) ng-bind-html="columnDefs.name | ngeoTrustHtml | translate"> <i ng-show="ctrl.sortedBy !== columnDefs.name" class="fa fa-fw"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === true" class="fa fa-caret-up"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === false" class="fa fa-caret-down"></i> </th> </tr> </thead> <tbody> <tr ng-repeat="attributes in ctrl.configuration.data" ng-class="[\'row-\' + ctrl.configuration.getRowUid(attributes), ctrl.configuration.isRowSelected(attributes) ? \'ngeo-grid-active\': \'\']" ng-click="ctrl.clickRow(attributes, $event)" ng-mousedown=ctrl.preventTextSelection($event)> <td ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-bind-html="attributes[columnDefs.name] | removeCDATA | ngeoTrustHtml"></td> </tr> </tbody> </table> </div> '},,,function(e,t){e.exports='<div class="btn-group dropup"> <a type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class=gmf-mouseposition-control-target></span> <span class=caret></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li class=dropdown-header translate>Coordinate systems</li> <li ng-repeat="projitem in ::ctrl.projections"> <a href ng-click=ctrl.setProjection(projitem)> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.projection == projitem}"></span> {{::projitem.label}} </a> </li> </ul> </div> '},function(e,t){e.exports="<div ngeo-map=ctrl.map ngeo-map-manage-resize=ctrl.manageResize ngeo-map-resize-transition=ctrl.resizeTransition> </div> "},function(e,t){e.exports='<div class="btn-group btn-block" ng-class="::{\'dropup\': scaleselectorCtrl.options.dropup}"> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span ng-bind-html="scaleselectorCtrl.currentScale | ngeoScalify | ngeoTrustHtml"></span>&nbsp;<i class=caret></i> </button> <ul class="dropdown-menu btn-block" role=menu> <li ng-repeat="zoomLevel in ::scaleselectorCtrl.zoomLevels"> <a href ng-click=scaleselectorCtrl.changeZoom(zoomLevel) ng-bind-html="scaleselectorCtrl.getScale(zoomLevel) | ngeoScalify | ngeoTrustHtml"> </a> </li> </ul> </div> '},function(e,t){e.exports='<div class=modal-header> <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button> <h4 class=modal-title translate>Share this map</h4> </div> <div class=modal-body> <form role=form name=gmfShareForm novalidate> <div class=form-group> <label for=gmfShareInputShortLink translate>Permalink</label> <input type=text class=form-control id=gmfShareInputShortLink onclick=this.select() ng-model=$ctrl.shortLink readonly=True> <p class=help-block translate>Copy this link to share it.</p> <p class=text-danger ng-if=$ctrl.showLengthWarning> <span class="fa fa-exclamation-triangle"></span> {{\'You have a lot of drawn elements in this map. The above link may not be correctly supported by some browsers.\' | translate}} </p> <p class=text-danger ng-if=$ctrl.errorOnGetShortUrl> <span class="fa fa-exclamation"></span> {{\'Error, cannot get the shortened URL.\' | translate}} </p> </div> <hr ng-if=::$ctrl.enableEmail> <div class=gmf-share-email ng-if=::$ctrl.enableEmail> <div class=form-group> <label for=gmfShareInputEmail translate>Send this link to</label> <input type=email class=form-control name=inputEmail id=gmfShareInputEmail placeholder=E-mail ng-model=$ctrl.email required> <span ng-show="gmfShareForm.$submitted || gmfShareForm.inputEmail.$touched"> <span class=text-danger ng-show="gmfShareForm.inputEmail.$error.email || gmfShareForm.inputEmail.$error.required"> <i class="fa fa-exclamation-triangle" aria-hidden=true></i> {{\'Invalid email.\' | translate}}</span> </span> </div> <div class=form-group> <textarea class=form-control ng-attr-placeholder="{{\'Message (optional)\' | translate }}" ng-model=$ctrl.message></textarea> </div> <span class=text-success ng-if=$ctrl.successfullySent> <i class="fa fa-check" aria-hidden=true></i> {{ \'Link successfully sent.\' | translate }} </span> <span class=text-danger ng-if=$ctrl.errorOnsend> <i class="fa fa-exclamation" aria-hidden=true></i> {{ \'Error, the link has not been sent.\' | translate }} </span> </div> <div class=text-right> <button type=button class="btn btn-default" data-dismiss=modal translate>Close</button> <button ng-if=::$ctrl.enableEmail type=submit class="btn btn-default btn-primary" ng-click=$ctrl.sendShortUrl() ng-disabled=!gmfShareForm.$valid translate>Send </button> </div> </form> </div> '},function(e,t){e.exports='<div class=gmf-time-slider> <div ui-slider=sliderCtrl.sliderOptions ng-model=sliderCtrl.dates> <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex=0 data-toggle=tooltip title=""> </span> </div> <div class=gmf-time-slider-displayed-dates> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[0])}}</span> </div> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'value\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates)}}</span> </div> <div class=gmf-time-slider-end-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[1])}}</span> </div> </div> </div> '},,,,function(e,t){e.exports='<div class=gmf-layertree-root-tools ng-if=layertreeCtrl.isRoot> <a href ng-if="gmfLayertreeCtrl.nodesCount() > 0" ng-click=gmfLayertreeCtrl.removeAllNodes()> <span class="fa fa-trash"></span> {{\'Clear all\' | translate}} </a> </div> <div ng-if=::!layertreeCtrl.isRoot id=gmf-layertree-node-{{::layertreeCtrl.uid}} ng-class="[layertreeCtrl.node.children ? \'gmf-layertree-group\' : \'gmf-layertree-leaf\', \'gmf-layertree-depth-\' + layertreeCtrl.depth, gmfLayertreeCtrl.getResolutionStyle(layertreeCtrl.node), gmfLayertreeCtrl.getNodeState(layertreeCtrl)]"> <div class=ngeo-sortable-handle ng-show="layertreeCtrl.depth === 1 && layertreeCtrl.parent.children.length > 1"> <i class="gmf-layertree-sortable-handle-icon fa fa-ellipsis-v"></i> </div> <a ng-if=::layertreeCtrl.node.children data-toggle=collapse href=#gmf-layertree-layer-group-{{::layertreeCtrl.uid}} aria-expanded={{::layertreeCtrl.node.metadata.isExpanded}} class="fa gmf-layertree-expand-node fa-fw"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::!layertreeCtrl.node.children ng-class="::{\'gmf-layertree-no-layer-icon\' : !gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl)}" class=gmf-layertree-layer-icon> <div> <img ng-if="::(legendIconUrl=gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl))" ng-src={{::legendIconUrl}}>  </div> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::layertreeCtrl.node.children> <span ng-switch="layertreeCtrl.node.children && !layertreeCtrl.layer.loading"> <i ng-switch-when=true class="fa fa-fw gmf-layertree-state"></i> <i ng-switch-when=false class="fa fa-fw fa-refresh fa-spin"></i> </span> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) class=gmf-layertree-name data-toggle=tooltip data-placement=top title="{{layertreeCtrl.node.name | translate}}"> {{layertreeCtrl.node.name | translate}} <i class="gmf-icon gmf-icon-search-go gmf-layertree-zoom" data-toggle=tooltip data-placement=bottom data-title="{{\'Not visible at current scale. Click to zoom.\'|translate}}" ng-click="::gmfLayertreeCtrl.zoomToResolution(layertreeCtrl); $event.preventDefault(); $event.stopPropagation();" ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) == \'on\'"> </i> <span ngeo-popover ngeo-popover-dismiss=.content ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) !== \'off\' && layertreeCtrl.node.time && layertreeCtrl.node.time.mode !== \'disabled\'"> <span ngeo-popover-anchor class="fa fa-clock-o" ng-click="$event.preventDefault(); $event.stopPropagation()"> </span> <div ngeo-popover-content> <ngeo-date-picker ng-if="::layertreeCtrl.node.time.widget === \'datepicker\'" time=layertreeCtrl.node.time on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </ngeo-date-picker> <gmf-time-slider ng-if="::layertreeCtrl.node.time.widget === \'slider\'" gmf-time-slider-time=layertreeCtrl.node.time gmf-time-slider-on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </gmf-time-slider> </div> </span> <span class="fa fa-pencil" data-toggle=tooltip data-placement=right title="{{\'Currently editing this layer\'|translate}}" ng-if=layertreeCtrl.properties.editing> </span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-if="::layertreeCtrl.depth == 1" ng-click=gmfLayertreeCtrl.removeNode(layertreeCtrl.node)> <span class="fa fa-trash"></span> </a> <a class=gmf-layertree-node-menu-btn href="" ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl) ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-menu-\' + layertreeCtrl.uid)"> <span class="fa fa-cog"></span> </a> <span ngeo-popover ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed && !layertreeCtrl.node.children) || (gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend) || layertreeCtrl.getDataSource().filtrable" ngeo-popover-dismiss=.content> <span ngeo-popover-anchor class="extra-actions fa fa-cog"> </span> <div ngeo-popover-content> <ul> <li ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed)"> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </li> <li ng-if="::gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend"> <i class="fa fa-th-list fa-fw"></i> <a ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\'); popoverCtrl.dismissPopover()" data-toggle=collapse href=""> {{\'Show/hide legend\'|translate}} </a> </li> <li ng-if="layertreeCtrl.getDataSource() && layertreeCtrl.getDataSource().filtrable"> <i class="fa fa-filter fa-fw"></i> <a ng-click=gmfLayertreeCtrl.toggleFiltrableDataSource(layertreeCtrl.getDataSource()) href=""> {{\'Filter\'|translate}} </a> </li> </ul> </div> </span> <span class=gmf-layertree-metadata ng-if=::layertreeCtrl.node.metadata.metadataUrl> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow === true"> <a title="{{\'More informations\'|translate}}" href={{::layertreeCtrl.node.metadata.metadataUrl}} target=blank_> </a> </span> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow !== true"> <a title="{{\'More informations\'|translate}}" href="" ng-click=gmfLayertreeCtrl.displayMetadata(layertreeCtrl)> </a> </span> </span> </span> </div> <div class=gmf-layertree-node-menu id=gmf-layertree-node-menu-{{::layertreeCtrl.uid}} style=display:none ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl)> <div ng-if=::gmfLayertreeCtrl.supportsOpacityChange(layertreeCtrl)> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </div> <a class=gmf-layertree-node-menu-togglelegend ng-if=::gmfLayertreeCtrl.supportsLegend(layertreeCtrl) data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> <span class="fa fa-th-list"> </span> {{\'Show/hide legend\'|translate}} </a> </div> <div ng-if="::!layertreeCtrl.isRoot && gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend" id=gmf-layertree-node-{{::layertreeCtrl.uid}}-legend class="collapse gmf-layertree-legend" ng-class="[gmfLayertreeCtrl.getNodeState(layertreeCtrl), layertreeCtrl.node.metadata.isLegendExpanded ? \'in\' : \'\']"> <a title="{{\'Hide legend\'|translate}}" data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> {{\'Hide legend\'|translate}} </a> <div ng-if="gmfLayertreeCtrl.isNodeLegendVisible(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')"> <div ng-repeat="(title, url) in gmfLayertreeCtrl.getLegendsObject(layertreeCtrl)"> <p ng-if="gmfLayertreeCtrl.getNumberOfLegendsObject(layertreeCtrl) > 1">{{title|translate}}</p> <img ng-src={{url}}> </div> </div> </div> <ul class=gmf-layertree-root-external-datasources ng-if="layertreeCtrl.isRoot && (gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length)"> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmtsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups" group=wmtsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups" group=wmsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-if=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length group=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup> </gmf-datasourcegrouptree> </ul> <ul id=gmf-layertree-layer-group-{{::layertreeCtrl.uid}} ng-if=::layertreeCtrl.node.children ng-class="{collapse: !layertreeCtrl.isRoot, in : layertreeCtrl.node.metadata.isExpanded}" ngeo-sortable="::layertreeCtrl.isRoot && layertreeCtrl.node.children" ngeo-sortable-options="{handleClassName: \'ngeo-sortable-handle\', draggerClassName: \'gmf-layertree-dragger\', placeholderClassName : \'gmf-layertree-curr-drag-item\'}" ngeo-sortable-callback=::gmfLayertreeCtrl.afterReorder ngeo-sortable-callback-ctx=::gmfLayertreeCtrl> <li class=gmf-layertree-node ng-repeat="node in layertreeCtrl.node.children" ng-class="\'gmf-layertree-depth-\' + layertreeCtrl.depth" ngeo-layertree=node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<span ng-if=::!layertreeCtrl.isRoot>{{::layertreeCtrl.node.name}}</span> <input type=checkbox ng-if="::layertreeCtrl.node && !layertreeCtrl.node.children" ng-model=layertreeCtrl.getSetActive ng-model-options="{getterSetter: true}"/> <ul ng-if=::layertreeCtrl.node.children> <li ng-repeat="node in ::layertreeCtrl.node.children" ngeo-layertree=::node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<div class="gmf-layertree-group gmf-layertree-depth-1 {{$ctrl.group.visibilityState}}"> <a data-toggle=collapse href=#gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} aria-expanded=true class="fa gmf-layertree-expand-node fa-fw"> </a> <a class="fa fa-fw gmf-layertree-state" href ng-click=$ctrl.toggle()> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggle()> <span>{{$ctrl.group.title | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.remove()> <span class="fa fa-trash"></span> </a> </span> </div> <ul id=gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} class="collapse in"> <li class="gmf-layertree-node gmf-layertree-depth-2" ng-class="[dataSource.visible ? \'on\' : \'off\']" ng-repeat="dataSource in $ctrl.group.dataSources"> <div class=gmf-layertree-leaf> <a href ng-click=$ctrl.toggleDataSource(dataSource) class="gmf-layertree-layer-icon gmf-layertree-no-layer-icon"> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggleDataSource(dataSource)> <span>{{dataSource.name | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.removeDataSource(dataSource)> <span class="fa fa-trash"></span> </a> </span> </div> </li> </ul> '},function(e,t,r){e.exports=r.p+"crosshair.3aa99e.svg"},function(e,t){e.exports='<div class=form-group ng-switch=$ctrl.filtrableDataSources.length> <span ng-switch-when=0 translate>No filtrable layer available!</span> <select class=form-control ng-disabled=$ctrl.aRuleIsActive ng-switch-default ng-model=$ctrl.gmfDataSourceBeingFiltered.dataSource ng-options="dataSource.name | translate for dataSource in $ctrl.filtrableDataSources"> <option value="" translate>-- Layer to filter --</option> </select> <div ng-if="$ctrl.customRules && $ctrl.directedRules && $ctrl.readyDataSource"> <hr class=gmf-filterselector-separator /> <div class="dropdown gmf-filterselector-savedfilters"> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0}" type=button data-toggle=dropdown ng-disabled="$ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0"> <span translate>Saved</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <a href ng-click=$ctrl.saveFilterLoadItem(item)> <span>{{::item.name}}</span> </a> </li> <li role=separator class=divider></li> <li> <a href ng-click=$ctrl.saveFilterManage()> <span translate>Manage saved filters</span> </a> </li> </ul> </div> <ngeo-filter a-rule-is-active=$ctrl.aRuleIsActive custom-rules=$ctrl.customRules datasource=$ctrl.readyDataSource directed-rules=$ctrl.directedRules feature-overlay=$ctrl.featureOverlay map=$ctrl.map tool-group=$ctrl.toolGroup> </ngeo-filter> <div> <a class="btn btn-link gmf-filterselector-savebtn" type=button data-toggle=dropdown ng-click="!$ctrl.aRuleIsActive && $ctrl.saveFilterShowModal()" ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-save"></span> <span translate>Save</span> </a> </div> </div> <ngeo-modal ng-model=$ctrl.saveFilterSaveModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Save filter\' | translate}}</h4> </div> <div class=modal-body> <p class=gmf-filterselector-savefilter-desc translate> You can save the filter that you created to re-load it later. </p> <input type=text class=form-control name=name ng-model=$ctrl.saveFilterName placeholder="{{\'Filter name\' | translate}}"/> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Cancel\' | translate}}</button> <button type=button ng-click=$ctrl.saveFilterSave() ng-disabled="$ctrl.saveFilterName === \'\'" class="btn btn-primary">{{\'Save\' | translate}}</button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.saveFilterManageModalShown> <div class=gmf-filterselector-managefilter-modal> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Manage filters\' | translate}}</h4> </div> <div class=modal-body> <ul> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <span>{{::item.name}}</span> <a href ng-click=$ctrl.saveFilterRemoveItem(item)> {{ \'Delete\' | translate }} </a> <div class=gmf-eol></div> </li> </ul> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Close\' | translate}}</button> </div> </div> </ngeo-modal> </div> '},function(e,t){e.exports='<div class=dropdown> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-cog"></span> <span class=caret></span> </a> <ul class=dropdown-menu> <li class=ngeo-filter-condition-criteria-header translate>Criteria taken into account</li> <li ng-repeat="condition in ::$ctrl.conditions"> <a href ng-click=$ctrl.setCondition(condition)> <span ng-class="{\'ngeo-filter-condition-criteria-active\': condition.value == $ctrl.datasource.filterCondition}" class="fa fa-check ngeo-filter-condition-criteria"> </span> <span>{{::condition.text | translate}}</span> </a> </li> </ul> </div> <ngeo-rule ng-repeat="rule in $ctrl.directedRules" feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-directed map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> <hr class=ngeo-filter-separator-rules /> <div ng-repeat="rule in $ctrl.customRules"> <a class="btn btn-xs btn-link ngeo-filter-rule-custom-rm-btn" ng-click="!$ctrl.aRuleIsActive && $ctrl.removeCustomRule(rule)" ng-disabled=$ctrl.aRuleIsActive href> <span class="fa fa-remove"></span> </a> <ngeo-rule feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-custom map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> </div> <div class=dropdown> <a class="btn btn-link dropdown-toggle" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span translate>+ Add a new criteria</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="attribute in ::$ctrl.geometryAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span translate>Spatial filter</span> </a> </li> <li role=presentation class=divider></li> <li ng-repeat="attribute in ::$ctrl.otherAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span>{{::attribute.name | translate}}</span> </a> </li> </ul> </div> <hr class=ngeo-filter-separator-criteria /> <a class="btn btn-link" type=button ng-click=$ctrl.apply() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-check"></span> <span translate>Apply filter</span> </a> <a class="btn btn-link" type=button ng-click=$ctrl.getData() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-chevron-right"></span> <span translate>Get data</span> </a> '},function(e,t){e.exports='<div class=dropdown ng-class="{open: $ctrl.rule.active}"> <a class="btn btn-default btn-sm dropdown-toggle" type=button ng-click=$ctrl.toggle()> <span>{{ ::$ctrl.clone.name | translate }}</span> <span class=caret></span> </a> <div class="dropdown-menu form-group"> <select class="form-control input-sm ngeo-rule-operators-list" ng-disabled=$ctrl.drawActive ng-if=::$ctrl.clone.operators ng-model=$ctrl.clone.operator ng-options="$ctrl.operators[operator] | translate for operator in ::$ctrl.clone.operators track by operator"> </select> <div ng-switch=::$ctrl.clone.type> <div class="ngeo-rule-type-date form-group" ng-if=$ctrl.rule.active ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <ngeo-date-picker time=$ctrl.timeRangeMode on-date-selected=$ctrl.onDateRangeSelected(time)> </ngeo-date-picker> </div> <div ng-switch-default> <ngeo-date-picker time=$ctrl.timeValueMode on-date-selected=$ctrl.onDateSelected(time)> </ngeo-date-picker> </div> </div> </div> <div class="ngeo-rule-type-geometry form-group" ng-switch-when=geometry> <div ng-switch=$ctrl.geomType> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </div> <ngeo-drawfeature ngeo-drawfeature-active=$ctrl.drawActive ngeo-drawfeature-features=$ctrl.drawnFeatures ngeo-drawfeature-map=$ctrl.map> <div ngeo-btn-group class=btn-group> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-sm btn-default ngeo-drawfeature-point" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-sm btn-default ngeo-drawfeature-linestring" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-sm btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-sm btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-sm btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> </div> <div class=ngeo-rule-type-geometry-instructions ng-if=$ctrl.drawActive> <span ng-if=dfCtrl.drawPoint.active> {{ \'Draw a point on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureLength.active> {{ \'Draw a line string on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureArea.active> {{ \'Draw a polygon on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureAzimut.active> {{ \'Draw a circle on the map.\' | translate }} </span> <span ng-if=dfCtrl.drawRectangle.active> {{ \'Draw a rectangle on the map.\' | translate }} </span> </div> </ngeo-drawfeature> </div> <div class="checkbox ngeo-rule-type-select" ng-switch-when=select> <a ng-click=$ctrl.selectAllChoices() href>{{ All | translate}} </a> <label class="form-group ol-unselectable" ng-repeat="choice in ::$ctrl.clone.choices"> <input ng-checked="$ctrl.clone.getExpression() && $ctrl.clone.getExpression().split(\',\').indexOf(choice) > -1" ng-click=$ctrl.toggleChoiceSelection(choice) type=checkbox value=choice /> <span>{{ choice | translate }}</span> </label> </div> <div class="form-group ngeo-rule-type-text" ng-switch-default> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.lowerBoundary /> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.upperBoundary /> </div> <div ng-switch-default> <input type=number class="form-control input-sm" ng-if="$ctrl.clone.type === \'number\'" ng-model=$ctrl.clone.expression /> <input type=text class="form-control input-sm" ng-if="$ctrl.clone.type !== \'number\'" ng-model=$ctrl.clone.expression /> </div> </div> </div> <div class=ngeo-rule-btns> <button class="btn btn-xs btn-default" ng-click=$ctrl.apply() type=button>{{\'Apply\' | translate}}</button> <button class="btn btn-xs btn-default" ng-click=$ctrl.cancel() type=button>{{\'Cancel\' | translate}}</button> </div> </div> </div> </div> <div class=ngeo-rule-value ng-if="$ctrl.rule.value !== null"> <a class="btn btn-xs btn-link" ng-click="!$ctrl.rule.active && $ctrl.reset()" ng-disabled=$ctrl.rule.active href> <span class="fa fa-remove"></span> </a> <div ng-switch=::$ctrl.rule.type> <div ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>From </span> <span>{{ $ctrl.timeToDate($ctrl.rule.lowerBoundary) }}</span> <span translate> to </span> <span>{{ $ctrl.timeToDate($ctrl.rule.upperBoundary) }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.timeToDate($ctrl.rule.getExpression()) }}</span> </div> </div> </div> <div ng-switch-when=geometry> <span>{{ $ctrl.operators[$ctrl.rule.operator] }}</span> <span ng-switch=$ctrl.getRuleGeometryType()> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </span> </div> <div ng-switch-when=select> <span ng-repeat="choice in $ctrl.rule.getExpression().split(\',\')"> {{ choice | translate }}{{ $last ? \'\' : \', \' }} </span> </div> <div ng-switch-default> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>Between </span> <span>{{ $ctrl.rule.lowerBoundary }}</span> <span translate> and </span> <span>{{ $ctrl.rule.upperBoundary }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.rule.getExpression() }}</span> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<div class=ngeo-datepicker> <form name=dateForm class=ngeo-datepicker-form novalidate> <div ng-if="::datepickerCtrl.time.widget === \'datepicker\'"> <div class=ngeo-datepicker-start-date> <span ng-if="::datepickerCtrl.time.mode === \'range\'" translate>From:</span> <span ng-if="::datepickerCtrl.time.mode !== \'range\'" translate>Date:</span> <input name=sdate ui-date=datepickerCtrl.sdateOptions ng-model=datepickerCtrl.sdate required=""/> </div> <div class=ngeo-datepicker-end-date ng-if="::datepickerCtrl.time.mode === \'range\'"> <span translate>To:</span> <input name=edate ui-date=datepickerCtrl.edateOptions ng-model=datepickerCtrl.edate required=""/> </div> </div> </form> </div> '},,,,,,function(e,t){e.exports='<h4 class="popover-title ngeo-popup-title"> <span ng-bind-html=title></span> <button type=button class=close ng-click="open = false"> &times;</button> </h4> <div class=popover-content ng-bind-html=content></div> '},,,,,,function(e,t){e.exports='<ul class=gmf-backgroundlayerselector> <li ng-repeat="layer in ctrl.bgLayers" ng-click=ctrl.setLayer(layer) ng-class="{\'gmf-backgroundlayerselector-active\': ctrl.bgLayer == layer, \'gmf-backgroundlayerselector-disabled\': ctrl.opacityLayer == layer}"> <img class=gmf-thumb ng-src="{{::layer.get(\'metadata\')[\'thumbnail\']}}"/> <span class=gmf-text>{{layer.get("label") | translate}}</span> <span ng-class="{\'gmf-backgroundlayerselector-opacity-check\': ctrl.opacityLayer == layer}"></span> </li> <input ng-if=ctrl.opacityLayer class="input-action gmf-backgroundlayerselector-opacity-slider" name=bg-layer-opacity type=range min=0 max=1 step=0.01 ng-model=ctrl.getSetBgLayerOpacity ng-model-options="{getterSetter: true}"> </ul> '},function(e,t){e.exports='<div ng-if=$ctrl.gmfUser.username> <div class=form-group> <span>{{\'Logged in as\' | translate}}</span> <strong>{{ ::$ctrl.gmfUser.username }}</strong>. </div> <form name=logoutForm role=form ng-submit=$ctrl.logout() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=!$ctrl.changingPassword> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Logout\' | translate}}"/> </div> <div class=form-group> <input ng-show=$ctrl.allowPasswordChange type=button class="form-control btn btn-default" value="{{\'Change password\' | translate}}" ng-click="$ctrl.changingPassword = true"/> </div> </form> <form name=changePasswordForm role=form ng-submit=$ctrl.changePassword() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=$ctrl.changingPassword> <div class=form-group> <input type=password class=form-control name=oldpassword ng-model=$ctrl.oldPwdVal ng-attr-placeholder="{{\'Old password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpassword ng-model=$ctrl.newPwdVal ng-attr-placeholder="{{\'New password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpasswordconfirm ng-model=$ctrl.newPwdConfVal ng-attr-placeholder="{{\'Confirm new password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Change password\' | translate}}"/> </div> <div class=form-group> <input type=button class="form-control btn btn-default" value="{{\'Cancel\' | translate}}" ng-if=!$ctrl.userMustChangeItsPassword ng-click=$ctrl.changePasswordReset() /> <input type=button class="form-control btn btn-default" value="{{\'Logout\' | translate}}" ng-if=$ctrl.userMustChangeItsPassword ng-click=$ctrl.logout() /> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> </div> <div ng-if=!$ctrl.gmfUser.username> <div class="alert alert-warning" ng-show=$ctrl.infoMessage> <span>{{ $ctrl.infoMessage }}</span> </div> <form name=loginForm role=form ng-submit=$ctrl.login() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}"> <div class=form-group> <input type=text class=form-control name=login ng-model=$ctrl.loginVal ng-attr-placeholder="{{\'Username\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=password ng-model=$ctrl.pwdVal ng-attr-placeholder="{{\'Password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Connect\' | translate}}"/> </div> <div ng-show=$ctrl.allowPasswordReset class=form-group> <a ng-click=$ctrl.resetPassword() href="">{{\'Password forgotten?\' | translate}}</a> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.resetPasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password forgotten?\' | translate}} </h4> </div> <div class=modal-body translate> A new password has just been sent to you by e-mail. </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> '},,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);
//# sourceMappingURL=oeview.cdc4f4.js.map