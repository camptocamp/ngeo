(function(t){function e(e){var r=e[0];var s=e[1];var o=e[2];var l,c,u=0,f=[];for(;u<r.length;u++){c=r[u];if(i[c]){f.push(i[c][0])}i[c]=0}for(l in s){if(Object.prototype.hasOwnProperty.call(s,l)){t[l]=s[l]}}if(h)h(e);while(f.length){f.shift()()}n.push.apply(n,o||[]);return a()}function a(){var t;for(var e=0;e<n.length;e++){var a=n[e];var r=true;for(var o=1;o<a.length;o++){var l=a[o];if(i[l]!==0)r=false}if(r){n.splice(e--,1);t=s(s.s=a[0])}}return t}var r={};var i={14:0};var n=[];function s(e){if(r[e]){return r[e].exports}var a=r[e]={i:e,l:false,exports:{}};t[e].call(a.exports,a,a.exports,s);a.l=true;return a.exports}s.m=t;s.c=r;s.d=function(t,e,a){if(!s.o(t,e)){Object.defineProperty(t,e,{configurable:false,enumerable:true,get:a})}};s.r=function(t){Object.defineProperty(t,"__esModule",{value:true})};s.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};s.d(e,"a",e);return e};s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};s.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[];var l=o.push.bind(o);o.push=e;o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var h=l;n.push([428,0]);return a()})({399:function(t,e,a){"use strict";a.r(e);var r=a(551);var i=a(56);var n=a(214);var s=a(122);var o=a(226);var l=a(2);var c=a(191);var h=a(79);var u=a(1);var f=a(3);var p=a(14);var g=a(20);var v=a(36);var d=a(21);var m=a(69);var y=a(34);var _=a(61);var w=a(57);var C=function t(e){y["a"].call(this,{handleEvent:g["b"]});this.changeEventKey_=null;this.type_=e.type;this.minPoints_=e.minPoints?e.minPoints:this.type_==="Polygon"?3:2;this.sketchFeature_=null;this.sketchPoints_=[];this.sketchPoint_=null;this.overlay_=new _["a"]({source:new w["b"]({useSpatialIndex:false,wrapX:e.wrapX?e.wrapX:false}),style:e.style||c["a"].getDefaultDrawStyleFunction(),updateWhileAnimating:true,updateWhileInteracting:true});f["a"](this,"change:active",this.updateState_,this);this.set("dirty",false);this.set("drawing",false);this.set("valid",false)};u["d"](C,y["a"]);C.prototype.setMap=function(t){var e=this.getMap();if(e){if(this.changeEventKey_){f["e"](this.changeEventKey_)}}y["a"].prototype.setMap.call(this,t);if(t){this.changeEventKey_=f["a"](t.getView(),"change:center",this.handleViewCenterChange_,this)}this.updateState_()};C.prototype.getDirty=function(){return this.get("dirty")};C.prototype.getDrawing=function(){return this.get("drawing")};C.prototype.getValid=function(){return this.get("valid")};C.prototype.getFeature=function(){return this.sketchFeature_};C.prototype.addToDrawing=function(){var t=this.getActive();var e=this.getDrawing();if(!t||!e){return}var a=void 0;var r=this.getSketchPointGeometry_();var i=r.getCoordinates();var n=void 0;if(this.type_==="Point"){if(!this.sketchFeature_){this.sketchFeature_=new p["a"](new d["a"](i));var s=new h["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(s)}a=this.sketchFeature_.getGeometry();l["a"].assertInstanceof(a,m["a"]);a.setCoordinates(i);return}if(this.type_==="LineString"){this.sketchPoints_.push(this.sketchPoint_);if(!this.sketchFeature_){n=[i.slice(),i.slice()];this.sketchFeature_=new p["a"](new v["a"](n));var o=new h["a"]("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(o)}else{a=this.sketchFeature_.getGeometry();l["a"].assertInstanceof(a,m["a"]);n=a.getCoordinates();n.push(i.slice());a.setCoordinates(n)}}var c=this.getDirty();if(c){this.set("dirty",false)}var u=this.getValid();if(this.type_==="LineString"){if(n.length>=this.minPoints_){if(!u){this.set("valid",true)}}else{if(u){this.set("valid",false)}}}this.sketchPoint_=null;this.updateSketchFeatures_()};C.prototype.clearDrawing=function(){this.setActive(false);this.setActive(true)};C.prototype.finishDrawing=function(){var t=this.getActive();var e=this.getDrawing();if(!t||!e){return}if(this.sketchPoint_){this.addToDrawing()}this.set("drawing",false);var a=new h["a"]("drawend",{feature:this.sketchFeature_});this.dispatchEvent(a)};C.prototype.startDrawing_=function(){this.set("drawing",true);this.createOrUpdateSketchPoint_();this.updateSketchFeatures_();if(this.type_==="Point"){this.addToDrawing()}};C.prototype.modifyDrawing_=function(){if(!this.sketchFeature_){return}var t=this.getCenter_();if(this.type_==="LineString"){var e=this.sketchFeature_.getGeometry();l["a"].assertInstanceof(e,m["a"]);var a=e.getCoordinates();a.pop();a.push(t);e.setCoordinates(a)}var r=this.getDirty();if(!r){this.set("dirty",true)}};C.prototype.abortDrawing_=function(){var t=this.sketchFeature_;if(t||this.sketchPoints_.length>0){this.sketchFeature_=null;this.sketchPoint_=null;this.overlay_.getSource().clear(true)}this.sketchPoints_=[];this.set("dirty",false);this.set("drawing",false);this.set("valid",false);return t};C.prototype.updateState_=function(){var t=this.getMap();var e=this.getActive();if(!t||!e){this.abortDrawing_()}else{this.startDrawing_()}this.overlay_.setMap(e?t:null)};C.prototype.handleViewCenterChange_=function(t){var e=this.getActive();var a=this.getDrawing();if(!e||!a){return}this.createOrUpdateSketchPoint_();if(this.type_==="Point"){this.addToDrawing()}else{this.modifyDrawing_();this.updateSketchFeatures_()}};C.prototype.createOrUpdateSketchPoint_=function(){var t=this.getCenter_();if(this.sketchPoint_){var e=this.getSketchPointGeometry_();e.setCoordinates(t)}else{this.sketchPoint_=new p["a"](new d["a"](t))}};C.prototype.updateSketchFeatures_=function(){var t=[];if(this.sketchFeature_){t.push(this.sketchFeature_)}if(this.sketchPoint_){t.push(this.sketchPoint_)}var e=this.overlay_.getSource();e.clear(true);e.addFeatures(t);e.addFeatures(this.sketchPoints_)};C.prototype.getSketchPointGeometry_=function(){l["a"].assert(this.sketchPoint_,"sketch point should be thruty");var t=this.sketchPoint_.getGeometry();l["a"].assertInstanceof(t,d["a"]);return t};C.prototype.getCenter_=function(){var t=this.getMap().getView().getCenter();l["a"].assertArray(t);return t};var k=C;var b=a(9);var M=function t(e,a,r){var i=r!==undefined?r:{};b["a"](i,{displayHelpTooltip:false});o["a"].call(this,e,a,i)};u["d"](M,o["a"]);M.prototype.createDrawInteraction=function(t,e){return new k({type:"LineString",style:t,source:e})};var P=M;var D=a(101);var S=a(33);var F=a(124);var A=a(35);var I=a(12);var x=angular.module("gmfMobileMeasureLength",[s["a"].name]);x.value("gmfMobileMeasureLengthTemplateUrl",function(t,e){var a=e["gmfMobileMeasureLengthTemplateurl"];return a!==undefined?a:"gmf/measure/lengthComponent"});x.run(["$templateCache",function(t){t.put("gmf/measure/lengthComponent",a(427))}]);x.component_=function(t){return{restrict:"A",scope:{active:"=gmfMobileMeasurelengthActive",precision:"<?gmfMobileMeasurelengthPrecision",map:"=gmfMobileMeasurelengthMap",sketchStyle:"=?gmfMobileMeasurelengthSketchstyle"},controller:"GmfMobileMeasureLengthController as ctrl",bindToController:true,templateUrl:t,link:function t(e,a,r,i){i.init()}}};x.component_.$inject=["gmfMobileMeasureLengthTemplateUrl"];x.directive("gmfMobileMeasurelength",x.component_);x.Controller_=function(t,e,a){var r=this;this.scope_=t;this.filter_=e;this.gettextCatalog_=a;this.map;this.active;this.scope_.$watch(function(){return r.active},function(t){r.measure.setActive(t)});this.precision;this.sketchStyle=new I["c"]({fill:new S["a"]({color:"rgba(255, 255, 255, 0.2)"}),stroke:new A["a"]({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new F["a"]({stroke:new A["a"]({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})});this.measure;this.drawInteraction;this.dirty=false;this.drawing=false;this.valid=false};x.Controller_.$inject=["$scope","$filter","gettextCatalog"];x.Controller_.prototype.init=function(){this.measure=new P(this.filter_("ngeoUnitPrefix"),this.gettextCatalog_,{precision:this.precision,sketchStyle:this.sketchStyle});this.measure.setActive(this.active);D["a"].interaction(this.measure);this.drawInteraction=this.measure.getDrawInteraction();var t=this.drawInteraction;D["a"].interaction(t);Object.defineProperty(this,"hasPoints",{get:function t(){return this.drawInteraction.getFeature()!==null}});f["a"](t,"change:dirty",function(){this.dirty=t.getDirty();if(this.dirty){this.scope_.$apply()}},this);f["a"](t,"change:drawing",function(){this.drawing=t.getDrawing()},this);f["a"](t,"change:valid",function(){this.valid=t.getValid()},this);this.map.addInteraction(this.measure)};x.Controller_.prototype.addPoint=function(){this.drawInteraction.addToDrawing()};x.Controller_.prototype.clear=function(){this.drawInteraction.clearDrawing()};x.Controller_.prototype.finish=function(){this.drawInteraction.finishDrawing()};x.Controller_.prototype.deactivate=function(){this.active=false};x.controller("GmfMobileMeasureLengthController",x.Controller_);var L=x;var T=a(220);var E=a(105);var $=function t(e,a){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};b["a"](r,{displayHelpTooltip:false});E["a"].call(this,r);this.format_=e;this.coordFormat_=a};u["d"]($,E["a"]);$.prototype.createDrawInteraction=function(t,e){return new k({type:"Point",style:t,source:e})};$.prototype.handleMeasure=function(t){var e=l["a"].assertInstanceof(this.sketchFeature.getGeometry(),d["a"]);var a=this.decimals;var r=E["a"].getFormattedPoint(e,a,this.format_,this.coordFormat_);var i=e.getLastCoordinate();t(r,i)};var j=$;var V=a(159);var G=angular.module("gmfMobileMeasurePoint",[T["a"].module.name,V["a"].name]);G.value("gmfMobileMeasurePointTemplateUrl",function(t,e){var a=e["gmfMobileMeasurePointTemplateurl"];return a!==undefined?a:"gmf/measure/pointComponent"});G.run(["$templateCache",function(t){t.put("gmf/measure/pointComponent",a(426))}]);G.component_=function(t){return{restrict:"A",scope:{active:"=gmfMobileMeasurepointActive",getCoordinateDecimalsFn:"&?gmfMobileMeasurepointCoordinatedecimals",getLayersConfigFn:"&gmfMobileMeasurepointLayersconfig",map:"=gmfMobileMeasurepointMap",sketchStyle:"=?gmfMobileMeasurepointSketchstyle",format:"<gmfMobileMeasurepointFormat"},controller:"GmfMobileMeasurePointController as ctrl",bindToController:true,templateUrl:t,link:function t(e,a,r,i){i.init()}}};G.component_.$inject=["gmfMobileMeasurePointTemplateUrl"];G.directive("gmfMobileMeasurepoint",G.component_);G.Controller_=function(t,e,a,r,i){var n=this;this.gmfRaster_=r;this.ngeoDebounce_=i;this.gettextCatalog_=t;this.$filter_=a;this.map;this.active;e.$watch(function(){return n.active},function(t){n.measure.setActive(t);n.handleMeasureActiveChange_()});var s=this["getCoordinateDecimalsFn"];this.coordinateDecimals=s?s():0;this.layersConfig;this.sketchStyle;if(this.sketchStyle===undefined){this.sketchStyle=new I["c"]({fill:new S["a"]({color:"rgba(255, 255, 255, 0.2)"}),stroke:new A["a"]({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new F["a"]({stroke:new A["a"]({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})})}this.format;this.measure;this.drawInteraction;this.mapViewPropertyChangeEventKey_=null};G.Controller_.$inject=["gettextCatalog","$scope","$filter","gmfRaster","ngeoDebounce"];G.Controller_.prototype.init=function(){this.measure=new j(this.$filter_("ngeoNumberCoordinates"),this.format||"{x}, {y}",{decimals:this.coordinateDecimals,sketchStyle:this.sketchStyle});this.measure.setActive(this.active);D["a"].interaction(this.measure);this.drawInteraction=this.measure.getDrawInteraction();D["a"].interaction(this.drawInteraction);var t=this["getLayersConfigFn"]();l["a"].assert(Array.isArray(t));this.layersConfig=t;this.map.addInteraction(this.measure)};G.Controller_.prototype.deactivate=function(){this.active=false};G.Controller_.prototype.translate=function(t){return this.gettextCatalog_.getString(t)};G.Controller_.prototype.handleMeasureActiveChange_=function(){if(this.measure.getActive()){var t=this.map.getView();this.mapViewPropertyChangeEventKey_=f["a"](t,"propertychange",this.ngeoDebounce_(this.getMeasure_.bind(this),300,true),this);this.getMeasure_()}else if(this.mapViewPropertyChangeEventKey_){f["e"](this.mapViewPropertyChangeEventKey_);this.mapViewPropertyChangeEventKey_=null}};G.Controller_.prototype.getMeasure_=function(){var t=this;var e=this.map.getView().getCenter();l["a"].assertArray(e);var a={layers:this.layersConfig.map(function(t){return t.name}).join(",")};this.gmfRaster_.getRaster(e,a).then(function(e){var a=t.measure.getTooltipElement();var r=document.createElement("div");var i="gmf-mobile-measure-point";r.className=i;for(var n=t.layersConfig,s=Array.isArray(n),o=0,n=s?n:n[Symbol.iterator]();;){var l;if(s){if(o>=n.length)break;l=n[o++]}else{o=n.next();if(o.done)break;l=o.value}var c=l;var h=c.name;if(h in e){var u=e[h];var f=document.createElement("div");f.className="gmf-mobile-measure-point-"+h;var p=c.unit||"";var g=c.decimals&&c.decimals>0||0;u=t.$filter_("number")(u,g);f.innerHTML=[t.translate(h),": ",u," ",p].join("");r.appendChild(f)}}var v=a.getElementsByClassName(i);if(v[0]){v[0].remove()}a.appendChild(r)})};G.controller("GmfMobileMeasurePointController",G.Controller_);G.LayerConfig;var U=G;var O=a(120);var K=a(59);var R=a(37);var N=a(46);var H=a(295);var X=a(31);var J=a(52);var W={};W.module=angular.module("gmfapp",["gettext",i["a"].name,n["a"].module.name,L.name,U.name,O["a"].name]);W.module.value("gmfRasterUrl","https://geomapfish-demo.camptocamp.com/2.3/wsgi/raster");W.module.constant("defaultTheme","Demo");W.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js");W.MainController=function(t){var e=t.getMapCenter()||[537635,152640];var a=t.getMapZoom()||3;this.map=new R["a"]({layers:[new X["a"]({source:new J["a"]})],view:new N["a"]({projection:K["a"],resolutions:[200,100,50,20,10,5,2.5,2,1,.5],center:e,zoom:a})});this.map.addControl(new H["a"]);this.measureLengthActive=false;this.measurePointLayersConfig=[{name:"aster",unit:"m",decimals:2},{name:"srtm",unit:"m"}];this.measurePointActive=false};W.MainController.$inject=["gmfPermalink"];W.module.controller("MainController",W.MainController);var z=e["default"]=W},426:function(t,e){t.exports='<a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},427:function(t,e){t.exports='<a class="btn btn-default" ng-if="ctrl.drawing && (!ctrl.valid)" ng-click=ctrl.addPoint()> <span class="fa fa-check"></span> {{\'Set as starting point\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.dirty ng-click=ctrl.addPoint()> <span class="fa fa-plus"></span> {{\'Add new point\' | translate}} </a> <a class="btn btn-default" ng-if="ctrl.drawing && ctrl.valid && !ctrl.dirty" ng-click=ctrl.finish()> <span class="fa fa-check"></span> {{\'Terminate\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.valid ng-click=ctrl.clear()> <span class="fa fa-repeat"></span> {{\'Clear\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},428:function(t,e,a){a(74);a(73);t.exports=a(399)},551:function(t,e){}});
//# sourceMappingURL=mobilemeasure.b7a54c.js.map